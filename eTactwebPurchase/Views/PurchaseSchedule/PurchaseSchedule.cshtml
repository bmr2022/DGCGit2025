@model eTactWeb.DOM.Models.PurchaseSubScheduleModel

@{
    ViewData["Title"] = "Purchase Schedule";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<style>

    .select2-container--default .select2-selection--single {
        background-color: #e0f2f1;
        border: 1.5px solid #0a0a0a !important;
        border-radius: 4px;
    }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            /* border-bottom: 1.5px solid #000 !important; */
            border-bottom: none !important;
        }

    .select2-container--default .select2-results > .select2-results__options {
        background-color: #e0f2f1; /* Dropdown background color */
        color: #000;
</style>
<div class="card bg-gradient mb-3 border-light shadow-lg">
    <form asp-action="PurchaseSchedule" autocomplete="off" class="form-horizontal">
        <input type="hidden" asp-for="Mode" />
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                <strong>@ViewData["Title"] - @Model.YearCode</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    <a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient saleorderDashBoard">
                        <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                        Dashboard
                    </a>
                    @if (Model.Mode == "U" && Model.Mode != "V")
                    {
                        <div class="col-auto">
                            <a class="Copy btn btn-sm btn-outline-light bg-gradient" asp-action="PurchaseSchedule" asp-route-Mode="C" asp-route-ID="@Model.EntryID" asp-route-YC="@Model.YearCode" style="color:white!important;margin-right:5px;margin-left:5px;">
                                <i class="fa-solid fa-floppy-disk-pen fa-fw fa-lg" style="--fa-secondary-color: white; --fa-secondary-opacity: 1.0;--fa-animation-duration: 2s;"></i>
                                COPY
                            </a>
                        </div>
                    }
                    <partial name="_FormsButton" />
                </span>
            </h5>
        </div>
        <div class="card-body bg-light pt-0">
            <div asp-validation-summary="All" class="text-danger pt-1"></div>
            <div class="accordion shadow-lg">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_Panel1">
                        <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_Panel1" aria-expanded="true" aria-controls="B_Panel1">
                            <i class="fa-brands fa-wpforms fa-lg fa-fw pr35"></i>Required Parameter
                            <small class="p-3"></small>
                        </button>
                    </h2>
                    <div id="B_Panel1" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_Panel1">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3">
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <input type="hidden" asp-for="FinFromDate" value="@Model.FinFromDate" />
                                    <input type="hidden" asp-for="FinToDate" value="@Model.FinToDate" />
                                    <input type="hidden" asp-for="Mode" value="@Model.Mode" />
                                    <label asp-for="EntryID" class="form-label">Entry ID</label>
                                    <input asp-for="EntryID" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="YearCode" class="form-label">Year</label>
                                    <input asp-for="YearCode" class="form-control" value="@Model.YearCode" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryDate" class="form-label">Entry Date</label>
                                    @*<input asp-for="EntryDate"  class="form-control"  />*@
                                    <input type="text" asp-for="EntryDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CC" class="control-label">Branch</label>
                                    <input class="form-control" value="@Model.CC" asp-for="CC" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AccountCode" class="control-label">Vendor Name</label>
                                    <select class="form-select" asp-for="AccountCode" asp-items="@(new SelectList(Model.AccountList,"Value","Text"))">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PONO" class="control-label">PO NO</label>
                                    <select class="form-select" asp-for="PONO">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="POYearCode" class="control-label">PO Year</label>
                                    <select class="form-select" asp-for="POYearCode">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ScheduleNo" class="control-label">Sch No</label>
                                    <input asp-for="ScheduleNo" class="form-control" readonly style="background-color: lightblue !important;" />
                                </div>

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PODate" class="control-label">PO Date</label>
                                    <input type="text" asp-for="PODate" class="form-control" readonly />
                                    @* <input asp-for="PODate"  class="form-control"  />*@
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="POCloseDate" class="control-label">PO Exp.</label>
                                    <input type="text" asp-for="POCloseDate" class="form-control" readonly="readonly" />
                                    @*<input asp-for="POCloseDate"   class="form-control" readonly disabled />*@
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="TentetiveConfirm" class="control-label">Tent Confirm</label>
                                    <select class="form-select" asp-for="TentetiveConfirm" asp-items="@Model.TentetiveConfirmList">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="OrderPriority" class="control-label">Priority</label>
                                    <select class="form-select" asp-for="OrderPriority" asp-items="@Model.OrderPriorityList">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ModeOfTransport" class="control-label">Mode</label>
                                    <input asp-for="ModeOfTransport" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SchAmendmentNo" class="control-label">Sch Amd No</label>
                                    <input asp-for="SchAmendmentNo" class="form-control" />
                                </div>

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ScheduleDate" class="control-label">Sch Date</label>
                                    <input type="text" asp-for="ScheduleDate" class="form-control" readonly />
                                    @*      <input asp-for="ScheduleDate" class="form-control" />*@
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SchEffFromDate" class="startdate">Eff FromDate</label>
                                    <input type="text" asp-for="SchEffFromDate" readonly class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SchEffTillDate" class="startdate">Eff Till Date</label>
                                    <input type="text" asp-for="SchEffTillDate" readonly class="form-control" />
                                    @*<input asp-for="SchEffTillDate"  class="form-control" />*@
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SchAmendmentDate" class="startdate">PS Amend Date</label>
                                    @* <input asp-for="SchAmendmentDate"   class="form-control" />*@
                                    <input type="text" asp-for="SchAmendmentDate" class="form-control" readonly />
                                    @*  <div class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                    </div>*@
                                </div>
                                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="DeliveryAddress" class="control-label">Delivery Address</label>
                                    <input asp-for="DeliveryAddress" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="MRPNO" class="form-label">MRP No</label>
                                    <select class="form-select form-control" asp-for="MRPNO">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="MRPNoYearCode" class="form-label">MRP Year </label>
                                    <input asp-for="MRPNoYearCode" disabled class="form-control" />
                                </div>

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="MRPentryId" class="form-label">MRPEntryId </label>
                                    <input asp-for="MRPentryId" disabled class="form-control" />
                                </div>
                                @if (@Model.Mode == "PSA")
                                {
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="AmmEntryId">Amm EntryID</label>
                                        <input type="text" asp-for="AmmEntryId" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="AmmYearCode">Amm YC</label>
                                        <input type="text" asp-for="AmmYearCode" class="form-control" readonly />
                                    </div>
                                    <div class="col-auto">
                                        <button type="button" class="EXPORT btn btn-sm btn-outline-success" id="sendToExcel">
                                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> EXPORT
                                        </button>
                                    </div>
                                    <div class="col-auto mt-3">
                                        <input class="form-control" type="file" id="ExcelFile" />
                                    </div>
                                    <div class="col-auto">
                                        <button type="button" class="Importbtn btn btn-sm btn-outline-success" onclick="UploadExcel()">
                                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> Import From Excel
                                        </button>
                                    </div>

                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_Panel2">
                        <button class="accordion-button text-light pnl4BG bg-gradient collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#B_Panel2" aria-expanded="false" aria-controls="B_Panel2">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-hourglass-clock fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Purchase Schdule Grid</strong>
                            <small class="p-3"></small>
                        </button>
                    </h2>
                    <div id="B_Panel2" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_Panel2">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3">
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PartCode" class="form-label">Part Code</label>
                                    <select class="form-select" asp-for="PartCode">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="ItemCode" class="form-label">Item Name</label>
                                    <select class="form-select" asp-for="ItemCode">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Unit" class="form-label">Unit</label>
                                    <input asp-for="Unit" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SchQty" class="form-label">Sch Qty</label>
                                    <input asp-for="SchQty" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PendQty" class="form-label">Pend Qty</label>
                                    <input asp-for="PendQty" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AltUnit" class="form-label">Alt Unit</label>
                                    <input asp-for="AltUnit" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AltSchQty" class="form-label">Alt Sch Qty</label>
                                    <input asp-for="AltSchQty" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AltPendQty" class="form-label">Alt Pend Qty</label>
                                    <input asp-for="AltPendQty" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="DeliveryDate" class="form-label">Delivery Date</label>
                                    <input type="text" class="form-control" asp-for="DeliveryDate" name="DeliveryDate" readonly />
                                    @*<input asp-for="DeliveryDate" class="form-control" />*@
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Rate" class="form-label">Rate</label>
                                    <input asp-for="Rate" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="RateInOthCurr" class="form-label">Rate In Oth Curr.</label>
                                    <input asp-for="RateInOthCurr" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ItemSize" class="form-label">Item Size</label>
                                    <select class="form-select" asp-for="ItemSize">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ItemColor" class="form-label">Item Color</label>
                                    <select class="form-select" asp-for="ItemColor">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="OtherDetail" class="form-label">Other Detail</label>
                                    <input asp-for="OtherDetail" class="form-control" />
                                </div>
                                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:100px;">
                                    <label asp-for="Remarks" class="form-label">Remarks</label>
                                    <input asp-for="Remarks" class="form-control" />
                                    <input type="hidden" asp-for="Approved" class="form-control" />
                                    <input type="hidden" asp-for="ApprovedDate" class="form-control" />
                                    <input type="hidden" asp-for="Approvedby" class="form-control" />
                                    <input type="hidden" asp-for="AmmApproved" class="form-control" />
                                    <input type="hidden" asp-for="AmmApprovedDate" class="form-control" />
                                    <input type="hidden" asp-for="AmmApprovedby" class="form-control" />
                                </div>
                                <div class="col-md-2 me-3" style="margin-top:30px;">
                                    <input type="text" class="form-control" id="search-box" style="background-color:#FFFACD" placeholder="Search...">
                                </div>
                                @*<div class="col-lg-4 col-md-3 col-sm-3 text-center BtnExcel">
                                <input type="file" asp-for="ExcelFile" class="BtnUploadExl btn btn-sm btn-outline-success mt-2">
                                </div>*@
                                <div class="col-lg-2 col-md-3 col-sm-3 text-center ItemBtn">
                                    <button class="addItemBtn btn btn-sm btn-outline-danger mt-3">
                                        <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                    </button>
                                </div>
                                <div class="col-lg-2 col-md-3 col-sm-3 text-center" style="width:200px;">
                                    <button class="btn btn-sm btn-outline-success me-3" style="padding:3px;height:30px;width:70px;margin-left:20px;margin-top:15px;" type="button" id="SendToExportExcel">
                                        <i class="fa-solid fa-upload fa-fw fa-lg "></i>
                                    </button>
                                </div>
                            </div>
                            <div class="progress my-2 mb-3 mt-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-danger progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="card">
                                <div class="card-body overflow-auto pb-0">
                                    <table class="table table-hover table-bordered table-striped" id="PurchaseScheduleTbl">
                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                            <tr>
                                                <th>Action</th>
                                                <th>Sr#</th>
                                                <th>Item Code</th>
                                                <th>Item Name</th>
                                                <th>Unit</th>
                                                <th>Sch Qty</th>
                                                <th>Pend Qty</th>
                                                <th>Alt Qty</th>
                                                <th>Alt Sch Qty</th>
                                                <th>Alt Pent Qty</th>
                                                <th>Rate</th>
                                                <th>Rate In Other Curr</th>
                                                <th>Delivery Date</th>
                                                <th>Item Size</th>
                                                <th>Item Color</th>
                                                <th>Other Detail</th>
                                                <th>Remarks</th>
                                            </tr>
                                        </thead>
                                        <tbody id="divPurchaseScheduleGrid">
                                            <partial name="_PurchaseScheduleGrid" />
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="HPanel2">
                        <button class="accordion-button collapsed text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#ODGrid" aria-expanded="false" aria-controls="ODGrid">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
                        </button>
                    </h2>
                    <div id="ODGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3" id="_ItemGrid">
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="EntryByMachineName" class="form-label">Machine Name</label>
                                    <input asp-for="EntryByMachineName" value="@Environment.MachineName" readonly class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CreatedBy" class="form-label">Created By</label>
                                    <input type="hidden" asp-for="CreatedBy" class="form-control" readonly />
                                    <input asp-for="CreatedByName" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CreatedOn" class="form-label">Created Date</label>
                                    <input asp-for="CreatedOn" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="UpdatedBy" class="form-label">Updated By</label>
                                    <input type="hidden" asp-for="UpdatedBy" class="form-control" readonly />
                                    <input asp-for="UpdatedByName" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="UpdatedOn" class="form-label">Updated Date</label>
                                    <input asp-for="UpdatedOn" class="form-control" readonly />
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer p-3">
            <div class="card-header card-headerBG text-light bg-gradient">
                <h5>
                    <strong>@ViewData["Title"] - @Model.YearCode</strong>
                    <span class="d-flex float-end" style="margin-top:-2px;">
                        <a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient saleorderDashBoard">
                            <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                            Dashboard
                        </a>
                        @if (Model.Mode == "U" && Model.Mode != "V")
                        {
                            <div class="col-auto">
                                <a class="Copy btn btn-sm btn-outline-light bg-gradient" asp-action="PurchaseSchedule" asp-route-Mode="C" asp-route-ID="@Model.EntryID" asp-route-YC="@Model.YearCode" style="color:white!important;margin-right:5px;margin-left:5px;">
                                    <i class="fa-solid fa-floppy-disk-pen fa-fw fa-lg" style="--fa-secondary-color: white; --fa-secondary-opacity: 1.0;--fa-animation-duration: 2s;"></i>
                                    COPY
                                </a>
                            </div>
                        }
                        <partial name="_FormsButton" />
                    </span>
                </h5>
            </div>
        </div>
    </form>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script type="text/javascript" src='https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js'></script>
<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js'></script>

<!-- Bootstrap -->
<!-- Bootstrap DatePicker -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.css" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.js" type="text/javascript"></script>
<!-- Bootstrap DatePicker -->
@*<script type="text/javascript">
    $('input[type=datetime]').datepicker({
        dateFormat: "dd/mm/yy",
        changeMonth: true,
        changeYear: true,
    });
</script>*@
@section Scripts
{
    <script>
        $(function () {
            if ($('#Mode').val() != "U" && $('#Mode').val() != "PSA" && $('#Mode').val() != "PSU") {
                FillEntry();
            }
            if ($('#Mode').val() == "U" || $('#Mode').val() == "C" || $('#Mode').val() == "V" || $('#Mode').val() == "PSA" || $('#Mode').val() == "PSU") {
                /* //GetPOandYC(); */
                $('#PONO').append("<option selected value='@Model.PONO'>@Model.PONO</option>");
                $('#POYearCode').append("<option selected value='@Model.POYearCode'>@Model.POYearCode</option>");
                GetPOItem(parseInt($('#AccountCode').val()), $('#PONO').val(), parseInt($('#POYearCode').val()));
            }
            if ($('#Mode').val() == "PSA" || $('#Mode').val() == "PSU") {
                GetAmendEntry();
                $('#AccountCode,#PONO,#POYearCode,#SchAmendmentNo').prop("disabled", true);
            }
            /* //if ('@Model.Mode' != '' && parseInt('@Model.ID') != 0) {
            //    $.ajax({
            //        url: "@Url.Action("GetPONO")",
            //        data: { AccountCode: @Model.AccountCode },
            //        success: function (result, status, xhr) {
            //            if (result != null) {
            //                var obj = $.parseJSON(result);
            //                if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
            //                    $('#PONO').empty();
            //                    $('#PONO').append('<option>-Select-</option>');
            //                    $.each(obj.Result, function (key, val) {
            //                        $('#PONO').append('<option value="' + val.PONO + '">' + val.PONO + '</option>');
            //                    });
            //                }
            //            }
            //        },
            //    }).done(function () {
            //        $('#PONO').val('@Model.PONO');
            //        $.ajax({
            //            url: "@Url.Action("GetPOYear")",
            //            data: { AccountCode: parseInt($('#AccountCode').val()), PONO: $('#PONO').val() },
            //            success: function (result, status, xhr) {
            //                if (result != null) {
            //                    var obj = $.parseJSON(result);
            //                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
            //                        $('#POYearCode').empty();
            //                        $('#POYearCode').append('<option>-Select-</option>');
            //                        $.each(obj.Result, function (key, val) {
            //                            $('#POYearCode').append('<option value="' + val.YearCode + '">' + val.YearCode + '</option>');
            //                        });
            //                    }
            //                }
            //            },
            //        }).done(function () {
            //            $('#POYearCode').val('@Model.POYearCode');
            //            $.ajax({
            //                url: "@Url.Action("GetPODATA")",
            //                data: { AccountCode: parseInt($('#AccountCode').val()), PONO: ($('#PONO').val()), Year: $('#POYearCode').val() },
            //                success: function (result, status, xhr) {
            //                    if (result != null) {
            //                        var obj = $.parseJSON(result);
            //                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
            //                            GetPOItem(parseInt($('#AccountCode').val()), $('#PONO').val(), $('#POYearCode').val());
            //                        }
            //                    }
            //                },
            //            });
            //        });
            //    });
            //} */
        });

        function FillEntry() {
            $.ajax({
                type: "GET",
                url: "@Url.Action("FillEntry")",
                dataType: "json",
                data: { "YearCode": $('#YearCode').val() },
                success: function (result, status, error) {
                    /*   //console.log(result); */
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#EntryID').val(obj.Result.Table[0].EntryId);
                        $('#ScheduleNo').val(obj.Result.Table[0].SchNo);
                    }
                }
            });
        }

        function GetAmendEntry() {
            $.ajax({
                type: "GET",
                url: "@Url.Action("FillAmendEntry")",
                dataType: "json",
                data: { "YearCode": $('#AmmYearCode').val() },
                success: function (result, status, error) {
                    /*   //console.log(result); */
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#AmmEntryId').val(obj.Result.Table[0].EntryId);
                    }
                }
            });
        }


        function FillMRPNo() {

            /*  ; */
            $.ajax({
                url: '@Url.Action("FillMRPNo", "PurchaseSchedule")',
                type: 'POST',
                async: false,

                success: function (response, status, error) {

                    var MRPNoDropdown = $('#MRPNO');
                    var obj = $.parseJSON(response);
                    MRPNoDropdown.empty();
                    MRPNoDropdown.append('<option value="">--Select--</option>');
                    $.each(obj.Result, function (index, mrpno) {
                        MRPNoDropdown.append('<option value="' + mrpno.MRPNo + '">' + mrpno.MRPNo + '</option>');
                    });

                    if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                        var MRPNo = '@Model.MRPNO';
                        $('#MRPNO').val(MRPNo).trigger("change");
                        $('#MRPNO').val(MRPNo);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function FillMRPDetail() {

            var MRPNo = $("#MRPNO").val();
            $.ajax({
                url: '@Url.Action("FillMRPDetail", "PurchaseSchedule")',
                type: 'GET',
                data: {
                    MRPNo: MRPNo,

                },
                success: function (data) {


                    /*    // Parse JSON if response is a string */
                    if (typeof data === "string") {
                        try {
                            data = JSON.parse(data);
                        } catch (error) {

                            return;
                        }
                    }

                    /*  // Extract the first result from the array */
                    if (data && data.Result && data.Result.length > 0) {
                        var Year = data.Result[0];
                        var EntryId = data.Result[0];
                        $("#MRPNoYearCode").prop("disabled", false).val(Year.YearCode).trigger("input");
                        $("#MRPentryId").prop("disabled", false).val(EntryId.EntryId).trigger("input");


                    } else {

                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching employee details:", xhr.responseText || error);

                }
            });
        }


        function LockedFinancialYear() {
            $.ajax({
                type: "GET",
                url: "@Url.Action("CheckLockYear")",
                dataType: "json",
                data: { "YearCode": $('#YearCode').val() },
                success: function (result, status, error) {
                    console.log(result);
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.Result.Table[0] != undefined) {
                            if (obj.Result.Table[0].ClosedForAllusers == 'Y') {
                                $('#submitBTN').prop("disabled", true);
                                $('.card-footer #submitBTN').prop("disabled", true);
                            }
                        }
                    }
                }
            });
        }

        $('#DeliveryDate').change(function () {
            $('#ItemSize').focus();
        });

        $(document).ready(function () {

            $('#AccountCode').select2();
            GetFormRights();
            LockedFinancialYear();
            /*   //            $( "#datepicker" ).datepicker({
              //  dateFormat: "MM d, yy"
              //}); */

            if ($('#Mode').val() != "U" && $('#Mode').val() != "PSA" && $('#Mode').val() != "PSU" && $('#Mode').val() != "C") {
                /*    //Setting entry date to current date */
                $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

                /*   //Setting other dates to current date */
                $('#ScheduleDate,#PODate,#SchEffFromDate,#SchEffTillDate,#DeliveryDate,#SchAmendmentDate,#EntryDate')
                    .datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

                /*   //setting no backDate rule */
                $('#ScheduleDate,#PODate,#SchEffFromDate,#SchAmendmentDate,#EntryDate')
                    .datepicker("option", "minDate", 'now');

                //adding one month to schEffTOdate
                var currentDate = new Date();
                var addOneMonth = new Date();
                var schEffFromDate = $('#SchEffFromDate').datepicker('getDate');
                addOneMonth.setMonth(currentDate.getMonth() + 1);
                $('#SchEffTillDate').datepicker("setDate", addOneMonth);
                $('#SchEffTillDate').datepicker("option", "minDate", schEffFromDate);

                /*  //setting deliveryDtae in between schefffromdate to scheffTilldate */
                var effFromDate = $('#SchEffFromDate').datepicker('getDate');
                var effToDate = $('#SchEffTillDate').datepicker('getDate');
                $('#DeliveryDate').datepicker("option", "minDate", $('#SchEffFromDate').val());
                $('#DeliveryDate').datepicker("option", "maxDate", $('#SchEffTillDate').val());

                FillEntryDate();

            }
            else if ($('#Mode').val() == "PSA" || $('#Mode').val() == "PSU") {
                debugger
                $('#ScheduleDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#ScheduleDate').val()));
                $('#SchEffFromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#SchEffFromDate').val()));
                $('#SchEffTillDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#SchEffTillDate').val()));
                $('#SchAmendmentDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#SchAmendmentDate').val()));
                debugger
                $('#SchEffFromDate,#SchEffTillDate').datepicker("option", "minDate", parseDateToFormat($('#FinFromDate').val()));
                $('#SchEffFromDate,#SchEffTillDate').datepicker("option", "maxDate", parseDateToFormat($('#FinToDate').val()));
                $('#SchAmendmentDate').datepicker("option", "minDate", parseDateToFormat($('#SchEffFromDate').val()));
                $('#SchAmendmentDate').datepicker("option", "maxDate", parseDateToFormat($('#SchEffTillDate').val()));
                $('#DeliveryDate')
                    .datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

                var effFromDate = $('#SchEffFromDate').datepicker('getDate');
                var effToDate = $('#SchEffTillDate').datepicker('getDate');
                $('#DeliveryDate').datepicker("option", "minDate", effFromDate);
                $('#DeliveryDate').datepicker("option", "maxDate", effToDate);
            }
            else {

                var poDate = $('#PODate').val().split(" ")[0];
                var poCloseDate = $('#POCloseDate').val().split(" ")[0];
                var SchAmendmentDate = $('#SchAmendmentDate').val().split(" ")[0];
                var ScheduleDate = $('#ScheduleDate').val().split(" ")[0];
                var SchEffFromDate = $('#SchEffFromDate').val().split(" ")[0];
                var SchEffTillDate = $('#SchEffTillDate').val().split(" ")[0];
                updateDates(poDate, 'PODate');
                updateDates(poCloseDate, 'POCloseDate');
                updateDates(SchAmendmentDate, 'SchAmendmentDate');
                updateDates(ScheduleDate, 'ScheduleDate');
                updateDates(SchEffFromDate, 'SchEffFromDate');
                updateDates(SchEffTillDate, 'SchEffTillDate');

                /*    //setting no backDate rule */
                $('#ScheduleDate,#SchEffFromDate,#SchAmendmentDate,#EntryDate')
                    .datepicker("option", "minDate", 'now');
                $('#DeliveryDate')
                    .datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                /*    //adding one month to schEffTOdate */
                var currentDate = new Date();
                var addOneMonth = new Date();
                var schEffFromDate = $('#SchEffFromDate').datepicker('getDate');
                addOneMonth.setMonth(currentDate.getMonth() + 1);
                /*     //$('#SchEffTillDate').datepicker("setDate", addOneMonth); */
                $('#SchEffTillDate').datepicker("option", "minDate", schEffFromDate);

                /*      //setting deliveryDtae in between schefffromdate to scheffTilldate */
                var effFromDate = $('#SchEffFromDate').datepicker('getDate');
                var effToDate = $('#SchEffTillDate').datepicker('getDate');
                $('#DeliveryDate').datepicker("option", "minDate", effFromDate);
                $('#DeliveryDate').datepicker("option", "maxDate", effToDate);

                $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#EntryDate').val()));

            }
            FillMRPNo();
            $("#MRPNO").on("change", function () {
                FillMRPDetail();

            });


            /*  //$('#ScheduleDate').on("change", function () {
             //     $('#SchEffFromDate').val('').datepicker("option", { "minDate": $('#ScheduleDate').val() });
             //  });

             //$('#SchEffFromDate').on("change", function () {
             //     var ll = $(this).val();
             //    var bb = $('#SchEffFromDate').val();
             //    var date = new Date(bb);
             //    date.setDate(date.getDate() + (+30));
             //    var dd = String(new Date().getDate()).padStart(2, '0');
             //    var formattedNextMonth = date.getMonth() + 1;
             //    const mm = formattedNextMonth > 9 ? formattedNextMonth.toString() : '0' + formattedNextMonth.toString();
             //    var mm1 = date.toLocaleString('en-US', { month: '2-digit' });
             //    var y = date.getFullYear();
             //    var someFormattedDate = dd + '/' + mm + '/' + y;
             //    var someFormattedDate1 = dd + '/' + mm1 + '/' + y;
             //    $('#SchEffTillDate').val(someFormattedDate);
             //    $('#SchEffFromDate').val(someFormattedDate1);
             //    $('#DeliveryDate').val(someFormattedDate1);
             //    $('#ScheduleDate').val(someFormattedDate1);
             //    ClearGrid();
             //});

             //$('#SchEffTillDate').on("change", function () {
             //    $('#DeliveryDate').val('').datepicker("option", { "maxDate": $(this).val() });
             //    ClearGrid();
             //}); */

            $('.hasDatepicker').datepicker("option", "showAnim", "clip");

            $('#PartCode').prop('selectedIndex') != 0 ? $('.ItemBtn').fadeIn() : $('.ItemBtn').fadeOut();
            /* $('#PartCode').prop('selectedIndex') != 0 ? $('.ItemBtn').fadeIn() : $('.ItemBtn').fadeOut(); */
            $('.BtnExcel').fadeOut();

            /* $('#SchEffFromDate').change(); */
        });

        $('#sendToExcel').click(function () {


            let table = $("#PurchaseScheduleTbl");
            console.log(table);
            ;
            TableToExcel.convert(table[0], {
                name: `PurchaseScheduleTableAmm.xlsx`,
                sheet: {
                    name: 'PurchaseScheduleTableAmm'
                }
            });
        });

        $('#SchQty').on('input', function () {
            let value = $(this).val();
            value = value.replace(/[^\d.]/g, '');
            if (value.split('.').length > 2) {
                value = value.replace(/\.+$/, '');
            }
            $(this).val(value);
        });

        function UploadExcel() {
            var fileInput = $('#ExcelFile');


            var formData = new FormData();
            /*  //formData.append("excelFile", file); */
            formData.append("excelFile", fileInput.prop("files")[0]);
            formData.append("PoNo", $('#PONO').val());
            formData.append("POYearcode", $('#POYearCode').val());
            formData.append("AccountCode", $('#AccountCode').val());
            formData.append("SchNo", "");
            formData.append("SchYearCode", 0);
            formData.append("Flag", "PURCHASEORDER");

            var Err = 0;

            if ($('#ExcelFile').val() == '') {
                AddErrorCls('ExcelFile');
                Err = 1;
                return;
            }
            else {
                RemoveErrorCls('ExcelFile');
            }

            $.ajax({
                url: "@Url.Action("UploadPurchaseSchedule")",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (result) {
                    if (result == "Duplicate") {
                        $.notify("Duplicate Item Not allowed", "error");
                    }
                    else if (result == "Not Done") {
                        $.notify("Pend Qty cannot be less than 0!Please Try again!", "error");
                    }
                    else if (result == "Partcode not available") {
                        $.notify("Imported Partcode is not available, Please check!!!", "error");
                    } else {
                        $('#divPurchaseScheduleGrid').empty();
                        $('#divPurchaseScheduleGrid').html(result);
                    }

                }
            });
        }


        /*   //$("#EntryDate").on('onkeydown', function (e) { e.preventDefault(); var key = event.keyCode || event.charCode; if (key == 8) { return false } else { return false; } });
          //by sumu */
        AutoComplete('SaleScheduleMain', 'ModeOfTransport', 'ModeOfTransport', null);
        /* //by sumu
        //$('#ScheduleDate,#SchEffTillDate,#SchEffFromDate,#SchAmendmentDate,#DeliveryDate').on('keydown', function (e) {
        //    e.preventDefault();
        //    return false;
        //}); */

        $('#SchAmendmentDate').change(function () {
            ClearGrid();
        });


        $('.BtnUploadExl').click(function () {
            $(this).val() != null ? $(this).val('') : null;
        });
        /*  // upload in excel start here */
        $('.BtnUploadExl').change(function () {
            var fileExtension = ['xls', 'xlsx'];
            var filename = $('.BtnUploadExl').val();
            if (filename.length == 0) {
                $.notify('Please select Excel File...!', "error");
                return false;
            }
            else {
                var extension = filename.replace(/^.*\./, '');
                if ($.inArray(extension, fileExtension) == -1) {
                    $.notify('Please select only Excel File...!', "info");
                    return false;
                }
            }

            var fData = new FormData();

            var fileUpload = $(".BtnUploadExl").get(0);
            var files = fileUpload.files;
            var AC = parseInt($('#AccountCode').val());
            var PONO = ($('#PONO').val());
            var Year = $('#POYearCode').val();

            fData.append(files[0].name, files[0]);
            fData.append('AC', AC);
            fData.append('PONO', PONO);
            fData.append('Year', Year);
            fData.append('FromDate', $('#SchEffFromDate').val());
            fData.append('TillDate', $('#SchEffTillDate').val());

            $.ajax({
                type: "POST",
                url: "@Url.Action("UploadExcel")",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN", $('input:hidden[name="__RequestVerificationToken"]').val());
                },
                data: fData,
                contentType: false,
                processData: false,
                success: function (result, status, xhr) {
                    if (xhr.status == 207) {
                        var ErrMsg = "";
                        $.each(result, function (key, val) {
                            ErrMsg += val + '\n';
                        });
                        $.notify(ErrMsg, { position: 'top center', className: 'error', clickToHide: true, autoHide: false });
                    }
                    else {
                        $('#divPurchaseScheduleGrid').html(result.trim());
                    }
                },
                error: function (result, status, xhr) {
                    $.notify('Please select only Excel File...!', "info");
                }
            });
        });

        $('#ScheduleDate').change(function () {
            ClearGrid();
            var schDate = $(this).datepicker('getDate');
            $('#SchEffFromDate').datepicker("option", "minDate", schDate);
            $('#DeliveryDate').datepicker("option", "minDate", schDate);
            var schEffDate = $(this).datepicker('getDate');
            $('#SchEffTillDate').datepicker("option", "minDate", schEffDate);

        });

        $('#SchEffFromDate').change(function () {
            ClearGrid();
            debugger
            var effFromDate = $('#SchEffFromDate').datepicker('getDate');
            $('#DeliveryDate').datepicker("option", "minDate", effFromDate);
            $('#SchEffTillDate').datepicker("option", "minDate", effFromDate);
            $('#SchAmendmentDate').datepicker("option", "minDate", parseDateToFormat($('#SchEffFromDate').val()));
        });

        $('#SchEffTillDate').change(function () {
            ClearGrid();
            debugger
            var effToDate = $('#SchEffTillDate').datepicker('getDate');
            $('#DeliveryDate').datepicker("option", "maxDate", effToDate);
            /*     //$('#SchEffTillDate').datepicker("option","minDate",effFromDate); */
            $('#SchAmendmentDate').datepicker("option", "maxDate", parseDateToFormat($('#SchEffTillDate').val()));
        });

        function updateDates(dateString, ID) {
            /*   //const dateString = '04/Aug/2023'; */
            const dateObject = new Date(dateString);

            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const convertedDate = dateObject.toLocaleDateString('en-GB', options);

            $('#' + ID).datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", convertedDate);

        }

        $('button[type="submit"]').click(function (e) {
            e.preventDefault();
            var rowCount = $('#divPurchaseScheduleGrid tr td').length;
            if (rowCount > 1) {
                $('form').submit();
            }
            else {
                $.notify("Grid should atleast have one item", "error");
                return;
            }
        });

        $('#AccountCode').change(function () {
            $.ajax({
                url: "@Url.Action("GetAddress")",
                type: "POST",
                data: { AccountCode: $('#AccountCode').val() },
                success: function (data) {
                    ;
                    if (data != null) {
                        var obj = $.parseJSON(data);
                        $('#DeliveryAddress').val(obj.Result.Table[0].ComAddress);
                    }
                    console.log(1);
                },
                error: function (errMsg) {
                    $.notify(errMsg, { position: "top center", className: "error" });
                }
            });
            /*  //$.getJSON
             //    ({
             //        url: "@Url.Action("GetPONO")",
             //        data: { AccountCode: $(this).val() },
             //        success: function (result, status, xhr) {
             //            if (result != null) {
             //                var obj = $.parseJSON(result);
             //                if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
             //                    $('#PONO').empty();
             //                    $('#PONO').append('<option>-Select-</option>');
             //                    $.each(obj.Result, function (key, val) {
             //                        $('#PONO').append('<option value="' + val.PONO + '">' + val.PONO + '</option>');

             //                    });
             //                }
             //                else if (obj.StatusCode == 500 && obj.StatusText == 'Error') {
             //                    $('#PONO').empty();
             //                    $('#PONO').append('<option>-Select-</option>');
             //                }

             //                $('#POYearCode').empty();
             //                $('#POYearCode').append('<option>-Select-</option>');
             //                // $('#POYearCode').change();

             //                $('#PODATE,#DeliveryAddress').val('');
             //                $('#ScheduleDate,#SchEffFromDate,#SchEffTillDate').prop('disabled', true);

             //                ClearGrid();
             //            }
             //        },
             //        error: function (result, status, xhr) {
             //            $.notify(result.responseText, "error");
             //        }
             //    }); */
            GetPOandYC();
        });
        function GetPOandYC() {
            $.getJSON
                ({
                    url: "@Url.Action("GetPONO")",
                    data: { AccountCode: $('#AccountCode').val() },
                    success: function (result, status, xhr) {
                        if (result != null) {
                            var obj = $.parseJSON(result);
                            if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                                $('#PONO').empty();
                                $('#PONO').append('<option>-Select-</option>');
                                $.each(obj.Result, function (key, val) {
                                    $('#PONO').append('<option value="' + val.PONO + '">' + val.PONO + '</option>');

                                });
                            }
                            else if (obj.StatusCode == 500 && obj.StatusText == 'Error') {
                                $('#PONO').empty();
                                $('#PONO').append('<option>-Select-</option>');
                            }

                            $('#POYearCode').empty();
                            $('#POYearCode').append('<option>-Select-</option>');
                            /*  // $('#POYearCode').change(); */

                            $('#PODATE,#DeliveryAddress').val('');
                            $('#ScheduleDate,#SchEffFromDate,#SchEffTillDate').prop('disabled', true);

                            ClearGrid();
                        }
                    },
                    error: function (result, status, xhr) {
                        $.notify(result.responseText, "error");
                    }
                });
        }

        function GetFormRights() {
            $.ajax({
                url: "@Url.Action("GetFormRights")",
                type: "POST",
                success: function (data) {
                    if (data != null) {
                        var obj = $.parseJSON(data);
                        if (obj.Result.Table.length == 0) {
                            $("button[type='submit']").prop("disabled", true);

                        } else {
                            console.log(obj);
                            var optAll = obj.Result.Table[0].OptAll;
                            var optSave = obj.Result.Table[0].OptSave;
                            var optUpdate = obj.Result.Table[0].OptUpdate;
                            var optDelete = obj.Result.Table[0].OptDelete;
                            var optView = obj.Result.Table[0].OptView;
                            if (!optAll) {
                                if (!optSave) {
                                    $("button[type='submit']").prop("disabled", true);
                                }
                                if (!(optUpdate || optDelete || optView)) {
                                    $(".saleorderDashBoard")
                                        .addClass("disabled-link")
                                        .on("click", function (e) {
                                            e.preventDefault(); // Prevents clicking the link
                                        });
                                }
                            }

                        }
                    }
                },
                error: function (errMsg) {
                    $.notify(errMsg, { position: "top center", className: "error" });
                }
            });
        }

        function FillEntryDate() {
            debugger
            var finFromDate = $('#FinFromDate').val();
            var finToDate = $('#FinToDate').val();
            debugger
            var dateParts1 = finFromDate.split("/");
            var monthNames = {
                "Jan": "01",
                "Feb": "02",
                "Mar": "03",
                "Apr": "04",
                "May": "05",
                "Jun": "06",
                "Jul": "07",
                "Aug": "08",
                "Sep": "09",
                "Oct": "10",
                "Nov": "11",
                "Dec": "12"
            };

            var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
            var dateParts2 = finToDate.split("/");

            var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];

            console.log(formattedDate1);
            console.log(formattedDate2);
            $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

            $('#EntryDate').datepicker("option", "minDate", parseDateToFormat(formattedDate1));
            $('#EntryDate').datepicker("option", "maxDate", parseDateToFormat(formattedDate2));

        }

        /* //PO No chage */
        $('#PONO').change(function () {
            $.getJSON({
                url: "@Url.Action("GetPOYear")",

                data: { AccountCode: parseInt($('#AccountCode').val()), PONO: $('#PONO').val() },
                success: function (result, status, xhr) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#POYearCode').empty();
                            $('#POYearCode').append('<option>-Select-</option>');
                            $.each(obj.Result, function (key, val) {
                                $('#POYearCode').append('<option value="' + val.YearCode + '">' + val.YearCode + '</option>');
                            });
                        }
                        else if (obj.StatusCode == 500 && obj.StatusText == 'Error') {
                            $('#POYearCode').empty();
                            $('#POYearCode').append('<option>-Select-</option>');
                            $('#POYearCode').change();
                        }
                    }
                    ClearGrid();
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                }
            });
        });

        $(".startdate").datepicker({
            dateFormat: 'dd/mm/yy',//check change
            changeMonth: true,
            changeYear: true
        });

        function formatJSONDate(jsonDate) {
            var newDate = new Date(jsonDate);
            var day = newDate.getDate();
            var month = newDate.getUTCMonth() + 1;
            var year = newDate.getFullYear();

            /*  // Remove leading zero for day and month if greater than 10 */
            var formattedDay = (day < 10) ? "0" + day : day.toString();
            var formattedMonth = (month < 10) ? "0" + month : month.toString();

            var finaldate = formattedDay + "/" + formattedMonth + "/" + year;
            return finaldate;
        }

        function formatDate(d) {
            /*  //var newDate = new Date(jsonDate); */
            var newDate = new Date(d);
            var day = newDate.getDate();
            var month = newDate.getUTCMonth();
            /*  //  alert(month); */
            var year = newDate.getFullYear();
            finaldate = new Date(year, month, day);
            return finaldate;
        }

        function formatcurrDate(d1) {
            /*   //var newDate = new Date(jsonDate);
              //   var newDate = new Date(d); */
            var day = d1.getDate();
            var month = d1.getUTCMonth();
            /*   //  alert(month); */
            var year = d1.getFullYear();
            finaldate = new Date(year, month, day);
            return finaldate;
        }

        function convertDate(date) {
            var yyyy = date.getFullYear().toString();
            var mm = (date.getMonth() + 1).toString();
            var dd = date.getDate().toString();

            var mmChars = mm.split('');
            var ddChars = dd.split('');

            return yyyy + '/' + (mmChars[1] ? mm : "0" + mmChars[0]) + '/' + (ddChars[1] ? dd : "0" + ddChars[0]);
        }
        /*    // PO Year chage */
        $('#POYearCode').change(function () {
            $.getJSON({
                url: "@Url.Action("GetPODATA")",
                data: { AccountCode: parseInt($('#AccountCode').val()), PONO: $('#PONO').val(), Year: $(this).val() },
                success: function (result, status, xhr) {
                    if (result != null) {
                        /*     //var obj = $.parseJSON(result); */
                        var obj = jQuery.parseJSON(result);
                        /*      // alert(new Date()); //working wala alert */
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {

                            $("#PODate").val(formatJSONDate(obj.Result[0].PODate));
                            $('#POCloseDate').val(formatJSONDate(obj.Result[0].POCLOSEDATE));
                            $('#DeliveryAddress').val(obj.Result[0].DeliveryAddress);
                            /*   //$('#SchEffFromDate').datepicker({ dateFormat: "'dd-mm-y'" }).datepicker("setDate", new Date());   // nusrat
                              //$('#SchEffFromDate').datepicker({ dateFormat: "'dd/mm/yy'" }).datepicker("setDate", new Date());
                              ////alert ("1")
                              //$('#SchAmendmentDate').datepicker({ dateFormat: "dd/mm/yy'" }).datepicker("setDate", new Date());
                              //$('#ScheduleDate').datepicker({ dateFormat: "dd/mm/yy'" }).datepicker("setDate", new Date());
                              //$('#DeliveryDate').datepicker({ dateFormat: "dd/mm/yy'" }).datepicker("setDate", new Date()); */
                            $('#ScheduleDate,#SchEffFromDate,#SchEffTillDate').prop('disabled', false);

                            /*    //$("#ScheduleDate,#SchEffFromDate,#SchEffTillDate,#SchAmendmentDate").datepicker("option", "maxDate", formatDate(obj.Result[0].POCLOSEDATE));
                               //$("#ScheduleDate,#SchEffFromDate,#SchEffTillDate,#SchAmendmentDate").datepicker("option", "minDate", formatDate(obj.Result[0].PODate)); */

                            GetPOItem(parseInt($('#AccountCode').val()), $('#PONO').val(), parseInt($('#POYearCode').val()));
                            $('.BtnExcel').fadeIn();
                            $('#SchEffFromDate').change();
                        }
                        else if (obj.StatusCode == 500 && obj.StatusText == 'Error') {
                            /*    //alert('outside 200'); */
                            $('#CustomerOrderNo,#PODate,#DeliveryAddress').val('');
                            $('#ScheduleDate,#SchEffFromDate,#SchEffTillDate').prop('disabled', true);
                            $('#ItemCode,#PartCode').empty();
                            $('#ItemCode,#PartCode').append('<option>-Select-</option>');
                            $('.ItemBtn').fadeOut(), $('.BtnExcel').fadeOut(), $('.BtnUploadExl').val('');
                        }
                    }
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                }
            });
        });
        // po item
        async function GetPOItem(AC, PONO, Year) {
            $.getJSON({
                url: "@Url.Action("GetPOItem")",
                data: { AccountCode: AC, PONO: PONO, Year: Year },
                success: await function (result, status, xhr) {
                    if (result != null) {
                        /*    //  alert ("inside fill item") */
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#PartCode').empty();
                            $('#PartCode').append('<option value=0>-Select-</option>');
                            $.each(obj.Result, function (key, val) {
                                $('#PartCode').append('<option value="' + val.ItemCode + '">' + val.PartCode + '</option>');
                            });

                            $('#ItemCode').empty();
                            $('#ItemCode').append('<option value=0>-Select-</option>');
                            $.each(obj.Result, function (key, val) {
                                $('#ItemCode').append('<option value="' + val.ItemCode + '">' + val.ItemName + '</option>');
                            });
                        }
                        else if (obj.StatusCode == 500 && obj.StatusText == 'Error') {
                            $('#ItemCode,#ItemName').empty();
                            $('#ItemCode,#ItemName').append('<option value=0>-Select-</option>');
                        }
                    }
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                }
            });
        };

        $('#PartCode,#ItemCode').change(function () {
            if ($(this).prop('selectedIndex') != 0) {
                $.getJSON({
                    url: "@Url.Action("GetPOItem")",
                    data: { AccountCode: parseInt($('#AccountCode').val()), PONO: ($('#PONO').val()), Year: $('#POYearCode').val(), ItemCode: parseInt($(this).val()) },
                    success: function (result, status, xhr) {
                        if (result != null) {
                            var obj = $.parseJSON(result);
                            if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                                $('#Unit').val(obj.Result[0].Unit), $('#Rate').val(obj.Result[0].Rate.toFixed(2));
                                obj.Result[0].AltUnit == null ? ($('#AltUnit').prop('disabled', true), $('#AltSchQty').prop('disabled', true)) : ($('#AltUnit').val(obj.Result[0].AltUnit), $('#AltSchQty').val('0.00'));
                            }
                            else if (obj.StatusCode == 500 && obj.StatusText == 'Error') {

                            }
                        }
                    },
                    error: function (result, status, xhr) {
                        $.notify(result.responseText, "error");
                    }
                });
            }
            else {
                $('#Unit').val(''), $('#Rate').val('0.00'), $('#SchQty').val(''), $('#DeliveryDate').val('');
            }
        });

        $('#SchQty').change(function () {
            $.ajax({
                type: "GET",
                url: "@Url.Action("AltUnitConversion")",
                dataType: "json",
                data: { ItemCode: $('#PartCode').val(), AltQty: 0, UnitQty: $('#SchQty').val() },
                success: function (data, status, error) {
                    console.log(data);
                    if (data != null) {
                        var obj = $.parseJSON(data);
                        $('#AltSchQty').val(obj.Result[0].AltUnitValue);
                    }
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        });
        $('#PartCode').change(function () {
            SetPartCodeItemName('PartCode');
            $('#PartCode').prop('selectedIndex') != 0 ? $('.ItemBtn').fadeIn() : $('.ItemBtn').fadeOut();
        });

        $('#ItemCode').change(function () {
            SetPartCodeItemName('ItemCode');
            $('#PartCode').prop('selectedIndex') != 0 ? $('.ItemBtn').fadeIn() : $('.ItemBtn').fadeOut();
        });

        $('#SchQty').keyup(function () {
            $(this).val().trim() == "" ? ($('#PendQty').val(0), $(this).val(0)) : $('#PendQty').val($(this).val());
        });

        $('#AltSchQty').keyup(function () {
            $(this).val().trim() == "" ? ($('#AltPendQty').val(0), $(this).val(0)) : $('#AltPendQty').val($(this).val());
        });

        function ValidateSSGrid() {
            var Err = 0;
            if ($('#PartCode').prop('selectedIndex') == 0 || $('#ItemCode').prop('selectedIndex') == 0) {
                AddErrorCls('PartCode'), AddErrorCls('ItemCode');
                Err = 1;
            }
            else {
                RemoveErrorCls('PartCode'), RemoveErrorCls('ItemCode');
            }

            if (parseFloat($('#SchQty').val()) <= 0) {
                AddErrorCls('SchQty');
                Err = 1;
            }
            else {
                RemoveErrorCls('SchQty');
            }

            if ($('#DeliveryDate').val() == "" || $('#DeliveryDate').val() == null) {
                AddErrorCls('DeliveryDate');
                Err = 1;
            }
            else {
                RemoveErrorCls('DeliveryDate');
            }
            Err == 1 ? ShowErrorFld('H_Panel2') : HideErrorFld('H_Panel2');
            if (Err == 1) return false;

            return true;
        }
        function BackButtonData(event) {

            event.preventDefault();
            var urlHref = $(event.currentTarget).attr("href");
            var linkUrl = urlHref;
            linkUrl = linkUrl + "&PartCode=" + $('#PartCode').val() + "&ItemName=" + $('#ItemName').val() + "&IndentNo=" + $('#IndentNo').val() + "&DeptName=" + $('#DeptName').val() + "&FromDate=" + $('#FromDate').val() + "&ToDate=" + $('#ToDate').val() + "&SummaryDetail=" + $('#SummaryDetail').val() + "&Searchbox=" + $('#search-box').val();
            window.location.href = linkUrl;
        }
        var currentSearchColumn = null;
        $("#search-box").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#divPurchaseScheduleGrid tr").filter(function () {
                if (currentSearchColumn !== null) {
                    var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
                    $(this).toggle(columnText.indexOf(value) > -1);
                } else {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                }
            });
        });


        $(document).on("click", "th[data-columnno]", function () {
            currentSearchColumn = $(this).data('columnno');
            $("#search-box").val('').trigger('keyup'); // Reset search box and trigger the search
        });
        function ClearGrid() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("ClearGrid")",
                success: function (result, status, xhr) {
                    $('#divPurchaseScheduleGrid').html(result.trim());
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                }
            });
        }

        $('.addItemBtn').click(function (e) {

            e.preventDefault();

            if (!ValidateSSGrid()) return;

            var SchData = {
                "ItemCode": parseInt($('#ItemCode').val()),
                "PartCode": $('#PartCode :selected').text(),
                "ItemName": $('#ItemCode :selected').text(),
                "Unit": $('#Unit').val(),
                "SchQty": $('#SchQty').val(),
                "PendQty": $('#PendQty').val(),
                "AltUnit": $('#AltUnit').val(),
                "AltSchQty": $('#AltSchQty').val(),
                "AltPendQty": $('#AltPendQty').val(),
                "Rate": $('#Rate').val(),
                "RateInOthCurr": $('#RateInOthCurr').val(),
                "DeliveryDate": $('#DeliveryDate').val(),
                "ItemSize": $('#ItemSize').val(),
                "ItemColor": $('#ItemColor').val(),
                "Remarks": $('#Remarks').val(),
                "CC": $('#CC').val(),
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("AddScheduleDetail")',
                data: SchData,
                statusCode: {
                    207: function () {
                        $.notify('Duplicate Item...!', "info");
                        $('#PartCode,#ItemCode').val('0');
                        $('#SchQty,#PendQty,#AltSchQty,#AltPendQty').val('0');
                        $('#AltUnit,#PendQty').val('0');
                    }
                },
                success: function (result, status, xhr) {
                    if (xhr.status == 200 && xhr.responseText == result) {
                        $('#divPurchaseScheduleGrid').html(result);
                    }
                },
                error: function (result, status, xhr) {
                    $.notify('Something Went Wrong in purchase schedule ajax, Please Try Again.', "error");
                }
            });
        });

        function DeleteItemRow(SeqNo) {
            $.ajax({
                url: '@Url.Action("DeleteItemRow")',
                type: "POST",
                async: false,
                data: { "SeqNo": SeqNo },
                success: function (data, status, xhr) {
                    $('#divPurchaseScheduleGrid').html(data);
                },
                error: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                },
                failure: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                }
            });
        }

        function ValidateForm() {
            var Err = 0;
            if ($('#AccountCode').prop('selectedIndex') == 0) {
                AddErrorCls('AccountCode');
                Err = 1;
            }
            else {
                RemoveErrorCls('AccountCode');
            }

            if ($('#PONO').prop('selectedIndex') == 0) {
                AddErrorCls('PONO');
                Err = 1;
            }
            else {
                RemoveErrorCls('PONO');
            }

            if ($('#POYearCode').prop('selectedIndex') == 0) {
                AddErrorCls('POYearCode');
                Err = 1;
            }
            else {
                RemoveErrorCls('POYearCode');
            }

            Err == 1 ? ShowErrorFld('H_Panel1') : HideErrorFld('H_Panel1');

            if ($('#divPurchaseScheduleGrid tr')[0].innerText.trim() == 'NO DATA ADDED') {
                ShowErrorFld('H_Panel2');
                Err = 1;
            }
            else {
                HideErrorFld('H_Panel2');
            }

            if (Err == 1) return false;

            return true;
        }

        $('form').submit(function (event) {
            $('.btn-outline-primary').prop('disabled', true).html('Validating Form... <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');
            if (!ValidateForm()) {
                event.preventDefault(); // Prevent the form from submitting via the browser
                $('.btn-outline-primary').prop('disabled', false).html('<i class="fa-solid fa-chevron-circle-right fa-fw fa-lg"></i> SUBMIT');
            }
            else {
                /*   //event.stopPropagation(); // Prevent calling function inside this function. */
                var form = $(this);
                var url = form.attr('action'); //get submit url [replace url here if desired]
                $("form :input").prop("disabled", false);
            }
        });

        $("#SendToExportExcel").click(function () {

            const table = document.querySelector("#PurchaseScheduleTbl");
            const rows = table.querySelectorAll("tr");
            const data = [];

            const headerRow = rows[0];
            const headerData = [];

            headerRow.querySelectorAll("th").forEach((cell, index) => {
                if ($(cell).is(':visible')) {
                    headerData.push(cell.textContent);
                }
            });

            let maxColumns = 0;
            for (let i = 1; i < rows.length; i++) {
                const cellsCount = rows[i].querySelectorAll("td, input").length;
                maxColumns = Math.max(maxColumns, cellsCount);
            }
            for (let i = headerData.length; i < maxColumns; i++) {
                headerData.push('');
            }

            data.push(headerData);

            for (let i = 1; i < rows.length; i++) {
                const rowData = [];
                const cells = rows[i].querySelectorAll("td");

                cells.forEach((cell, index) => {
                    if ($(headerRow.querySelectorAll("th")[index]).is(':visible')) {
                        rowData.push(cell.textContent);
                    }
                });

                const inputCells = rows[i].querySelectorAll("input");
                if (inputCells.length > 0) {
                    inputCells.forEach((inputCell, index) => {
                        if ($(headerRow.querySelectorAll("th")[index]).is(':visible')) {
                            rowData.push(inputCell.value);
                        }
                    });
                }
                for (let j = rowData.length; j < headerData.length; j++) {
                    rowData.push('');
                }

                data.push(rowData);
            }

            const ws = XLSX.utils.aoa_to_sheet(data);

            const colsWidths = [];
            headerRow.querySelectorAll("th").forEach((cell, index) => {
                if ($(cell).is(':visible')) {
                    colsWidths.push({ wch: 15 });
                }
            });
            ws["!cols"] = colsWidths;

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet 1")

            XLSX.writeFile(wb, "PurchaseSchedule.xlsx");
        });

        function EditItemRow(SeqNo) {
            var PartCode = $('#PartCode').val();
            $.ajax({
                url: '@Url.Action("EditItemRow")',
                type: "POST",
                async: false,
                data: { PartCode: PartCode, SeqNo: SeqNo },
                success: function (data, status, xhr) {
                    var obj = $.parseJSON(data);
                    if (obj != null && obj.length == 1) {
                        debugger
                        $('#PartCode').val(obj[0].ItemCode).change();
                        $('#Unit').val(obj[0].Unit);
                        $('#SchQty').val(obj[0].SchQty);
                        $('#PendQty').val(obj[0].PendQty);
                        $('#AltUnit').val(obj[0].AltUnit);
                        $('#AltSchQty').val(obj[0].AltSchQty);
                        $('#AltPendQty').val(obj[0].AltPendQty);
                        $('#Rate').val(obj[0].Rate);
                        $('#RateInOthCurr').val(obj[0].RateInOthCurr);
                        $('#DeliveryDate').val(obj[0].DeliveryDate);
                        $('#ItemSize').val(obj[0].ItemSize);
                        $('#ItemColor').val(obj[0].ItemColor);
                        $('#OtherDetail').val(obj[0].OtherDetail);
                        $('#Remarks').val(obj[0].Remarks);
                        $('#SeqNo').val(obj[0].SeqNo);

                        DeleteItemRow(SeqNo);
                        /*  //if ($('#divPurchaseScheduleGrid').children().length == 0) {
                         //    var NoData = '<tr class="text-center"><td colspan="32" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
                         //    $('#divPurchaseScheduleGrid').html(NoData);
                         //} */

                    }
                },
                error: function (response) {
                    $.notify(response.responseText, "error");
                },
                failure: function (response) {
                    $.notify(response.responseText, "error");
                }
            });
        }

    </script>

    <script src="https://cdn.jsdelivr.net/gh/linways/table-to-excel@v1.0.4/dist/tableToExcel.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.2/xlsx.full.min.js"></script>
}
