@model eTactWeb.DOM.Models.ProductionEntryModel

@{
    ViewData["Title"] = "Production Entry";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<style>

    #GateMainTable thead th {
        background-color: #127387;
        position: sticky;
        top: -15px;
        z-index: 1;
    }

    #GridLabels th {
        background-color: #127387;
        position: sticky;
        top: 0px;
        z-index: 1;
    }

    .select2-container--default .select2-selection--single {
        background-color: #e0f2f1;
        border: 1.5px solid #0a0a0a !important;
        border-radius: 4px;
    }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            /* border-bottom: 1.5px solid #000 !important; */
            border-bottom: none !important;
        }

    .select2-container--default .select2-results > .select2-results__options {
        background-color: #e0f2f1; /* Dropdown background color */
        color: #000;
</style>

<div class="card bg-gradient mb-3 border-light shadow-lg">
    <form asp-action="ProductionEntry" autocomplete="off" class="form-horizontal">
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                <strong>Production Entry : @Model.YearCode</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    <a asp-action="ProductionEntryDashboard" asp-route-ID="0" class="btn btn-secondary btn-sm DashBoard">
                        <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                        Dashboard
                    </a>
                    <div class="row justify-content-between g-2">
                        <div class="col-auto">
                            <input asp-for="FromDateBack" type="hidden" value="@Model.FromDateBack" />
                            <input asp-for="ToDateBack" type="hidden" value="@Model.ToDateBack" />
                            <input asp-for="SlipNoBack" type="hidden" value="@Model.SlipNoBack" />
                            <input asp-for="PartCodeBack" type="hidden" value="@Model.PartCodeBack" />
                            <input asp-for="ItemNameBack" type="hidden" value="@Model.ItemNameBack" />
                            <input asp-for="ProdPlanNoBack" type="hidden" value="@Model.ProdPlanNoBack" />
                            <input asp-for="ProdSchNoBack" type="hidden" value="@Model.ProdSchNoBack" />
                            <input asp-for="GlobalSearchBack" type="hidden" value="@Model.GlobalSearchBack" />
                            <input asp-for="ReqNoBack" type="hidden" value="@Model.ReqNoBack" />
                            <input asp-for="DashboardTypeBack" type="hidden" value="@Model.DashboardTypeBack" />
                            @*<a href="#" class="btn offer-listbtn hvr-sweep-to-right btn-sm btn-secondary" onclick="back();">*@
                            <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                BACK
                            </a>
                        </div>
                        @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                        {
                            <div class="col-auto">
                                @*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
                                <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                    @* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
                                    <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                    REFRESH
                                </a>
                            </div>
                            @if (Model.Mode == "U")
                            {
                                @*Model.Mode = "U";*@
                                <div class="col-auto">
                                    @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                    <button type="submit" class="UpdateButton btn btn-sm btn-outline-light bg-gradient submitBTN">
                                        <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                        UPDATE
                                    </button>
                                </div>
                            }

                            else
                            {
                                <div class="col-auto">
                                    @*   <button type="submit" class="btn btn-sm btn-outline-primary">*@
                                    <button type="submit" class="btn btn-primary btn-sm submitBTN" id="submitBTN">
                                        <i class="fa-solid fa-chevron-circle-right"></i>
                                        SUBMIT
                                    </button>
                                </div>
                            }
                        }
                    </div>
                </span>
            </h5>
        </div>
        <div class="card-body bg-light pt-0">
            <div class="accordion shadow-lg">
                <div class="accordion-item" id="GI_Grid">
                    <h2 class="accordion-header" id="H_RParameter">
                        <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_RParameter" aria-expanded="true" aria-controls="B_RParameter">
                            <i class="fa-brands fa-wpforms fa-lg fa-fw pr35"></i>
                            Production Entry
                        </button>
                    </h2>

                    <div id="B_RParameter" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_RParameter">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3 align-items-center">
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style=" width:80px">
                                    <input type="hidden" asp-for="FinFromDate" value="@Model.FinFromDate" />
                                    <input type="hidden" asp-for="FinToDate" value="@Model.FinToDate" />
                                    <input type="hidden" value="@Model.Mode" asp-for="Mode" />
                                    <input type="hidden" asp-for="EntrybyMachineName" value="@Environment.MachineName" />
                                    <input asp-for="QcMandatory" type="hidden" class="form-label" value="@Model.QcMandatory" />
                                    <label asp-for="EntryId" class="form-label">Entry ID</label>
                                    <input asp-for="EntryId" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style=" width:110px">
                                    <label asp-for="EntryDate" class="form-label">Entry Date</label>
                                    <input asp-for="EntryDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style=" width:90px">
                                    <label asp-for="YearCode" class="form-label">Year Code</label>
                                    <input asp-for="YearCode" class="form-control" value="@Model.YearCode" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style=" width:150px">
                                    <label asp-for="ProdAgainstPlanManual" class="form-label" style="color: blue;">Prod Against</label>
                                    <input type="hidden" id="hiddenProdAgain" value="@Model.ProdAgainstPlanManual" />
                                    @if (Model.ReqNo != null)
                                    {
                                        <select asp-for="ProdAgainstPlanManual" class="form-select">
                                           
                                            <option  value="PRODSCHEDULE">Against Plan Sch</option>
                                            <option  value="REQUISITION">Against Requisition</option>
                                            <option selected value="UNPLANNED">UnPlanned</option>
                                            
                                        </select>
                                    }
                                    else
                                    {
                                        <select asp-for="ProdAgainstPlanManual" class="form-select">
                                          
                                            <option  value="PRODSCHEDULE">Against Plan Sch</option>
                                            <option value="REQUISITION">Against Requisition</option>
                                            <option selected value="UNPLANNED">UnPlanned</option>
                                           
                                        </select>
                                    }
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:100px">
                                    <label asp-for="ProdType" class="form-label" style="color: blue;">Prod Type</label>
                                    <input asp-for="ProdEntryAllowToAddRMItem" type="hidden" class="form-label" value="@Model.ProdEntryAllowToAddRMItem" />
                                    <select class="form-select" asp-for="ProdType">
                                        <option value="Production" selected>Production</option>
                                        <option value="ReWork">ReWork</option>
                                        <option value="SampleProd">Sample Prod</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style=" width:200px">
                                    <label asp-for="ProdSlipNo" class="form-label" style="color: blue;">Prod Slip No</label>
                                    <input asp-for="ProdSlipNo" class="form-control" readonly style="background-color: lightblue !important;" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style=" width:120px">
                                    <label asp-for="ActualProdDate" class="form-label" style="color: blue;">Act Prod Date</label>
                                    <input asp-for="ProdEntryAllowBackDate" type="hidden" class="form-control" />
                                    <input asp-for="ActualProdDate" class="form-control" readonly value="@Model.ActualProdDate" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style=" width:130px">
                                    <label asp-for="Shift" class="form-label">Shift</label>
                                    <input asp-for="ShiftId" type="hidden" class="form-label" value="@Model.ShiftId" />
                                    <select asp-for="Shift" class="form-select"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:180px">
                                    <label asp-for="WorkCenter" class="form-label" style="color: red;">Prod In Work Center*</label>
                                    <input asp-for="ProdInWCID" type="hidden" class="form-label" value="@Model.ProdInWCID" />
                                    <select asp-for="WorkCenter" class="form-select"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PartCode" class="form-label" style="color: red;">Part Code*</label>
                                    <select asp-for="PartCode" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:250px;">
                                    <label asp-for="ItemName" class="form-label" style="color: red;">Item Name*</label>
                                    <input asp-for="FGItemCode" type="hidden" class="form-label" />
                                    <select asp-for="ItemName" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="Operation" class="form-label" style="color: red;">Operation*</label>
                                    <input asp-for="ProcessId" type="hidden" class="form-label" />
                                    <select asp-for="Operation" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" id="ReqNodiv">
                                    <label asp-for="ReqNo" class="form-label" style="color:red">Req No*</label>
                                    <select asp-for="ReqNo" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ReqYeardiv" style=" width:100px">
                                    <label asp-for="ReqYear" class="form-label" style="color:red">Req Year*</label>
                                    <select asp-for="ReqYear" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ReqDatediv" style=" width:100px">
                                    <label asp-for="ReqDate" class="form-label" style="color:red">Req Date*</label>
                                    <input asp-for="ReqDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ProdSchdiv" style=" width:200px">
                                    <label asp-for="ProdSch" class="form-label" style="color:red">Prod Sch*</label>
                                    <select asp-for="ProdSch" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ProdSchYeardiv" style=" width:120px">
                                    <label asp-for="ProdSchYear" class="form-label" style="color:red">Sch Year*</label>
                                    <select asp-for="ProdSchYear" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ProdSchDatediv" style=" width:120px">
                                    <label asp-for="ProdSchDate" class="form-label" style="color:red">SchDate*</label>
                                    <input asp-for="ProdSchDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ProdPlandiv" style="width:120px">
                                    <label asp-for="ProdPlan" class="form-label">Prod Plan</label>
                                    <input asp-for="ProdPlan" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ProdPlanYeardiv" style=" width:120px">
                                    <label asp-for="ProdPlanYear" class="form-label">Prod Plan Year</label>
                                    <input asp-for="ProdPlanYear" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ProdPlanDatediv" style=" width:120px">
                                    <label asp-for="ProdPlanDate" class="form-label">Prod Plan Date</label>
                                    <input asp-for="ProdPlanDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ParentProdSchdiv" style="width:120px">
                                    <label asp-for="ParentProdSch" class="form-label">Parent Prod Sch</label>
                                    <select asp-for="ParentProdSch" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" id="ParentProdSchYeardiv" style=" width:150px">
                                    <label asp-for="ParentProdSchYear" class="form-label">Parent ProdSch Year</label>
                                    <select asp-for="ParentProdSchYear" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:100px" id="plannedtarget">
                                    <label asp-for="TargetQty" class="form-label" style="color: blue;">Target Qty</label>
                                    <input asp-for="TargetQty" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:100px" id="unplannedtarget">
                                    <label asp-for="TargetQtyUnplanned" class="form-label">Target Qty</label>
                                    <input asp-for="TargetQtyUnplanned" class="form-control" id="unTarget" min="0" type="number" step="any" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:100px">
                                    <label asp-for="ProdQty" class="form-label" style="color: red;">Prod Qty*</label>
                                    <input asp-for="ProdQty" class="form-control" min="0" type="number" step="any" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:100px">
                                    <label asp-for="PendQty" class="form-label">Pend Qty</label>
                                    <input asp-for="PendQty" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Stock" class="form-label">Stock</label>
                                    <input asp-for="Stock" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="MachineGroup" class="form-label">Machine Group</label>
                                    <select asp-for="MachineGroup" class="form-select"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="MachineName" class="form-label">Machine Name</label>
                                    <input asp-for="MachineId" type="hidden" class="form-label" />
                                    <select asp-for="MachineName" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:150px">
                                    <label asp-for="BOMNo" class="form-label" style="color: red;">Bom No*</label>
                                    <select asp-for="BOMNo" class="form-select">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:120px">
                                    <label asp-for="BomEffecDate" class="form-label" style="color: red;">Bom Eff Date*</label>
                                    <input asp-for="BomEffecDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:90px">
                                    <label asp-for="StartupRej" class="form-label">Startup Rej</label>
                                    <input asp-for="StartupRej" class="form-control" min="0" type="number" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:90px">
                                    <label asp-for="QcRejQty" class="form-label">Rej Qty</label>
                                    <input asp-for="QcRejQty" class="form-control" min="0" type="number" />
                                </div>
                                @if ((Model.Mode == "U" || Model.Mode == "V") && Model.SenToQc == "Y")
                                {
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                        <label asp-for="SenToQc" class="form-label" style="color: red;">Send To Qc*</label>
                                        <input asp-for="SenToQc" class="form-control" value="@Model.SenToQc" readonly />
                                    </div>
                                    @if (Model.Store == "W")
                                    {
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                            <label asp-for="Store" class="form-label" style="color: red;">Store/Wc*</label>
                                            <input asp-for="Store" class="form-control" value="@Model.Store" readonly />
                                        </div>
                                    }
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                        <label asp-for="NextWorkCenter" class="form-label" style="color: red;">Next Work Center*</label>
                                        <input asp-for="NextWCID" type="hidden" class="form-label" />
                                        <input asp-for="NextWorkCenter" class="form-control" value="@Model.NextWorkCenter" readonly />
                                    </div>
                                }
                                else
                                {
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                        <label asp-for="SenToQc" class="form-label" style="color: red;">Send To Qc*</label>
                                        <select class="form-select" asp-for="SenToQc">
                                            <option>-Select-</option>
                                            <option value="Y">Yes</option>
                                            <option value="N">No</option>
                                        </select>
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:100px">
                                        <label asp-for="Store" class="form-label" style="color: red;">Store/Wc*</label>
                                        <select class="form-select" asp-for="Store">
                                            <option>-Select-</option>
                                            <option value="S">Store</option>
                                            <option value="W">WorkCenter</option>
                                        </select>
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:180px">
                                        <label asp-for="NextWorkCenter" class="form-label" style="color: red;">Next Work Center*</label>
                                        <input asp-for="NextWCID" type="hidden" class="form-label" />
                                        <input asp-for="NextStoreId" type="hidden" class="form-label" />
                                        <select asp-for="NextWorkCenter" class="form-select"></select>
                                    </div>
                                }
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" sstyle="width:80px" id="StoreTransferdiv">
                                    <label asp-for="StoreTransfer" class="form-label" style="color: red;">Store/Wc*</label>
                                    <select class="form-select" asp-for="StoreTransfer">
                                        <option>-Select-</option>
                                        <option value="W">WorkCenter</option>
                                        <option value="S">Store</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:200px" id="Rejtransferdiv">
                                    <label asp-for="RejTransferTo" class="form-label" style="color:red">Transfer Rej Qty To*</label>
                                    <input asp-for="TransferToRejStoreId" type="hidden" class="form-label" />
                                    <input asp-for="RejWCId" type="hidden" class="form-label" />
                                    <select asp-for="RejTransferTo" class="form-select"></select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:100px">
                                    <label asp-for="BatchNo" class="form-label">Batch No</label>
                                    <input asp-for="BatchNo" class="form-control" readonly />

                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:150px">
                                    <label asp-for="UniqueBatchNo" class="form-label">Unique Batch No</label>
                                    <input asp-for="UniqueBatchNo" class="form-control" readonly />
                                </div>
                                <div class="col-xl-4 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <button class="btn btn-sm btn-outline-primary bg-gradient" onclick="GetChildData(event)" style="margin-left:10px;margin-top:10px;">
                                        <i class="fa fa-plus-circle fafw fa-lg"></i>
                                        Child Part Stock
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning bg-gradient" id="displaylistbutton" onclick="DisplayBomDetail(event)" style="margin-left:0px;margin-top:10px;"><i class="fa fa-list-alt fafw fa-lg"></i> Bom</button>
                                    <button class="btn btn-sm btn-outline-success bg-gradient" id="displayroutingdata" onclick="DisplayRoutingData(event)" style="margin-left:0px;margin-top:10px;"><i class="fa fa-list-alt fafw fa-lg"></i> Routing</button>
                                    <span id="productDetailAlert" style="display:none; color:white; background-color:red; padding:2px 6px; font-size:12px; border-radius:4px;">Product detail</span>
                                    <span id="scrapDetailAlert" style="display:none; color:white; background-color:green; padding:2px 6px; font-size:12px; border-radius:4px;">Product detail</span>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button id="H_SAGrid" class="accordion-button collapsed text-light pnl4BG bg-gradient addToGridHeading" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid" style="width: 90%;">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Child part Consumption Detail</strong>
                        </button>
                        <button type="button" class="addToGrid btn btn-sm btn-outline-danger" onclick="GridButton(event)" style="width:150px">
                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                        </button>
                        <div class="col-md-1 me-2">
                            <input type="text" class="form-control" id="search-box" style="background-color:#FFFACD" placeholder="Search...">
                        </div>
                    </h2>
                    
                    <div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3" id="_ItemGrid">
                                <div class="card">
                                    <div class="card-body overflow-auto pb-0" style="max-height: 240px;">
                                        <table class="table table-hover table-bordered table-striped" id="GateMainTable">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                                <tr>
                                                    <th>Action</th>
                                                    <th>Seq No</th>
                                                    <th>Part Code</th>
                                                    <th>Item Name</th>
                                                    <th>Total Req RMQty</th>
                                                    <th>CONS QTY</th>
                                                    <th>Unit</th>
                                                    <th>FG ProdQty</th>
                                                    <th>Toatl Stock</th>
                                                    <th>Batch Stock</th>
                                                    <th>Batch No</th>
                                                    <th>Unique Batch No</th>
                                                    <th>Batch date</th>
                                                    <th>Pend Qty</th>
                                                    <th>Remaining Stock</th>
                                                    <th>AltQty</th>
                                                    <th>AltUnit</th>
                                                    <th>RMNet Wt</th>
                                                    <th>Gross Wt</th>
                                                    <th>Batch wise</th>
                                                    <th>Std Packing</th>
                                                    <th>Pend AfterIssue</th>
                                                    <th>Store Name</th>
                                                    <th>Rate</th>
                                                    <th>Remark</th>
                                                    <th>Main RMQty</th>
                                                </tr>
                                            </thead>
                                            <tbody id="divProductionEntryGrid">
                                                <partial name="_ProductionChildDataDetail" />
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                                <div class="accordion-body" id="altProductionentry">
                                    <div class="row g-2 gx-3" id="_ItemGrid">
                                        <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:220px">
                                            <label asp-for="RmPartCode" class="form-label">Part Code</label>
                                            <select asp-for="RmPartCode" class="form-select" style="width:200px">
                                                <option value="">-Select-</option>
                                            </select>
                                        </div>
                                        <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:220px">
                                            <label asp-for="RmItemName" class="form-label">Item Name</label>
                                            <input asp-for="RmItemCode" type="hidden" class="form-label" value="@Model.RmItemCode" />
                                            <select asp-for="RmItemName" class="form-select" style="width:200px">
                                                <option value="">-Select-</option>
                                            </select>
                                        </div>
                                        <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:220px">
                                            <label asp-for="AltPartCode" class="form-label">Alt PartCode</label>
                                            <select asp-for="AltPartCode" class="form-select" style="width:200px">
                                                <option value="">-Select-</option>
                                            </select>
                                        </div>
                                        <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:220px">
                                            <label asp-for="AltItemName" class="form-label">Alt ItemName</label>
                                            <input asp-for="AltRMItemCode" type="hidden" class="form-label" value="@Model.AltRMItemCode" />
                                            <select asp-for="AltItemName" class="form-select" style="width:200px">
                                                <option value="">-Select-</option>
                                            </select>
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="ReqQty" class="form-label">ReqQty</label>
                                            <input asp-for="ReqQty" class="form-control" min="0" type="number" />
                                        </div>
                                        <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                            <label asp-for="RmBatchNo" class="form-label">BatchNo</label>
                                            <select asp-for="RmBatchNo" class="form-select">
                                                <option value="">-Select-</option>
                                            </select>
                                        </div>
                                        <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                            <label asp-for="RmUniqueBatchNo" class="form-label">Unique BatchNo</label>
                                            <select asp-for="RmUniqueBatchNo" class="form-select">
                                                <option value="">-Select-</option>
                                            </select>
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="TotalStock" class="form-label">Total Stock</label>
                                            <input asp-for="TotalStock" class="form-control" readonly />
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="LotStock" class="form-label">Lot Stock</label>
                                            <input asp-for="LotStock" class="form-control" readonly />
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="Unit" class="form-label">Unit</label>
                                            <input asp-for="Unit" class="form-control" />
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="BatchDate" class="form-label">Batch date</label>
                                            <input asp-for="BatchDate" class="form-control" />
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="Rate" class="form-label">Rate</label>
                                            <input asp-for="Rate" class="form-control" min="0" type="number" />
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="DetailRemark" class="form-label">Remark</label>
                                            <input asp-for="DetailRemark" class="form-control" />
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                            <label asp-for="StdPacking" class="form-label">Std Packing</label>
                                            <input asp-for="StdPacking" class="form-control" min="0" type="number" />
                                        </div>
                                        <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px;margin-top:20px">
                                            <button type="button" id="AddChildPartbtn" class="addToGrid btn btn-sm btn-outline-danger" onclick="Add2Grid()" style="width:150px">
                                                <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD CHILD GRID
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br />


                        </div>

                        <div class="card">
                            <div class="card-body overflow-auto pb-0">
                              <div class="ms-auto d-flex align-items-center">
                                    <div class="col-md-2">
                                        <input type="text" class="form-control" id="search-box2" placeholder="Search..."  style="background-color:#FFFACD;" "">
                                    </div>
                              </div>
                                <div class="table-responsive" style="max-height:250px;">
                                    <table class="table table-hover table-bordered table-striped">
                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap;position:static" id="GridLabels">
                                            <tr>
                                                <th>Action</th>
                                                <th>SeqNo</th>
                                                <th style="color:yellow">Part Code*</th>
                                                <th style="color:yellow">Item Name*</th>
                                                <th style="color:yellow">Total Req RMQty*</th>
                                                <th style="color:yellow">CONS QTY*</th>
                                                <th style="color:yellow">Unit*</th>
                                                <th>FG ProdQty</th>
                                                <th>Toatl Stock</th>
                                                <th>Batch Stock</th>
                                                <th>Batch No</th>
                                                <th>Unique Batch No</th>
                                                <th>Batch date</th>
                                                <th>Pend Qty</th>
                                                <th>Remaining Stock</th>
                                                <th>AltQty</th>
                                                <th>AltUnit</th>
                                                <th>RMNet Wt</th>
                                                <th>Gross Wt</th>
                                                <th>Batch wise</th>
                                                <th>Std Packing</th>
                                                <th>Pend AfterIssue</th>
                                                <th>Store Name</th>
                                                <th>Rate</th>
                                                <th>Remark</th>
                                                <th>Main RMQty</th>
                                            </tr>
                                        </thead>
                                        <tbody id="divAddProductionEntryGrid">
                                            <partial name="_ProductionEntryGrid" />
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button id="H_DrawingDetail" class="accordion-button collapsed text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_DrawingDetail" aria-expanded="true" aria-controls="B_DrawingDetail">
                            <strong style="text-transform:uppercase"><i class="fa fa-fw pr35 fa-book fa-lg" aria-hidden="true"></i>Breakdown Detail</strong>
                        </button>
                    </h2>
                    <div id="B_DrawingDetail" class="accordion-collapse collapse pnl1 bg-gradient" aria-labelledby="H_DrawingDetail">
                        <div class="accordion-body">
                            <div class="row g-3" id="_BreakdownDetail">
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:130px">
                                    <label asp-for="BreakfromTime" class="form-label" style="color:red">Break From Time*</label>
                                    <input asp-for="BreakfromTime" class="form-control" value="@Model.BreakfromTime" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="BreaktoTime" class="form-label" style="color:red">Break To Time*</label>
                                    <input asp-for="BreaktoTime" class="form-control" value="@Model.BreaktoTime" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:210px">
                                    <label asp-for="ReasonDetail" class="form-label" style="color:red">Reason Detail*</label>
                                    <input asp-for="ReasonId" class="form-control" type="hidden" />
                                    <select asp-for="ReasonDetail" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="BreakTimeMin" class="form-label" style="color:red">Break Time Min*</label>
                                    <input asp-for="BreakTimeMin" class="form-control" min="0" type="number" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:210px">
                                    <label asp-for="ResEmpName" class="form-label" style="color:red">Responsible Emp Name*</label>
                                    <input asp-for="ResponcibleEmp" class="form-control" type="hidden" />
                                    <select asp-for="ResEmpName" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:210px">
                                    <label asp-for="ResFactor" class="form-label" style="color:red">Responsible Factor*</label>
                                    <select asp-for="ResFactor" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:160px;margin-top:35px">
                                    <button type="button" class="GridButton btn btn-sm btn-outline-danger" onclick="BreakdownGrid(event)">
                                        <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                    </button>
                                </div>
                            </div>
                            <br />
                            <div class="card">
                                <div class="card-body overflow-auto pb-0">
                                    <div class="table-responsive" style="max-height:250px;">
                                        <table class="table table-hover table-bordered table-striped">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap;position:static" id="GridLabels">
                                                <tr>
                                                    <th>Action</th>
                                                    <th>SeqNo</th>
                                                    <th>Break From Time</th>
                                                    <th>Break To Time</th>
                                                    <th>Reason Detail</th>
                                                    <th>Break Time Min</th>
                                                    <th>Responsible Emp Name</th>
                                                    <th>Responsible Factor</th>
                                                </tr>
                                            </thead>
                                            <tbody id="divBreakdownDetailGrid">
                                                <partial name="_ProductionEntryBreakdownDetail" />
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_Procurment">
                        <button id="H_Procurment" class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_Procurment" aria-expanded="true" aria-controls="B_Procurment">
                            <strong style="text-transform:uppercase"><i class="fa fa-fw pr35 fa-book fa-lg" aria-hidden="true"></i>Operators Detail</strong>
                        </button>
                    </h2>
                    <div id="B_Procurment" class="accordion-collapse collapse pnl1 bg-gradient" aria-labelledby="H_Procurment">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3" id="_OrderDetail">
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:210px">
                                    <label asp-for="OperatorName" class="form-label" style="color:red">Operator Name*</label>
                                    <input asp-for="OperatorId" class="form-control" type="hidden" />
                                    <select asp-for="OperatorName" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="Fromtime" class="form-label" style="color:red">From Time*</label>
                                    <input asp-for="Fromtime" class="form-control" placeholder="hh:mm:ss" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="ToTime" class="form-label" style="color:red">To Time*</label>
                                    <input asp-for="ToTime" class="form-control" placeholder="hh:mm:ss" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="TotalHours" class="form-label" style="color:red">Total Hours*</label>
                                    <input asp-for="TotalHours" class="form-control" min="0" type="number" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="OverTimeHrs" class="form-label">Over Time Hours</label>
                                    <input asp-for="OverTimeHrs" class="form-control" min="0" type="number" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="MachineCharges" class="form-label">Machine Changes</label>
                                    <input asp-for="MachineCharges" class="form-control" min="0" type="number" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px;margin-top:28px">
                                    <button type="button" class="GridButton btn btn-sm btn-outline-danger" onclick="OperatorGrid(event)" style="width:150px">
                                        <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                    </button>
                                </div>
                            </div>
                            </br>
                            <div class="card">
                                <div class="card-body overflow-auto pb-0">
                                    <div class="table-responsive" style="max-height:250px;">
                                        <table class="table table-hover table-bordered table-striped">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap;position:static" id="GridLabels">
                                                <tr>
                                                    <th>Action</th>
                                                    <th>SeqNo</th>
                                                    <th>Operator Name</th>
                                                    <th>From Time</th>
                                                    <th>To Time</th>
                                                    <th>Total Hours</th>
                                                    <th>Over Time Hours</th>
                                                    <th>Machine Changes</th>
                                                </tr>
                                            </thead>
                                            <tbody id="divOperatorDetailGrid">
                                                <partial name="_ProductionEntryOperatorDetail" />
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_Measurements">
                        <button id="H_Measurements" class="accordion-button collapsed text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_Measurements" aria-expanded="true" aria-controls="B_Measurements">
                            <strong style="text-transform:uppercase"><i class="fa fa-fw pr35 fa-book fa-lg" aria-hidden="true"></i>Scarp Detail</strong>
                        </button>
                    </h2>
                    <div id="B_Measurements" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_Measurements">
                        <div class="accordion-body">
                            <div class="row g-3">
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ScrapPartCode" class="form-label" style="color:red">Part Code*</label>
                                    <select asp-for="ScrapPartCode" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ScrapItemName" class="form-label" style="color:red">Item Name*</label>
                                    <input asp-for="ScrapItemCode" class="form-control" type="hidden" />
                                    <select asp-for="ScrapItemName" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:120px">
                                    <label asp-for="ScrapType" class="form-label" style="color:red">Scrap Type*</label>
                                    <select asp-for="ScrapType" class="form-select" style="width:100px"></select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ScrapQty" class="form-label" style="color:red">Scrap Qty*</label>
                                    <input asp-for="ScrapQty" class="form-control" min="0" type="number" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="Scrapunit" class="form-label">Scrap Unit</label>
                                    <input asp-for="Scrapunit" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="Store" class="form-label" style="color:red">Store/Wc*</label>
                                    <select class="form-select" asp-for="StoreTransferScrap">
                                        <option>-Select-</option>
                                        <option value="S">Store</option>
                                        <option value="W">WorkCenter</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="TransferToWCStore" class="form-label" style="color:red">Transfer To Wc or Store*</label>
                                    <input asp-for="TransferToStoreId" class="form-control" type="hidden" />
                                    <input asp-for="TransferToWC" class="form-control" type="hidden" />
                                    <input asp-for="TransferToWC" class="form-control" type="hidden" />
                                    <select asp-for="TransferToWCStore" class="form-select" style="width:150px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px;margin-top:28px">
                                    <button type="button" class="GridButton btn btn-sm btn-outline-danger" onclick="ScrapGrid(event)" style="width:150px">
                                        <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                    </button>
                                </div>
                            </div>
                            </br>
                            <div class="card">
                                <div class="card-body overflow-auto pb-0">
                                    <div class="table-responsive" style="max-height:250px;">
                                        <table class="table table-hover table-bordered table-striped">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap;position:static" id="GridLabels">
                                                <tr>
                                                    <th>Action</th>
                                                    <th>Seq No</th>
                                                    <th>Scrap ItemName</th>
                                                    <th>Scrap PartCode</th>
                                                    <th>Scrap Type</th>
                                                    <th>Scrap Qty</th>
                                                    <th>Scrap Unit</th>
                                                    <th>Store/WC</th>
                                                    <th>Transfer to WC or Store</th>
                                                </tr>
                                            </thead>
                                            <tbody id="divScrapDetailGrid">
                                                <partial name="_ProductionEntryScrapDetail" />
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_ProductionData">
                        <button id="H_ProductionData" class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_Production" aria-expanded="true" aria-controls="B_Production">
                            <strong style="text-transform:uppercase"><i class="fa fa-fw pr35 fa-book fa-lg" aria-hidden="true"></i>Production Entry By product</strong>
                        </button>
                    </h2>
                    <div id="B_Production" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_ProductionData">
                        <div class="accordion-body">
                            <div class="row g-3">
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ProductPartCode" class="form-label" style="color:red">Part Code*</label>
                                    <select asp-for="ProductPartCode" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ProductItemName" class="form-label" style="color:red">Item Name*</label>
                                    <input asp-for="ProductItemCode" class="form-control" type="hidden" />
                                    <select asp-for="ProductItemName" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:120px">
                                    <label asp-for="ProductType" class="form-label" style="color:red">Product Type*</label>
                                    <select asp-for="ProductType" class="form-select" style="width:100px"></select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ProductQty" class="form-label" style="color:red">Product Qty*</label>
                                    <input asp-for="ProductQty" class="form-control" min="0" type="number" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="Productunit" class="form-label">Product Unit</label>
                                    <input asp-for="Productunit" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ProductStore" class="form-label" style="color:red">Store/Wc*</label>
                                    <select class="form-select" asp-for="StoreTransferProduct">
                                        <option>-Select-</option>
                                        <option value="S">Store</option>
                                        <option value="W">WorkCenter</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                    <label asp-for="ProductTransferToWCStore" class="form-label" style="color:red">Transfer To Wc or Store*</label>
                                    <input asp-for="ProductStoreId" class="form-control" type="hidden" />
                                    <input asp-for="ProductToWC" class="form-control" type="hidden" />
                                    <input asp-for="ProductToWC" class="form-control" type="hidden" />
                                    <select asp-for="ProductTransferToWCStore" class="form-select" style="width:150px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px;margin-top:28px">
                                    <button type="button" class="GridButton btn btn-sm btn-outline-danger" onclick="ProductGrid(event)" style="width:150px">
                                        <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                    </button>
                                </div>
                            </div>
                            </br>
                            <div class="card">
                                <div class="card-body overflow-auto pb-0">
                                    <div class="table-responsive" style="max-height:250px;">
                                        <table class="table table-hover table-bordered table-striped">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap;position:static" id="GridLabels">
                                                <tr>
                                                    <th>Action</th>
                                                    <th>Seq No</th>
                                                    <th>Product ItemName</th>
                                                    <th>Product PartCode</th>
                                                    <th>Product Type</th>
                                                    <th>Product Qty</th>
                                                    <th>Product Unit</th>
                                                    
                                                    <th>Transfer to WC or Store</th>
                                                </tr>
                                            </thead>
                                            <tbody id="divProductDetailGrid">
                                                <partial name="_ProductionEntryProductDetail" />
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_OpGrid">
                        <button class="accordion-button collapsed text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#ODGrid" aria-expanded="false" aria-controls="ODGrid">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Optional Parameter Entry</strong>
                        </button>
                    </h2>
                    <div id="ODGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3" id="_ItemGrid">
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="ProdStartTime" class="form-label">Prod Start Time</label>
                                    <input asp-for="ProdStartTime" class="form-control" placeholder="hh:mm:ss" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="ProdEndTime" class="form-label">Prod End Time</label>
                                    <input asp-for="ProdEndTime" class="form-control" placeholder="hh:mm:ss" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:200px">
                                    <label asp-for="ToolName" class="form-label">Tool Name</label>
                                    <input asp-for="ToolItemCode" type="hidden" />
                                    <select asp-for="ToolName" class="form-select"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="InitalReading" class="form-label">Initial Reading</label>
                                    <input asp-for="InitalReading" class="form-control" min="0" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="EndReading" class="form-label">End Reading</label>
                                    <input asp-for="EndReading" class="form-control" min="0" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="Superwiser" class="form-label">Superwiser</label>
                                    <select asp-for="Superwiser" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="Operator" class="form-label">Operatory</label>
                                    <select asp-for="Operator" class="form-select" style="width:180px"></select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="Shots" class="form-label">Shots</label>
                                    <input asp-for="Shots" class="form-control" min="0" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="Cavity" class="form-label">Cavity</label>
                                    <input asp-for="Cavity" class="form-control" min="0" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="TransferTo" class="form-label">Transfer Prod Qty</label>
                                    <input asp-for="TransferTo" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="StdCycleTime" class="form-label">Std Cycle Time</label>
                                    <input asp-for="StdCycleTime" class="form-control" min="0" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="Customerorderno" class="form-label">Customer Order No</label>
                                    <input asp-for="Customerorderno" class="form-control" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="SONo" class="form-label">So No</label>
                                    <input asp-for="SONo" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="SoYear" class="form-label">So Year</label>
                                    <input asp-for="SoYear" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="SoDate" class="form-label">So Date</label>
                                    <input asp-for="SoDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="Tranfererd" class="form-label">Tranfererd</label>
                                    <input asp-for="Tranfererd" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="ReWorkEntryId" class="form-label">Rework Entry Id</label>
                                    <input asp-for="ReWorkEntryId" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="ReWorkEntrydate" class="form-label">Rework Entry date</label>
                                    <input asp-for="ReWorkEntrydate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="RewYearcode" class="form-label">Rew Year Code</label>
                                    <input asp-for="RewYearcode" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="QCOffered" class="form-label">QC Offered</label>
                                    <input asp-for="QCOffered" class="form-control" readonly />
                                </div>

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="Remark" class="form-label">Remark</label>
                                    <input asp-for="Remark" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:100px">
                                    <label asp-for="ProdSeqNo" class="form-label">Prod Seq No</label>
                                    <input asp-for="ProdSeqNo" class="form-control" min="0" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style=" width:120px">
                                    <label asp-for="QcOfferedDate" class="form-label">Qc Offered date</label>
                                    <input asp-for="QcOfferedDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="QCQTy" class="form-label">Qc Qty</label>
                                    <input asp-for="QCQTy" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="OKQty" class="form-label">Qc Ok Qty</label>
                                    <input asp-for="OKQty" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="QcRejQty" class="form-label">QC Rej Qty</label>
                                    <input asp-for="QcRejQty" class="form-control" readonly />
                                </div>
                                @if (Model.Mode != "U" && Model.Mode != "V")
                                {
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                        <label asp-for="ActualEnteredByName" class="form-label">Actual Enter By</label>
                                        <input asp-for="ActualEnteredBy" type="hidden" class="form-label" />
                                        <input asp-for="ActualEnteredByName" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                        <label asp-for="ActualEntryDate" class="form-label">Actual Entry Date</label>
                                        <input asp-for="ActualEntryDate" class="form-control" readonly />
                                    </div>
                                }
                                else
                                {
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                        <label asp-for="ActualEnteredByName" class="form-label">Actual Enter By</label>
                                        <input asp-for="ActualEnteredBy" type="hidden" class="form-label" />
                                        <input asp-for="ActualEnteredByName" class="form-control" readonly value="@Model.ActualEnteredByName" />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                        <label asp-for="ActualEntryDate" class="form-label">Actual Entry Date</label>
                                        <input asp-for="ActualEntryDate" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                        <label asp-for="UpdatedByName" class="form-label">Last Updated By</label>
                                        <input asp-for="LastUpdatedBy" type="hidden" class="form-label" />
                                        <input asp-for="UpdatedByName" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                        <label asp-for="LastUpdatedDate" class="form-label">Last Updated date</label>
                                        <input asp-for="LastUpdatedDate" class="form-control" readonly />
                                    </div>
                                }
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-9">
                                    <label asp-for="ShiftClosed" class="form-label">Shift Closed</label>
                                    <input asp-for="ShiftClosed" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:120px">
                                    <label asp-for="QcCompleted" class="form-label">QC Completed</label>
                                    <input asp-for="QcCompleted" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-9" style="width:150px">
                                    <label asp-for="MaterialTransferd" class="form-label">Material Transfered</label>
                                    <input asp-for="MaterialTransferd" class="form-control" readonly />
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>
        <partial name="_DisplayBomDetail" />
        <partial name="_DisplayRoutingDetail" />
        <div class="card-footer p-3">
            <div class="row justify-content-between g-2">
                <div class="card-header card-headerBG text-light bg-gradient">
                    <h5>
                        <strong>Production Entry - Financial Year: @Model.YearCode</strong>

                        <span class="d-flex float-end" style="margin-top:-2px;">
                            <div class="col-auto">
                                @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="PrintButton">
                                    <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                    PRINT
                                </button>
                            </div>
                            @*<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">*@
                            <a asp-action="ProductionEntryDashboard" tabindex="-1" asp-route-ID="0" class="btn btn-secondary btn-sm DashBoard">
                                <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                                Dashboard
                            </a>
                            @*<partial name="_FormsButton" />*@
                            <div class="row justify-content-between g-2">
                                <div class="col-auto">
                                    <input asp-for="FromDateBack" type="hidden" value="@Model.FromDateBack" />
                                    <input asp-for="ToDateBack" type="hidden" value="@Model.ToDateBack" />
                                    <input asp-for="SlipNoBack" type="hidden" value="@Model.SlipNoBack" />
                                    <input asp-for="PartCodeBack" type="hidden" value="@Model.PartCodeBack" />
                                    <input asp-for="ItemNameBack" type="hidden" value="@Model.ItemNameBack" />
                                    <input asp-for="ProdPlanNoBack" type="hidden" value="@Model.ProdPlanNoBack" />
                                    <input asp-for="ProdSchNoBack" type="hidden" value="@Model.ProdSchNoBack" />
                                    <input asp-for="GlobalSearchBack" type="hidden" value="@Model.GlobalSearchBack" />
                                    <input asp-for="ReqNoBack" type="hidden" value="@Model.ReqNoBack" />
                                    <input asp-for="DashboardTypeBack" type="hidden" value="@Model.DashboardTypeBack" />
                                    @*<a href="#" class="btn offer-listbtn hvr-sweep-to-right btn-sm btn-secondary" onclick="back();">*@
                                    <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                        <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                        BACK
                                    </a>
                                </div>
                                @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                                {
                                    <div class="col-auto">
                                        @*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
                                        <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                            @* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
                                            <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                            REFRESH
                                        </a>
                                    </div>
                                    @if (Model.Mode == "U")
                                    {
                                        @*Model.Mode = "U";*@
                                        <div class="col-auto">
                                            @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                            <button type="submit" class="UpdateButton btn btn-sm btn-outline-light bg-gradient submitBTN">
                                                <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                                UPDATE
                                            </button>
                                        </div>
                                    }

                                    else
                                    {
                                        <div class="col-auto">
                                            @*   <button type="submit" class="btn btn-sm btn-outline-primary">*@
                                            <button type="submit" class="btn btn-primary btn-sm submitBTN" id="submitBTN">
                                                <i class="fa-solid fa-chevron-circle-right"></i>
                                                SUBMIT
                                            </button>
                                        </div>
                                    }
                                }
                            </div>
                        </span>
                    </h5>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
    .toggle-btn {
        border: none;
        background: none;
        padding: 0;
    }

    .disabled-link {
        pointer-events: none; /* Disables clicking */
        color: gray; /* Makes it look disabled */
        text-decoration: none; /* Removes underline */
        cursor: not-allowed; /* Changes cursor */
    }

    .toggle-btn .fa {
        color: white;
        margin-left: 3px;
    }

    .fa {
        margin-left: 3px;
    }
</style>

@section Scripts
{
    <script>

        $('.submitBTN').click(function (e) {

            e.preventDefault();
            if (!ValidateGI_Grid()) return;
            $('form').submit();
        });
        function GetFormRights() {
            $.ajax({
                url: "@Url.Action("GetFormRights")",
                type: "POST",
                success: function (data) {
                    if (data != null) {
                        var obj = $.parseJSON(data);
                        if (obj.Result.Table.length == 0) {
                            $("#submitBTN").prop("disabled", true);
                            $('.card-footer #submitBTN').prop("disabled", true);
                            $(".DashBoard")
                                .addClass("disabled-link")
                                .on("click", function (e) {
                                    e.preventDefault(); // Prevents clicking the link
                                });
                        }
                        else {
                            // console.log(obj);
                            var optAll = obj.Result.Table[0].OptAll;
                            var optSave = obj.Result.Table[0].OptSave;
                            var optUpdate = obj.Result.Table[0].OptUpdate;
                            var optDelete = obj.Result.Table[0].OptDelete;
                            var optView = obj.Result.Table[0].OptView;
                            if (!optAll) {
                                if (!optSave) {
                                    $("#submitBTN").prop("disabled", true);
                                    $('.card-footer #submitBTN').prop("disabled", true);
                                }
                                if (!(optUpdate || optDelete || optView)) {
                                    $(".DashBoard")
                                        .addClass("disabled-link")
                                        .on("click", function (e) {
                                            e.preventDefault(); // Prevents clicking the link
                                        });
                                }
                            }
                        }
                    }
                },
                error: function (errMsg) {
                    $.notify(errMsg, { position: "top center", className: "error" });
                }
            });
        }


        function ValidateGI_Grid() {

            var Err = 0;
            if ($('#ItemName').prop('selectedIndex') == 0) {
                AddErrorCls('ItemName');
                $.notify("ItemName Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ItemName');
            }
            if ($('#PartCode').prop('selectedIndex') == 0) {
                AddErrorCls('PartCode');
                $.notify("PartCode Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('PartCode');
            }
            if ($('#ProdQty').val() == 0 || $('#ProdQty').val() < 0) {
                AddErrorCls('ProdQty');
                $.notify("Prod Qty can not be less than 0", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ProdQty');
            }
            if ($('#WorkCenter').prop('selectedIndex') == 0) {
                AddErrorCls('WorkCenter');
                $.notify("WorkCenter Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('WorkCenter');
            }
            if ($('#Store').prop('selectedIndex') == 0) {
                AddErrorCls('Store');
                $.notify("Store or WorkCenter Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('Store');
            }
            if ($('#SenToQc').prop('selectedIndex') == 0) {
                AddErrorCls('SenToQc');
                $.notify("SenToQc Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('SenToQc');
            }
            if ($('#NextWorkCenter').prop('selectedIndex') <= 0) {
                AddErrorCls('NextWorkCenter');
                $.notify("NextWorkCenter Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('NextWorkCenter');
            }
            if ($('#divAddProductionEntryGrid tr td').length <= 1) {
                $.notify("Childgrid Should have atleast 1 item", "error");
                return false;
            }
            if ($('#ProdAgainstPlanManual').val() == 'UNPLANNED') {
                var Target = Number(parseFloat($('#unTarget').val()).toFixed(6));
                var ProdQty = Number(parseFloat($('#ProdQty').val()).toFixed(6));
                if (ProdQty > Target) {
                    $.notify("ProdQty cannot be greater than TargetQty", "error");
                    Err = 1;
                }
                else if (ProdQty < 0) {
                    $.notify("ProdQty cannot be less than 0", "error");
                }
                else {
                    var PendQty = Target - ProdQty;
                    $('#PendQty').val(0);
                    $('#PendQty').val(PendQty);

                }

            } else {
                var TargetQty = Number(parseFloat($('#TargetQty').val()).toFixed(6));
                var ProdQty = Number(parseFloat($('#ProdQty').val()).toFixed(6));
                if (ProdQty > TargetQty) {
                    $.notify("ProdQty cannot be greater than TargetQty", "error");
                    Err = 1;
                }
                else if (ProdQty < 0) {
                    $.notify("ProdQty cannot be less than 0", "error");
                }
                else {
                    var PendQty = TargetQty - ProdQty;
                    $('#PendQty').val(0);
                    $('#PendQty').val(PendQty);
                }
            }
            if (parseInt($('#InitalReading').val()) > parseInt($('#EndReading').val())) {
                Err = 1;
                $.notify('InitialReading is not greater than EndReading.', "error");
            }
            Err == 1 ? ShowErrorFldwithAddtoGrid('H_SAGrid') : HideErrorFldwithAddtoGrid('H_SAGrid');
            if (Err == 1) return false;
            return true;
        }

        $('.UpdateButton').click(function (e) {
            e.preventDefault();
            if (!ValidateGI_Grid()) return;
            $('form').submit();
        });

        $(document).ready(function ()
        {
             
            GetFormRights();
            $('#ReqNodiv').hide();
            $('#ReqYeardiv').hide();
            $('#ReqDatediv').hide();
            $('#displaylistbutton').hide();
            $('#displayroutingdata').hide();
            $('#ProdType').rules("remove", "required");
            $('#Stock').rules("remove", "required");
            $('#TargetQty').rules("remove", "required");
            $('#ProdQty').rules("remove", "required");
            $('#PendQty').rules("remove", "required");
            $('#StartupRej').rules("remove", "required");
            $('#RejQty').rules("remove", "required");
            $('#Store').rules("remove", "required");
            $('#Store').rules("remove", "required");
            $('#ProdStartTime').rules("remove", "required");
            $('#ProdEndTime').rules("remove", "required");
            $('#ToolName').rules("remove", "required");
            $('#InitalReading').rules("remove", "required");
            $('#EndReading').rules("remove", "required");
            $('#Shots').rules("remove", "required");
            $('#Cavity').rules("remove", "required");
            $('#StdCycleTime').rules("remove", "required");
            $('#Customerorderno').rules("remove", "required");
            $('#SONo').rules("remove", "required");
            $('#SoYear').rules("remove", "required");
            $('#Tranfererd').rules("remove", "required");
            $('#ReWorkEntryId').rules("remove", "required");
            $('#ReWorkEntrydate').rules("remove", "required");
            $('#RewYearcode').rules("remove", "required");
            $('#QcOffered').rules("remove", "required");
            $('#Remark').rules("remove", "required");
            $('#ProdSeqNo').rules("remove", "required");
            $('#QcQty').rules("remove", "required");
            $('#NextWorkCenter').rules("remove", "required");
            $('#Store').rules("remove", "required");
            $('#QcOkQty').rules("remove", "required");
            $('#QcRejQty').rules("remove", "required");
            $('#ParentProdSch').rules("remove", "required");
            $('#ParentProdSchYear').rules("remove", "required");
            $('#ActualEntryBy').rules("remove", "required");
            $('#LastUpdatedBy').rules("remove", "required");
            $('#ShiftClosed').rules("remove", "required");
            $('#QcCompleted').rules("remove", "required");
            $('#MaterialTransferd').rules("remove", "required");
            $('#RmPartCode').rules("remove", "required");
            $('#RmItemName').rules("remove", "required");
            $('#AltPartCode').rules("remove", "required");
            $('#AltItemName').rules("remove", "required");
            $('#ReqQty').rules("remove", "required");
            $('#RmBatchNo').rules("remove", "required");
            $('#RmUniqueBatchNo').rules("remove", "required");
            $('#TotalStock').rules("remove", "required");
            $('#LotStock').rules("remove", "required");
            $('#Unit').rules("remove", "required");
            $('#BatchDate').rules("remove", "required");
            $('#Rate').rules("remove", "required");
            $('#DetailRemark').rules("remove", "required");
            $('#StdPacking').rules("remove", "required");
            $('#BatchNo').rules("remove", "required");
            $('#UniqueBatchNo').rules("remove", "required");
            $('#QCOffered').rules("remove", "required");
            $('#ReasonDetail').rules("remove", "required");
            $('#ResEmpName').rules("remove", "required");
            $('#Others').rules("remove", "required");
            $('#OperatorName').rules("remove", "required");
            $('#OverTimeHrs').rules("remove", "required");
            $('#MachineCharges').rules("remove", "required");
            $('#ScrapPartCode').rules("remove", "required");
            $('#ScrapItemName').rules("remove", "required");
            $('#ScrapItemName').rules("remove", "required");
            $('#ScrapQty').rules("remove", "required");
            $('#Scrapunit').rules("remove", "required");
            $('#StoreTransferScrap').rules("remove", "required");
            $('#ScrapType').rules("remove", "required");
            $('#TransferToWCStore').rules("remove", "required");

            FillShift();
            FillWorkcenter();
            FillMachineGroup();
            FillMachineName();
            GetItem();
            GetPartCode();
            FillOperator();
            FillSuperwiser();
            FillOperatorName();
            FillBreakdownreason();
            FillResponsibleEmp();
            FillScrapItems();
            FillScrapPartCode();
            FillScrapType();
            FillProductType();
            FillResFactor();
            FillAltItemName();
            FillAltPartCode();
            FillTool();
            FillShiftTime();
            CheckAutoOrManual();
            if ($('#Mode').val() != 'U' && $('#Mode').val() != 'V') {
                /* alert("inside"); */
                fillEntryandGate();

                var finFromDate = $('#FinFromDate').val();
                var finToDate = $('#FinToDate').val();

                var dateParts1 = finFromDate.split("/");
                var monthNames = {
                    "Jan": "01",
                    "Feb": "02",
                    "Mar": "03",
                    "Apr": "04",
                    "May": "05",
                    "Jun": "06",
                    "Jul": "07",
                    "Aug": "08",
                    "Sep": "09",
                    "Oct": "10",
                    "Nov": "11",
                    "Dec": "12"
                };

                var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
                var dateParts2 = finToDate.split("/");
                $('#altProductionentry').hide();
                /* $('#unplannedtarget').hide(); */
                $('#AddChildPartbtn').hide();
                $('#StoreTransferdiv').hide();
                $('#Rejtransferdiv').hide();

                var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];

                $('#SoDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#ReWorkEntrydate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#QcOfferedDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#ActualEntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#LastUpdatedDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#BatchDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                function getFormattedDate() {
                    var today = new Date();
                    var year = today.getFullYear();
                    var month = String(today.getMonth() + 1).padStart(2, '0'); // Months are zero-based
                    var day = String(today.getDate()).padStart(2, '0'); // Pad single digits with a leading zero

                    return `${year}-${month}-${day}`;
                }

                var fromtime = $('#ProdStartTime').val();
                var ProdStartTime = fromtime.split("T")[1].slice(0, 5);
                var ProdstartDate = getFormattedDate(ProdstartDate);
                var maxProdStartDate = new Date();
                var StartTime = `${ProdstartDate} ${ProdStartTime}`;
                maxProdStartDate.setDate(maxProdStartDate.getDate() + 1);
                flatpickr("#ProdStartTime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: StartTime,
                    minDate: ProdstartDate, // Minimum selectable date and time
                    maxDate: maxProdStartDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });


                var totime = $('#ProdEndTime').val();
                var ProdEndTime = totime.split("T")[1].slice(0, 5);
                var ProdendDate = getFormattedDate(ProdendDate);
                var maxProdEndDate = new Date(ProdendDate);
                var EndTime = `${ProdendDate} ${ProdEndTime}`;
                maxProdEndDate.setDate(maxProdEndDate.getDate() + 2);
                flatpickr("#ProdEndTime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: EndTime,
                    minDate: ProdendDate, // Minimum selectable date and time
                    maxDate: maxProdEndDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });

                flatpickr("#BreakfromTime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: StartTime,
                    minDate: ProdstartDate, // Minimum selectable date and time
                    maxDate: maxProdStartDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });

                flatpickr("#BreaktoTime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: EndTime,
                    minDate: ProdendDate, // Minimum selectable date and time
                    maxDate: maxProdEndDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });

                flatpickr("#Fromtime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: StartTime,
                    minDate: ProdstartDate, // Minimum selectable date and time
                    maxDate: maxProdStartDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });

                flatpickr("#ToTime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: EndTime,
                    minDate: ProdendDate, // Minimum selectable date and time
                    maxDate: maxProdEndDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });


                var fromDateStr = $('#BreakfromTime').val();
                var toTimeStr = $('#BreaktoTime').val();
                function CheckBreakdownDifference(fromDateStr, toTimeStr) {

                    var fromDate = new Date(fromDateStr);
                    var toTime = new Date(toTimeStr);
                    if (fromDate > toTime) {
                        var breakToTime = $('#BreaktoTime').val();
                        var parts = breakToTime.split(' ');
                        var datePart = parts[0];
                        var timePart = parts[1];
                        var dateComponents = datePart.split('-');
                        var year = parseInt(dateComponents[0]);
                        var month = parseInt(dateComponents[1]);
                        var day = parseInt(dateComponents[2]);
                        var newDateObj = new Date(year, month - 1, day + 1);
                        var newDatePart = newDateObj.getFullYear() + '-' +
                            ('0' + (newDateObj.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + newDateObj.getDate()).slice(-2);
                        var newDateTime = newDatePart + ' ' + timePart;
                        $('#BreaktoTime').val(newDateTime);
                        flatpickr("#BreaktoTime", {
                            enableTime: true,
                            dateFormat: "Y-m-d H:i",
                            altInput: true,
                            altFormat: "H:i",
                            enableSeconds: true, // Enable seconds input
                            defaultDate: newDateTime,
                            minDate: ProdendDate, // Minimum selectable date and time
                            maxDate: maxProdEndDate, // Maximum selectable date and time
                            onChange: function (selectedDates, dateStr, instance) {
                                instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                            }
                        });
                        GetTimeDiff();
                    }
                }

                var fromDateStr = $('#ProdStartTime').val();
                var toTimeStr = $('#ProdEndTime').val();
                function CheckDifference(fromDateStr, toTimeStr) {

                    var fromDate = new Date(fromDateStr);
                    var toTime = new Date(toTimeStr);
                    if (fromDate > toTime) {
                        var breakToTime = $('#ProdEndTime').val();
                        var parts = breakToTime.split(' ');
                        var datePart = parts[0];
                        var timePart = parts[1];
                        var dateComponents = datePart.split('-');
                        var year = parseInt(dateComponents[0]);
                        var month = parseInt(dateComponents[1]);
                        var day = parseInt(dateComponents[2]);
                        var newDateObj = new Date(year, month - 1, day + 1);
                        var newDatePart = newDateObj.getFullYear() + '-' +
                            ('0' + (newDateObj.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + newDateObj.getDate()).slice(-2);
                        var newDateTime = newDatePart + ' ' + timePart;
                        $('#ProdEndTime').val(newDateTime);
                        flatpickr("#ProdEndTime", {
                            enableTime: true,
                            dateFormat: "Y-m-d H:i",
                            altInput: true,
                            altFormat: "H:i",
                            enableSeconds: true, // Enable seconds input
                            defaultDate: newDateTime,
                            minDate: ProdendDate, // Minimum selectable date and time
                            maxDate: maxProdEndDate, // Maximum selectable date and time
                            onChange: function (selectedDates, dateStr, instance) {
                                instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                            }
                        });
                    }
                }

                var fromDateStr = $('#Fromtime').val();
                var toTimeStr = $('#ToTime').val();
                function CheckOperatorDifference(fromDateStr, toTimeStr) {

                    var fromDate = new Date(fromDateStr);
                    var toTime = new Date(toTimeStr);
                    if (fromDate > toTime) {
                        var breakToTime = $('#ToTime').val();
                        var parts = breakToTime.split(' ');
                        var datePart = parts[0];
                        var timePart = parts[1];
                        var dateComponents = datePart.split('-');
                        var year = parseInt(dateComponents[0]);
                        var month = parseInt(dateComponents[1]);
                        var day = parseInt(dateComponents[2]);
                        var newDateObj = new Date(year, month - 1, day + 1);
                        var newDatePart = newDateObj.getFullYear() + '-' +
                            ('0' + (newDateObj.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + newDateObj.getDate()).slice(-2);
                        var newDateTime = newDatePart + ' ' + timePart;
                        $('#ToTime').val(newDateTime);
                        flatpickr("#ToTime", {
                            enableTime: true,
                            dateFormat: "Y-m-d H:i",
                            altInput: true,
                            altFormat: "H:i",
                            enableSeconds: true, // Enable seconds input
                            defaultDate: newDateTime,
                            minDate: ProdendDate, // Minimum selectable date and time
                            maxDate: maxProdEndDate, // Maximum selectable date and time
                            onChange: function (selectedDates, dateStr, instance) {
                                instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                            }
                        });
                        GetTimeDiffHours();
                    }
                }

                CheckBreakdownDifference(fromDateStr, toTimeStr);
                CheckDifference(fromDateStr, toTimeStr);
                CheckOperatorDifference(fromDateStr, toTimeStr);
                GetServerDate();
                CheckProdDate();
            }
            if ($('#Mode').val() == 'U' || $('#Mode').val() == 'V') {

                $('#displaylistbutton').show();
                $('#displayroutingdata').show();
                $('#altProductionentry').hide();
                var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ")[0]);

                /* monika */
                /* $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", EntryDate); */
                 $('#EntryDate').datepicker("setDate", EntryDate);
                 /* ------------ */

              /*   var ActualProdDate = parseDateToFormat($('#ActualProdDate').val().split(" ")[0]);
                $('#ActualProdDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", ActualProdDate); */

                $('#LastUpdatedDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                var QcMandatory = "@Model.QCMandatory";
                $('#QcMandatory').val(QcMandatory);
                if ($('#StartupRej').val() == 0 || $('#QcRejQty').val() == 0) {
                    $('#StoreTransferdiv').hide();
                    $('#Rejtransferdiv').hide();
                }
                $('#SenToQc').change();
                $('#StoreTransfer').change();
                function getFormattedDate() {
                    var today = new Date();
                    var year = today.getFullYear();
                    var month = String(today.getMonth() + 1).padStart(2, '0'); // Months are zero-based
                    var day = String(today.getDate()).padStart(2, '0'); // Pad single digits with a leading zero

                    return `${year}-${month}-${day}`;
                }
                var fromtime = $('#ProdStartTime').val();
                var ProdStartTime = fromtime.split("T")[1].slice(0, 5);
                var ProdstartDate = getFormattedDate(ProdstartDate);
                var maxProdStartDate = new Date();
                var StartTime = `${ProdstartDate} ${ProdStartTime}`;
                maxProdStartDate.setDate(maxProdStartDate.getDate() + 1);
                flatpickr("#ProdStartTime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: StartTime,
                    minDate: ProdstartDate, // Minimum selectable date and time
                    maxDate: maxProdStartDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });


                var totime = $('#ProdEndTime').val();
                var ProdEndTime = totime.split("T")[1].slice(0, 5);
                var ProdendDate = getFormattedDate(ProdendDate);
                var maxProdEndDate = new Date(ProdendDate);
                var EndTime = `${ProdendDate} ${ProdEndTime}`;
                maxProdEndDate.setDate(maxProdEndDate.getDate() + 2);
                flatpickr("#ProdEndTime", {
                    enableTime: true,
                    dateFormat: "Y-m-d H:i",
                    altInput: true,
                    altFormat: "H:i",
                    enableSeconds: true, // Enable seconds input
                    defaultDate: EndTime,
                    minDate: ProdendDate, // Minimum selectable date and time
                    maxDate: maxProdEndDate, // Maximum selectable date and time
                    onChange: function (selectedDates, dateStr, instance) {
                        instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                    }
                });

                var selectElement = $("#ProdAgainstPlanManual");
                var desiredValue = $('#hiddenProdAgain').val();
                if (desiredValue == 'REQUISITION') {
                    $('#ProdAgainstPlanManual').append('<option value="PRODSCHEDULE">Against Plan Sch</option>\
                                                                                                                                                                                                                                                                                                                                                                                                            <option selected value="REQUISITION">Against Requisition</option>\
                                                                                                                                                                                                                                                                                                                                                                                                            <option value="UNPLANNED">UnPlanned</option>\
                                                                                                                                                                                                                                                                                                                                                                                                           ');
                }
                else if (desiredValue == 'PRODSCHEDULE') {
                    $('#ProdAgainstPlanManual').append('<option selected value="PRODSCHEDULE">Against Plan Sch</option>\
                                                                                                                                                                                                                                                                                                                                                                                                                    <option value="REQUISITION">Against Requisition</option>\
                                                                                                                                                                                                                                                                                                                                                                                                                    <option value="UNPLANNED">UnPlanned</option>\
                                                                                                                                                                                                                                                                                                                                                                                                                   ');
                }
                else if (desiredValue == 'UNPLANNED') {
                    $('#ProdAgainstPlanManual').append('<option value="PRODSCHEDULE">Against Plan Sch</option>\
                                                                                                                                                                                                                                                                                                                                                                                                                            <option value="REQUISITION">Against Requisition</option>\
                                                                                                                                                                                                                                                                                                                                                                                                                            <option selected value="UNPLANNED">UnPlanned</option>\
                                                                                                                                                                                                                                                                                                                                                                                                                           ');
                }
                $('#ProdAgainstPlanManual').change();
                $('#Store').change();
                var selectElement = $("#PartCode");
                var desiredValue = $('#hiddenPartCode').val();
                selectElement.find("option[value='" + desiredValue + "']").prop("selected", true);
                CheckProdDate();
                GetProcessDetail();
            }

            function actualformateDate(dateStr) {
                var parts = dateStr.split('/');
                return `${parts[2]}-${parts[1]}-${parts[0]}`;
            }

        })

        document.getElementById('unTarget').addEventListener('focusout', function () {
            const value = this.value;
            document.getElementById('ProdQty').value = value;
            FillScrapData();
            FillProductDetail();

            const grid = document.getElementById('divProductDetailGrid');
            const alertBox = document.getElementById('productDetailAlert');

            if (grid && grid.innerHTML.trim() !== "") {
                alertBox.style.display = "inline-block";
            } else {
                alertBox.style.display = "none";
            }

            const Scrapgrid = document.getElementById('divScrapDetailGrid');
            const ScrapalertBox = document.getElementById('scrapDetailAlert');

            if (Scrapgrid && Scrapgrid.innerHTML.trim() !== "") {
                ScrapalertBox.style.display = "inline-block";
            } else {
                ScrapalertBox.style.display = "none";
            }
        });

        $('#ProdAgainstPlanManual').select2();
        $('#Shift').select2();
        $('#ItemName').select2();
        $('#PartCode').select2();
        $('#WorkCenter').select2();
        $('#ReqNo').select2();
        $('#ReqYear').select2();
        $('#ProdSch').select2();
        $('#ProdSchYear').select2();
        $('#ParentProdSch').select2();
        $('#ParentProdSchYear').select2();
        $('#MachineGroup').select2();
        $('#MachineName').select2();
        $('#Operation').select2();
        $('#BOMNo').select2();
        $('#RejTransferTo').select2();
        $('#NextWorkCenter').select2();
        $('#Superwiser').select2();
        $('#Operator').select2();
        $('#OperatorName').select2();
        $('#ReasonDetail').select2();
        $('#ResEmpName').select2();
        $('#ResFactor').select2();
        $('#ScrapItemName').select2();
        $('#ScrapPartCode').select2();
        $('#ScrapType').select2();
        $('#TransferToWCStore').select2();
        $('#ProductItemName').select2();
        $('#ProductPartCode').select2();
        $('#ProductType').select2();
        $('#ProductTransferToWCStore').select2();
        $('#AltItemName').select2();
        $('#AltPartCode').select2();
        $('#RmPartCode').select2();
        $('#RmItemName').select2();


        if($('#ProdAgainstPlanManual').val() == "UNPLANNED")
        {
            $('#ProdSchdiv').hide();
            $('#ProdSchYeardiv').hide();
            $('#ProdSchDatediv').hide();
            $('#ProdPlandiv').hide();
            $('#ProdPlanYeardiv').hide();
            $('#ProdPlanDatediv').hide();
            $('#ParentProdSchdiv').hide();
            $('#ParentProdSchYeardiv').hide();
            $('#ReqNodiv').hide();
            $('#ReqYeardiv').hide();
            $('#ReqDatediv').hide();
            $('#plannedtarget').hide();
            $('#unplannedtarget').show();
            $('#ProdSch').val('');
            $('#ProdSchYear').val('');
            $('#ProdPlan').val('');
            $('#ProdPlanYear').val('');
            $('#ProdPlanDate').val('');
            $('#ReqNo').val('');
            $('#ReqYear').val('');
            $('#ReqDate').val('');
            if ($('#Mode').val() != "U" && $('#Mode').val() != "V") {
                $('#TargetQty').val(0);
                $('#ProdQty').val(0);
                $('#PendQty').val(0);
            }
            GetItem();
            GetPartCode();
        }

        $('#ProdAgainstPlanManual').change(function () {

            if ($('#ProdAgainstPlanManual').val() == "REQUISITION") {

                $('#ProdSchdiv').hide();
                $('#ProdSchYeardiv').hide();
                $('#ProdSchDatediv').hide();
                $('#ProdPlandiv').hide();
                $('#ProdPlanYeardiv').hide();
                $('#ProdPlanDatediv').hide();
                $('#ParentProdSchdiv').hide();
                $('#ParentProdSchYeardiv').hide();
                $('#ReqNodiv').show();
                $('#ReqYeardiv').show();
                $('#ReqDatediv').show();
                $('#plannedtarget').show();
                $('#unplannedtarget').hide();
                $('#ProdSch').val('');
                $('#ProdSchYear').val('');
                $('#ProdPlan').val('');
                $('#ProdPlanYear').val('');
                $('#ProdPlanDate').val('');
                if ($('#Mode').val() != "U" && $('#Mode').val() != "V") {
                    $('#TargetQty').val(0);
                    $('#ProdQty').val(0);
                    $('#PendQty').val(0);
                }
                GetItem();
                GetPartCode();
            } else if ($('#ProdAgainstPlanManual').val() == "PRODSCHEDULE") {
                $('#ProdSchdiv').show();
                $('#ProdSchYeardiv').show();
                $('#ProdSchDatediv').show();
                $('#ProdPlandiv').show();
                $('#ProdPlanYeardiv').show();
                $('#ProdPlanDatediv').show();
                $('#ParentProdSchdiv').show();
                $('#ParentProdSchYeardiv').show();
                $('#ReqNodiv').hide();
                $('#ReqYeardiv').hide();
                $('#ReqDatediv').hide();
                $('#plannedtarget').show();
                $('#unplannedtarget').hide();
                $('#ReqNo').val('');
                $('#ReqYear').val('');
                $('#ReqDate').val('');
                if ($('#Mode').val() != "U" && $('#Mode').val() != "V") {
                    $('#TargetQty').val(0);
                    $('#ProdQty').val(0);
                    $('#PendQty').val(0);
                }
                GetItem();
                GetPartCode();
            } else if ($('#ProdAgainstPlanManual').val() == "UNPLANNED") {
                $('#ProdSchdiv').hide();
                $('#ProdSchYeardiv').hide();
                $('#ProdSchDatediv').hide();
                $('#ProdPlandiv').hide();
                $('#ProdPlanYeardiv').hide();
                $('#ProdPlanDatediv').hide();
                $('#ParentProdSchdiv').hide();
                $('#ParentProdSchYeardiv').hide();
                $('#ReqNodiv').hide();
                $('#ReqYeardiv').hide();
                $('#ReqDatediv').hide();
                $('#plannedtarget').hide();
                $('#unplannedtarget').show();
                $('#ProdSch').val('');
                $('#ProdSchYear').val('');
                $('#ProdPlan').val('');
                $('#ProdPlanYear').val('');
                $('#ProdPlanDate').val('');
                $('#ReqNo').val('');
                $('#ReqYear').val('');
                $('#ReqDate').val('');
                if ($('#Mode').val() != "U" && $('#Mode').val() != "V") {
                    $('#TargetQty').val(0);
                    $('#ProdQty').val(0);
                    $('#PendQty').val(0);
                }
                GetItem();
                GetPartCode();
            }
        })
        var currentSearchColumn = null;
         
        $("#search-box").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#divProductionEntryGrid tr").filter(function () {
                if (currentSearchColumn !== null) {
                    var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
                    $(this).toggle(columnText.indexOf(value) > -1);
                } else {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                }
            });
        });


        $(document).on("click", "th[data-columnno]", function () {
            currentSearchColumn = $(this).data('columnno');
            $("#search-box").val('').trigger('keyup'); // Reset search box and trigger the search
        });

        var currentSearchColumn2 = null;
         
        $("#search-box2").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#divAddProductionEntryGrid tr").filter(function () {
                if (currentSearchColumn2 !== null) {
                    var columnText = $(this).find('td').eq(currentSearchColumn2).text().toLowerCase();
                    $(this).toggle(columnText.indexOf(value) > -1);
                } else {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                }
            });
        });


        $(document).on("click", "th[data-columnno]", function () {
            currentSearchColumn2 = $(this).data('columnno');
            $("#search-box2").val('').trigger('keyup'); // Reset search box and trigger the search
        });
        $('#Store').change(function () {
            if ($('#Store').val() == "S") {
                $('#NextWorkCenter').change(function () {
                    $('#NextStoreId').val($('#NextWorkCenter').val());
                    $('#NextWCID').val(0);
                });
            }
            if ($('#Store').val() == 'W') {
                if ($('#QcMandatory').val() == 'Y') {
                    $('#Store').append('<option value="W"> WorkCenter </option>');
                    $('#Store').val("W");
                    FillIssWorkcenterForQcMandatory();
                }
                if ($('#QcMandatory').val() == 'N') {
                    FillIssWorkcenter();
                }
                $('#NextWorkCenter').change(function () {
                    $('#NextWCID').val($('#NextWorkCenter').val());
                    $('#NextStoreId').val(0);
                });
            }
            else if ($('#Store').val() == 'S') {
                FillIssStore();
            }
        })

        $('#StoreTransfer').change(function () {

            if ($('#StoreTransfer').val() == 'W') {
                FillTransferWorkCenter();
            }
            else if ($('#StoreTransfer').val() == 'S') {
                FillStore();
            }
        })

        $('#StoreTransferScrap').change(function () {

            if ($('#StoreTransferScrap').val() == 'W') {
                FillTransferWorkCenterforScrap();
            }
            else if ($('#StoreTransferScrap').val() == 'S') {
                FillStoreforScrap();
            }
        })

        $('#StoreTransferProduct').change(function () {

            if ($('#StoreTransferProduct').val() == 'W') {
                FillProductTransferWorkCenterforScrap();
            }
            else if ($('#StoreTransferProduct').val() == 'S') {
                FillProductStoreforScrap();
            }
        })

        function GetServerDate() {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetServerDate", "ProductionEntry")",
                async: false,
                success: function (result, status, error) {
                     const serverDate = new Date(result);
                     /* alert(serverDate); */
                     $('#ActualProdDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", serverDate);
                    $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", serverDate);
                    
                     
                }
            });
        }



        function getFormattedDate() {
            var today = new Date();
            var year = today.getFullYear();
            var month = String(today.getMonth() + 1).padStart(2, '0'); // Months are zero-based
            var day = String(today.getDate()).padStart(2, '0'); // Pad single digits with a leading zero

            return `${year}-${month}-${day}`;
        }

        $('#StartupRej').change(function () {

            if ($('#StartupRej').val() < 0) {
                $.notify("StartupRejQty cannot less than zero.", 'error');
                $('#StoreTransferdiv').hide();
                $('#Rejtransferdiv').hide();
            }
            else if ($('#StartupRej').val() > 0) {
                $('#StoreTransferdiv').show();
                $('#Rejtransferdiv').show();
                var StartupRej = Number(parseFloat($('#StartupRej').val()).toFixed(6));
                var QcRejQty = Number(parseFloat($('#QcRejQty').val()).toFixed(6));
                var BothPlusQty = StartupRej + QcRejQty;
                if (BothPlusQty > Number(parseFloat($('#ProdQty').val()).toFixed(6))) {
                    $.notify("ProdQty cannot Less that StartupRej + QcRejQty", "error");
                }
            }
        })

        $('#QcRejQty').change(function () {

            if ($('#QcRejQty').val() < 0) {
                $.notify("QcRejQty cannot less than zero.", 'error');
                $('#StoreTransferdiv').hide();
                $('#Rejtransferdiv').hide();
            }
            else if ($('#QcRejQty').val() > 0) {
                $('#StoreTransferdiv').show();
                $('#Rejtransferdiv').show();
                var StartupRej = Number(parseFloat($('#StartupRej').val()).toFixed(6));
                var QcRejQty = Number(parseFloat($('#QcRejQty').val()).toFixed(6));
                var BothPlusQty = StartupRej + QcRejQty;
                if (BothPlusQty > Number(parseFloat($('#ProdQty').val()).toFixed(6))) {
                    $.notify("ProdQty cannot Less that StartupRej + QcRejQty", "error");
                }
            }
        })

        $('#BOMNo').change(function () {
            FillScrapData();
            FillProductDetail();
            FillProductPartCode();
            FillProductItems();
        })

        function fillEntryandGate() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillEntryandGate")",
                dataType: "json",
                data: { "YearCode": $('#YearCode').val(), "EntryDate": $('#EntryDate').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        console.log(obj);
                        $('#EntryId').val(obj.Result[0].ProdEntryId);
                        $('#ProdSlipNo').val(obj.Result[0].ProdSlipNo);
                    }
                }
            });
        }

        $('#Shift').change(function () {

            $('#ShiftId').val($('#Shift').val());
            FillShiftTime();
            var fromtime = $('#ProdStartTime').val();
            var ProdStartTime = fromtime.split("T")[1].slice(0, 5);
            var ProdstartDate = getFormattedDate(ProdstartDate);
            var maxProdStartDate = new Date();
            var StartTime = `${ProdstartDate} ${ProdStartTime}`;
            maxProdStartDate.setDate(maxProdStartDate.getDate() + 1);
            flatpickr("#ProdStartTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "H:i",
                enableSeconds: true, // Enable seconds input
                defaultDate: StartTime,
                minDate: ProdstartDate, // Minimum selectable date and time
                maxDate: maxProdStartDate, // Maximum selectable date and time
                onChange: function (selectedDates, dateStr, instance) {
                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                }
            });


            var totime = $('#ProdEndTime').val();
            var ProdEndTime = totime.split("T")[1].slice(0, 5);
            var ProdendDate = getFormattedDate(ProdendDate);
            var maxProdEndDate = new Date(ProdendDate);
            var EndTime = `${ProdendDate} ${ProdEndTime}`;
            maxProdEndDate.setDate(maxProdEndDate.getDate() + 2);
            flatpickr("#ProdEndTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "H:i",
                enableSeconds: true, // Enable seconds input
                defaultDate: EndTime,
                minDate: ProdendDate, // Minimum selectable date and time
                maxDate: maxProdEndDate, // Maximum selectable date and time
                onChange: function (selectedDates, dateStr, instance) {
                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                }
            });

            flatpickr("#BreakfromTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "H:i",
                enableSeconds: true, // Enable seconds input
                defaultDate: StartTime,
                minDate: ProdstartDate, // Minimum selectable date and time
                maxDate: maxProdStartDate, // Maximum selectable date and time
                onChange: function (selectedDates, dateStr, instance) {
                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                }
            });

            flatpickr("#BreaktoTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "H:i",
                enableSeconds: true, // Enable seconds input
                defaultDate: EndTime,
                minDate: ProdendDate, // Minimum selectable date and time
                maxDate: maxProdEndDate, // Maximum selectable date and time
                onChange: function (selectedDates, dateStr, instance) {
                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                }
            });
            flatpickr("#Fromtime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "H:i",
                enableSeconds: true, // Enable seconds input
                defaultDate: StartTime,
                minDate: ProdstartDate, // Minimum selectable date and time
                maxDate: maxProdStartDate, // Maximum selectable date and time
                onChange: function (selectedDates, dateStr, instance) {
                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                }
            });

            flatpickr("#ToTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                altInput: true,
                altFormat: "H:i",
                enableSeconds: true, // Enable seconds input
                defaultDate: EndTime,
                minDate: ProdendDate, // Minimum selectable date and time
                maxDate: maxProdEndDate, // Maximum selectable date and time
                onChange: function (selectedDates, dateStr, instance) {
                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                }
            });
        });
        $('#WorkCenter').change(function () {
            $('#ProdInWCID').val($('#WorkCenter').val());
            GetProcessDetail();
            FillOperation();
            GetTotalStockWorkCenterQty();
        });
        $('#Operation').change(function () {

            $('#ProcessId').val($('#Operation').val());
            GetProcessDetail();
        });
        $('#MachineName').change(function () {
            $('#MachineId').val($('#MachineName').val());
        });
        $('#StoreTransfer').change(function () {

            if ($('#Store').val() == "S") {
                $('#RejTransferTo').change(function () {
                    $('#TransferToRejStoreId').val($('#RejTransferTo').val());
                    $('#RejWCId').val(0);
                });
            }
            else if ($('#StoreTransfer').val() == "W") {
                $('#RejTransferTo').change(function () {
                    $('#RejWCId').val($('#RejTransferTo').val());
                    $('#TransferToRejStoreId').val(0);
                });
            }
        });
        function FillShift() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillShift")",
                dataType: "json",
                data: {},
                async: false,
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#Shift').empty();
                            $('#Shift').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {

                                $('#Shift').append('<option selected value="' + val.entryid + '">' + val.shiftname + '</option>');
                                $('#ShiftId').val($('#Shift').val())
                            })
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var shiftname = $('#ShiftId').val();
                                $('#Shift').val(shiftname).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function FillShiftTime() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillShiftTime")",
                dataType: "json",
                data: { "ShiftId": $('#Shift').val() },
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#ProdStartTime').val(obj.Result[0].FromTime)
                        $('#ProdEndTime').val(obj.Result[0].ToTime)
                    }
                }
            });
        }

        function FillScrapData() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillScrapData")",
                data: { "FGItemCode": parseInt($('#FGItemCode').val()), "FgProdQty": parseFloat($('#ProdQty').val()), "BomNo": $('#BOMNo').val() },
                async: false,
                success: function (data) {

                    $('#divScrapDetailGrid').empty().append(data);
                }
            });
        }

        function FillProductDetail() {
            $('#divProductDetailGrid').empty();
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProductDetail")",
                data: { "FGItemCode": parseInt($('#FGItemCode').val()), "FgProdQty": parseFloat($('#ProdQty').val()), "BomNo": $('#BOMNo').val() },
                async: false,
                success: function (data) {
                    console.log("Product Data" + data);
                    $('#divProductDetailGrid').append(data);
                }
            });
        }

        function FillSuperwiser() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillSuperwiser")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#Superwiser').empty();
                            $('#Superwiser').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#Superwiser').append('<option selected value="' + val.Emp_Name + '">' + val.Emp_Name + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillOperator() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillOperator")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#Operator').empty();
                            $('#Operator').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#Operator').append('<option selected value="' + val.Emp_Name + '">' + val.Emp_Name + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillOperatorName() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillOperatorName")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#OperatorName').empty();
                            $('#OperatorName').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#OperatorName').append('<option selected value="' + val.Emp_Id + '">' + val.Emp_Name + '</option>');
                                $('#OperatorId').val($('#OperatorName').val())
                            })
                        }
                    }
                }
            });
        }

        function FillBreakdownreason() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillBreakdownreason")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ReasonDetail').empty();
                            $('#ReasonDetail').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ReasonDetail').append('<option selected value="' + val.entryid + '">' + val.BreakDownreason + '</option>');
                                $('#ReasonId').val($('#ReasonDetail').val());
                            })
                        }
                    }
                }
            });
        }

        function FillWorkcenter() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillWorkcenter")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#WorkCenter').empty();
                            $('#WorkCenter').append('<option disabled>-Select-</option>');
                            var WcId = "@Model.ProdInWCID";
                            WcId = WcId ? parseInt(WcId, 10) : 0;
                            $.each(obj.Result, function (index, val) {
                                var isSelected = (val.entryid == WcId) ? "selected" : "";
                                $('#WorkCenter').append('<option ' + isSelected + ' value="' + val.entryid + '">' + val.WorkCenterDescription + '</option>');
                            });
                            $('#ProdInWCID').val($('#WorkCenter').val());
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var workcenter = $('#ProdInWCID').val();
                                $('#WorkCemter').val(workcenter).trigger("change");
                            }
                            FillOperation();
                        }
                    }
                }
            });
        }


        $('#ActualProdDate').change(function () {
            $('#divProductionEntryGrid').empty();
            $('#divAddProductionEntryGrid').empty();
        });
        $('#ProdQty').change(function () {
            $('#divProductionEntryGrid').empty();
            $('#divAddProductionEntryGrid').empty();
            FillScrapData();
            FillProductDetail();
        });
        $('#WorkCenter').change(function () {
            $('#divProductionEntryGrid').empty();
            $('#divAddProductionEntryGrid').empty();
            GetProcessDetail();
        });
        function FillTransferWorkCenterforScrap() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillTransferWorkCenter")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#TransferToWCStore').empty();
                            $('#TransferToWCStore').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#TransferToWCStore').append('<option selected value="' + val.entryid + '">' + val.WorkCenterDescription + '</option>');
                                $('#TransferToWC').val($('#TransferToWCStore').val())
                            })
                        }
                    }
                }
            });
        }
        function FillProductTransferWorkCenterforScrap() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillTransferWorkCenter")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProductTransferToWCStore').empty();
                            $('#ProductTransferToWCStore').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ProductTransferToWCStore').append('<option selected value="' + val.entryid + '">' + val.WorkCenterDescription + '</option>');
                                $('#ProductToWC').val($('#ProductTransferToWCStore').val())
                            })
                        }
                    }
                }
            });
        }
        function FillScrapType() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillScrapType")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ScrapType').empty();
                            $('#ScrapType').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ScrapType').append('<option selected value="' + val.ScrapType + '">' + val.ScrapType + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillProductType() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProductType")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProductType').empty();
                            $('#ProductType').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ProductType').append('<option selected value="' + val.ProductType + '">' + val.ProductType + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillResFactor() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillResFactor")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ResFactor').empty();
                            $('#ResFactor').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ResFactor').append('<option selected value="' + val.ResFactor + '">' + val.ResFactor + '</option>');
                            })
                        }
                    }
                }
            });
        }

        var itemBatchArray = [];//for deleting and adding batchnos in batchlist if its performed
        var BatchUniqueUpd = [];//for deleting batches in sequence
        var SeqForBatch = 1;

        function GetBatchNo() {

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetBatchNumber")',
                data: { ItemCode: $('#RmItemName').val(), YearCode: $('#YearCode').val(), WcId: $('#WorkCenter').val(), TransDate: $('#ActualProdDate').val(), BatchNo: $('#BatchNo').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#RmBatchNo').empty();
                            $('#RmBatchNo').append('<option value="0" disabled selected>-Select-</option>');
                            //$('#uniquebatchno').empty();
                            //$('#uniquebatchno').append('<option value="" disabled selected>-Select-</option>');

                            var seenValues = {};
                            $.each(obj.Result, function (index, val) {

                                if (!seenValues[val.batchno]) {
                                    seenValues[val.batchno] = true;
                                    $('#RmBatchNo').append('<option value="' + val.batchno + '">' + val.batchno + '</option>');
                                }
                                //$('#RmUniqueBatchNo').append('<option value="' + val.UniqueBatchNo + '">' + val.UniqueBatchNo + '</option>');
                            });

                            var selectListLength = $('#RmBatchNo option').length - 1;
                            // var selectList
                            var itemArrayLength = itemBatchArray.length;
                            if (itemArrayLength > 0) {

                                var itemsWithCode16 = itemBatchArray.filter(function (item) {
                                    return item.itemcode === parseInt(ItemCode);
                                });
                                var selectList = $('#RmBatchNo');
                                selectList.find('option').each(function () {

                                    var optionValue = $(this).val();

                                    var existsInItemsWithCode16 = itemsWithCode16.some(function (item) {
                                        return item.batchno === optionValue;
                                    });

                                    if (existsInItemsWithCode16) {
                                        $(this).remove();
                                    }
                                });
                            }
                        } else {
                            $('#RmBatchNo').empty();
                            $('#RmBatchNo').append('<option value="0" disabled selected>-Select-</option>');
                            $('#RmUniqueBatchNo').empty();
                            $('#RmUniqueBatchNo').append('<option value="0" disabled selected>-Select-</option>');
                        }

                    }
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        }

        $('#RmBatchNo').change(function () {

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetBatchNumber")',
                data: { ItemCode: $('#RmItemName').val(), YearCode: $('#YearCode').val(), WcId: $('#WorkCenter').val(), TransDate: $('#ActualProdDate').val(), BatchNo: $('#RmBatchNo').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {

                            $('#RmUniqueBatchNo').empty();
                            $('#RmUniqueBatchNo').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                if ($("#RmUniqueBatchNo option[value='" + val.UniqueBatchNo + "']").length == 0) {
                                    $('#RmUniqueBatchNo').append('<option value="' + val.UniqueBatchNo + '" data-stock="' + val.stock + '">' + val.UniqueBatchNo + '</option>');
                                }
                            });
                        }
                    }
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        });

        function FillTool() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillTool")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ToolName').empty();
                            $('#ToolName').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ToolName').append('<option selected value="' + val.itemCode + '">' + val.ItemName + '</option>');
                            })
                            $('#ToolItemCode').val($('#ToolName').val());
                        }
                    }
                }
            });
        }

        $('#RmUniqueBatchNo').change(function () {
            GetBatchWorkCenterQty();
            GetWorkCenterQty();
        });

        var editingBreakdownNow = false;
        function EditBreakdownItemRow(SeqNo) {

            if (editingBreakdownNow == false) {

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: '@Url.Action("EditBreakdownItemRow")',
                        type: "POST",
                        data: { SeqNo: SeqNo, Mode: $('#Mode').val() },
                    })
                        .done(function (data, status, xhr) {
                            editingBreakdownNow = true;
                            var obj = $.parseJSON(data);
                            DeleteBreakdownItemRow(SeqNo)
                                .then(() => {
                                    $('#ReasonDetail').val(obj[0].ReasonId).trigger('change');
                                    $('#ResEmpName').val(obj[0].ResponcibleEmp).trigger('change');
                                    $('#ResFactor').val(obj[0].ResFactor).trigger('change');
                                    $('#BreakTimeMin').val(obj[0].BreakTimeMin)
                                    GetDateforBreakdown();
                                })
                                .catch((error) => {
                                    reject(error);
                                });

                        })
                        .fail(function (response) {
                            reject(response.responseText);
                        });
                });
            }
            else {
                $.notify("Cannot edit as one item is already on above edit grid", "error");
            }
        }

        var isEditBreakdownAllowed = "false";

        function DeleteBreakdownItemRow(SeqNo) {

            return new Promise((resolve, reject) => {
                $.ajax({
                    url: '@Url.Action("DeleteBreakdownItemRow")',
                    type: "POST",
                    data: { "SeqNo": SeqNo, "Mode": $('#Mode').val() },
                    success: function (data) {
                        $('#divBreakdownDetailGrid').html(data);
                        $.notify("Item Deleted from Grid", "info");
                        isEditBreakdownAllowed = "true";
                        resolve();
                    },
                    error: function (response) {
                        reject(response.responseText);
                    }
                });
            });
        }

        var editingOperatorNow = false;
        function EditOperatorItemRow(SeqNo) {

            if (editingOperatorNow == false) {

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: '@Url.Action("EditOperatorItemRow")',
                        type: "POST",
                        data: { SeqNo: SeqNo, Mode: $('#Mode').val() },
                    })
                        .done(function (data, status, xhr) {
                            editingOperatorNow = true;
                            var obj = $.parseJSON(data);
                            DeleteOperatorItemRow(SeqNo)
                                .then(() => {

                                    $('#OperatorName').val(obj[0].OperatorId).trigger('change');
                                    $('#OverTimeHrs').val(obj[0].OverTimeHrs);
                                    $('#MachineCharges').val(obj[0].MachineCharges);
                                    $('#TotalHours').val(obj[0].TotalHours);
                                    GetDateforOperator();
                                })
                                .catch((error) => {
                                    reject(error);
                                });

                        })
                        .fail(function (response) {
                            reject(response.responseText);
                        });
                });
            }
            else {
                $.notify("Cannot edit as one item is already on above edit grid", "error");
            }
        }

        var isEditOperationAllowed = "false";

        function DeleteOperatorItemRow(SeqNo) {

            return new Promise((resolve, reject) => {
                $.ajax({
                    url: '@Url.Action("DeleteOperatorItemRow")',
                    type: "POST",
                    data: { "SeqNo": SeqNo, "Mode": $('#Mode').val() },
                    success: function (data) {

                        $('#divOperatorDetailGrid').html(data);
                        $.notify("Item Deleted from Grid", "info");
                        isEditOperationAllowed = "true";
                        resolve();
                    },
                    error: function (response) {
                        reject(response.responseText);
                    }
                });
            });
        }

        var editingScrapNow = false;
        function EditScrapItemRow(SeqNo) {

            if (editingScrapNow == false) {

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: '@Url.Action("EditScrapItemRow")',
                        type: "POST",
                        data: { SeqNo: SeqNo, Mode: $('#Mode').val() },
                    })
                        .done(function (data, status, xhr) {
                            editingScrapNow = true;
                            var obj = $.parseJSON(data);
                            DeleteScrapItemRow(SeqNo)
                                .then(() => {

                                    $('#ScrapPartCode').val(obj[0].ScrapItemCode).trigger('change');
                                    $('#ScrapItemName').val(obj[0].ScrapItemCode).trigger('change');
                                    $('#ScrapType').val(obj[0].ScrapType).trigger('change');
                                    $('#ScrapQty ').val(obj[0].ScrapQty);
                                    $('#Scrapunit').val(obj[0].Scrapunit);
                                    $('#StoreTransferScrap').change();
                                    $('#StoreTransferScrap').val(obj[0].StoreTransferScrap).trigger('change');
                                    $('#TransferToWCStore').val(obj[0].TransferToWCStore).trigger('change');
                                })
                                .catch((error) => {
                                    reject(error);
                                });

                        })
                        .fail(function (response) {
                            reject(response.responseText);
                        });
                });
            }
            else {
                $.notify("Cannot edit as one item is already on above edit grid", "error");
            }
        }

        var isEditScrapAllowed = "false";

        function DeleteScrapItemRow(SeqNo) {

            return new Promise((resolve, reject) => {
                $.ajax({
                    url: '@Url.Action("DeleteScrapItemRow")',
                    type: "POST",
                    data: { "SeqNo": SeqNo, "Mode": $('#Mode').val() },
                    success: function (data) {
                        $('#divScrapDetailGrid').html(data);
                        $.notify("Item Deleted from Grid", "info");
                        isEditScrapAllowed = "true";
                        resolve();
                    },
                    error: function (response) {
                        reject(response.responseText);
                    }
                });
            });
        }

        var BatchStock = 0;
        function GetBatchWorkCenterQty() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetWorkCenterQty")",
                data: { ItemCode: $('#RmItemName').val(), WcId: $('#WorkCenter').val(), TillDate: $('#ActualProdDate').val(), BatchNo: $('#RmBatchNo').val(), UniqueBatchNo: $('#RmUniqueBatchNo').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        // BatchStock=0
                        $('#LotStock').val($.parseJSON(result).Result[0].STOCK);

                        BatchStock = $.parseJSON(result).Result[0].STOCK;
                    }
                }
            });
        }
        function GetWorkCenterQty() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetWorkCenterTotalStock")",
                data: { ItemCode: $('#RmItemName').val(), WcId: $('#WorkCenter').val(), TillDate: $('#ActualProdDate').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#TotalStock').val($.parseJSON(result).Result[0].STOCK);
                    }
                }
            });
        }

        function GetTotalStockWorkCenterQty() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetWorkCenterTotalStock")",
                data: { ItemCode: $('#ItemName').val(), WcId: $('#WorkCenter').val(), TillDate: $('#ActualProdDate').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#Stock').val($.parseJSON(result).Result[0].STOCK);
                    }
                }
            });
        }

        function GetUnit() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetUnit")",
                data: { RmItemCode: $('#RmItemName').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#Unit').val($.parseJSON(result).Result[0].Unit);
                    }
                }
            });
        }

        function GetScrapUnit() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetScrapUnit")",
                data: { ScrapItemCode: $('#ScrapItemName').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#Scrapunit').val($.parseJSON(result).Result[0].Unit);
                    }
                }
            });
        }

        function GetProductUnit() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProductUnit")",
                data: { ProductItemCode: $('#ProductItemCode').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#Productunit').val($.parseJSON(result).Result[0].Unit);
                    }
                }
            });
        }

        function FillRMItemName() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillRMItemName")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#RmItemName').empty();
                            $('#RmItemName').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#RmItemName').append('<option value="' + val.Item_Code + '">' + val.Item_Name + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillAltItemName() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillAltItemName")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#AltItemName').empty();
                            $('#AltItemName').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#AltItemName').append('<option value="' + val.Item_Code + '">' + val.Item_Name + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillRMPartCode() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillRMPartCode")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#RmPartCode').empty();
                            $('#RmPartCode').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#RmPartCode').append('<option value="' + val.Item_Code + '">' + val.PartCode + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillAltPartCode() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillAltPartCode")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#AltPartCode').empty();
                            $('#AltPartCode').append('<option>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#AltPartCode').append('<option value="' + val.Item_Code + '">' + val.PartCode + '</option>');
                            })
                        }
                    }
                }
            });
        }

        function FillStoreforScrap() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillStore")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#TransferToWCStore').empty();
                            $('#TransferToWCStore').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#TransferToWCStore').append('<option selected value="' + val.entryid + '">' + val.Store_Name + '</option>');
                                $('#TransferToStoreId').val($('#TransferToWCStore').val())
                            })
                        }
                    }
                }
            });
        }

        function FillProductStoreforScrap() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillStore")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProductTransferToWCStore').empty();
                            $('#ProductTransferToWCStore').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ProductTransferToWCStore').append('<option selected value="' + val.entryid + '">' + val.Store_Name + '</option>');
                                $('#ProductStoreId').val($('#ProductTransferToWCStore').val())
                            })
                        }
                    }
                }
            });
        }

        function CheckAutoOrManual() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetFeatureOption")",
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#ProdEntryAllowToAddRMItem').val(obj.Result[0].ProdEntryAllowToAddRMItem);
                        if (obj.Result[0].ProdEntryAllowToAddRMItem == 'y' || $('#ProdType').val() == 'ReWork' || obj.Result[0].ProdEntryAllowToAddRMItem == 'Y') {
                            $('#altProductionentry').show();
                            FillRMItemName();
                            FillRMPartCode();
                            var i = 1;
                            removeReadonlyAttributes(i);
                            i++;
                        } else {
                            $('#altProductionentry').hide();
                        }
                    }
                }
            });
        }
        function CheckProdDate() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetLastProddate")",
                dataType: "json",
                data: { "YearCode": $('#YearCode').val() },
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.Result[0].LastProdDate != null) {
                            var lastProdDate = (obj.Result[0].LastProdDate).split("T")[0]
                            var formatedDate = lastProdDate.split("-");
                            var result = formatedDate[2] + "/" + formatedDate[1] + "/" + formatedDate[0];
                            var finToDate = $('#FinToDate').val();
                            var dateParts1 = finToDate.split("/");
                            var monthNames = {
                                "Jan": "01",
                                "Feb": "02",
                                "Mar": "03",
                                "Apr": "04",
                                "May": "05",
                                "Jun": "06",
                                "Jul": "07",
                                "Aug": "08",
                                "Sep": "09",
                                "Oct": "10",
                                "Nov": "11",
                                "Dec": "12"
                            };
                            var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2]
                        }
                        $('#ProdEntryAllowBackDate').val(obj.Result[0].ProdEntryAllowBackDate);
                        if (obj.Result[0].ProdEntryAllowBackDate == 'Y') 
                        {

                        /*     $("#ActualProdDate").datepicker("option", "minDate", result);
                            $("#ActualProdDate").datepicker("option", "maxDate", formattedDate1); */
                        }
                        var date = new Date();
                        var formattedDate = String(date.getDate()).padStart(2, '0') + '/' + String(date.getMonth() + 1).padStart(2, '0') + '/' + date.getFullYear()
                        if (obj.Result[0].ProdEntryAllowBackDate == 'N') {

                        /*     $("#ActualProdDate").datepicker("option", "minDate", formattedDate);
                            $("#ActualProdDate").datepicker("option", "maxDate", formattedDate); */
                        }
                    }
                }
            });
        }

        function formatDate(d) {

            var newDate = new Date(d);
            var day = newDate.getDate();
            var month = newDate.getUTCMonth();
            var year = newDate.getFullYear();
            finaldate = new Date(year, month, day);
            return finaldate;
        }

        function FillStore() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillStore")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#RejTransferTo').empty();
                            $('#RejTransferTo').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#RejTransferTo').append('<option value="' + val.entryid + '">' + val.Store_Name + '</option>');
                                $('#TransferToRejStoreId').val($('#RejTransferTo').val());
                                $('#RejWCId').val(0);
                            })
                            if ($('#StartupRej').val() > 0 || $('#QcRejQty').val() > 0) {
                                var rejworkcenter = "@Model.RejWCId";
                                $('#RejTransferTo').val(rejworkcenter).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function FillTransferWorkCenter() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillTransferWorkCenter")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#RejTransferTo').empty();
                            $('#RejTransferTo').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#RejTransferTo').append('<option value="' + val.entryid + '">' + val.WorkCenterDescription + '</option>');
                                $('#RejWCId').val($('#RejTransferTo').val());
                                $('#TransferToRejStoreId').val(0);
                            })
                            if ($('#StartupRej').val() > 0 || $('#QcRejQty').val() > 0) {
                                var rejworkcenter = "@Model.RejWCId";
                                $('#RejTransferTo').val(rejworkcenter).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function FillMachineGroup() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillMachineGroup")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#MachineGroup').empty();
                            $('#MachineGroup').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#MachineGroup').append('<option selected value="' + val.entryid + '">' + val.MachGroup + '</option>');
                            });
                            $('#MachineGroup option').filter(function () {
                                return $(this).text() === "Assembly";
                            }).first().prop('selected', true);
                        }
                    }
                }
            });
        }

        function FillMachineName() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillMachineName")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#MachineName').empty();
                            $('#MachineName').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#MachineName').append('<option selected value="' + val.entryid + '">' + val.MachineName + '</option>');
                                $('#MachineId').val($('#MachineName').val());
                            })
                        }
                    }
                }
            });
        }

        function FillIssWorkcenter() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillIssWorkcenter")",
                dataType: "json",
                data: { "QcMandatory": $('#QcMandatory').val() },
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#NextWorkCenter').empty();
                            $('#NextWorkCenter').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#NextWorkCenter').append('<option value="' + val.WCID + '">' + val.WorkCenterDescription + '</option>');
                                $('#NextWCID').val($('#NextWorkCenter').val());
                                $('#NextStoreId').val(0);
                            })
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var nextwc = '@Model.NextWCID'
                                $('#NextWorkCenter').val(nextwc).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function FillIssWorkcenterForQcMandatory() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillIssWorkcenterForQcMandatory")",
                dataType: "json",
                data: { "QcMandatory": $('#QcMandatory').val() },
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#NextWorkCenter').empty();
                            $('#NextWorkCenter').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#NextWorkCenter').append('<option selected value="' + val.WCID + '">' + val.WorkCenterDescription + '</option>');
                                $('#NextWCID').val($('#NextWorkCenter').val());
                                $('#NextStoreId').val(0);
                            })
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var nextwc = '@Model.NextWCID'
                                $('#NextWorkCenter').val(nextwc).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function FillIssStore() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillIssStore")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#NextWorkCenter').empty();
                            $('#NextWorkCenter').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#NextWorkCenter').append('<option value="' + val.entryid + '">' + val.Store_Name + '</option>');
                                $('#NextStoreId').val($('#NextWorkCenter').val());
                                $('#NextWCID').val(0);
                            })
                        }
                    }
                }
            });
        }

        function FillOperation() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillOperation")",
                dataType: "json",
                data: { "ItemCode": $('#ItemName').val(), "WcId": $('#WorkCenter').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#Operation').empty();
                            $('#Operation').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#Operation').append('<option selected value="' + val.entryid + '">' + val.StageDescription + '</option>');
                                $('#ProcessId').val($('#Operation').val());
                            });
                            $('#Operation option').filter(function () {
                                return $(this).text() === "Assembly ";
                            }).first().prop('selected', true);
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var operation = $('#ProcessId').val();
                                $('#Operation').val(operation).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function FillResponsibleEmp() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillResponsibleEmp")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ResEmpName').empty();
                            $('#ResEmpName').append('<option disabled>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ResEmpName').append('<option selected value="' + val.Emp_Id + '">' + val.Emp_Name + '</option>');
                                $('#ResponcibleEmp').val($('#ResEmpName').val())
                            })
                        }
                    }
                }
            });
        }

        function DisplayBomDetail(event) {

            event.preventDefault();
            $('#DisplaybomDetailModal').modal('show');
            $.ajax({
                type: "POST",
                url: "@Url.Action("DisplayBomDetail")",
                dataType: "json",
                data: { "ItemCode": $('#ItemName').val(), "WOQty": $('#ProdQty').val(), "BomRevNo": $('#BOMNo').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var html = '';
                            $('#divDisplayBomDetail').empty();
                            var i = 1;
                            $.each(obj.Result, function (index, val) {
                                //html += '<tr><td><input id="Checkbox' + i + '"  type="checkbox"><input type="hidden" value="' + val.AccountCode + '" id="Accountcode' + i + '"/><input type="hidden" value="' + val.itemcode + '" id="Itemcode' + i + '"/></td><td><input id="AcName' + i + '" value=' + JSON.stringify(val.Account_Name) + ' readonly></td><td><input id="PartCode' + i + '" value=' + val.PartCode + ' readonly style="width:90px;"></td><td><input id="ItemName' + i + '" value=' + JSON.stringify(val.ItemName) + ' readonly></td><td><select id="Store' + i + '" onchange = "StoreChange(' + i + ')"></select></td><td><input id="Stock' + i + '" style="width:70px;" readonly></td> <td><input id="WOQty' + i + '" value=' + val.OrderQty + ' style="width:60px;background-color:#ffd6dd"><td><input id="OrderQty' + i + '" value=' + val.OrderQty + ' readonly style="width:60px;"></td><td><input id="OrderType' + i + '" value=' + val.OrderType + ' readonly style="width:90px;"></td><td><input id="wef' + i + '" value=' + val.wef.split("T")[0] + ' readonly style="width:90px;"></td><td><input type="hidden" id="SOType' + i + '" value=' + val.SOType + '><input id="AmmNo' + i + '" value=' + val.AmmNo + ' readonly style="width:40px;"></td><td><input id="AmmEffDate' + i + '" value=' + val.AmmEffDate.split("T")[0] + ' readonly style="width:90px;"></td><td><input id="unit' + i + '" value=' + val.unit + ' readonly style="width:40px;"></td><td><input id="AltQty' + i + '" value=' + val.AltQty + ' readonly style="width:30px;"></td><td><input id="AltUnit' + i + '" value=' + val.AltUnit + ' readonly style="width:50px;"></td><td><input id="Color' + i + '" readonly style="width:70px;" value= "' + val.Color + ' " ></td><td><input id="Description' + i + ' " readonly  value=' + val.Description + '></td><td><input id="CustOrderNo' + i + '" value=' + JSON.stringify(val.CustOrderNo) + ' readonly style="width:80px;"></td><td class="SONo' + i + '"><input id="SONo' + i + '" value=' + val.SONo + ' readonly style="width:40px;"></td><td><input id="SODate' + i + '" value=' + val.SODate.split("T")[0] + '  readonly style="width:90px;"></td><td class="SchNo' + i + '" ><input readonly  style="width:60px;" id="SchNO' + i + '" value=' + val.SchNO + ' ></td><td><input id="Schdate' + i + '" value=' + val.Schdate.split("T")[0] + ' readonly style="width:90px;"></td><td><input id="FGStoreName' + i + '" value=' + JSON.stringify(val.FGStoreName) + ' readonly style="width:90px;"></td><td><input id="FGStock' + i + '" value=' + val.FGStock + ' readonly style="width:90px;"></td><td><input id="ItemAmendmentNo' + i + '" value=' + val.ItemAmendmentNo + ' readonly style="width:100px;"></td><td><input id="SOCloseDate' + i + '" value=' + val.SOCloseDate.split("T")[0] + ' readonly style="width:90px;"></td><td><input id="SchEffTillDate' + i + '" value=' + val.ScheduleEffectiveTillDate.split("T")[0] + ' readonly style="width:90px;"></td>';
                                html += '<tr id="DisplayBomRow-' + i + '">' +
                                    '<td>' + i + '</td>' +
                                    '<td>' + val.FGPartCode + '</td>' +
                                    '<td>' + val.FGItemName + '</td>' +
                                    '<td>' + val.PartCode + '</td>' +
                                    '<td>' + val.RMItemName + '</td>' +
                                    '<td>' + val.RMPartCode + '</td>' +
                                    '<td>' + val.BOMQty + '</td>' +
                                    '<td>' + val.ReqQty + '</td>' +
                                    '</tr>';
                                i++;
                            });
                            $('#divDisplayBomDetail').append(html);

                            var RowCount = $('#divDisplayBomDetail tr').length;
                            var TdRow = $('#divDisplayBomDetail tr td').length;

                            if (TdRow > 1) {
                                $('#lblTotalNoOfItems').text(RowCount);
                            }
                            ColorRows();
                        }

                    }
                }
            });

        }

        function DisplayRoutingData(event) {

            event.preventDefault();
            $('#DisplayRoutingDetailModal').modal('show');
            $.ajax({
                type: "POST",
                url: "@Url.Action("DisplayRoutingDetail")",
                dataType: "json",
                data: { "ItemCode": $('#ItemName').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var html = '';
                            $('#divDisplayRoutingDetail').empty();
                            var i = 1;
                            $.each(obj.Result, function (index, val) {
                                //html += '<tr><td><input id="Checkbox' + i + '"  type="checkbox"><input type="hidden" value="' + val.AccountCode + '" id="Accountcode' + i + '"/><input type="hidden" value="' + val.itemcode + '" id="Itemcode' + i + '"/></td><td><input id="AcName' + i + '" value=' + JSON.stringify(val.Account_Name) + ' readonly></td><td><input id="PartCode' + i + '" value=' + val.PartCode + ' readonly style="width:90px;"></td><td><input id="ItemName' + i + '" value=' + JSON.stringify(val.ItemName) + ' readonly></td><td><select id="Store' + i + '" onchange = "StoreChange(' + i + ')"></select></td><td><input id="Stock' + i + '" style="width:70px;" readonly></td> <td><input id="WOQty' + i + '" value=' + val.OrderQty + ' style="width:60px;background-color:#ffd6dd"><td><input id="OrderQty' + i + '" value=' + val.OrderQty + ' readonly style="width:60px;"></td><td><input id="OrderType' + i + '" value=' + val.OrderType + ' readonly style="width:90px;"></td><td><input id="wef' + i + '" value=' + val.wef.split("T")[0] + ' readonly style="width:90px;"></td><td><input type="hidden" id="SOType' + i + '" value=' + val.SOType + '><input id="AmmNo' + i + '" value=' + val.AmmNo + ' readonly style="width:40px;"></td><td><input id="AmmEffDate' + i + '" value=' + val.AmmEffDate.split("T")[0] + ' readonly style="width:90px;"></td><td><input id="unit' + i + '" value=' + val.unit + ' readonly style="width:40px;"></td><td><input id="AltQty' + i + '" value=' + val.AltQty + ' readonly style="width:30px;"></td><td><input id="AltUnit' + i + '" value=' + val.AltUnit + ' readonly style="width:50px;"></td><td><input id="Color' + i + '" readonly style="width:70px;" value= "' + val.Color + ' " ></td><td><input id="Description' + i + ' " readonly  value=' + val.Description + '></td><td><input id="CustOrderNo' + i + '" value=' + JSON.stringify(val.CustOrderNo) + ' readonly style="width:80px;"></td><td class="SONo' + i + '"><input id="SONo' + i + '" value=' + val.SONo + ' readonly style="width:40px;"></td><td><input id="SODate' + i + '" value=' + val.SODate.split("T")[0] + '  readonly style="width:90px;"></td><td class="SchNo' + i + '" ><input readonly  style="width:60px;" id="SchNO' + i + '" value=' + val.SchNO + ' ></td><td><input id="Schdate' + i + '" value=' + val.Schdate.split("T")[0] + ' readonly style="width:90px;"></td><td><input id="FGStoreName' + i + '" value=' + JSON.stringify(val.FGStoreName) + ' readonly style="width:90px;"></td><td><input id="FGStock' + i + '" value=' + val.FGStock + ' readonly style="width:90px;"></td><td><input id="ItemAmendmentNo' + i + '" value=' + val.ItemAmendmentNo + ' readonly style="width:100px;"></td><td><input id="SOCloseDate' + i + '" value=' + val.SOCloseDate.split("T")[0] + ' readonly style="width:90px;"></td><td><input id="SchEffTillDate' + i + '" value=' + val.ScheduleEffectiveTillDate.split("T")[0] + ' readonly style="width:90px;"></td>';
                                html += '<tr id="DisplayBomRow-' + i + '">' +
                                    '<td>' + i + '</td>' +
                                    '<td>' + val.PartCode + '</td>' +
                                    '<td>' + val.ItemName + '</td>' +
                                    '<td>' + val.StageDescription + '</td>' +
                                    '<td>' + val.ProdOnWorkCenterDescription + '</td>' +
                                    '<td>' + val.TransferWCName + '</td>' +
                                    '<td>' + val.NeedQc + '</td>' +
                                    '<td>' + val.MachGroup + '</td>' +
                                    '<td>' + val.LeadTime + '</td>' +
                                    '<td>' + val.LeadTimeInMin + '</td>' +
                                    '<td>' + val.MandatoryOptionalProcess + '</td>' +
                                    '<td>' + val.SubItemName + '</td>' +
                                    '</tr>';
                                i++;
                            });
                            $('#divDisplayRoutingDetail').append(html);
                            var RowCount = $('#divDisplayRoutingDetail tr').length;
                            var TdRow = $('#divDisplayRoutingDetail tr td').length;

                            if (TdRow > 1) {
                                $('#lblroutingtotal').text(RowCount)
                            }
                        }
                        else {
                            $('#divDisplayRoutingDetail').empty();
                            $('#divDisplayRoutingDetail').append("<tr class='text - center'><td colspan='26' class='text - black - 50'><strong>NO DATA FOUND</strong></td></tr>")
                        }
                    }
                }
            });

        }

        function FillReqNo() {

            var FromDate = $('#FinFromDate').val();
            var ToDate = $('#FinToDate').val();
            var parsefromdate = new Date(FromDate);
            var fromyear = parsefromdate.getFullYear();
            var frommonth = parsefromdate.getMonth() + 1;
            var fromday = parsefromdate.getDate();
            frommonth = frommonth < 10 ? '0' + frommonth : frommonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedfromdate = fromyear + '/' + frommonth + '/' + fromday;
            var parsetodate = new Date(ToDate);
            var toyear = parsetodate.getFullYear();
            var tomonth = parsetodate.getMonth() + 1;
            var today = parsetodate.getDate();
            tomonth = tomonth < 10 ? '0' + tomonth : tomonth;
            today = today < 10 ? '0' + today : today;
            var formattedtodate = toyear + '/' + tomonth + '/' + today;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillReqNo")",
                dataType: "json",
                data: { FromDate: formattedfromdate, ToDate: formattedtodate, ProdAgainst: $('#ProdAgainstPlanManual').val(), ItemCode: $('#ItemName').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ReqNo').empty();
                            $('#ReqNo').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ReqNo').append('<option value="' + val.Reqno + '">' + val.Reqno + '</option>');
                            })
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var reqno = '@Model.ReqNo'
                                $('#ReqNo').val(reqno).trigger("change");
                            }
                        }
                        else {
                            $('#ReqNo').empty();
                            $('#ReqNo').append('<option selected>-Select-</option>');
                        }
                    }
                }
            });
        }

        function FillReqYear() {

            var FromDate = $('#FinFromDate').val();
            var ToDate = $('#FinToDate').val();
            var parsefromdate = new Date(FromDate);
            var fromyear = parsefromdate.getFullYear();
            var frommonth = parsefromdate.getMonth() + 1;
            var fromday = parsefromdate.getDate();
            frommonth = frommonth < 10 ? '0' + frommonth : frommonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedfromdate = fromyear + '/' + frommonth + '/' + fromday;
            var parsetodate = new Date(ToDate);
            var toyear = parsetodate.getFullYear();
            var tomonth = parsetodate.getMonth() + 1;
            var today = parsetodate.getDate();
            tomonth = tomonth < 10 ? '0' + tomonth : tomonth;
            today = today < 10 ? '0' + today : today;
            var formattedtodate = toyear + '/' + tomonth + '/' + today;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillReqYear")",
                dataType: "json",
                data: { FromDate: formattedfromdate, ToDate: formattedtodate, ProdAgainst: $('#ProdAgainstPlanManual').val(), ReqNo: $('#ReqNo').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ReqYear').empty();
                            $('#ReqYear').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ReqYear').append('<option value="' + val.YearCode + '">' + val.YearCode + '</option>');
                            })
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var reqyear = '@Model.ReqYear'
                                $('#ReqYear').val(reqyear).trigger("change");
                            }
                        }
                        else {
                            $('#ReqYear').empty();
                            $('#ReqYear').append('<option selected>-Select-</option>');
                        }
                    }
                }
            });
        }

        function FillReqQty() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillReqQty")",
                dataType: "json",
                data: { CurrentDate: $('#ActualProdDate').val(), ProdAgainst: $('#ProdAgainstPlanManual').val(), ReqNo: $('#ReqNo').val(), YearCode: $('#YearCode').val(), Itemcode: $('#ItemName').val(), ReqYearCode: $('#ReqYear').val() },
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#TargetQty').val(0);
                            $('#TargetQty').val(Number(obj.Result[0].QtyPendForProd.toFixed(6)));
                            $('#ProdQty').val(0);
                            $('#ProdQty').val(Number(obj.Result[0].QtyPendForProd.toFixed(6)));
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var ProdQty = '@Model.ProdQty'
                                $('#ProdQty').val(ProdQty);
                            }
                        }

                    }
                }
            });
        }

        function FillPendQty() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillPendQty")",
                dataType: "json",
                data: { CurrentDate: $('#ActualProdDate').val(), ProdAgainst: $('#ProdAgainstPlanManual').val(), ProdSchNo: $('#ProdSch').val(), YearCode: $('#YearCode').val(), Itemcode: $('#ItemName').val(), ProdSchYear: $('#ProdSchYear').val(), Entryid: $('#EntryId').val() },
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#TargetQty').val(0);
                            $('#TargetQty').val(Number(obj.Result[0].QtyPendForProd.toFixed(6)));
                            $('#ProdQty').val(0);
                            $('#ProdQty').val(Number(obj.Result[0].QtyPendForProd.toFixed(6)));
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var ProdQty = '@Model.ProdQty'
                                $('#ProdQty').val(ProdQty);
                            }
                        }
                    }
                }
            });
        }

        function FillReqDate() {

            var FromDate = $('#FinFromDate').val();
            var ToDate = $('#FinToDate').val();
            var parsefromdate = new Date(FromDate);
            var fromyear = parsefromdate.getFullYear();
            var frommonth = parsefromdate.getMonth() + 1;
            var fromday = parsefromdate.getDate();
            frommonth = frommonth < 10 ? '0' + frommonth : frommonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedfromdate = fromyear + '/' + frommonth + '/' + fromday;
            var parsetodate = new Date(ToDate);
            var toyear = parsetodate.getFullYear();
            var tomonth = parsetodate.getMonth() + 1;
            var today = parsetodate.getDate();
            tomonth = tomonth < 10 ? '0' + tomonth : tomonth;
            today = today < 10 ? '0' + today : today;
            var formattedtodate = toyear + '/' + tomonth + '/' + today;
            var currentdate = new Date();
            var currentyear = currentdate.getFullYear();
            var currentmonth = currentdate.getMonth() + 1;
            var currentday = currentdate.getDate();
            currentmonth = currentmonth < 10 ? '0' + currentmonth : currentmonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedcurrentdate = currentday + '/' + currentmonth + '/' + currentyear;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillReqDate")",
                dataType: "json",
                data: { FromDate: formattedfromdate, ToDate: formattedtodate, ProdAgainst: $('#ProdAgainstPlanManual').val(), ReqNo: $('#ReqNo').val(), ReqYearCode: $('#ReqYear').val(), ItemCode: $('#ItemName').val() },
                success: function (result, status, error) {

                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ReqDate').empty();
                            var ReqDate = obj.Result[0].ReqDate;
                            var dateObj = new Date(ReqDate);
                            var formattedDate = String(dateObj.getDate()).padStart(2, '0') + '/' +
                                String(dateObj.getMonth() + 1).padStart(2, '0') + '/' +
                                dateObj.getFullYear();
                            $('#ReqDate').val(formattedDate);
                        }
                        else {
                            $('#ReqDate').val(formattedcurrentdate);
                        }
                    }
                }
            });
        }

        function FillProdDate() {

            var FromDate = $('#FinFromDate').val();
            var ToDate = $('#FinToDate').val();
            var parsefromdate = new Date(FromDate);
            var fromyear = parsefromdate.getFullYear();
            var frommonth = parsefromdate.getMonth() + 1;
            var fromday = parsefromdate.getDate();
            frommonth = frommonth < 10 ? '0' + frommonth : frommonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedfromdate = fromyear + '/' + frommonth + '/' + fromday;
            var parsetodate = new Date(ToDate);
            var toyear = parsetodate.getFullYear();
            var tomonth = parsetodate.getMonth() + 1;
            var today = parsetodate.getDate();
            tomonth = tomonth < 10 ? '0' + tomonth : tomonth;
            today = today < 10 ? '0' + today : today;
            var formattedtodate = toyear + '/' + tomonth + '/' + today;
            var currentdate = new Date();
            var currentyear = currentdate.getFullYear();
            var currentmonth = currentdate.getMonth() + 1;
            var currentday = currentdate.getDate();
            currentmonth = currentmonth < 10 ? '0' + currentmonth : currentmonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedcurrentdate = currentday + '/' + currentmonth + '/' + currentyear;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProdDate")",
                dataType: "json",
                data: { FromDate: formattedfromdate, ToDate: formattedtodate, ProdAgainst: $('#ProdAgainstPlanManual').val(), ProdSchNo: $('#ProdSch').val(), ProdPlanYearCode: $('#ProdSchYear').val() },
                success: function (result, status, error) {

                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProdSchDate').empty();
                            var dateTimeString = obj.Result[0].ProdSchDate;
                            var date = new Date(dateTimeString);
                            var day = String(date.getDate()).padStart(2, '0');
                            var month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
                            var year = date.getFullYear();
                            var formattedDate = `${day}/${month}/${year}`;
                            $('#ProdSchDate').val(formattedDate);
                        }
                        else {
                            $('#ProdSchDate').val(formattedcurrentdate);
                        }
                    }
                }
            });
        }

        function FillProdSchNo() {

            var FromDate = $('#FinFromDate').val();
            var ToDate = $('#FinToDate').val();
            var parsefromdate = new Date(FromDate);
            var fromyear = parsefromdate.getFullYear();
            var frommonth = parsefromdate.getMonth() + 1;
            var fromday = parsefromdate.getDate();
            frommonth = frommonth < 10 ? '0' + frommonth : frommonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedfromdate = fromyear + '/' + frommonth + '/' + fromday;
            var parsetodate = new Date(ToDate);
            var toyear = parsetodate.getFullYear();
            var tomonth = parsetodate.getMonth() + 1;
            var today = parsetodate.getDate();
            tomonth = tomonth < 10 ? '0' + tomonth : tomonth;
            today = today < 10 ? '0' + today : today;
            var formattedtodate = toyear + '/' + tomonth + '/' + today;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProdSchNo")",
                dataType: "json",
                data: { FromDate: formattedfromdate, ToDate: formattedtodate, ProdAgainst: $('#ProdAgainstPlanManual').val(), ItemCode: $('#ItemName').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProdSch').empty();
                            $('#ProdSch').append('<option selected>-Select-</option>');
                            var ProdSch = "@Model.ProdSchNo";
                            ProdSch = ProdSch ? ProdSch.trim() : "";
                            $.each(obj.Result, function (index, val) {
                                var isSelected = (val.ProdSchNo == ProdSch) ? "selected" : "";
                                $('#ProdSch').append('<option ' + isSelected + ' value="' + val.ProdSchNo + '">' + val.ProdSchNo + '</option>');
                            })
                            if (ProdSch) {
                                $('#ProdSch').change();
                            }
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var schno = '@Model.ProdSch'
                                $('#ProdSch').val(schno).trigger("change");
                            }
                        }
                        else {
                            $('#ProdSch').empty();
                            $('#ProdSch').append('<option selected>-Select-</option>');
                        }
                    }
                }
            });
        }

        function FillProdSchYear() {

            var FromDate = $('#FinFromDate').val();
            var ToDate = $('#FinToDate').val();
            var parsefromdate = new Date(FromDate);
            var fromyear = parsefromdate.getFullYear();
            var frommonth = parsefromdate.getMonth() + 1;
            var fromday = parsefromdate.getDate();
            frommonth = frommonth < 10 ? '0' + frommonth : frommonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedfromdate = fromyear + '/' + frommonth + '/' + fromday;
            var parsetodate = new Date(ToDate);
            var toyear = parsetodate.getFullYear();
            var tomonth = parsetodate.getMonth() + 1;
            var today = parsetodate.getDate();
            tomonth = tomonth < 10 ? '0' + tomonth : tomonth;
            today = today < 10 ? '0' + today : today;
            var formattedtodate = toyear + '/' + tomonth + '/' + today;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProdSchYear")",
                dataType: "json",
                data: { FromDate: formattedfromdate, ToDate: formattedtodate, ProdAgainst: $('#ProdAgainstPlanManual').val(), ProdSch: $('#ProdSch').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProdSchYear').empty();
                            $('#ProdSchYear').append('<option selected>-Select-</option>');
                            var ProdSchYearCode = "@Model.ProdSchYear";
                            ProdSchYearCode = ProdSchYearCode ? parseInt(ProdSchYearCode, 10) : 0;
                            $.each(obj.Result, function (index, val) {
                                var isSelected = (val.YearCode == ProdSchYearCode) ? "selected" : "";
                                $('#ProdSchYear').append('<option ' + isSelected + ' value="' + val.YearCode + '">' + val.YearCode + '</option>');
                            })
                            if (ProdSchYearCode) {
                                $('#ProdSchYear').change();
                            }
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var prodyear = '@Model.ProdSchYear'
                                $('#ProdSchYear').val(prodyear).trigger("change");
                            }
                        }
                        else {
                            $('#ProdSchYear').empty();
                            $('#ProdSchYear').append('<option selected>-Select-</option>');
                        }
                    }
                }
            });
        }

        function FillProdPlanDetail() {

            var FromDate = $('#FinFromDate').val();
            var ToDate = $('#FinToDate').val();
            var parsefromdate = new Date(FromDate);
            var fromyear = parsefromdate.getFullYear();
            var frommonth = parsefromdate.getMonth() + 1;
            var fromday = parsefromdate.getDate();
            frommonth = frommonth < 10 ? '0' + frommonth : frommonth;
            fromday = fromday < 10 ? '0' + fromday : fromday;
            var formattedfromdate = fromyear + '/' + frommonth + '/' + fromday;
            var parsetodate = new Date(ToDate);
            var toyear = parsetodate.getFullYear();
            var tomonth = parsetodate.getMonth() + 1;
            var today = parsetodate.getDate();
            tomonth = tomonth < 10 ? '0' + tomonth : tomonth;
            today = today < 10 ? '0' + today : today;
            var formattedtodate = toyear + '/' + tomonth + '/' + today;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProdPlanDetail")",
                dataType: "json",
                data: { FromDate: formattedfromdate, ToDate: formattedtodate, ProdAgainst: $('#ProdAgainstPlanManual').val(), ProdSchNo: $('#ProdSch').val(), ProdYearCode: $('#ProdSchYear').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var ProdPlanDate = obj.Result[0].PlanNoDate;
                            var date = new Date(ProdPlanDate);
                            var formattedDate = `${String(date.getDate()).padStart(2, '0')}/${String(date.getMonth() + 1).padStart(2, '0')}/${date.getFullYear()}`;
                            $('#ProdPlan').val(obj.Result[0].PlanNo);
                            $('#ProdPlanYear').val(obj.Result[0].PlanNoYearCode);
                            $('#ProdPlanDate').val(formattedDate);
                        }
                    }
                }
            });
        }

        $("#unTarget").on("keydown", function (event) {

            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#ProdQty").on("keydown", function (event) {

            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#StartupRej").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#QcRejQty").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#BreakTimeMin").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#TotalHours").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#OverTimeHrs").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#MachineCharges").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#ScrapQty").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#InitalReading").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#EndReading").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#Shots").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#Cavity").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#StdCycleTime").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });
        $("#ProdSeqNo").on("keydown", function (event) {
            if (event.key.toLowerCase() === 'e' || event.key === '-') {
                event.preventDefault();
            }
        });

        $('#ProdQty').change(function () {
             
            if ($('#ProdAgainstPlanManual').val() == 'UNPLANNED') {
                var Target = Number(parseFloat($('#unTarget').val()).toFixed(6));
                var ProdQty = Number(parseFloat($('#ProdQty').val()).toFixed(6));
                if (ProdQty > Target) {
                    $.notify("ProdQty cannot be greater than TargetQty", "error");
                }
                else if (ProdQty < 0) {
                    $.notify("ProdQty cannot be less than 0", "error");
                }
                else {
                    var PendQty = Number((Target - ProdQty).toFixed(6));
                    $('#PendQty').val(0);
                    $('#PendQty').val(PendQty);
                }

            } else {
                var TargetQty = Number(parseFloat($('#TargetQty').val()).toFixed(6));
                var ProdQty = Number(parseFloat($('#ProdQty').val()).toFixed(6));
                if (ProdQty > TargetQty) {
                    $.notify("ProdQty cannot be greater than TargetQty", "error");
                }
                else if (ProdQty < 0) {
                    $.notify("ProdQty cannot be less than 0", "error");
                }
                else {
                    var PendQty = Number((TargetQty - ProdQty).toFixed(6));
                    $('#PendQty').val(0);
                    $('#PendQty').val(PendQty);
                }
            }
        })

        function ClearGridAjax() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("ClearGridAjax")",
                dataType: "json",
                async: false,
                success: function (data, status, error) {
                    console.log("Grid cleared");
                    $('#divAddProductionEntryGrid').empty();
                    $('#divProductionEntryGrid').empty();
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        }

        $(document).on('select2:select', '#ItemName,#PartCode', function (e) {

            var cntId = e.target.id;
            if (cntId == 'ItemName') {
                ItemNameChange(cntId);
            }
            else {
                PartCodeChange(cntId);
            }
            $('#FGItemCode').val($('#ItemName').val())
            $('#displayroutingdata').show();
            ClearGridAjax();
            FillReqNo();
            FillProdSchNo();
            $('#ProdSchYear').empty();
            FillBomNo();
            FillOperation();
            GetProcessDetail();
            GetTotalStockWorkCenterQty();
            $('#TargetQty').val(0);
            $('#ProdPlan').val('');
            $('#ProdPlanYear').val(0);
            $('#ProdPlanDate').val(0);
            FillScrapData();
            FillProductDetail();
            FillProductPartCode();
            FillProductItems();
        });

        function GetItemNameForPendingProduction() {

            FillReqNo();
            FillProdSchNo();
            FillBomNo();
            FillOperation();
            GetProcessDetail();
            GetTotalStockWorkCenterQty();
        }

        $(document).on('select2:select', '#RmItemName,#RmPartCode', function (e) {
            var cntId = e.target.id;
            if (cntId == 'RmItemName') {
                RMItemNameChange(cntId);
            }
            else {
                RMPartCodeChange(cntId);
            }
            $('#RmItemCode').val($('#RmItemName').val())
            GetBatchNo();
            FillReqNo();
            FillProdSchNo();
            GetUnit();
        });

        $(document).on('select2:select', '#ScrapItemName,#ScrapPartCode', function (e) {
            var cntId = e.target.id;
            if (cntId == 'ScrapItemName') {
                ScrapItemNameChange(cntId);
            }
            else {
                ScrapPartCodeChange(cntId);
            }
            $('#ScrapItemCode').val($('#ScrapItemName').val())
            $('#Scrapunit').val('')
            GetScrapUnit();
        });

        $(document).on('select2:select', '#ProductItemName,#ProductPartCode', function (e) {
            var cntId = e.target.id;
            if (cntId == 'ProductItemName') {
                ProductItemNameChange(cntId);
            }
            else {
                ProductPartCodeChange(cntId);
            }
            $('#ProductItemCode').val($('#ProductItemName').val())
            $('#Productunit').val('')
            GetProductUnit();
        });

        $(document).on('select2:select', '#AltItemName,#AltPartCode', function (e) {

            var cntId = e.target.id;
            if (cntId == 'AltItemName') {
                AltItemNameChange(cntId);
            }
            else {
                AltPartCodeChange(cntId);
            }
        });

        function ScrapPartCodeChange(ID) {

            $.when(SetPartCodeItemNameScrap(ID)).done(function () {
            });
        }

        function ScrapItemNameChange(ID) {
            SetPartCodeItemNameScrap(ID);
        }

        function ProductItemNameChange(ID) {
            SetPartCodeItemNameProduct(ID);
        }

        function ProductPartCodeChange(ID) {

            $.when(SetPartCodeItemNameProduct(ID)).done(function () {
            });
        }

        function AltPartCodeChange(ID) {

            $.when(SetPartCodeItemNameAlt(ID)).done(function () {
            });
        }

        function AltItemNameChange(ID) {
            SetPartCodeItemNameAlt(ID);
        }

        $('#ReqNo').change(function () {
            FillReqYear();
        });
        $('#ReqYear').change(function () {
            FillReqQty();
            FillReqDate();
        });
        $('#ProdSch').change(function () {
            FillProdSchYear();
        });

        $('#ProdSchYear').change(function () {
            FillPendQty();
            FillProdDate();
            FillProdPlanDetail();
        });

        function PartCodeChange(ID) {

            $.when(SetPartCodeItemName(ID)).done(function () {
            });
        }

        function ItemNameChange(ID) {
            SetPartCodeItemName(ID);
        }

        function RMPartCodeChange(ID) {

            $.when(SetPartCodeItemNameRM(ID)).done(function () {
            });
        }

        function RMItemNameChange(ID) {
            SetPartCodeItemNameRM(ID);
        }

        function FillScrapItems() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillScrapItems")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ScrapItemName').empty();
                            $('#ScrapItemName').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ScrapItemName').append('<option value="' + val.Item_Code + '">' + val.Item_Name + '</option>')
                            })
                        }
                    }
                }
            });
        }

        function FillProductItems() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProductItems")",
                dataType: "json",
                data: {"FgItemCode" : $('#FGItemCode').val(), "BomNo" : $('#BOMNo').val()},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProductItemName').empty();
                            $('#ProductItemName').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ProductItemName').append('<option value="' + val.Item_Code + '">' + val.Item_Name + '</option>')
                            })
                        }
                    }
                }
            });
        }

        function FillScrapPartCode() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillScrapPartCode")",
                dataType: "json",
                data: {},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ScrapPartCode').empty();
                            $('#ScrapPartCode').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ScrapPartCode').append('<option value="' + val.Item_Code + '">' + val.PartCode + '</option>')
                            })
                        }
                    }
                }
            });
        }

        function FillProductPartCode() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillProductPartCode")",
                dataType: "json",
                data: {"FgItemCode" : $('#FGItemCode').val(), "BomNo" : $('#BOMNo').val()},
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProductPartCode').empty();
                            $('#ProductPartCode').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                $('#ProductPartCode').append('<option value="' + val.Item_Code + '">' + val.PartCode + '</option>')
                            })
                        }
                    }
                }
            });
        }

        function GetItem() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetItems")",
                dataType: "json",
                data: { ProdAgainst: $('#ProdAgainstPlanManual').val(), YearCode: $('#YearCode').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ItemName').empty();
                            $('#ItemName').append('<option>-Select-</option>');
                            var ItemCode = "@Model.ItemCode";
                            ItemCode = ItemCode ? parseInt(ItemCode, 10) : 0;
                            $.each(obj.Result, function (index, val) {
                                var isSelected = (val.Item_Code == ItemCode) ? "selected" : "";
                                $('#ItemName').append('<option ' + isSelected + ' value="' + val.Item_Code + '">' + val.Item_Name + '</option>');
                            });
                            if (ItemCode) {
                                $('#FGItemCode').val(ItemCode);
                                GetItemNameForPendingProduction();
                            }
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                                var itemname = $('#FGItemCode').val();
                                $('#ItemName').val(itemname).trigger("change");
                                FillBomNo();
                                FillReqNo();
                                FillProdSchNo();
                                FillOperation();
                                GetProcessDetail();
                            }
                        }
                    }
                }
            });
        }

        function GetPartCode() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetPartCode")",
                dataType: "json",
                data: { ProdAgainst: $('#ProdAgainstPlanManual').val(), YearCode: $('#YearCode').val() },
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#PartCode').empty();
                            $('#PartCode').append('<option>-Select-</option>');
                            var ItemCode = "@Model.ItemCode";
                            ItemCode = ItemCode ? parseInt(ItemCode, 10) : 0;
                            $.each(obj.Result, function (index, val) {
                                var isSelected = (val.Item_Code == ItemCode) ? "selected" : "";
                                $('#PartCode').append('<option ' + isSelected + ' value="' + val.Item_Code + '">' + val.PartCode + '</option>')
                            })
                            var PartCode = "@Model.PartCode";
                            $('#PartCode option').filter(function () {
                                return $(this).val() === PartCode;
                            }).prop('selected', true);
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                                var partcode = $('#FGItemCode').val();
                                $('#PartCode').val(partcode).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function GetProcessDetail() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetProcessDetail")",
                dataType: "json",
                data: { ItemCode: parseInt($('#ItemName').val()), "ProcessId": $('#Operation').val(), "WcId": $('#WorkCenter').val() },
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var QcCheck = (obj.Result[0].NeedQc);
                            $('#QcMandatory').val(QcCheck);
                            if (QcCheck == "Y") {
                                if (obj.Result[0].wcid > 0) {
                                    $('#Store').prop("disabled", true);
                                    $('#NextWorkCenter').prop("disabled", true);
                                    $('#Store').val('W').trigger("change");
                                    $('#Store').append('<option value="W"> WorkCenter < /option>');
                                    $('#SenToQc').val('Y').trigger("change");
                                    $('#SenToQc').prop("disabled", true);
                                    $('#NextWorkCenter').val(obj.Result[0].wcid).trigger("change");
                                }
                            }
                            else if (QcCheck == "N") {
                                $('#SenToQc').prop("disabled", true);
                                $('#SenToQc').val('N').trigger("change");
                                $('#Store').prop("disabled", false);
                                $('#NextWorkCenter').prop("disabled", false);
                            } else {
                                $('#SenToQc').prop("disabled", false);
                                $('#Store').prop("disabled", false);
                                $('#NextWorkCenter').prop("disabled", false);
                            }
                        }
                        else {
                            $('#SenToQc').prop("disabled", false);
                            $('#Store').prop("disabled", false);
                            $('#NextWorkCenter').prop("disabled", false);
                        }
                    }
                }
            });
        }

        $('#SenToQc').change(function () {

            var SenToQc = $('#SenToQc').val();
            if (SenToQc == "Y") {
                $('#Store').prop("disabled", true);
                $('#QcMandatory').val("Y");
                $('#Store').val('W').trigger("change");
                $('#Store').append('<option value="W"> WorkCenter </option>');
                $('#Store').val("W");
                $('#NextWorkCenter').prop("disabled", true);
                FillIssWorkcenterForQcMandatory();
            }
            else {
                $('#SenToQc').prop("disabled", false);
                $('#Store').prop("disabled", false);
                $('#NextWorkCenter').prop("disabled", false);
                //FillIssWorkcenter();
            }
            if (SenToQc == "N") {
                $('#QcMandatory').val("N");
                FillIssWorkcenter();
            }
        })

        $('#OverTimeHrs').keyup(function () {
            if ($('#OverTimeHrs').val() > 48) {
                $.notify('OverTimeHrs cannot greater than 48', "error");
            }
        })

        function FillBomNo() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("FillBomNo")",
                dataType: "json",
                data: { ItemCode: parseInt($('#FGItemCode').val()) },
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        var BomEffecDate = obj.Result[0].EffectiveDate;
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#BOMNo').empty();
                            /* $('#BOMNo').append('<option>-Select-</option>'); */
                            var BomNo = "@Model.BOMNo";
                            BomNo = BomNo ? parseInt(BomNo, 10) : 0;
                            $.each(obj.Result, function (index, val) {
                                var isSelected = (val.BomNo == BomNo) ? "selected" : "";
                                $('#BOMNo').append('<option ' + isSelected + ' value="' + val.BomNo + '">' + val.BomNo + '</option>')
                            })
                            if (BomEffecDate != null) {
                                $('#BomEffecDate').val(BomEffecDate.split("T")[0]);
                            }
                            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                                var bomno = $('#BOMNo').val();
                                $('#BOMNo').val(bomno).trigger("change");
                            }
                        }
                    }
                }
            });
        }

        function SetPartCodeItemName(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).select2('val');
                if (ID == "PartCode") {
                    $("#ItemName").val(v).trigger("change");
                }

                if (ID == "ItemName") {
                    $("#PartCode").val(v).trigger("change");
                }
            }
        }

        function SetPartCodeItemNameScrap(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).select2('val');
                if (ID == "ScrapPartCode") {
                    $("#ScrapItemName").val(v).trigger("change");
                }

                if (ID == "ScrapItemName") {
                    $("#ScrapPartCode").val(v).trigger("change");
                }
            }
        }

        function SetPartCodeItemNameProduct(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).select2('val');
                if (ID == "ProductPartCode") {
                    $("#ProductItemName").val(v).trigger("change");
                }

                if (ID == "ScrapItemName") {
                    $("#ProductPartCode").val(v).trigger("change");
                }
            }
        }


        function SetPartCodeItemNameAlt(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).select2('val');
                if (ID == "AltPartCode") {
                    $("#AltItemName").val(v).trigger("change");
                }

                if (ID == "AltItemName") {
                    $("#AltPartCode").val(v).trigger("change");
                }
            }
        }

        function SetPartCodeItemNameRM(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).select2('val');
                if (ID == "RmPartCode") {
                    $("#RmItemName").val(v).trigger("change");
                }

                if (ID == "RmItemName") {
                    $("#RmPartCode").val(v).trigger("change");
                }
            }
        }

        function GetChildData(event) {

            event.preventDefault();
            if (!ValidateChildPart_Grid()) return;
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetChildData")",
                data: { WcId: $('#WorkCenter').val(), YearCode: $('#YearCode').val(), ProdQty: $('#ProdQty').val(), ItemCode: $('#ItemName').val(), ProdDate: $('#EntryDate').val(), BomNo: $('#BOMNo').val(), ProdType: $('#ProdType').val() },
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        $('#divProductionEntryGrid').empty();
                        $('#divProductionEntryGrid').append(result);
                        var row = $('#divProductionEntryGrid tr').length
                        var i = 1;
                        for (i = 1; i <= row; i++) {
                            var ReqQty = Number(parseFloat($('#ReqQty-' + i).val()).toFixed(6));
                            var TotalStock = Number(parseFloat($('#TotalStock-' + i).val()).toFixed(6));
                            if (ReqQty > TotalStock) {
                                document.getElementById('itemGrid-' + i).style.backgroundColor = '#ed6262';
                            }
                            if ($('#ProdType').val() == 'ReWork') {

                                removeReadonlyAttributes(i);
                                $('#deleteItem-' + i).removeClass('noCursor');
                            }
                            if ($('#ProdType').val() == 'Production') {
                                $('#deleteItem-' + i).addClass('noCursor');
                                CheckAutoOrManual();
                            }
                        }
                        $('#displaylistbutton').show();
                    }
                }
            });
        }

        function removeReadonlyAttributes(i) {

            while (true) {
                var inputField = document.getElementById('IssueQty-' + i);
                if (inputField === null) {
                    break; // Exit the loop if the element is not found
                }
                inputField.removeAttribute('readonly');
                i++;
            }
            var elements = document.getElementsByClassName('noCursor');
            while (elements.length > 0) {
                elements[0].classList.remove('noCursor');
            }
        }

        function IssQtyChange(i) {

            var IssQty = Number(parseFloat($('#IssueQty' + i).val()).toFixed(6));
            var TotalStock = Number(parseFloat($('#TotalStock' + i).val()).toFixed(6));
            var BatchStock = Number(parseFloat($('#BatchStock' + i).val()).toFixed(6));
            if (IssQty > TotalStock || IssQty > BatchStock) {
                $.notify('ConsumedQty cannot greater than Stock', "error");
            }
        }

        $('#ProdType').change(function () {

            $('#divProductionEntryGrid').empty();
            $('#divAddProductionEntryGrid').empty();
            if ($('#ProdType').val() == 'ReWork') {
                $('#altProductionentry').show();
                $('#AddChildPartbtn').show();
                FillRMItemName();
                FillRMPartCode();
            }
            else if ($('#ProdType').val() == 'Production') {
                $('#altProductionentry').hide();
                CheckAutoOrManual();
            }
        })

        function ValidatePE_Grid() {
             
            var Err = 0;
            if ($('#divProductionEntryGrid  tr').length == 0) {
                Err = 1;
                $.notify('Please Click to child part stock button to add to grid.', "error");
            }
            var row = $('#divProductionEntryGrid tr').length;
            var i = 1;
            for (i = 1; i <= row; i++) {
                var ReqQty = Number(parseFloat($('#ReqQty-' + i).val()).toFixed(6));
                var TotalStock = Number(parseFloat($('#TotalStock-' + i).val()).toFixed(6));
                if ( TotalStock<0) {
                    Err = 1;
                    $.notify('Total STock Can Not Be less Then 0.', "error");
                    Err == 1 ? ShowErrorFldwithAddtoGrid('H_SAGrid') : HideErrorFldwithAddtoGrid('H_SAGrid');
                    if (Err == 1) return false;
                    return true;
                }
            }


            if ($('#ProdType').val() == 'Production') {
                var Err = 0;
                var rowCount = $('#divProductionEntryGrid tr').length;
                var Totalqty = [];
                for (var i = 1; i <= rowCount; i++) {
                    Totalqty.push({
                        "PartCode": $('#PartCode-' + i).val(),
                        "ReqQty": Number(parseFloat($('#ReqQty-' + i).val()).toFixed(6)),
                        "IssueQty": Number(parseFloat($('#IssueQty-' + i).val()).toFixed(6))
                    })
                }
                var sums = {};
                var secondColumnValues = {};
                for (var i = 0; i < Totalqty.length; i++) {
                    var partCode = Totalqty[i].PartCode;
                    var secondColumnValue = Number(parseFloat(Totalqty[i].ReqQty).toFixed(6));
                    var thirdColumnValue = Number(parseFloat(Totalqty[i].IssueQty).toFixed(6));
                    if (!sums[partCode]) {
                        sums[partCode] = 0;
                        secondColumnValues[partCode] = secondColumnValue;
                    }
                    sums[partCode] += thirdColumnValue;
                    console.log("sum" + sums[partCode]);
                }
                for (var partCode in sums) {
                    console.log(sums);
                    if (sums.hasOwnProperty(partCode)) {
                        var sumThirdColumn = sums[partCode];
                        var secondColumnValue = secondColumnValues[partCode];
                        console.log(sumThirdColumn);
                        console.log(secondColumnValue);
                        if (Number(sumThirdColumn.toFixed(6)) !== Number(secondColumnValue.toFixed(6))) {
                            AddErrorCls('IssueQty');
                            Err = 1;
                            $.notify(`For part code ${partCode},is not consumed TotalQty :Cons Qty ${sumThirdColumn} and reqqty ${secondColumnValue}`, 'error');
                        }
                    }
                }
                Err == 1 ? ShowErrorFldwithAddtoGrid('H_SAGrid') : HideErrorFldwithAddtoGrid('H_SAGrid');
                if (Err == 1) return false;
                return true;
            }
            else {
                CheckAutoOrManual();
                return true;
            }
        }

        function GetTimeDiff() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetTimeDiff")",
                dataType: "json",
                data: { "ToTime": $('#BreaktoTime').val(), "DiffType": "M", "FromTime": $('#BreakfromTime').val() },
                async: false,
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var DiffMinutes = obj.Result[0].DiffMinutes;
                            $('#BreakTimeMin').val(DiffMinutes);
                        }
                    }
                }
            });
        }

        function GetTimeDiffHours() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetTimeDiff")",
                dataType: "json",
                data: { "ToTime": $('#ToTime').val(), "DiffType": "H", "FromTime": $('#Fromtime').val() },
                async: false,
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var DiffHour = obj.Result[0].DiffHour;
                            $('#TotalHours').val(DiffHour);
                        }
                    }
                }
            });
        }

        $('#BreakTimeMin').change(function () {
            GetDateforBreakdown();
        })

        function GetDateforBreakdown() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetDateforBreakdown")",
                dataType: "json",
                data: { "DiffType": "M", "QtyOfTime": $('#BreakTimeMin').val(), "FromTime": $('#BreakfromTime').val() },
                async: false,
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var DiffMinutes = obj.Result[0].DiffMinutes;
                            var formattedDateTime = DiffMinutes.replace('T', ' ').slice(0, 16);
                            $('#BreaktoTime').val(formattedDateTime);
                            var ProdendDate = getFormattedDate(ProdendDate);
                            var maxProdEndDate = new Date(ProdendDate);
                            maxProdEndDate.setDate(maxProdEndDate.getDate() + 2);
                            flatpickr("#BreaktoTime", {
                                enableTime: true,
                                dateFormat: "Y-m-d H:i",
                                altInput: true,
                                altFormat: "H:i",
                                enableSeconds: true, // Enable seconds input
                                defaultDate: formattedDateTime,
                                minDate: ProdendDate, // Minimum selectable date and time
                                maxDate: maxProdEndDate, // Maximum selectable date and time
                                onChange: function (selectedDates, dateStr, instance) {
                                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                                }
                            });
                        }
                    }
                }
            });
        }

        $('#TotalHours').change(function () {
            GetDateforOperator();
        })

        function GetDateforOperator() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetDateforBreakdown")",
                dataType: "json",
                data: { "DiffType": "H", "QtyOfTime": $('#TotalHours').val(), "FromTime": $('#Fromtime').val() },
                async: false,
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var DiffHour = obj.Result[0].DiffHour;
                            var formattedDateTime = DiffHour.replace('T', ' ').slice(0, 16);
                            $('#ToTime').val(formattedDateTime);
                            var ProdendDate = getFormattedDate(ProdendDate);
                            var maxProdEndDate = new Date(ProdendDate);
                            maxProdEndDate.setDate(maxProdEndDate.getDate() + 2);
                            flatpickr("#ToTime", {
                                enableTime: true,
                                dateFormat: "Y-m-d H:i",
                                altInput: true,
                                altFormat: "H:i",
                                enableSeconds: true, // Enable seconds input
                                defaultDate: formattedDateTime,
                                minDate: ProdendDate, // Minimum selectable date and time
                                maxDate: maxProdEndDate, // Maximum selectable date and time
                                onChange: function (selectedDates, dateStr, instance) {
                                    instance.altInput.value = instance.formatDate(selectedDates[0], "H:i");
                                }
                            });
                        }
                    }
                }
            });
        }

        function ValidateChildPE_Grid() {

            var Err = 0;
            var RmPartCode = $('#RmPartCode').find(':selected').text();
            var RmBatchNo = $('#RmBatchNo').find(':selected').text();
            var RowCount = $('#divAddProductionEntryGrid tr').length;
            var PartCodeBatchwise = [];
            for (var i = 1; i <= RowCount; i++) {
                PartCodeBatchwise.push({
                    "PartCode": $('#PartCode-' + i).text(),
                    "BatchNo": $('#RmBatchNo-' + i).text(),
                })
            }

            var uniquePartCode = {};
            var resultArray = [];

            PartCodeBatchwise.forEach(function (PartCode) {
                if (!uniquePartCode[PartCode]) {
                    resultArray.push(PartCode);
                    uniquePartCode[PartCode] = true;
                }
            });

            for (var i = 0; i < resultArray.length; i++) {
                if (resultArray[i] == RmPartCode) {
                    Err = 1;
                    $.notify('Cannot add duplicate Item.', "error");
                }
            }

            //else {
            //    Err = 0;
            //    $.notify('Item Added Successfully.', "success");
            //}
            Err == 1 ? ShowErrorFldwithAddtoGrid('H_SAGrid') : HideErrorFldwithAddtoGrid('H_SAGrid');
            if (Err == 1) return false;
            return true;
        }

        function ValidateChildPart_Grid() {

            var Err = 0;
            if ($('#WorkCenter').val() == '') {
                Err = 1;
                $.notify('Please select workcenter first.', "error");
            } else {
                RemoveErrorCls('WorkCenter');
            }
            if ($('#PartCode').val() == '-Select-') {
                Err = 1;
                $.notify('Please select PartCode first.', "error");
            } else {
                RemoveErrorCls('PartCode');
            }
            if ($('#ItemName').val() == '-Select-') {
                Err = 1;
                $.notify('Please select ItemName first.', "error");
            } else {
                RemoveErrorCls('ItemName');
            }
            if ($('#ProdQty').val() == 0 || $('#ProdQty').val() < 0) {
                Err = 1;
                $.notify('Please Fill ProdQty first.', "error");
            } else {
                RemoveErrorCls('ProdQty');
            }
            if ($('#YearCode').val() == 0 || $('#YearCode').val() < 0) {
                Err = 1;
                $.notify('Please Fill YearCode first.', "error");
            } else {
                RemoveErrorCls('ProdQty');
            }
            if ($('#EntryDate').val() == '') {
                Err = 1;
                $.notify('Please Fill EntryDate first.', "error");
            } else {
                RemoveErrorCls('EntryDate');
            }
            if ($('#BOMNo').val() == '') {
                Err = 1;
                $.notify('Please Fill BOMNo first.', "error");
            } else {
                RemoveErrorCls('BOMNo');
            }
            if ($('#ProdAgainstPlanManual').val() == 'UNPLANNED') {
                var Target = Number(parseFloat($('#unTarget').val()).toFixed(6));
                var ProdQty = Number(parseFloat($('#ProdQty').val()).toFixed(6));
                if (ProdQty > Target) {
                    $.notify("ProdQty cannot be greater than TargetQty", "error");
                    Err = 1;
                }
                else if (ProdQty < 0) {
                    $.notify("ProdQty cannot be less than 0", "error");
                }
                else {
                    var PendQty = Number((Target - ProdQty).toFixed(6));
                    $('#PendQty').val(0);
                    $('#PendQty').val(PendQty);

                }

            } else {

                var TargetQty = Number(parseFloat($('#TargetQty').val()).toFixed(6));
                var ProdQty = Number(parseFloat($('#ProdQty').val()).toFixed(6));
                if (ProdQty > TargetQty) {
                    $.notify("ProdQty cannot be greater than TargetQty", "error");
                    Err = 1;
                }
                else if (ProdQty < 0) {
                    $.notify("ProdQty cannot be less than 0", "error");
                }
                else {
                    var PendQty = Number((TargetQty - ProdQty).toFixed(6));
                    $('#PendQty').val(0);
                    $('#PendQty').val(PendQty);
                }
            }
            Err == 1 ? ShowErrorFldwithAddtoGrid('H_SAGrid') : HideErrorFldwithAddtoGrid('H_SAGrid');
            if (Err == 1) return false;
            return true;
        }

        function deletebyitem(i) {

            if ($('#ProdType').val() == "Production" && $('#ProdEntryAllowToAddRMItem').val() == 'N' && $('#ProdEntryAllowToAddRMItem').val() == 'n') {
                return false;
            } else if ($('#ProdType').val() == "ReWork" || $('#ProdEntryAllowToAddRMItem').val() == 'Y' || $('#ProdEntryAllowToAddRMItem').val() == 'y') {
                DeleteByItem(i);
                var row = $('#divProductionEntryGrid tr').length
                var i = 1;
                for (i = 1; i <= row; i++) {
                    var ReqQty = Number(parseFloat($('#ReqQty-' + i).val()).toFixed(6));
                    var TotalStock = Number(parseFloat($('#TotalStock-' + i).val()).toFixed(6));
                    if (ReqQty > TotalStock) {
                        document.getElementById('itemGrid-' + i).style.backgroundColor = '#ed6262';
                    }
                    if ($('#ProdType').val() == 'ReWork') {

                        removeReadonlyAttributes(i);
                        $('#deleteItem-' + i).removeClass('noCursor');
                    }
                    if ($('#ProdType').val() == 'Production') {
                        $('#deleteItem-' + i).addClass('noCursor');
                    }
                    else {
                        CheckAutoOrManual();
                    }
                }
            }
        }

        var editingNow = false;
        function EditItemRow(SeqNo) {

            if (editingNow == false) {
                return new Promise((resolve, reject) => {

                    $.ajax({
                        url: '@Url.Action("EditItemRow")',
                        type: "POST",
                        data: { "SeqNo": SeqNo },
                    })
                        .done(function (data, status, xhr) {

                            editingNow = true;
                            var obj = $.parseJSON(data);
                            if (obj != null && obj.length == 1) {
                                var i = 1;
                                $('#RmPartCode').val(obj[0].ItemCode).trigger('change');
                                $('#RmItemName').val(obj[0].ItemCode).trigger('change');
                                GetBatchNo();
                                if ($('#Mode').val() == "U") {
                                    $('#RmBatchNo').append('<option selected>' + obj[0].BatchNo + '</option>');
                                    $('#RmUniqueBatchNo').append('<option selected>' + obj[0].UniqueBatchNo + '</option>');
                                } else {
                                    $('#RmBatchNo').val(obj[0].BatchNo).trigger('change');
                                    $('#RmUniqueBatchNo').val(obj[0].UniqueBatchNo);
                                }
                                $('#ReqQty').val(obj[0].ReqQty);
                                $('#TotalStock').val(obj[0].TotalStock);
                                $('#LotStock').val(obj[0].LotStock);
                                $('#Unit').val(obj[0].Unit);
                                $('#BatchDate').val(obj[0].BatchDate.split("T")[0]);
                                $('#Rate').val(obj[0].Rate);
                                $('#DetailRemark').val(obj[0].Remark);
                                $('#StdPacking').val(obj[0].StdPacking);
                                //$('#divProductionEntryGrid').append(html);
                                if ($('#ProdType').val() == 'ReWork') {

                                    removeReadonlyAttributes(i);
                                }
                                else {
                                    CheckAutoOrManual();
                                }
                                i++;
                                $('#displaylistbutton').show();
                                DeleteItemRow(SeqNo);
                            }
                        })
                        .fail(function (response) {
                            reject(response.responseText);
                        });
                });
            }
            else {
                $.notify("Cannot edit as one item is already on above edit grid", "error");
            }
        }

        function DeleteItemRow(SeqNo) {

            $.ajax({
                url: '@Url.Action("DeleteItemRow")',
                type: "POST",
                data: { "SeqNo": SeqNo, "ProdType": $('#ProdType').val() },
                async: false,
                success: function (data, status, xhr) {

                    $('#divAddProductionEntryGrid').html(data);
                },
                error: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                },
                failure: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                }
            });
        }

        function DeleteByItem(SeqNo) {

            $.ajax({
                url: '@Url.Action("DeleteByItem")',
                type: "POST",
                data: { "SeqNo": SeqNo },
                async: false,
                success: function (data, status, xhr) {

                    $('#divProductionEntryGrid').html(data);
                },
                error: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                },
                failure: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                }
            });
        }

        function Add2Grid() {
            if (!ValidateChildPE_Grid()) return;
            var modelData = {
                "PartCode": $('#RmPartCode').find(':selected').text(),
                "ItemName": $('#RmItemName').find(':selected').text(),
                "ReqQty": $('#ReqQty').val(),
                "IssueQty": $('#IssueQty').val(),
                "unit": $('#Unit').val(),
                "MainIssueQty": 0,
                "ProdQty": 0,
                "TotalStock": $('#TotalStock').val(),
                "BatchStock": $('#LotStock').val(),
                "AltQty": 0,
                "AltUnit": $('#Unit').val(),
                "NetWt": 0,
                "GrossWt": 0,
                "Batchwise": 'YES',
                "BatchNo": $('#RmBatchNo').find(':selected').text(),
                "UniqueBatchNo": $('#RmUniqueBatchNo').find(':selected').text(),
                "PendQty": 0,
                "StdPacking": $('#StdPacking').val(),
                "PendAfterIssue": 0,
                "StoreName": $('#StoreName').val(),
                "Batchdate": $('#Batchdate').val(),
                "Rate": $('#Rate').val(),
                "DetailRemark": $('#DetailRemark').val(),
                "RemainingStock": 0,
                "ProdType": $('#ProdType').val(),
                "ProdEntryAllowToAddRMItem": $('#ProdEntryAllowToAddRMItem').val()
            }
            $.ajax({
                url: "@Url.Action("AddChilddetailGrid")",
                type: "POST",
                data: { modelData: modelData },
                success: function (data, status, xhr) {

                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");
                        $('#AddChildPartbtn').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD CHILD GRID</span>').prop("disabled", false);
                    }
                    else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
                        $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
                    }
                    else {
                        $('#divAddProductionEntryGrid').html(data);
                        $('#RmPartCode').prop('selectedIndex', 0).trigger("change"),
                            $('#RmItemName').prop('selectedIndex', 0).trigger("change"),
                            $('#AltPartCode').prop('selectedIndex', 0).trigger("change"),
                            $('#AltItemName').prop('selectedIndex', 0).trigger("change"),
                            $('#ReqQty').val(0),
                            $('#RmBatchNo').prop('selectedIndex', 0),
                            $('#RmUniqueBatchNo').prop('selectedIndex', 0),
                            $('#TotalStock').val(0),
                            $('#LotStock').val(0),
                            $('#Unit').val(''),
                            $('#Rate').val(0),
                            $('#DetailRemark').val(''),
                            $('#StdPacking').val(0)
                    }
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {

                    $('.Schedule').fadeIn();
                }
            }).done(function () {

            }).fail(function () {
                alert("error");;
            }).always(function () {

            });
        }

        function CheckAllowToAddNegativeStock() {
            var isAllowed = false;

            $.ajax({
                type: "POST",
                url: "@Url.Action("CheckAllowToAddNegativeStock")",
                dataType: "json",
                data: {},
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.Result[0].ProdEntryAllowToAddNegativeStock == 'Y') {
                            isAllowed = true;
                        }
                        if (obj.Result[0].ProdEntryAllowToAddNegativeStock == 'N') {
                            isAllowed = ValidatePE_Grid();
                        }
                    }
                }
            });
            return isAllowed;
        }

        function GridButton(event) {
            event.preventDefault();
             
            if (!CheckAllowToAddNegativeStock()) return;
            var rowCount = $('#divProductionEntryGrid tr').length;
            var ItemData = [];
            for (var i = 1; i <= rowCount; i++) {

                ItemData.push({
                    "SeqNo": i,
                    "PartCode": $('#PartCode-' + i).val(),
                    "ItemName": $('#ItemName-' + i).val(),
                    "ConsumedRMItemCode": $('#RmItemCode-' + i).val(),
                    "ReqQty": Number(parseFloat($('#ReqQty-' + i).val()).toFixed(6)),
                    "IssueQty": Number(parseFloat($('#IssueQty-' + i).val()).toFixed(6)),
                    "unit": $('#unit-' + i).val(),
                    "MainIssueQty": Number(parseFloat($('#MainIssueQty-' + i).val()).toFixed(6)),
                    "ProdQty": Number(parseFloat($('#ProdQty-' + i).val()).toFixed(6)),
                    "TotalStock": Number(parseFloat($('#TotalStock-' + i).val()).toFixed(6)),
                    "BatchStock": parseFloat($('#BatchStock-' + i).val()),
                    "AltQty": Number(parseFloat($('#AltQty-' + i).val()).toFixed(6)),
                    "AltUnit": $('#AltUnit-' + i).val(),
                    "NetWt": Number(parseFloat($('#NetWt-' + i).val()).toFixed(6)),
                    "GrossWt": Number(parseFloat($('#GrossWt-' + i).val()).toFixed(6)),
                    "Batchwise": $('#Batchwise-' + i).val(),
                    "BatchNo": $('#BatchNo-' + i).val(),
                    "UniqueBatchNo": $('#UniqueBatchNo-' + i).val(),
                    "PendQty": Number(parseFloat($('#PendQty-' + i).val()).toFixed(6)),
                    "StdPacking": $('#StdPacking-' + i).val(),
                    "PendAfterIssue": $('#PendAfterIssue-' + i).val(),
                    "StoreName": $('#StoreName-' + i).val(),
                    "Batchdate": $('#Batchdate-' + i).val(),
                    "Rate": Number(parseFloat($('#Rate-' + i).val()).toFixed(6)),
                    "DetailRemark": $('#DetailRemark-' + i).val(),
                    "RemainingStock": Number(parseFloat($('#RemainingStock-' + i).val()).toFixed(6)),
                    "ProdType": $('#ProdType').val(),
                    "ProdEntryAllowToAddRMItem": $('#ProdEntryAllowToAddRMItem').val()
                });
            }

            $.ajax({
                url: "@Url.Action("AddProductionEntryGrid")",
                type: "POST",
                data: { model: ItemData },
                success: function (data, status, xhr) {

                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");
                        $('.GridButton').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                    }
                    else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
                        $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
                    }
                    else {
                        $('#divAddProductionEntryGrid').html(data);
                        $('#divProductionEntryGrid').empty();
                        editingNow = false;
                    }
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {

                    $('.Schedule').fadeIn();
                }
            }).done(function () {

            }).fail(function () {
                alert("error");;
            }).always(function () {

            });
        }

        function ClearOperatorGrid() {

            $('#OperatorName').prop('selectedIndex', 0).trigger("change"),
                $('#OverTimeHrs').val(0),
                $('#MachineCharges').val(0)
        }

        function ValidateOperator_Grid() {

            var Err = 0;
            if ($('#TotalHours').val() <= 0) {
                Err = 1;
                $.notify('TotalHours cannot be 0 or less than 0', "error");
            }
            if ($('#OperatorName').val() == null) {
                Err = 1;
                $.notify('OperatorName is required', "error");
            }
            if ($('#OverTimeHrs ').val() > 48) {
                Err = 1;
                $.notify('OverTimeHrs is not greater than 48', "error");
            }
            Err == 1 ? ShowErrorFldwithAddtoGrid('H_Procurment') : HideErrorFldwithAddtoGrid('H_Procurment');
            if (Err == 1) return false;
            return true;
        }

        function OperatorGrid(event) {

            if (!ValidateOperator_Grid()) return;
            event.preventDefault();
            var OperatorData = {
                "OperatorName": $("#OperatorName").find(':selected').text(),
                "Fromtime": $("#Fromtime").val(),
                "OperatorId": $("#OperatorName").val(),
                "ToTime": $('#ToTime').val(),
                "TotalHours": $('#TotalHours').val(),
                "OverTimeHrs": $('#OverTimeHrs').val(),
                "MachineCharges": $('#MachineCharges').val(),
                "McId": $('#MachineName').val(),
                "ProcessId": $('#Operation').val()
            }

            $.ajax({
                url: "@Url.Action("AddOperatordetailGrid")",
                type: "POST",
                data: { model: OperatorData },
                success: function (data, status, xhr) {

                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");
                        $('.GridButton').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                    }
                    else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
                        $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
                    }
                    else {
                        $('#divOperatorDetailGrid').html(data);
                        editingOperatorNow = false;
                        ClearOperatorGrid();
                    }

                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {

                    $('.Schedule').fadeIn();
                }
            }).done(function () {

            }).fail(function () {
                alert("error");;
            }).always(function () {

            });
        }

        function ClearBreakdownGrid() {

            $('#ReasonDetail').prop('selectedIndex', 0).trigger("change"),
                $('#ResEmpName').prop('selectedIndex', 0).trigger("change"),
                $('#ResFactor').prop('selectedIndex', 0).trigger("change")
        }

        function ValidateBreak_Grid() {
            var Err = 0;
            if ($('#BreakTimeMin').val() <= 0) {
                Err = 1;
                $.notify('You can not add For 0 and less than 0 Breakdown minutes', "error");
            }
            if ($('#ReasonDetail').val() == null) {
                Err = 1;
                $.notify('ReasonDetail is required', "error");
            }
            if ($('#ResEmpName').val() == null) {
                Err = 1;
                $.notify('ResEmpName is required', "error");
            }
            if ($('#ResFactor').val() == null) {
                Err = 1;
                $.notify('ResFactor is required', "error");
            }
            Err == 1 ? ShowErrorFldwithAddtoGrid('H_DrawingDetail') : HideErrorFldwithAddtoGrid('H_DrawingDetail');
            if (Err == 1) return false;
            return true;
        }

        function reformatDateTime(datetimeStr) {
            let date = new Date(datetimeStr.replace(' ', 'T')); // Replace space with 'T' to create a valid ISO format
            let day = String(date.getDate()).padStart(2, '0');
            let month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-indexed
            let year = date.getFullYear();
            let hours = String(date.getHours()).padStart(2, '0');
            let minutes = String(date.getMinutes()).padStart(2, '0');
            let seconds = String(date.getSeconds()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        }

        function BreakdownGrid(event) {
            if (!ValidateBreak_Grid()) return;
            event.preventDefault();
            var datefromString = $("#BreakfromTime").val()
            var fromdate = new Date(datefromString);
            var formattedfromDate = `${fromdate.getFullYear()}-${String(fromdate.getMonth() + 1).padStart(2, '0')}-${String(fromdate.getDate()).padStart(2, '0')} ` +
                `${String(fromdate.getHours()).padStart(2, '0')}:${String(fromdate.getMinutes()).padStart(2, '0')}:${String(fromdate.getSeconds()).padStart(2, '0')}.` +
                `${String(fromdate.getMilliseconds()).padStart(3, '0')}`;
            var datetoString = $("#BreaktoTime").val();
            var todate = new Date(datetoString);
            var formattedtoDate = `${todate.getFullYear()}-${String(todate.getMonth() + 1).padStart(2, '0')}-${String(todate.getDate()).padStart(2, '0')} ` +
                `${String(todate.getHours()).padStart(2, '0')}:${String(todate.getMinutes()).padStart(2, '0')}:${String(todate.getSeconds()).padStart(2, '0')}.` +
                `${String(todate.getMilliseconds()).padStart(3, '0')}`;
            var BreakdownData = {
                "BreakfromTime": formattedfromDate,
                "BreaktoTime": formattedtoDate,
                "ReasonDetail": $('#ReasonDetail').find(':selected').text(),
                "ReasonId": $('#ReasonDetail').val(),
                "BreakTimeMin": $('#BreakTimeMin').val(),
                "ResEmpName": $('#ResEmpName').find(':selected').text(),
                "ResponcibleEmp": $('#ResEmpName').val(),
                "ResFactor": $('#ResFactor').val(),
            }

            $.ajax({
                url: "@Url.Action("AddBreakdowndetailGrid")",
                type: "POST",
                data: { model: BreakdownData },
                success: function (data, status, xhr) {

                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");
                    }
                    else {
                        $('#divBreakdownDetailGrid').html(data);
                        editingBreakdownNow = false;
                        ClearBreakdownGrid();
                    }

                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {

                    $('.Schedule').fadeIn();
                }
            }).done(function () {

            }).fail(function () {
                alert("error");;
            }).always(function () {

            });
        }

        function ValidateScrap_Grid() {

            var Err = 0;
            if ($('#ScrapPartCode').prop('selectedIndex') == 0) {
                AddErrorCls('ScrapPartCode');
                $.notify("Select ScrapPartcode", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ScrapPartCode');
            }
            if ($('#ScrapItemName').prop('selectedIndex') == 0) {
                AddErrorCls('ScrapItemName');
                $.notify("Select ScrapItemName", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ScrapItemName');
            }
            if ($('#ScrapQty').val() == 0) {
                AddErrorCls('ScrapQty');
                $.notify("ScrapQty Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ScrapQty');
            }
            if ($('#ScrapQty').val() > 0) {
                if ($('#StoreTransferScrap').prop('selectedIndex') == 0) {
                    AddErrorCls('StoreTransferScrap');
                    $.notify("StoreTransferScrap Required", "error");
                    Err = 1;
                } else {
                    RemoveErrorCls('StoreTransferScrap');
                }
                if ($('#TransferToWCStore').val() == null) {
                    AddErrorCls('TransferToWCStore');
                    $.notify("TransferToWCStore Required", "error");
                    Err = 1;
                } else {
                    RemoveErrorCls('TransferToWCStore');
                }
                Err == 1 ? ShowErrorFldwithAddtoGrid('H_Measurements') : HideErrorFldwithAddtoGrid('H_Measurements');
                if (Err == 1) return false;
                return true;
            }
        }

        function ValidateProduct_Grid() {

            var Err = 0;
            if ($('#ProductPartCode').prop('selectedIndex') == 0) {
                AddErrorCls('ProductPartCode');
                $.notify("Select ProductPartCode", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ProductPartCode');
            }
            if ($('#ProductItemName').prop('selectedIndex') == 0) {
                AddErrorCls('ProductItemName');
                $.notify("Select ProductItemName", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ProductItemName');
            }
            if ($('#ProductQty').val() == 0) {
                AddErrorCls('ProductQty');
                $.notify("ProductQty Required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('ProductQty');
            }
            if ($('#ProductQty').val() > 0) {
                if ($('#StoreTransferProduct').prop('selectedIndex') == 0) {
                    AddErrorCls('StoreTransferProduct');
                    $.notify("StoreTransferProduct Required", "error");
                    Err = 1;
                } else {
                    RemoveErrorCls('StoreTransferProduct');
                }
                if ($('#ProductTransferToWCStore').val() == null) {
                    AddErrorCls('ProductTransferToWCStore');
                    $.notify("ProductTransferToWCStore Required", "error");
                    Err = 1;
                } else {
                    RemoveErrorCls('ProductTransferToWCStore');
                }
                Err == 1 ? ShowErrorFldwithAddtoGrid('H_Measurements') : HideErrorFldwithAddtoGrid('H_Measurements');
                if (Err == 1) return false;
                return true;
            }
        }

        function ClearScrapGrid() {

            $('#ScrapPartCode').prop('selectedIndex', 0).trigger("change"),
                $('#ScrapItemName').prop('selectedIndex', 0).trigger("change"),
                $('#ScrapType').prop('selectedIndex', 0).trigger("change"),
                $('#Scrapunit').val(''),
                $('#ScrapQty').val(0),
                $('#StoreTransferScrap').prop('selectedIndex', 0),
                $('#TransferToWCStore').prop('selectedIndex', 0).trigger("change")
        }

        function ClearProductGrid() {

            $('#ProductPartCode').prop('selectedIndex', 0).trigger("change"),
                $('#ProductItemName').prop('selectedIndex', 0).trigger("change"),
                $('#ProductType').prop('selectedIndex', 0).trigger("change"),
                $('#Productunit').val(''),
                $('#ProductQty').val(0),
                $('#StoreTransferProduct').prop('selectedIndex', 0),
                $('#ProductTransferToWCStore').prop('selectedIndex', 0).trigger("change")
        }

        function ScrapGrid(event) {

            event.preventDefault();
            if (!ValidateScrap_Grid()) return;
            var TransferToStoreId = 0;
            var TransferToWC = 0;
            var TransferToWCStore = $('#StoreTransferScrap').val();
            if (TransferToWCStore == "S") {
                TransferToStoreId = $('#TransferToWCStore').val();
            }
            else {
                TransferToWC = $('#TransferToWCStore').val();
            }
            var ScrapData = {
                "ScrapItemName": $('#ScrapItemName').find(':selected').text(),
                "ScrapPartCode": $('#ScrapPartCode').find(':selected').text(),
                "ScrapItemCode": $('#ScrapItemCode').val(),
                "ScrapType": $('#ScrapType').val(),
                "ScrapQty": $('#ScrapQty').val(),
                "Scrapunit": $('#Scrapunit').val(),
                "StoreTransferScrap": $('#StoreTransferScrap').val(),
                "TransferToWCStore": $('#TransferToWCStore').find(':selected').text(),
                "TransferToStoreId": parseInt($('#TransferToWCStore').val()),
                "TransferToWC": parseInt($('#TransferToWCStore').val())
            }

            $.ajax({
                url: "@Url.Action("AddScrapdetailGrid")",
                type: "POST",
                data: { model: ScrapData },
                success: function (data, status, xhr) {

                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");
                    }
                    else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
                        $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
                    }
                    else {
                        $('#divScrapDetailGrid').html(data);
                        editingScrapNow = false;
                        ClearScrapGrid();
                    }

                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {

                    $('.Schedule').fadeIn();
                }
            }).done(function () {

            }).fail(function () {
                alert("error");;
            }).always(function () {

            });
        }

        function ProductGrid(event) {
             
            event.preventDefault();
            if (!ValidateProduct_Grid()) return;
            var ProductTransferToStoreId = 0;
            var ProductTransferToWCId = 0;
            var ProductTransferToWCStore = $('#StoreTransferProduct').val();
            if (ProductTransferToWCStore == "S") {
                ProductTransferToStoreId = $('#ProductStoreId').val();
            }
            else {
                ProductTransferToWCId = $('#ProductToWC').val();
            }
            var ProductData = {
                "ProductItemName": $('#ProductItemName').find(':selected').text(),
                "ProductPartCode": $('#ProductPartCode').find(':selected').text(),
                "ProductItemCode": $('#ProductItemCode').val(),
                "ProductType": $('#ProductType').val(),
                "ProductQty": $('#ProductQty').val(),
                "Productunit": $('#Productunit').val(),
                "StoreTransferProduct": $('#StoreTransferProduct').val(),
                "ProductTransferToWCStore": $('#ProductTransferToWCStore').find(':selected').text(),
                "ProductStoreId": ProductTransferToStoreId,
                "ProductToWCId": ProductTransferToWCId
            }

            $.ajax({
                url: "@Url.Action("AddProductdetailGrid")",
                type: "POST",
                data: { model: ProductData },
                success: function (data, status, xhr) {

                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");
                    }
                    else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
                        $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
                    }
                    else {
                        $('#divProductDetailGrid').html(data);
                        editingProductNow = false;
                        ClearProductGrid();
                    }

                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {

                    $('.Schedule').fadeIn();
                }
            }).done(function () {

            }).fail(function () {
                alert("error");;
            }).always(function () {

            });
        }

        var editingProductNow = false;
        function EditProductItemRow(SeqNo) {
             
            if (editingProductNow == false) {

                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: '@Url.Action("EditProductItemRow")',
                        type: "POST",
                        data: { SeqNo: SeqNo, Mode: $('#Mode').val() },
                    })
                        .done(function (data, status, xhr) {
                            editingProductNow = true;
                            var obj = $.parseJSON(data);
                            DeleteProductItemRow(SeqNo)
                                .then(() => {
                                    0
                                    $('#ProductPartCode').val(obj[0].ProductItemCode).trigger('change');
                                    $('#ProductItemName').val(obj[0].ProductItemCode).trigger('change');
                                    $('#ProductType').val(obj[0].ProductType).trigger('change');
                                    $('#ProductQty').val(obj[0].ProductQty);
                                    $('#Productunit').val(obj[0].Productunit);
                                    $('#StoreTransferProduct').change();
                                    $('#StoreTransferProduct').val(obj[0].StoreTransferProduct).trigger('change');
                                    $('#ProductTransferToWCStore').val(obj[0].ProductTransferToWCStore).trigger('change');
                                })
                                .catch((error) => {
                                    reject(error);
                                });

                        })
                        .fail(function (response) {
                            reject(response.responseText);
                        });
                });
            }
            else {
                $.notify("Cannot edit as one item is already on above edit grid", "error");
            }
        }

        var isEditProductAllowed = "false";

        function DeleteProductItemRow(SeqNo) {

            return new Promise((resolve, reject) => {
                $.ajax({
                    url: '@Url.Action("DeleteProductItemRow")',
                    type: "POST",
                    data: { "SeqNo": SeqNo, "Mode": $('#Mode').val() },
                    success: function (data) {
                        $('#divProductDetailGrid').html(data);
                        $.notify("Item Deleted from Grid", "info");
                        isEditProductAllowed = "true";
                        resolve();
                    },
                    error: function (response) {
                        reject(response.responseText);
                    }
                });
            });
        }

        function PressBack() {

            sessionStorage.setItem('FromDateBack', $('#FromDateBack').val());
            sessionStorage.setItem('ToDateBack', $('#ToDateBack').val());
            sessionStorage.setItem('SlipNoBack', $('#SlipNoBack').val());
            sessionStorage.setItem('PartCodeBack', $('#PartCodeBack').val());
            sessionStorage.setItem('ItemNameBack', $('#ItemNameBack').val());
            sessionStorage.setItem('ProdPlanNoBack', $('#ProdPlanNoBack').val());
            sessionStorage.setItem('ProdSchNoBack', $('#ProdSchNoBack').val());
            sessionStorage.setItem('ReqNoBack', $('#ReqNoBack').val());
            sessionStorage.setItem('GlobalSearchBack', $('#GlobalSearchBack').val());
            sessionStorage.setItem('DashboardTypeBack', $('#DashboardTypeBack').val());

            window.history.back();
        }

        $('#btnRoutingExcel').click(function () {
            $("#GridLabels").table2excel({
                filename: "RoutingDetail.xls"
            });
        });

        $('#InitalReading').keyup(function () {

            if (parseInt($('#InitalReading').val()) > parseInt($('#EndReading').val())) {
                $.notify('InitialReading is not greater than EndReading.', "error");
            }
        })

    </script>
    <script src="~/Scripts/table2excel.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
}