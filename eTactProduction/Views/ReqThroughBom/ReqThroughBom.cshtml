@model eTactWeb.DOM.Models.RequisitionThroughBomModel

@{
    ViewData["Title"] = "Requisition Through BOM";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<style>

    .select2-container--default .select2-selection--single {
        background-color: #e0f2f1;
        border: 1.5px solid #0a0a0a !important;
        border-radius: 4px;
    }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            /* border-bottom: 1.5px solid #000 !important; */
            border-bottom: none !important;
        }

    .select2-container--default .select2-results > .select2-results__options {
        background-color: #e0f2f1; /* Dropdown background color */
        color: #000;
</style>

<div class="card bg-gradient mb-3 border-light shadow-lg">
    <partial name="_ReqThroughBomPopup" />
    <form asp-action="ReqThroughBom" autocomplete="off" class="form-horizontal">
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                <strong>Requisition Through BOM</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    <div class="col-auto">
                        <a type="button" class="btn btn-sm btn-outline-light bg-gradient" asp-action="PrintReport" asp-controller="ReqThroughBom" asp-route-EntryId="@Model.EntryId" asp-route-YearCode="@Model.YearCode">
                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                            PRINT
                        </a>
                    </div>
                    <a asp-action="Dashboard" asp-route-FromDate="@DateTime.Now.AddDays(1 - DateTime.Now.Day)" asp-route-Todate="@DateTime.Today" asp-route-Flag="True" class="btn btn-sm btn-outline-light bg-gradient">
                        <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                        Dashboard
                    </a>
                    <div class="row justify-content-between g-2">
                        <div class="col-auto">
                            <input asp-for="REQNoBack" type="hidden" value="@Model.REQNoBack" />
                            <input asp-for="ItemNameBack" type="hidden" value="@Model.ItemNameBack" />
                            <input asp-for="PartCodeBack" type="hidden" value="@Model.PartCodeBack" />
                            <input asp-for="WorkCenterIdBack" type="hidden" value="@Model.WorkCenterIdBack" />
                            <input asp-for="WONoBack" type="hidden" value="@Model.WONoBack" />
                            <input asp-for="DeptNameBack" type="hidden" value="@Model.DeptNameBack" />
                            <input asp-for="FromDateBack" type="hidden" value="@Model.FromDateBack" />
                            <input asp-for="ToDateBack" type="hidden" value="@Model.ToDateBack" />
                            <input asp-for="TypeBack" type="hidden" value="@Model.TypeBack" />
                            <input asp-for="GlobalSearchBack" type="hidden" value="@Model.GlobalSearchBack" />
                            <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                BACK
                            </a>
                        </div>
                        @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                        {
                            <div class="col-auto">
                                <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                    <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                    REFRESH
                                </a>
                            </div>
                            @if (Model.Mode == "U"  )
                            {
                                <div class="col-auto">
                                    <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="UpdateButton">
                                        <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                        UPDATE
                                    </button>
                                </div>
                            }
                            
                            else
                            {
                                <div class="col-auto">
                                    <button type="submit" class="btn btn-primary btn-sm" id="submitBTN">
                                        <i class="fa-solid fa-chevron-circle-right"></i>
                                        SUBMIT
                                    </button>
                                </div>
                            }
                        }
                    </div>
                </span>
            </h5>
        </div>
        <div class="card-body bg-light pt-0">
            <div class="accordion shadow-lg">
                <div class="accordion-item" id="GI_Grid">
                    <h2 class="accordion-header" id="H_RParameter">
                        <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_RParameter" aria-expanded="true" aria-controls="B_RParameter">
                            <i class="fa-brands fa-wpforms fa-lg fa-fw pr35"></i>
                            Required Parameter
                        </button>
                    </h2>
                    <div id="B_RParameter" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_RParameter">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3">
                                <div class="col-lg">
                                    <input type="hidden" asp-for="Mode" value="@Model.Mode" />
                                    <label asp-for="EntryId" class="form-label">Entry Id</label>
                                    <input asp-for="EntryId " class="form-control" readonly />
                                </div>
                                <div class="col-lg">
                                    <label asp-for="YearCode" class="form-label">Year Code</label>
                                    <input asp-for="YearCode " class="form-control" readonly />
                                </div>
                                <div class="col-lg">
                                    <label asp-for="EntryDate" class="form-label">Entry Date</label>
                                    <input type="hidden" asp-for="FinFromDate" value="@Model.FinFromDate" />
                                    <input type="hidden" asp-for="FinToDate" value="@Model.FinToDate" />
                                    <input asp-for="EntryDate " class="form-control" readonly />
                                </div>
                                <div class="col-lg">
                                    <label asp-for="CC" class="form-label">Branch</label>
                                    <input asp-for="CC " class="form-control" readonly />
                                </div>
                                <div class="col-lg">
                                    <label asp-for="REQNo" class="form-label" style="color:blue">Req NO</label>
                                    @if (Model.Mode != "U" && Model.Mode != "V")
                                    {
                                        <input asp-for="REQNo" class="form-control" style="width:115px;background-color: lightblue !important;" readonly   />
                                    }
                                    else
                                    {
                                        <input asp-for="REQNo" class="form-control" value="@Model.REQNo" style="width:115px;background-color: lightblue !important;" readonly  />
                                    }
                                </div>
                                <div class="col-lg">
                                    <label asp-for="ReqDate" class="form-label">Req Date</label>
                                    <input type="hidden" asp-for="ReqTime" value="@Model.ReqTime" />
                                    <input type="hidden" asp-for="CancelDate" value="@Model.CancelDate" />
                                    <input asp-for="ReqDate " class="form-control" readonly />
                                    @if (@Model.Mode == "U" || @Model.Mode == "V")
                                    {
                                        <input id="hiddenReqDate" type="hidden" class="form-control" value="@Model.ReqDate" readonly />
                                    }
                                </div>
                                <div class="col-lg">
                                    <label asp-for="FromDepartmentId" class="form-label" style="color:red">From Dept*</label>
                                    <select class="form-select" asp-for="FromDepartmentId" asp-items="@(new SelectList(Model.DepartmentList,"Value","Text"))">
                                        @* @if (@Model.Mode == "U" || @Model.Mode == "V")
                                        {
                                            <option value="@Model.FromDepartmentId" selected>@Model.FromDepartmentId</option>
                                        } *@
                                    </select>
                                </div>
                                <div class="col-lg">
                                    <label asp-for="WONo" class="form-label" style="color:blue">Plan No</label>
                                    <select class="form-select" asp-for="WONo">
                                        @if (@Model.Mode == "U" || @Model.Mode == "V")
                                        {
                                            <input type="hidden" id="hiddenWONO" value="@Model.WONo" />
                                        }
                                    </select>
                                </div>
                                <div class="col-lg">
                                    <label asp-for="WoYearCode" class="form-label" style="color:blue">Plan YC</label>
                                    <select class="form-select" asp-for="WoYearCode">
                                        @if (@Model.Mode == "U" || @Model.Mode == "V")
                                        {
                                            <option value="@Model.WoYearCode" selected>@Model.WoYearCode</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-lg">
                                    <label asp-for="WODate" class="form-label" style="color:blue">Plan Date</label>
                                    <input asp-for="WODate" class="form-control" />
                                </div>
                                <div class="col-lg">
                                    <label asp-for="MachineId" class="form-label" style="color:blue">Machine</label>
                                    <select class="form-select" asp-for="MachineId" asp-items="@(new SelectList(Model.MachineList,"Value","Text"))">
                                        @if (@Model.Mode == "U" || @Model.Mode == "V")
                                        {
                                            <option value="@Model.MachineId" selected>@Model.MachineId</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-lg">
                                    <label asp-for="WorkCenterId" class="form-label" style="color:red">WC*</label>
                                    <select class="form-select" asp-for="WorkCenterId">
                                        @if (@Model.Mode == "U" || @Model.Mode == "V")
                                        {
                                            <input type="hidden" id="hiddenWorkCenter" value="@Model.WorkCenterId" />
                                        }
                                    </select>
                                </div>

                            </div>
                        </div>
                    </div>


                    <div class="accordion-item">
                        <h2 class="accordion-header" id="H_SAGrid">
                            <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
                                <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Req Through BOM Grid</strong>
                            </button>
                        </h2>

                        <div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                            <div class="accordion-body">
                                <div class="row g-2 gx-3" id="_ItemGrid">
                                </div>
                                <div class="progress my-2 mb-3" style="height: 4px;">
                                    <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="card">
                                    <div class="card-body overflow-auto pb-0">
                                        <table class="table table-hover table-bordered table-striped">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                                <tr>
                                                    <th style="min-width: 150px;color:yellow">Part Code*</th>
                                                    <th style="min-width: 300px; text-align: left;">
                                                        <div style="display: flex; justify-content: space-between; align-items: center;color:yellow">
                                                            <span>Item Name*</span>Show All</span>
                                                        </div>
                                                    </th>
                                                    <th style="min-width: 80px;color:yellow">Unit*</th>
                                                    <th style="min-width: 80px;;color:yellow">Qty*</th>
                                                    <th style="min-width: 80px;">Pend Qty</th>
                                                    <th style="min-width: 150px;">Store</th>
                                                    <th style="min-width: 80px;">Total Stock</th>
                                                    <th style="min-width: 80px;">Alt Unit</th>
                                                    <th style="min-width: 80px;">Alt Qty</th>
                                                    <th style="min-width: 80px;">Pend Alt Qty</th>
                                                    <th style="min-width: 80px;color:yellow">Bom Rev No*</th>
                                                    <th style="min-width: 150px;">Item Location</th>
                                                    <th style="min-width: 150px;">Item Bin Rack No</th>
                                                    <th style="min-width: 150px;">Bom Rev date</th>
                                                    <th style="min-width: 150px;">Project No</th>
                                                    <th style="min-width: 150px;">Project year code</th>
                                                    <th style="min-width: 150px;">Cost Center</th>
                                                    <th style="min-width: 150px;">Remark</th>
                                                    <th style="min-width: 150px;">Item Model</th>
                                                    <th style="min-width: 150px;">Item Size</th>
                                                    <th style="min-width: 150px;">Expected date</th>
                                                </tr>
                                            </thead>
                                            <tbody id="">
                                                <tr>
                                                    <td style="width:80% !important;">
                                                        <select class="form-select" style="width:100% !important;" id="PartCode">
                                                        </select>
                                                    </td>
                                                    <td style="width:200% !important;">
                                                        <div class="d-flex">
                                                            <select class="form-select" id="ItemCode" style="width:100% !important;"></select>
                                                            <button onclick="DisplayBomDetail(event)" style="background-color:#ffd6dd"
                                                                    class="formateBtn">
                                                                <i class="fa-solid fa-plus"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <input asp-for="Unit" class="form-control" readonly />
                                                    </td>
                                                    <td>
                                                        <input id="Qty" style="width:100%" class="form-control" type="number" min="0" />
                                                    </td>
                                                    <td>
                                                        <input id="PendQty" class="form-control" readonly />
                                                    </td>
                                                    <td>
                                                        <select class="form-select" id="StoreId" asp-items="@(new SelectList(Model.StoreList,"Value","Text"))">
                                                            <option value="" disabled selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input id="TotalStock" class="form-control" readonly />
                                                    </td>
                                                    <td>
                                                        <input id="AltUnit" class="form-control" readonly />
                                                    </td>
                                                    <td>
                                                        <input id="AltQty" class="form-control" />
                                                    </td>
                                                    <td>
                                                        <input asp-for="PendAltQty" class="form-control" readonly />
                                                    </td>
                                                    <td style="width: 100px;">
                                                        <select class="form-select" asp-for="BomRevNo" style="width: 100px;">
                                                            <option value="" disabled selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input asp-for="ItemLocation" class="form-control" readonly />
                                                    </td>
                                                    <td>
                                                        <input asp-for="ItemBinRackNo" class="form-control" readonly />
                                                    </td>
                                                    <td>
                                                        <input asp-for="BOMEffDate" class="form-control" readonly />
                                                    </td>
                                                    <td style="width:80% !important;">
                                                        <select class="form-select" style="width:100% !important;" asp-for="ProjectNo">
                                                            <option value="" disabled selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input class="form-control" asp-for="ProjectYearCode" readonly />
                                                    </td>
                                                    <td style="width:80% !important;">
                                                        <select class="form-select" style="width:100% !important;" asp-for="CostCenterId" asp-items="@(new SelectList(Model.CostCenterList,"Value","Text"))">
                                                            <option value="" disabled selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input asp-for="Remark" class="form-control" />
                                                    </td>
                                                    <td>
                                                        <input asp-for="ItemModel" class="form-control" />
                                                    </td>
                                                    <td>
                                                        <input asp-for="ItemSize" class="form-control" />
                                                    </td>
                                                    <td>
                                                        <input asp-for="ExpectedDate" class="form-control" value="@Model.ExpectedDate" />
                                                    </td>

                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                            <partial name="_DisplayReqThrBomDetail" />
                            <div class=" col-4 col-auto">
                                <div class="row justify-content-around">
                                    <div class="col-auto">
                                        <button type="button" class="GridButton btn btn-sm btn-outline-danger mt-3">
                                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                        </button>
                                    </div>
                                    <div class="col-6 col-auto">
                                        <button type="button" class="Display btn btn-sm btn-outline-success mt-3">
                                            <i class="fa-solid fa-calendar-clock fa-fw fa-lg"></i> Display Stock
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="progress my-2 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="card">
                                <div class="card-body overflow-auto pb-0">
                                    <table class="table table-hover table-bordered table-striped">
                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                            <tr>
                                                <th>Action</th>
                                                <th>Item Name</th>
                                                <th>Part Code</th>
                                                <th>Req Qty</th>
                                                <th>Pend Qty</th>
                                                <th>Store</th>
                                                <th>Total Stock</th>
                                                <th>Project No</th>
                                                <th>Project year code</th>
                                                <th>Bom Rev No</th>
                                                <th>Bom Rev Date</th>
                                                <th>Cost Center</th>
                                                <th>Alt Unit</th>
                                                <th>Alt Qty</th>
                                                <th>Item Model</th>
                                                <th>Item Size</th>
                                                <th>Expected Date</th>
                                                <th>Pend Alt Qty</th>
                                                <th>Item Location</th>
                                                <th>Item Bin Rack No</th>
                                            </tr>
                                        </thead>
                                        <tbody id="divReqThroughBomAdded">
                                            <partial name="_ReqThruBomGrid" />
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="progress my-2 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="OtherGrid">
                            <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#OtherGridDetail" aria-expanded="true" aria-controls="OtherGridDetail">
                                <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
                            </button>
                        </h2>
                        <div id="OtherGridDetail" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="OtherGrid">
                            <div class="accordion-body">
                                <div class="progress my-2 mb-3" style="height: 4px;">
                                    <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="row g-2 gx-3" id="_ItemGrid">

                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="ReqReason" class="form-label">Req Reason</label>
                                        <input asp-for="ReqReason " class="form-control" />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="RequByEmpId" class="form-label">Req by Emp</label>
                                        <select class="form-select" asp-for="RequByEmpId" asp-items="@(new SelectList(Model.EmployeeList,"Value","Text"))">
                                            @if (@Model.Mode == "U" || @Model.Mode == "V")
                                            {
                                                <option value="@Model.RequByEmpId" selected>@Model.RequByEmpId</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="Prefix" class="form-label">Prefix</label>
                                        <input asp-for="Prefix" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="Remarks" class="form-label">Remarks</label>
                                        <input asp-for="Remarks" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="Completed" class="form-label">Completed</label>
                                        <input asp-for="Completed" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="Cancel" class="form-label">Cancel</label>
                                        <input asp-for="Cancel" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="CancelReason" class="form-label">Cancel Reason</label>
                                        <input asp-for="CancelReason" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="NeedApproval" class="form-label">NeedApproval</label>
                                        <input asp-for="NeedApproval" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="Approved" class="form-label">Approved</label>
                                        <input asp-for="Approved" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="ApproveDate" class="form-label">Approve Date</label>
                                        <input asp-for="ApproveDate" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="ApproveBy" class="form-label">Approve By</label>
                                        <input asp-for="ApproveBy" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="LineRejEntryId" class="form-label">Line Rej Entry Id</label>
                                        <input asp-for="LineRejEntryId" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="LineRejYearCode" class="form-label">Line Rej YC</label>
                                        <input asp-for="LineRejYearCode" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="EntryByMachineName" class="form-label">Entry By Machine</label>
                                        <input asp-for="EntryByMachineName" value="@Environment.MachineName" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="CreatedBy" class="form-label">Actual Entered By</label>
                                        <input type="hidden" asp-for="CreatedBy" class="form-control" readonly />
                                        <input asp-for="CreatedByName" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="CreatedOn" class="form-label">ActualEntryDate</label>
                                        <input asp-for="CreatedOn" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="UpdatedBy" class="form-label">Updated By</label>
                                        <input type="hidden" asp-for="UpdatedBy" class="form-control" readonly />
                                        <input asp-for="UpdatedByName" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="UpdatedOn" class="form-label">Updated Date</label>
                                        <input asp-for="UpdatedOn" class="form-control" readonly />
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="card-header card-headerBG text-light bg-gradient">
                <h5>
                    <strong>Requisition Through BOM</strong>
                    <span class="d-flex float-end" style="margin-top:-2px;">
                        <div class="col-auto">
                            <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="PrintButton">
                                <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                PRINT
                            </button>
                        </div>
                        <a asp-action="Dashboard" asp-route-FromDate="@DateTime.Now.AddMonths(-3)" asp-route-Todate="@DateTime.Today" asp-route-Flag="True" class="btn btn-sm btn-outline-light bg-gradient">
                            <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                            Dashboard
                        </a>
                        <partial name="_FormsButton" />
                    </span>
                </h5>
            </div>
        </div>
    </form>
</div>

<style>
    .formateBtn {
        margin-left: 5px;
        border-radius: 7px;
        background-color: #ffd6dd;
        border: none;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
    }

    .color-box {
        width: 10px;
        height: 10px;
    }
</style>


@section Scripts {
    <script>

        $(document).ready(function () {

            $('#PartCode').select2();
            $('#ItemCode').select2();
            $('#ProjectNo').select2();
            $('#CostCenterId').select2();

            var finFromDate = $('#FinFromDate').val();
            var finToDate = $('#FinToDate').val();

            var dateParts1 = finFromDate.split("/");
            var monthNames = {
                "Jan": "01",
                "Feb": "02",
                "Mar": "03",
                "Apr": "04",
                "May": "05",
                "Jun": "06",
                "Jul": "07",
                "Aug": "08",
                "Sep": "09",
                "Oct": "10",
                "Nov": "11",
                "Dec": "12"
            };
            var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
            var dateParts2 = finToDate.split("/");
            var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];

            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ")[0]);
                var PlanDt = parseDateToFormat($('#WODate').val().split(" ")[0]);
                var ReqDt = parseDateToFormat($('#hiddenReqDate').val().split(" ")[0]);
                var ExpectedDate = "@Model.ExpectedDate";
                var ReqTime = "@Model.ReqTime";
                var CancelDate = "@Model.CancelDate";
                var ApproveDate = "@Model.ApproveDate";
                var DeptId = "@Model.FromDepartmentId";
                $('#ExpectedDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#ExpectedDate').datepicker("option", "minDate", 'now');
                $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", EntryDate);
                $('#ReqDate').datepicker("option", "minDate", formattedDate1);
                $('#ReqDate').datepicker("option", "maxDate", formattedDate2);
                $('#ExpectedDate').datepicker("option", "maxDate", formattedDate2);
                $('#ExpectedDate').datepicker("option", "minDate", 'now');
                $('#WODate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", PlanDt);
                $('#ReqDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", ReqDt);
                $('#ReqTime').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", ReqTime);
                $('#ApproveDate').datepicker("option", "minDate", formattedDate1);
                $('#ApproveDate').datepicker("option", "maxDate", formattedDate2);
                $('#CancelDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", CancelDate);
                $('#ApproveDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", ApproveDate);
            }
            else {
                $('#EntryDate,#WODate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", new Date());
                $('#WODate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", new Date());
                $('#ApproveDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#ExpectedDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#ExpectedDate').datepicker("option", "minDate", 'now');
                $("#WODate").css("pointer-events", "none");
                $('#ReqDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#ReqDate').datepicker("option", "minDate", formattedDate1);
                $('#ReqDate').datepicker("option", "maxDate", formattedDate2);
                $('#ApproveDate').datepicker("option", "minDate", formattedDate1);
                $('#ApproveDate').datepicker("option", "maxDate", formattedDate2);
                $('#ExpectedDate').datepicker("option", "maxDate", formattedDate2);
                $('#ReqTime').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#CancelDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                $('#EntryDate').datepicker("option", "maxDate", 'now');
            }
            GetFormRights();
            if ($('#Mode').val() != "U" && $('#Mode').val() != "V") {
                $('#ReqDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                GetNewEntry();
            }

            function Validate_SubmitReq() {
                 
                var Err = 0;
                if ($('#divReqThroughBomAdded tr td').length <= 1) {
                    $.notify('Grid Should Have Atleast 1 Item...!', "error");
                    Err = 1;
                }
                if ($('#WorkCenterId').val() == null) {
                    $.notify("Please fill Work Center");
                    AddErrorCls('WorkCenterId');
                    Err = 1;
                }
                else {
                    RemoveErrorCls('WorkCenterId');
                }
                
                Err == 1 ? ShowErrorFld('H_SAGrid') : HideErrorFld('H_SAGrid');
                if (Err == 1) return false;
                return true;
            }

            $('#submitBTN').click(function (e) {
                e.preventDefault();
                if (!Validate_SubmitReq()) return;
                $('form').submit();
            });

            $('#UpdateButton').click(function (e) {
                e.preventDefault();
                if (!Validate_SubmitReq()) return;
                $('form').submit();
            });

            if ($('#Mode').val() != '') {
                $('#PartCode').rules("remove", "required");
                $('#ItemCode').rules("remove", "required");
                $('#Unit').rules("remove", "required");
                $('#BomRevNo').rules("remove", "required");
                $('#BOMEffDate').rules("remove", "required");
                $('#StoreId').rules("remove", "required");
                $('#CostCenterId').rules("remove", "required");
                $('#Prefix').rules("remove", "required");
                $('#Remarks').rules("remove", "required");
                $('#Completed').rules("remove", "required");
                $('#Cancel').rules("remove", "required");
                $('#CancelReason').rules("remove", "required");
                $('#NeedApproval').rules("remove", "required");
                $('#Approved').rules("remove", "required");
                $('#ApproveDate').rules("remove", "required");
                $('#ItemModel').rules("remove", "required");
                $('#ItemSize').rules("remove", "required");
                $('#ExpectedDate').rules("remove", "required");
                $('#ItemLocation').rules("remove", "required");
                $('#ItemBinRackNo').rules("remove", "required");
                $('#FromDepartmentId').rules("remove", "required");
            }
            $('#Prefix').rules("remove", "required");
            $('#Remarks').rules("remove", "required");
            $('#Completed').rules("remove", "required");
            $('#Cancel').rules("remove", "required");
            $('#CancelReason').rules("remove", "required");
            $('#NeedApproval').rules("remove", "required");
            $('#Approved').rules("remove", "required");
            $('#ApproveDate').rules("remove", "required");
            $('#ItemModel').rules("remove", "required");
            $('#ItemSize').rules("remove", "required");
            $('#ExpectedDate').rules("remove", "required");
            $('#ItemLocation').rules("remove", "required");
            $('#ItemBinRackNo').rules("remove", "required");
            $('#Remark').rules("remove", "required");
            $('#ProjectNo').rules("remove", "required");
            $('#ProjectYearCode').rules("remove", "required");
            $('#REQNo').rules("remove", "required");
            $('#CostCenterId').rules("remove", "required");
            $('#ReqReason').rules("remove", "required");
            $('#AltUnit').rules("remove", "required");
            $('#WONo').rules("remove", "required");
            $('#WoYearCode').rules("remove", "required");
            $('.Display').hide();
            $('#YearCode').val();

            fillItems();
            fillWO();
            fillWC();
            fillProjectNoandYC();
            functionFeatureOption();

        });

        function Validate_BomDetail() {
             
            var Err = 0;
            if ($('#PartCode').prop('selectedIndex') == 0) {
                 
                AddSelectErrorCls('PartCode');
                $.notify('Please select Partcode for BomDetail.', "error");
                Err = 1;
            }
            else {
                RemoveSelectErrorCls('PartCode');
            }
            if ($('#ItemCode').prop('selectedIndex') == 0) {
                 
                AddSelectErrorCls('ItemCode');
                $.notify('Please select ItemName for BomDetail.', "error");
                Err = 1;
            }
            else {
                RemoveSelectErrorCls('ItemCode');
            }
            Err == 1 ? ShowErrorFld('H_SAGrid') : HideErrorFld('H_SAGrid');
            if (Err == 1) return false;
            return true;
        }

        function DisplayBomDetail(event) {
            event.preventDefault();
            if (!Validate_BomDetail()) return;
            var Qty = $('#Qty').val();
            if (Qty == '' || Qty == null) {
                Qty = 0;
            }
            else {
                Qty = parseInt($('#Qty').val());
            }
            $('#DisplayReqThrbomDetailModal').modal('show');

            $.ajax({
                type: "POST",
                url: "@Url.Action("DisplayBomDetail")",
                dataType: "json",
                data: { "ItemCode": parseInt($('#ItemCode').val()), "WOQty": Qty, "BomRevNo": parseInt($('#BomRevNo').val()) },
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            var html = '';
                            $('#divDisplayReqThrBomDetail').empty();
                            var i = 1;
                            $.each(obj.Result, function (index, val) {
                                html += '<tr id="DisplayReqThrBomRow-' + i + '">' +
                                    '<td>' + i + '</td>' +
                                    '<td>' + val.FGPartCode + '</td>' +
                                    '<td>' + val.FGItemName + '</td>' +
                                    '<td>' + val.PartCode + '</td>' +
                                    '<td>' + val.RMItemName + '</td>' +
                                    '<td>' + val.RMPartCode + '</td>' +
                                    '<td>' + val.BOMQty + '</td>' +
                                    '<td>' + val.ReqQty + '</td>' +
                                    '</tr>';
                                i++;
                            });
                            $('#divDisplayReqThrBomDetail').append(html);

                            var RowCount = $('#divDisplayBomDetail tr').length;
                            var TdRow = $('#divDisplayBomDetail tr td').length;

                            if (TdRow > 1) {
                                $('#lblTotalNoOfItems').text(RowCount);
                            }
                            ColorRows();
                        }
                    }
                }
            });
        }

        function ColorRows() {
            var row = $('#divDisplayReqThrBomDetail tr').length;
            for (var i = 1; i <= row; i++) {
                if ($('#SubBom-' + i).text() == 'NO') {
                    $('#DisplayReqThrBomRow-' + i).css({ 'background-color': '#94d6df' });
                } else {
                    $('#DisplayReqThrBomRow-' + i).css({ 'background-color': '#ffddbf' });
                }
            }
        }

        function PressBack() {

            localStorage.setItem('REQNoBack', $('#REQNoBack').val());
            localStorage.setItem('ItemNameBack', $('#ItemNameBack').val());
            localStorage.setItem('PartCodeBack', $('#PartCodeBack').val());
            localStorage.setItem('WorkCenterIdBack', $('#WorkCenterIdBack').val());
            localStorage.setItem('WONoBack', $('#WONoBack').val());
            localStorage.setItem('DeptNameBack', $('#DeptNameBack').val());
            localStorage.setItem('FromDateBack', $('#FromDateBack').val());
            localStorage.setItem('ToDateBack', $('#ToDateBack').val());
            localStorage.setItem('TypeBack', $('#TypeBack').val());
            localStorage.setItem('GlobalSearchBack', $('#GlobalSearchBack').val());

            window.history.back();
        }


        function functionFeatureOption() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("CheckFeatureOption")",
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        var allowOption = obj.Result.Table[0].AllowBackDateRequsitionWITHBOM;
                        if (allowOption == 'Y') {
                            $('#EntryDate').css("pointer-events", "auto");
                            $('#EntryDate').css('background-color', 'rgb(248,255,178)');
                        }
                        else {
                            $('#EntryDate').css("pointer-events", "none");
                            $('#EntryDate').css('color', 'rgb(248,255,178)');
                        }
                    }
                }
            });
        }

        $("#Qty").on("input", function (e) {
            var inputValue = $(this).val();

            inputValue = inputValue.replace(/[^0-9.]/g, '');

            var dotCount = inputValue.split('.').length - 1;
            if (dotCount > 1) {
                inputValue = inputValue.slice(0, -1);
            }
            $(this).val(inputValue);
        });

        function GetNewEntry() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetNewEntry")",
                dataType: "json",
                data: { "YearCode": $('#YearCode').val() },
                success: function (result, status, error) {
                    console.log(result);
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        console.log(obj);
                        $('#EntryId').val(obj.Result[0].EntryID);
                        $('#REQNo').val(obj.Result[0].REQNo);
                    }
                }
            });
        }

        function GetFormRights() {

            $.ajax({
                url: "@Url.Action("GetFormRights")",
                type: "POST",
                success: function (data) {
                    if (data != null) {
                        var obj = $.parseJSON(data);
                        console.log(obj);
                        var optAll = obj.Result.Table[0].OptAll;
                        var optSave = obj.Result.Table[0].OptSave;
                        var optUpdate = obj.Result.Table[0].OptUpdate;
                        var optDelete = obj.Result.Table[0].OptDelete;
                        var optView = obj.Result.Table[0].OptView;
                        if (!optAll) {
                            if (!optSave) {
                                $("#submitBTN").prop("disabled", true);
                            }
                        }
                    }
                },
                error: function (errMsg) {
                    $.notify(errMsg, { position: "top center", className: "error" });
                }
            });
        }

        function fillItems() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillItems")",
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);

                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ItemCode,#PartCode').empty();
                            $('#PartCode').append('<option disabled selected value="">-Select-</option>');
                            $('#ItemCode').append('<option disabled selected value="">-Select-</option>');
                            $.each(obj.Result.Table, function (index, val) {
                                $('#PartCode').append('<option value="' + val.Item_Code +
                                    '" data-unit="' + val.Unit +
                                    '" data-altunit="' + val.AlternateUnit +
                                    '" data-bin="' + val.BinNo +
                                    '" data-location="' + val.Location +
                                    '">' + val.PartCode + '</option>');

                                $('#ItemCode').append('<option value="' + val.Item_Code +
                                    '" data-unit="' + val.Unit +
                                    '" data-altunit="' + val.AlternateUnit +
                                    '" data-bin="' + val.BinNo +
                                    '" data-location="' + val.Location +
                                    '">' + val.Item_Name + '</option>');
                            });
                        }
                    }
                }
            });
        }

        function fillWO() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillWorkOrder")",
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);

                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#WONo,#WoYearCode').empty();
                            $('#WONo,#WoYearCode').append('<option disabled selected>-Select-</option>');
                            $.each(obj.Result.Table, function (index, val) {
                                if ($('#hiddenWONO').val() == val.WONO) {
                                    $('#WONo').append('<option value="' + val.WONO +
                                        '" data-woyearcode="' + val.Yearcode +
                                        '" data-wodate="' + val.WODate +
                                        '" selected>' + val.WONO + '</option>');
                                    $('#WoYearCode').append('<option value="' + val.YearCode +
                                        '" selected>' + val.YearCode + '</option>');
                                }
                                else {
                                    $('#WONo').append('<option value="' + val.WONO +
                                        '" data-woyearcode="' + val.YearCode +
                                        '" data-wodate="' + val.WODate +
                                        '">' + val.WONO + '</option>');
                                }

                            });
                        }
                    }
                }
            });
        }

        $('#WONo').change(function () {
            $('#WoYearCode').empty();
            $('#WoYearCode').append('<option selected disabled>-Select-</option>');
            var yearcode = $(this).find(':selected').data('woyearcode');
            $('#WoYearCode').append('<option value="' + yearcode + '">' + yearcode + '</option>');
        });

        $('#WoYearCode').change(function () {

            $("#WODate").val($('#WONo').find(':selected').data('wodate').split("T")[0]);
        });
        function fillWC() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillWorkCenter")",
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);

                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#WorkCenterId').empty();
                            $('#WorkCenterId').append('<option disabled selected>-Select-</option>');
                            $.each(obj.Result.Table, function (index, val) {
                                if ($('#hiddenWorkCenter').val() == val.EntryID) {
                                    $('#WorkCenterId').append('<option value="' + val.EntryID +
                                        '" selected>' + val.WorkCenterDescription + '</option>');
                                } else {
                                    $('#WorkCenterId').append('<option value="' + val.EntryID +
                                        '">' + val.WorkCenterDescription + '</option>');
                                }

                            });
                        }
                    }
                }
            });
        }


        $(document).on('select2:select', '#ItemCode,#PartCode', function (e) {
            var cntId = e.target.id;

            if (cntId == 'ItemCode') {
                ItemNameChange(cntId);
            }
            else {
                PartCodeChange(cntId);
            }
            if ($('#StoreId').prop('selectedIndex') > 0 && parseInt($('#Qty').val()) > 0) {
                $('.Display').show();
            }
        });

        $('#StoreId').change(function () {

            fillStock();
            if ($('#PartCode').prop('selectedIndex') > 0 && $('#ItemCode').prop('selectedIndex') > 0 && $('#Qty').val() > 0) {
                $('.Display').show();
            }
        });

        function fillStock() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillTotalStock")",
                data: { ItemCode: parseInt($('#ItemCode').val()), Store: parseInt($('#StoreId').val()) },
                dataType: "json",
                success: function (result, status, error) {
                    $('#TotalStock').val(0);
                    if (result != null) {
                        var obj = $.parseJSON(result);

                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#TotalStock').val(obj.Result.Table[0].STOCK);
                        }
                    }
                }
            });
        }

        async function GetItemPartCode(ID) {
            $.getJSON({
                url: '@Url.Action("GetItemPartCode", "SaleOrder")',
                data: { Code: $('#' + ID).val() },
                success: function (result, status, xhr) {
                    if (result) {
                        var obj = JSON.parse(result);
                        if (!obj) {
                            $('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
                        }
                        else if (obj.StatusCode == 200 && obj.StatusText == "Success") {
                            $('#Unit').val(obj.Result[0].Unit);
                            $('#HSNNo').val(obj.Result[0].HSNNo);
                            $('#AltUnit').val(obj.Result[0].AltUnit == null ? 'NA' : obj.Result[0].AltUnit);
                            !$('#AltUnit').val() ? $('#UnitRate').prop('disabled', true) : $('#UnitRate').prop('disabled', false);
                        }
                    }
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                }
            });
        }

        function copyToClipboardForDropdown(element) {
            var $temp = $("<input>");
            $("body").append($temp);
            ;
            $temp.val($(element).find(":selected").text()).select();
            document.execCommand("copy");
            $temp.remove();
        }
        function PartCodeChange(ID) {
            copyToClipboardForDropdown("#PartCode");
            fillStock();

            $('#Unit').val($('#PartCode').find(':selected').data('unit'));
            $('#AltUnit').val($('#PartCode').find(':selected').data('altunit'));
            $('#ItemBinRackNo').val($('#PartCode').find(':selected').data('bin'));
            $('#ItemLocation').val($('#PartCode').find(':selected').data('location'));
            if ($('#AltUnit').val() != '') {
                $('#AltQty').prop("readonly", false);
            }
            $.when(SetPartCodeItemName(ID)).done(function () {
                GetItemPartCode(ID)
            });

            fillBomRevNo();
        }
        function SetPartCodeItemName(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).select2('val');
                if (ID == "PartCode") {
                    $("#ItemCode").val(v).trigger("change");
                }

                if (ID == "ItemCode") {
                    $("#PartCode").val(v).trigger("change");
                }
            }
        }

        function ItemNameChange(ID) {
            copyToClipboardForDropdown("#ItemCode");
            fillStock();

            $('#Unit').val($('#ItemCode').find(':selected').data('unit'));
            $('#AltUnit').val($('#PartCode').find(':selected').data('altunit'));
            $('#AltUnit').val($('#ItemCode').find(':selected').data('altunit'));
            $('#ItemBinRackNo').val($('#ItemCode').find(':selected').data('bin'));
            $('#ItemLocation').val($('#ItemCode').find(':selected').data('location'));
            if ($('#AltUnit').val() != '') {
                $('#AltQty').prop("readonly", false);
            }
            SetPartCodeItemName(ID);
            GetItemPartCode(ID);
            fillBomRevNo();
        }

        function fillBomRevNo() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetBomRevNo")",
                async: false,
                data: { ItemCode: parseInt($('#ItemCode').val()) },
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#BomRevNo').empty();
                            $('#BOMEffDate').val('');
                            $.each(obj.Result, function (index, val) {
                                var EffDate = "";
                                if (val.EffectiveDate == '') {
                                    EffDate = formatUniversalDate(new Date());
                                }
                                else {
                                    EffDate = formatUniversalDate(val.EffectiveDate);
                                }
                                $('#BomRevNo').append('<option value="' + val.bomno +
                                    '" data-bom-date="' + EffDate + '">' + val.bomno + '</option>');
                            });
                            $('#BOMEffDate').val($('#BomRevNo').find(':selected').data('bom-date'));
                        }
                    }
                }

            });
        }
        function fillProjectNoandYC() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetProjectNo")",
                async: false,
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {

                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ProjectNo').empty();
                            $('#ProjectYearCode').val('');
                            $('#ProjectNo').append('<option disabled value="" selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {

                                $('#ProjectNo').append('<option value="' + val.projectname +
                                    '" data-yearcode="' + val.yearcode + '">' + val.projectname + '</option>');
                            });

                        }
                    }
                }

            });
        }

        $('#ProjectNo').change(function () {
            $('#ProjectYearCode').val($('#ProjectNo').find(':selected').data('yearcode'));
        });

        $('#BomRevNo').change(function () {
            $('#BOMEffDate').val($('#BomRevNo').find(':selected').data('bom-date'));
        });

        function formatUniversalDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [day, month, year].join('/');
        }

        $('.Display').click(function () {
            $('.modal-header').addClass('bg-graident bg-warning');
            $('.modal-title').text('DISPLAY');
            $.ajax({
                url: "@Url.Action("GetPopUpData")",
                data: { ItemCode: parseInt($('#ItemCode').val()), BomNo: parseInt($('#BomRevNo').val()) },
                success: function (result, status, xhr) {
                    $('#divDisplayGrid').empty();
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $.each(obj.Result, function (index, val) {
                                var html = '';
                                html += '<tr><td id="ModalItemName">' + val.Item_Name + '</td><td id="ModalPartCode">' + val.PartCode + '</td><td id="ModalUnit">' + val.Unit + '</td><td id="ModalPendQty">' + $('#StoreId').find(":selected").text() + '</td><td id="ModalBomQty">' + val.BomQty + '</td><td id="ModalTotalStock">' + $('#TotalStock').val() + '</td><td id="ModalShortQty">' + $('#Qty').val() + '</td></tr>';
                                $('#divDisplayGrid').append(html);
                            });
                        }
                    }
                }
            });
            $('#PopupModel').modal("show");
        });

        function ValidateReq_Grid() {
            var Err = 0;
            if (!isNaN($('#Qty').val())) {
                if (parseInt($('#Qty').val()) <= 0 || $('#Qty').val() == '') {
                    AddErrorCls('Qty');
                    $.notify("Qty cannot be less than 0", "error");
                    Err = 1;
                }
                else {
                    RemoveErrorCls('Qty');
                }
            }
            else {
                AddErrorCls('Qty');
                Err = 1;
            }
            if (!isNaN($('#AltQty').val())) {
                RemoveErrorCls('AltQty');
            }
            else {
                $.notify("AltQty cannot be less than 0", "error");
                AddErrorCls('AltQty');
                Err = 1;
            }
            if ($('#Unit').val() == '') {
                AddErrorCls('Unit');
                $.notify("Unit is required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('Unit');
            }
            if ($('#PartCode').prop('selectedIndex') == 0 || $('#ItemCode').prop('selectedIndex') == 0) {
                AddErrorCls('PartCode'), AddErrorCls('ItemCode');
                $.notify("PartCode and ItemName is required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('PartCode'), RemoveErrorCls('ItemCode');
            }
            if ($('#BomRevNo').val() == null) {
                AddErrorCls('BomRevNo');
                $.notify("Bom Rev No is required", "error");
                Err = 1;
            }
            else {
                RemoveErrorCls('BomRevNo');
            }

            Err == 1 ? ShowErrorFld('H_SAGrid') : HideErrorFld('H_SAGrid');
            if (Err == 1) return false;

            return true;
        }


        $('#FromDepartmentId').change(function () {
            if (parseInt($('#FromDepartmentId').val()) == 4) {

                $('#WorkCenterId').prop('disabled', false);
            }
            else {
                $('#WorkCenterId').prop('selectedIndex', 0);
            }
        });

        $('#Qty').keyup(function () {
            var qty = parseFloat($(this).val());

            if (qty < 0) {
                $.notify("Qty cannot be less than 0", "error");
                $('#Qty').val(0);
            }
            $('#PendQty').val(parseFloat(qty));
            if ($('#StoreId').prop('selectedIndex') > 0 && $('#PartCode').prop('selectedIndex') > 0 && $('#ItemCode').prop('selectedIndex') > 0) {
                $('.Display').show();
            }
        });

        $('#AltQty').keyup(function () {
            var altqty = parseFloat($(this).val());
            if (altqty < 0) {
                $.notify("AltQty cannot be less than 0", "error");
                $('#AltQty').val(0);
            }
            $('#PendAltQty').val(parseFloat(altqty));
        })

        $('.GridButton').click(function (e) {
            e.preventDefault();

            if (!ValidateReq_Grid()) return;

            var ItemData = {
                "ItemCode": parseInt($('#ItemCode').val()),
                "PartCode": $('#PartCode').find(':selected').text(),
                "ItemName": $('#ItemCode').find(':selected').text(),
                "Unit": $('#Unit').val(),
                "Qty": $('#Qty').val(),
                "PendQty": $('#PendQty').val(),
                "StoreId": $('#StoreId').val(),
                "StoreName": $('#StoreId').find(':selected').text(),
                "TotalStock": $('#TotalStock').val(),
                "ProjectNo": $('#ProjectNo').val(),
                "ProjectYearCode": $('#ProjectYearCode').val(),
                "CostCenterId": $('#CostCenterId').val(),
                "CostCenterName": $('#CostCenterId').find(":selected").text(),
                "BomRevNo": $('#BomRevNo').val(),
                "BOMEffDate": $('#BOMEffDate').val(),
                "ItemModel": $('#ItemModel').val(),
                "ItemSize": $('#ItemSize').val(),
                "ExpectedDate": $('#ExpectedDate').val(),
                "Remark": $('#Remark').val(),
                "ItemLocation": $('#ItemLocation').val(),
                "ItemBinRackNo": $('#ItemBinRackNo').val(),
                "AltUnit": $('#AltUnit').val(),
                "AltQty": $('#AltQty').val(),
                "PendAltQty": $('#PendAltQty').val(),
            }

            $.ajax({
                url: "@Url.Action("AddReqThruBomDetail")",
                type: "POST",
                data: ItemData,
                beforeSend: function (xhr) {
                    console.log(1);
                },
                success: function (data, status, xhr) {
                    console.log(2);
                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");

                    }
                    else {
                        $('#divReqThroughBomAdded').html(data);
                        $('#PartCode').focus();
                        $.notify('Item Added To Grid', "success");
                        ClearGrid();
                        $('.Display').hide();
                    }

                    var rowCount = $('#divReqThroughBomAdded tr').length;
                    for (var i = 1; i <= rowCount + 1; i++) {
                        $('#editButton-' + i).css("pointer-events", "auto");
                    }
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {
                    console.log(5);
                }
            }).done(function () {
                console.log(3);
            }).fail(function () {
                alert("error");;
            }).always(function () {
                console.log(4);
            });
        });

        function ClearGrid() {
            $('#PartCode,#ItemCode,#StoreId,#BomRevNo,#ProjectNo,#ProjectYearCode,#CostCenterId').prop('selectedIndex', 0);
            $('#PartCode,#ItemCode').val('').trigger('change')
            $('#Unit,#Qty,#PendQty,#TotalStock,#AltUnit,#AltQty,#ItemLocation,#ItemBinRackNo,#BOMEffDate,#Remark,#ItemModel,#ItemSize,#PenAltQty').val(" ");
        }

        function formatUniversalDatee(dateString) {

            const parts = dateString.split("/");

            const year = parseInt(parts[2]);
            const month = parseInt(parts[1]) - 1;
            const day = parseInt(parts[0]);

            const date = new Date(year, month, day);

            const options = { day: "numeric", month: "short", year: "numeric" };
            const formattedDate = date.toLocaleDateString("en-US", options);

            console.log(formattedDate);
            return formattedDate;
        }
        function DeleteItemRow(SeqNo) {
            $.ajax({
                url: '@Url.Action("DeleteItemRow")',
                type: "POST",
                data: { "SeqNo": SeqNo },
                async: false,
                success: function (data, status, xhr) {
                    $('#divReqThroughBomAdded').html(data);
                    $.notify("Item Deleted from Grid", "info");
                },
                error: function (response, status, xhr) {

                    $.notify("Cannot delete item !!!", "error");
                },
                failure: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                }
            });
        }

        function ExportChildPartList() {
            $("#ChildPartList").table2excel({
                filename: "ChildPartList.xls"
            });
        }

        function ExportBomDetailList() {
            $(".BomDetailtable").table2excel({
                filename: "BomDetail.xls"
            });
        }

        async function EditItemRow(SeqNo) {
            $.ajax({
                url: '@Url.Action("EditItemRow")',
                type: "POST",
                data: { SeqNo: SeqNo },
                success: await function (data, status, xhr) {
                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify("If Same Tax Exists, Item Cannot Be Edited...!", "warning");
                    }
                    else {
                        ;
                        var obj = $.parseJSON(data);
                        DeleteItemRow(SeqNo);

                        if (obj != null && obj.length == 1) {
                            $('#PartCode').val(obj[0].ItemCode).change();
                            $('#ItemCode').val(obj[0].ItemCode).change();
                            $('#Unit').val(obj[0].Unit);
                            $('#Qty').val(obj[0].Qty);
                            $('#AltUnit').val(obj[0].AltUnit);
                            $('#AltQty').val(obj[0].AltQty);
                            $('#ItemModel').val(obj[0].ItemModel);
                            $('#ItemSize').val(obj[0].ItemSize);
                            $('#ExpectedDate').val(obj[0].ExpectedDate);
                            $('#PendQty').val(obj[0].PendQty);
                            $('#PendAltQty').val(obj[0].PendAltQty);
                            $('#StoreId').val(obj[0].StoreId);
                            $('#TotalStock').val(obj[0].TotalStock);
                            $('#ProjectNo').val(obj[0].ProjectNo);
                            $('#ProjectYearCode').val(obj[0].ProjectYearCode);
                            $('#CostCenterId').val(obj[0].CostCenterId);
                            $('#ItemLocation').val(obj[0].ItemLocation);
                            $('#ItemBinRackNo').val(obj[0].ItemBinRackNo);
                            $('#BomRevNo').val(obj[0].BomRevNo);
                            $('#BOMEffDate ').val(obj[0].BOMEffDate);

                        }
                        var rowCount = $('#divReqThroughBomAdded tr').length;
                        for (var i = 1; i <= rowCount + 1; i++) {
                            $('#editButton-' + i).css("pointer-events", "none");
                            $('#editButton-' + i).css("cursor", "not-allowed");
                        }
                    }
                },
                error: function (response) {
                    $.notify(response.responseText, "error");
                },
                failure: function (response) {
                    $.notify(response.responseText, "error");
                }
            });
        }

    </script>
    <script src="~/Scripts/table2excel.js"></script>

}