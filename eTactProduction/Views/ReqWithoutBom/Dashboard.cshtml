@model eTactWeb.DOM.Models.ReqMainDashboard

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<div class="shadow-lg">
    <div class="card rounded border-light bg-gradient">
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                Requisition Without BOM - <strong>Dashboard</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    <a asp-action="ReqWithoutBom" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">
                        <i class="fa fa-plus-circle fafw fa-lg" aria-hidden="true"></i>
                        Add New
                    </a>
                </span>
            </h5>
        </div>
        <div class="card-body">
            <div class="card overflow-auto">
                <div class="card-body">
                    <form id="SParam">
                        <div class="row">
                            <div class="col-lg">
                                <label asp-for="REQNo" class="form-label">REQ No</label>
                                <input asp-for="REQNo" class="form-control" />
                                <input asp-for="FromDate1" type="hidden" class="form-control" />
                                <input asp-for="ToDate1" type="hidden" class="form-control" />
                                <input asp-for="EntryId" type="hidden" class="form-control" />
                                <input asp-for="YearCode" type="hidden" class="form-control" />
                            </div>
                            <div class="col-lg">
                                <label asp-for="ItemName" class="form-label">Item Name</label>
                                <input asp-for="ItemName" class="form-control" />
                            </div>
                            <div class="col-sm-3 col-md-6 col-lg-4 col-xl-2">
                                <label asp-for="PartCode" class="form-label">Part Code</label>
                                <input asp-for="PartCode" class="form-control" />
                            </div>
                            <div class="col-xxl-1 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                                <label asp-for="WorkCenter" class="form-label">Work Center</label>
                                <input asp-for="WorkCenter" class="form-control" />
                            </div>
                            <div class="col-xxl-1 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                                <label asp-for="WONo" class="form-label">Work Order No</label>
                                <input asp-for="WONo" class="form-control" />
                            </div>
                            <div class="col-xxl-1 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                                <label class="form-label">Dept Name</label>
                                <input id="DeptName" class="form-control" />
                            </div>
                            <div class="col-xxl-1 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                                <label asp-for="CC" class="form-label">Branch</label>
                                <input asp-for="CC" class="form-control" readonly />
                            </div>
                            <div class="col-xxl-1 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                                <label class="form-label">Type</label>
                                <select id="DashboardType" class="form-select">
                                    <option value="" disabled>-Select-</option>
                                    <option value="Summary" selected>Summary</option>
                                    <option value="Detail">Detail</option>
                                </select>
                            </div>
                            <div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-12 col-xs-12">
                                <div class="row">
                                    <div class="col">
                                        <label class="form-label">From Date</label>
                                        <input asp-for="FromDate1" id="FromDate" maxlength="10" class="form-control" />
                                    </div>
                                    <div class="col">
                                        <label class="form-label">To Date</label>
                                        <input asp-for="ToDate1" id="ToDate" maxlength="10" class="form-control" />
                                    </div>
                                </div>
                            </div>
                            @*<div class=" d-flex justify-content-center mt-3" width="inherit">
                            <div>
                            <label class="form-label">Global search</label>
                            <input type="text" class="form-control" id="search-box" style="background-color:#FFFACD" placeholder="Search...">
                            </div>
                            <button class="btn btn-sm btn-outline-info" type="button" style="padding:0px;height:30px;width:100px;" onclick="GetSearchData();">
                            <i class="fa-solid fa-magnifying-glass fa-fw fa-lg"></i>SEARCH
                            </button>
                            <button class="btn btn-sm btn-outline-success" style="padding:3px;height:30px;width:100px;margin-left:20px;" type="button" id="sendToExcel">
                            <i class="fa-solid fa-upload fa-fw fa-lg "></i>EXCEL
                            </button>
                            <a class="btn btn-sm btn-outline-danger" style="padding:3px;height:30px;width:100px;margin-left:20px;" asp-controller="ReqWithoutBom" asp-action="Dashboard"
                            asp-route-FromDate="@DateTime.Now.AddDays(1 - DateTime.Now.Day)" asp-route-Todate="@DateTime.Today" asp-route-Flag="True">
                            <i class="fa-solid fa-rotate fa-fw fa-lg"></i>RESET
                            </a>
                            <div class="d-flex" style="margin-left:50px;margin-top:10px;">
                            <label class="color-box" style="background-color: #FF0000;"></label><label style="margin-left:5px;margin-top:-5px;">Pending</label>
                            <label class="color-box" style="background-color: green;margin-left:25px;"></label><label style="margin-left:5px;margin-top:-5px;">Completely Issued</label>
                            <label class="color-box" style="background-color: blue;margin-left:25px;"></label><label style="margin-left:5px;margin-top:-5px;">Cancelled Requisition</label>
                            </div>
                            </div>*@
                            <div class="d-flex justify-content-between align-items-center mt-3" width="inherit">
                                <!-- Global search -->
                                <div>
                                    <label class="form-label">Global search</label>
                                    <input type="text" class="form-control" asp-for="SearchBox" id="search-box" style="background-color:#FFFACD" placeholder="Search..." fdprocessedid="pr7n9">
                                </div>
                                <div class="d-flex" style="margin-left:50px;margin-top:10px;">
                                    <label class="color-box" style="background-color: #FF0000;"></label><label style="margin-left:5px;margin-top:-5px;">Pending</label>
                                    <label class="color-box" style="background-color: green;margin-left:25px;"></label><label style="margin-left:5px;margin-top:-5px;">Completely Issued</label>
                                    <label class="color-box" style="background-color: blue;margin-left:25px;"></label><label style="margin-left:5px;margin-top:-5px;">Cancelled Requisition</label>
                                </div>
                                <!-- Buttons -->
                                <div class="d-flex">
                                    <button class="btn btn-sm btn-outline-info" style="padding:0px;height:30px;width:100px;" type="button" onclick="GetSearchData();" fdprocessedid="1jbn8">
                                        <i class="fa-solid fa-magnifying-glass fa-fw fa-lg"></i>SEARCH
                                    </button>
                                    <button class="btn btn-sm btn-outline-success" style="padding:3px;height:30px;width:100px;margin-left:20px;" type="button" id="sendToExcel" fdprocessedid="h6tj29">
                                        <i class="fa-solid fa-upload fa-fw fa-lg "></i>EXCEL
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" style="padding:3px; height:30px; width:100px; margin-left:20px;" type="button" id="sendToPDF">
                                        <i class="fa-solid fa-file-pdf fa-fw fa-lg"></i> PDF
                                    </button>
                                    <a class="btn btn-sm btn-outline-danger" style="padding:3px;height:30px;width:100px;margin-left:20px;" href="/ReqWithoutBom/Dashboard?FromDate=01%2F03%2F2024%2013%3A27%3A54&amp;Todate=19%2F03%2F2024%2000%3A00%3A00&amp;Flag=True">
                                        <i class="fa-solid fa-rotate fa-fw fa-lg"></i>RESET
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="card-body pb-0 pt-0">
            <div class="progress" style="height: 4px;">
                <div class="progress-bar progress-bar-striped bg-info" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
        <div class="card-body">
            <div class="card overflow-auto">
                <div class="card-body" id="divDashboardGrid">
                    <partial name="_ReqWithoutBomDashboardGrid" />
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
    {
    <script>
        var GlobalSearchBack = "";
        var FromDateBack = "";
        var ToDateBack = "";
        $(function () {

            FromDateBack = sessionStorage.getItem('FromDateBack');
            ToDateBack = sessionStorage.getItem('ToDateBack');
            var REQNoBack = sessionStorage.getItem('REQNoBack');
            var PartCodeBack = sessionStorage.getItem('PartCodeBack');
            var ItemNameBack = sessionStorage.getItem('ItemNameBack');
            var WorkCenterBack = sessionStorage.getItem('WorkCenterBack');
            var WorkOrderNoback = sessionStorage.getItem('WorkOrderNoback');
            var DeptNameBack = sessionStorage.getItem('DeptNameBack');
            var DashboardTypeBack = sessionStorage.getItem('DashboardTypeBack');
            GlobalSearchBack = sessionStorage.getItem('GlobalSearchBack');

            var dashGrid = $('#ReqBomTbody tr').length;
            $('#totalRows').text(dashGrid);
            //GetFormRights();

            //$("#FromDate").datepicker({ changeMonth: true, changeYear: true, dateFormat: 'dd/mm/yy' });
            //$("#FromDate").on('keydown', function (e) { e.preventDefault(); return false; });
            //$("#ToDate").datepicker({ changeMonth: true, changeYear: true, dateFormat: 'dd/mm/yy' });
            //$("#ToDate").on('keydown', function (e) { e.preventDefault(); return false; });
            var currentDate = new Date();

            var firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            function formatDate(date) {
                var day = ("0" + date.getDate()).slice(-2);
                var month = ("0" + (date.getMonth() + 1)).slice(-2);
                var year = date.getFullYear();
                var dateString = day + "/" + month + "/" + year;
                return dateString;
            }
            //$('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

            $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", formatDate(firstDayOfMonth));
            $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

            AutoComplete('VRequisitionMainDetail', 'REQNo', 'REQNo', null);
            AutoComplete('VRequisitionMainDetail', 'ItemName', 'Item_Name', null);
            AutoComplete('VRequisitionMainDetail', 'PartCode', 'PartCode', null);
            AutoComplete('VRequisitionMainDetail', 'WorkCenter', 'WorkCenter', null);
            AutoComplete('VRequisitionMainDetail', 'WONo', 'WONo', null);
            AutoComplete('VRequisitionMainDetail', 'DeptName', 'DeptName', null);
            AutoComplete('VRequisitionMainDetail', 'CC', 'BranchName', null);

            if ($('#FromDate1').val() != "" && $('#ToDate1').val() != "") {
                var inputFromDateString = $('#FromDate1').val().split(" ")[0];
                var inputToDateString = $('#ToDate1').val().split(" ")[0];

                var originalFromDate = new Date(inputFromDateString);
                var originalToDate = new Date(inputToDateString);


                //fromdate
                var day = originalFromDate.getDate();
                var month = originalFromDate.getMonth() + 1;
                var year = originalFromDate.getFullYear();

                var convertedFromDateText = day.toString().padStart(2, '0') + '/' + month.toString().padStart(2, '0') + '/' + year;

                //todate
                var day = originalToDate.getDate();
                var month = originalToDate.getMonth() + 1;
                var year = originalToDate.getFullYear();

                var convertedToDateText = day.toString().padStart(2, '0') + '/' + month.toString().padStart(2, '0') + '/' + year;


                $('#FromDate').val(convertedFromDateText);
                $('#ToDate').val(convertedToDateText);

            }
            if (FromDateBack != null && FromDateBack != '') {
                 
                $('#REQNo').val(REQNoBack);
                $('#ItemName').val(ItemNameBack);
                $('#PartCode').val(PartCodeBack);
                $('#WorkCenter').val(WorkCenterBack);
                $('#WONo').val(WorkOrderNoback);
                $('#DeptName').val(DeptNameBack);
                $('#DashboardType').val(DashboardTypeBack);
                $('#FromDate').val(FromDateBack);
                $('#ToDate').val(ToDateBack);
                $('#search-box').val(GlobalSearchBack);
            }
            GetSearchData();
            $("#search-box").val($('#search-box').val()).trigger('keyup');

            //$('#ToDate').change(function () {
            //    SummaryData();
            //});
            //GetSearchData();

            sessionStorage.removeItem('FromDateBack');
            sessionStorage.removeItem('ToDateBack');
            sessionStorage.removeItem('REQNoBack');
            sessionStorage.removeItem('PartCodeBack');
            sessionStorage.removeItem('ItemNameBack');
            sessionStorage.removeItem('WorkCenterBack');
            sessionStorage.removeItem('WorkOrderNoback');
            sessionStorage.removeItem('DeptNameBack');
            sessionStorage.removeItem('DashboardTypeBack');
            sessionStorage.removeItem('GlobalSearchBack');
        });

        function BackButtonData(event) {
             
            event.preventDefault();
            var urlHref = $(event.currentTarget).attr("href");
            var linkUrl = urlHref;
            linkUrl = linkUrl + "&REQNo=" + $('#REQNo').val() + "&ItemName=" + $('#ItemName').val() + "&PartCode=" + $('#PartCode').val() + "&WorkCenter=" + $('#WorkCenter').val() + "&WONo=" + $('#WONo').val() + "&DeptName=" + $('#DeptName').val() + "&DashboardType=" + $('#DashboardType').val() + "&FromDate=" + $('#FromDate').val() + "&ToDate=" + $('#ToDate').val() + "&GlobalSearch=" + $('#search-box').val();
            window.location.href = linkUrl;
        }
        $('#sendToPDF').click(async function () {
            debugger
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'a4' });

            // Get dynamic values
            var reqNo = $('#REQNo').val();
            var itemName = $('#ItemName').val();
            var partCode = $('#PartCode').val();
            var workCenter = $('#WorkCenter').val();
            var woNo = $('#WONo').val();
            var deptName = $('#DeptName').val();
            var cc = $('#CC').val();
            var fromDate = $('#FromDate').val();
            var toDate = $('#ToDate').val();

            var dashboardTypeText = $('#DashboardType option:selected').text();
            var dashboardTypeValue = $('#DashboardType').val();

            var entryId = $('#EntryId').val();
            var yearCode = $('#YearCode').val();

            // Report Title
            doc.setFontSize(16).text(dashboardTypeText, 40, 40);

            // Date Range
            doc.setFontSize(10).text(`For the duration From: ${fromDate}     To: ${toDate}`, 40, 58);

            let currentY = 75;
            const headerFields = [
                /*  { label: 'Report Type (Text)', value: reportTypeText || '' },
                 { label: 'Report Type (Value)', value: reportTypeValue || '' },
                 { label: 'MRN Type (Text)', value: mrnTypeText || '' },
                 { label: 'MRN Type (Value)', value: mrnTypeValue || '' },
                 { label: 'From Date', value: fromDate || '' },
                 { label: 'To Date', value: toDate || '' },
                 { label: 'Vendor Name', value: vendorName || '' },
                 { label: 'Gate Entry No', value: gateNo || '' },
                 { label: 'MRN No', value: mrnNo || '' },
                 { label: 'Invoice No', value: invoiceNo || '' },
                 { label: 'PO No', value: poNo || '' },
                 { label: 'Sch No', value: schNo || '' },
                 { label: 'Part Code', value: partCode || '' },
                 { label: 'Item Name', value: itemName || '' },
                 { label: 'Document Type', value: docName || '' },
                 { label: 'Work Center', value: (workCenter && workCenter !== '-Select-') ? workCenter : '' },
                 { label: 'Item Group', value: itemGroup || '' },
                 { label: 'Item Type', value: itemType || '' },
                 { label: 'Batch No', value: batchNo || '' },
                 { label: 'Unique Batch No', value: uniqueBatchNo || '' } */
            ];

            // Filter out any fields with empty values
            const filled = headerFields.filter(field => field.value);

            // If there is at least one non-empty value, print the header
            if (filled.length > 0) {
                filled.forEach(field => {
                    doc.setFontSize(10)
                        .text(`${field.label}: ${field.value}`, 40, currentY);
                    currentY += 15;
                });
            }

            // Fetch data
            var resp = await fetch('/ReqWithoutBom/GetReqWithoutBomDashBoardGridData');
            var rows = await resp.json();

            // Declare headers and body
            let headers = [];
            let body = [];

            // Handle report type logic
            switch (dashboardTypeValue) {
                case 'Summary':
                    headers = [
                        "#Sr","REQ No", "Req Date", "Entry Date", "Work Center", "WO No", "Branch Name",
                        "Reason", "Cancel", "Machine Name", "WO Year Code", "Entry Id", "Year Code",
                        "Total Req Qty", "Total Pend Qty", "Created By", "Updated By"
                    ];
                    console.log("Data:", rows);
                    body = rows.map((r, i) => [
                        i + 1,r.reqNo,r.reqDate ? r.reqDate.split(" ")[0] : "",     
                        r.entryDate ? r.entryDate.split(" ")[0] : "",r.workCenter,
                        r.woNo,r.branchName, r.reason,r.cancel, r.machName,  r.woYearcode,
                        r.entryId,r.yearCode,r.totalReqQty, r.totalPendQty, r.createdBy,
                        r.updatedBy
                    ]);
                break;
                case 'Detail':
                    headers = [
                        "#Sr","REQ No", "Req Date", "Item Name", "Part Code", "Quantity", "Unit", "Alt Qty", 
                        "Pending Qty", "Location", "Bin No", "Entry Date", "Work Center","Branch Name",
                        "Cancel", "Entry ID",
                        "Total Req Qty", "Total Pend Qty"
                    ];

                    console.log("Data:", rows);
                    body = rows.map((r, i) => [
                        i + 1, r.reqNo, r.reqDate.split(" ")[0] : "", r.itemName, r.partCode, r.qty, r.unit,
                        r.altQty, r.pendQty, r.location, r.binNo, r.entryDate.split(" ")[0] : "",
                        r.workCenter, r.branchName,  r.cancel, 
                         r.entryId, r.totalReqQty, r.totalPendQty
                    ]);


                break;
                

                
                default:
                    headers = [
                        "#Sr", "REQ No", "Req Date", "Entry Date", "Work Center", "WO No", "Branch Name",
                        "Reason", "Cancel", "Machine Name", "WO Year Code", "Entry Id", "Year Code",
                        "Total Req Qty", "Total Pend Qty", "Created By", "Updated By"
                    ];
                    console.log("Data:", rows);
                    body = rows.map((r, i) => [
                       i + 1, r.reqNo, r.reqDate ? r.reqDate.split(" ")[0] : "",
                        r.entryDate ? r.entryDate.split(" ")[0] : "", r.workCenter,
                        r.woNo, r.branchName, r.reason, r.cancel, r.machName, r.woYearcode,
                        r.entryId, r.yearCode, r.totalReqQty, r.totalPendQty, r.createdBy,
                        r.updatedBy
                    ]);
                    break;
            }

            // Generate table with custom column width handling
            doc.autoTable({
                startY: currentY + 15, // Adjust the starting Y position
                head: [headers],
                body: body,
                styles: { cellWidth: 'wrap' },
                theme: 'grid',
                margin: { left: 40, right: 40 },
                styles: {
                    fontSize: 7,
                    cellPadding: 1,
                    overflow: 'linebreak',
                    halign: 'center',
                    valign: 'middle'
                },
                headStyles: {
                    fillColor: [41, 128, 185],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                tableWidth: 'auto',
                columnStyles: {
                    0: { cellWidth: 30 },   // Column 1: Sr#
                    1: { cellWidth: 50 },   // Column 2: VendorName
                    2: { cellWidth: 50 },   // Column 3: MRNNo
                    3: { cellWidth: 40 },   // Column 4: MRNDate
                    4: { cellWidth: 60 },   // Column 5: GateNo
                    5: { cellWidth: 30 },   // Column 6: GDate
                    6: { cellWidth: 40 },   // Column 7: InvoiceNo
                    7: { cellWidth: 40 },   // Column 8: InvoiceDate
                    8: { cellWidth: 60 },   // Column 9: DocNo
                    9: { cellWidth: 50 },   // Column 10: PartCode
                    10: { cellWidth: 60 },  // Column 11: ItemName
                    11: { cellWidth: 20 },  // Column 12: BillQty
                    12: { cellWidth: 20 },  // Column 13: RecQty
                    13: { cellWidth: 20 },  // Column 14: ShortExcessQty
                    14: { cellWidth: 50 },  // Column 15: Unit
                    15: { cellWidth: 40 },  // Column 16: Amount
                    16: { cellWidth: 40 },  // Column 17: TotalAmt
                    17: { cellWidth: 40 },  // Column 18: NetAmount
                    18: { cellWidth: 30 },  // Column 19: Remark
                    19: { cellWidth: 30 },  // Column 20: ActualEntryByEmp
                    20: { cellWidth: 40 },  // Column 21: ActualEntryDate


                },
                showHead: 'everyPage'
            });

            // Save the PDF
            doc.save(`ReqWithoutBom_${dashboardTypeValue.replace(/\s+/g, '_')}.pdf`);

        });
        $(document).on("click", ".sortCol", function () {
             
            var $column = $(this).parent().closest("th");
            var colno = $(this).data('columnno');
            var currentOrder = $(this).data('sortorder');

            $('.sortCol').css('color', 'white');

            if (currentOrder === 'asc') {
                sortTable('ReqBomTable', colno, false);
                $(this).data('sortorder', 'desc');
                $(this).css('color', 'yellow');
                //$(this).css('font-size', 'larger');
                $(this).find('i:first').removeClass('fa-arrow-up');
                $(this).find('i:first').addClass('fa-arrow-down');
            } else {
                sortTable('ReqBomTable', colno, true);
                $(this).data('sortorder', 'asc');
                $(this).css('color', 'yellow');
                // $(this).css('font-size', 'larger');
                $(this).find('i:first').removeClass('fa-arrow-down');
                $(this).find('i:first').addClass('fa-arrow-up');
            }
        });


        $('#DashboardType').change(function () {
            if ($(this).val() == "Summary") {
                SummaryData();
            } else {
                DetailData();
            }

        });

        function selection(CurrentRow) {

            $(CurrentRow).css({ 'background-color': '#00bcd4' });
            $("#ReqBomTbody tr").not(CurrentRow).css({ 'background-color': '' });
        }

        function formatDate(d) {

            var newDate = new Date(d);
            var day = newDate.getDate();
            var month = newDate.getUTCMonth();
            var year = newDate.getFullYear();
            finaldate = new Date(year, month, day);
            return finaldate;
        }

        function GetSearchData() {
             
            if ($('#DashboardType').val() == "Summary") {
                SummaryData();
            } else {
                DetailData();
            }
        }

        function SummaryData() {
              
            var data = $('#SParam').serialize();
            $.ajax({
                url: '@Url.Action("GetSearchData")',
                type: "POST",
                data: { REQNo: $('#REQNo').val(), WCName: $('#WorkCenter').val(), WONo: $('#WONo').val(), DepName: $('#DeptName').val(), PartCode: $('#PartCode').val(), ItemName: $('#ItemName').val(), BranchName: $('#CC').val(), FromDate: $('#FromDate').val(), ToDate: $('#ToDate').val() },
                async:false,
                success: function (data) {
                     
                    $('#divDashboardGrid').empty().append(data);
                    GetFormRights();
                    var dashGrid = $('#ReqBomTbody tr').length;
                    $('#totalRows').text(dashGrid);
                    //$('#search-box').val(GlobalSearchBack);
                    //$("#search-box").val($('#search-box').val()).trigger('keyup');
                    //$('#FromDate').val(FromDateBack);
                    //$('#ToDate').val(ToDateBack);
                    var rowwCount = $('#ReqBomTbody tr').length;
                    for (var i = 1; i <= rowwCount; i++) {
                        var pendQty = $('#PendQty-' + i).val();
                        var Cancel = $('#Cancel-' + i).val();
                        if (pendQty > 0) {
                            $('#' + i).css("color", "red");
                        }
                        if (pendQty == 0) {
                            $('#' + i).css("color", "green");

                        }
                        if (Cancel == "Y") {
                            $('#' + i).css("color", "blue");

                        }
                    }
                },
                error: function (response) {
                    alert(response.responseText);
                },
                failure: function (response) {
                    alert(response.responseText);
                }
            });
        }

        function DetailData() {
            var data = $('#SParam').serialize();
            $.ajax({
                url: '@Url.Action("GetDetailData","ReqWithoutBom")',
                type: "POST",
                data: { REQNo: $('#REQNo').val(), WCName: $('#WorkCenter').val(), WONo: $('#WONo').val(), DepName: $('#DeptName').val(), PartCode: $('#PartCode').val(), ItemName: $('#ItemName').val(), BranchName: $('#CC').val(), FromDate: $('#FromDate').val(), ToDate: $('#ToDate').val() },
                async: false,
                success: function (data) {

                    $('#divDashboardGrid').empty().append(data);
                    GetFormRights();
                    var dashGrid = $('#ReqBomTbody tr').length;
                    $('#totalRows').text(dashGrid);
                    //$('#search-box').val(GlobalSearchBack);
                    //$("#search-box").val($('#search-box').val()).trigger('keyup');
                    //$('#FromDate').val(FromDateBack);
                    //$('#ToDate').val(ToDateBack);
                    var rowwCount = $('#ReqBomTbody tr').length;
                    for (var i = 1; i <= rowwCount; i++) {
                        var pendQty = $('#PendQty-' + i).val();
                        var Cancel = $('#Cancel-' + i).val();
                        if (pendQty > 0) {
                            $('#' + i).css("color", "red");
                        }
                        if (pendQty == 0) {
                            $('#' + i).css("color", "green");

                        }
                        if (Cancel == "Y") {
                            $('#' + i).css("color", "blue");

                        }
                    }

                },
                error: function (response) {
                    alert(response.responseText);
                },
                failure: function (response) {
                    alert(response.responseText);
                }
            });
        }

        function PropEditDelete() {
            $.ajax({
                url: '@Url.Action("PropEditDelete","ReqWithoutBom")',
                type: "POST",
                data: { REQNo: $('#REQNo').val(), WCName: $('#WorkCenter').val(), WONo: $('#WONo').val(), DepName: $('#DeptName').val(), PartCode: $('#PartCode').val(), ItemName: $('#ItemName').val(), BranchName: $('#CC').val(), FromDate: $('#FromDate').val(), ToDate: $('#ToDate').val() },
                success: function (data) {
                    $('#divDashboardGrid').empty().append(data);
                },
                error: function (response) {
                    alert(response.responseText);
                },
                failure: function (response) {
                    alert(response.responseText);
                }
            });
        }

        $('#sendToExcel').click(function () {
            $("#ReqBomTable").table2excel({
                filename: "ReqWithoutBom.xls"
            });
        });

        function GetFormRights() {

            $.ajax({
                url: "@Url.Action("GetFormRights")",
                type: "POST",
                async: false,
                success: function (data) {
                    if (data != null) {

                        var obj = $.parseJSON(data);
                        console.log(obj);
                        var optAll = obj.Result.Table[0].OptAll;
                        var optSave = obj.Result.Table[0].OptSave;
                        var optUpdate = obj.Result.Table[0].OptUpdate;
                        var optDelete = obj.Result.Table[0].OptDelete;
                        var optView = obj.Result.Table[0].OptView;
                        var rowCounter = $('#divDashboardGrid tr').length;
                        if (!optAll) {
                            if (!optView) {

                                for (var i = 0; i < rowCounter; i++) {
                                    $('#viewCursorDiv-' + i).empty();
                                    $('#viewCursorDiv-' + i).append(`<a class="table-link link-success noCursor" id="viewNoCursor"">
                                                                        <span class="fa-stack">
                                                                            <i class="fa fa-square fa-stack-2x"></i>
                                                                            <i class="fa-solid fa-magnifying-glass fa-stack-1x fa-inverse"></i>
                                                                        </span>
                                                                    </a>`);
                                }
                            }
                            if (!optUpdate) {
                                for (var i = 0; i < rowCounter; i++) {
                                    $('#editCursorDiv-' + i).empty();
                                    $('#editCursorDiv-' + i).append(`<a class="table-link link-primary noCursor">
                                                                        <span class="fa-stack">
                                                                            <i class="fa fa-square fa-stack-2x"></i>
                                                                            <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
                                                                        </span>
                                                                    </a>`);
                                }
                            }
                            if (!optDelete) {
                                for (var i = 0; i < rowCounter; i++) {
                                    $('#deleteCursorDiv-' + i).empty();
                                    $('#deleteCursorDiv-' + i).append(`<a class="table-link link-danger noCursor">
                                                                        <span class="fa-stack">
                                                                            <i class="fa fa-square fa-stack-2x"></i>
                                                                            <i class="fa-solid fa-trash fa-stack-1x fa-inverse"></i>
                                                                        </span>
                                                                    </a>`);
                                }
                            }
                        }
                    }
                },
                error: function (errMsg) {
                    $.notify(errMsg, { position: "top center", className: "error" });
                }
            });
        }

        function confirmDelete(event) {
            event.preventDefault();
            if (confirm("Are you sure you want to delete this entry?")) {

                var linkUrl = $(event.currentTarget).attr("href");
                linkUrl = linkUrl + "&FromDate=" + $('#FromDate').val() + "&ToDate=" + $('#ToDate').val() + "&REQNo=" + $('#REQNo').val() + "&WCName=" + $('#WorkCenter').val() + "&WONo=" + $('#WONo').val() + "&DepName=" + $('#DeptName').val() + "&PartCode=" + $('#PartCode').val() + "&ItemName=" + $('#ItemName').val();
                window.location.href = linkUrl;
            }
        }

        //$(document).on("click", ".ascCol", function () {
        //    ;
        //    var $column = $(this).parent().closest("th");
        //    var colno = $column.data('columnno');
        //    $('.ascCol').css('color', 'white');
        //    $('.descCol').css('color', 'white');
        //    sortTable(colno, true);
        //    $(this).css('color', 'yellow');
        //});

        //$(document).on("click", ".descCol", function () {
        //    ;
        //    var $column = $(this).parent().closest("th");
        //    var colno = $column.data('columnno');
        //    $('.ascCol').css('color', 'white');
        //    $('.descCol').css('color', 'white');
        //    sortTable(colno, false);
        //    $(this).css('color', 'yellow');
        //});

        var currentSearchColumn = null;
        $("#search-box").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#ReqBomTbody tr").filter(function () {
                if (currentSearchColumn !== null) {
                    var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
                    $(this).toggle(columnText.indexOf(value) > -1);
                } else {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                }
            });
        });

        $(document).on("click", "th[data-columnno]", function () {

            currentSearchColumn = $(this).data('columnno');
            $("#search-box").val('').trigger('keyup');
        });



    </script>
    <script src="~/Scripts/table2excel.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

}


<style>
    .color-box {
        width: 10px;
        height: 10px;
    }
</style>