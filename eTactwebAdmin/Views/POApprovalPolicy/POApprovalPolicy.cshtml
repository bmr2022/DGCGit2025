	@model eTactWeb.DOM.Models.POApprovalPolicyModel;
@{
	ViewData["Title"] = "PO Approval Policy";
	Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<style>
	.disabled-link {
		pointer-events: none;
		color: gray;
		text-decoration: none;
		cursor: not-allowed;
	}
</style>

<div class="card bg-gradient mb-3 border-light shadow-lg">
	<form asp-action="POApprovalPolicy" asp-controller="POApprovalPolicy" method="post" autocomplete="on" class="form-horizontal">
		<div class="card-header card-headerBG text-light bg-gradient">
			<div class="card-header card-headerBG text-light justify-content-center bg-gradient">
				<h5>
					<strong>PO Approval Policy</strong>
					<span class="d-flex float-end" style="margin-top:-2px;">
						<a asp-controller="POApprovalPolicy" asp-action="POApprovalPolicyDashBoard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient DashBoard">
							<i class="fa-solid fa-grip fa-fw fa-lg fa-beat" aria-hidden="true"></i>
							Dashboard
						</a>
						<div class="row justify-content-between g-2">
							<div class="col-auto">
								<a href="#" class="btn btn-primary btn-sm" onclick="PressBack();">
									<i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
									BACK
								</a>
							</div>
							@if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
							{
								<div class="col-auto">
									<a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
										<i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
										REFRESH
									</a>
								</div>
								@if (Model.Mode == "U")
								{
									Model.Mode = "U";
									<div class="col-auto">
										<button type="submit" class="submitBTN btn btn-sm btn-outline-light bg-gradient submitBTN">
											<i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
											UPDATE
										</button>
									</div>
								}

								else
								{
									<div class="col-auto">
										<button type="submit" class="btn btn-primary btn-sm submitBTN">
											<i class="fa-solid fa-chevron-circle-right"></i>
											SUBMIT
										</button>
									</div>
								}
							}
						</div>
					</span>
				</h5>
			</div>
			<div class="card-body bg-light">
				<div class="accordion shadow-lg" id="accordionItemCategory">
					<div class="accordion-item">
						<h2 class="accordion-header" id="H_ItemCategoryDetail">
							<button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_ItemCategoryDetail"
									aria-expanded="true" aria-controls="B_ItemCategoryDetail">
								<strong><i class="fa fa-fw pr35 fa-book fa-lg" aria-hidden="true"></i>PO Approval Policy</strong>
								<small class="p-3"></small>
							</button>
						</h2>
						<div id="B_ItemCategoryDetail" class="accordion-collapse collapse pnl1 bg-gradient show" aria-labelledby="H_ItemCategoryDetail">
							<div class="accordion-body">
								<div class="row g-2">
									<input type="hidden" value="@Model.Mode" asp-for="Mode" />
									<input type="hidden" value="@Environment.MachineName" asp-for="EntryByMachine" />

									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:60px;">
										<label asp-for="EntryId" class="form-label">Entry Id</label>
										<input asp-for="EntryId" class="form-control" readonly />
									</div>

									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="EntryDate" class="form-label">EntryDate</label>
										<input asp-for="EntryDate" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:70px;">
										<label asp-for="YearCode" class="form-label">YearCode</label>
										<input asp-for="YearCode" class="form-control" readonly />
									</div>
									
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:140px;">
										<label asp-for="POTYPE" class="form-label" style="color:red">PO Type</label>
										<select class="form-select" asp-for="POTYPE">
											<option value="">-Select-</option>
											<option value="Open">Open</option>
											<option value="Close">Close</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:220px;">
										<label asp-for="GroupName" class="form-label" >Group Name</label>
										<input type="hidden" asp-for="GroupCode" />
										<select class="form-select" asp-for="GroupName" style="width:210px;">
											<option value="">-Select-</option>
										</select>`
									</div>

									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:140px;">
										<label asp-for="CatName" class="form-label" >Category Name</label>
										<input type="hidden" asp-for="CatId" />
										<select class="form-select" asp-for="CatName">
											<option value="">-Select-</option>
										</select>
									</div>

									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:190px;">
										<label asp-for="PartCode" class="form-label" >Part Code</label>
										<input type="hidden" asp-for="ItemCode" />
										<select class="form-select" asp-for="PartCode" id="PartCode" style="width:180px;">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:240px;">
										<label asp-for="ItemName" class="form-label">Item Name</label>
										
										<select class="form-select" asp-for="ItemName" id="ItemName" style="width:230px;">
											<option value="">-Select-</option>
										</select>
									</div>

									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:240px;">
										<label asp-for="EmpName" class="form-label" >Employee Name</label>
										<input type="hidden" asp-for="EmpId" />
										<select class="form-select" asp-for="EmpName" style="width:230px;">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="FromAmt" class="form-label">From Amt</label>
										<input asp-for="FromAmt" class="form-control"  />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12 mb-4">
										<label asp-for="ToAmt" class="form-label">To Amt</label>
										<input asp-for="ToAmt" class="form-control"  />
									</div>
									
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:200px;">
										<label asp-for="ONLY1stApprovalRequired" class="form-label">Only First Approval Required</label>
										<select class="form-select" asp-for="ONLY1stApprovalRequired" style="width:190px;">
											<option value="Y">Yes</option>
											<option value="N">No</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:200px;">
										<label asp-for="OnlyFinalApprovalRequired" class="form-label">Only Final Approval Required</label>
										<select class="form-select" asp-for="OnlyFinalApprovalRequired" style="width:190px;">
											<option value="Y">Yes</option>
											<option value="N">No</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:240px;">
										<label asp-for="All3ApprovalRequired" class="form-label">All 3 Approval Required</label>
										<select class="form-select" asp-for="All3ApprovalRequired" style="width:220px;">
											<option value="Y">Yes</option>
											<option value="N">No</option>
										</select>
									</div>
								</div>

								
								<div class="row">


										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12 mb-4" style="width:180px;">
											<label asp-for="FirstApprovalRequired" class="form-label" style="color:red">First Approval Required*</label>
											<select class="form-select" asp-for="FirstApprovalRequired" style="width:150px;">
												<option value="Y">Yes</option>
												<option value="N">No</option>
											</select>
										</div>
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForFirstApproval" class="form-label">Employee Name For First Approval </label>
											<input type="hidden" asp-for="EmpidForFirstApproval" />
											<select class="form-select" asp-for="EmpNameForFirstApproval" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForFirstApproval1" class="form-label" style="color:red">Employee Name For First Approval 1*</label>
											<input type="hidden" asp-for="EmpidForFirstApproval1" />
											<select class="form-select" asp-for="EmpNameForFirstApproval1" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForFirstApproval2" class="form-label">Employee Name For First Approval 2*</label>
											<input type="hidden" asp-for="EmpidForFirstApproval2" />
											<select class="form-select" asp-for="EmpNameForFirstApproval2" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForFirstApproval3" class="form-label">Employee Name For First Approval 3*</label>
											<input type="hidden" asp-for="EmpidForFirstApproval3" />
											<select class="form-select" asp-for="EmpNameForFirstApproval3" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>
										@* Second *@
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12 mb-4" style="width:180px;">
											<label asp-for="FinalApprovalRequired1" class="form-label" style="color:red">Final Approval Required*</label>
											<select class="form-select" asp-for="FinalApprovalRequired1" style="width:150px;">
												<option value="Y">Yes</option>
												<option value="N">No</option>
											</select>
										</div>
									
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12 " style="width:300px;">
											<label asp-for="EmpNameForFinalApproval" class="form-label">Employee Name For Final Approval </label>
											<input type="hidden" asp-for="EmpidForFinalApproval" />
											<select class="form-select" asp-for="EmpNameForFinalApproval" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForFinalApproval1" class="form-label" style="color:red">Employee Name For Final Approval 1* </label>
											<input type="hidden" asp-for="EmpidForFinalApproval1" />
											<select class="form-select" asp-for="EmpNameForFinalApproval1" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForFinalApproval2" class="form-label">Employee Name For Final Approval 2 </label>
											<input type="hidden" asp-for="EmpidForFinalApproval2" />
											<select class="form-select" asp-for="EmpNameForFinalApproval2" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>

										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForFinalApproval3" class="form-label">Employee Name For Final Approval 3 </label>
											<input type="hidden" asp-for="EmpidForFinalApproval3" />
											<select class="form-select" asp-for="EmpNameForFinalApproval3" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>


									
									
									
									
									
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12 mb-4" style="width:300px;">
										<label asp-for="EmpNameForMgmtApproval1" class="form-label" style="color:red"> Employee Name For Mgmt Approval 1* </label>
										<input type="hidden" asp-for="EmpidForMgmtApproval1" />
										<select class="form-select" asp-for="EmpNameForMgmtApproval1" style="width:290px;">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
										<label asp-for="EmpNameForMgmtApproval12" class="form-label" > Employee Name For Mgmt Approval 2 </label>
										<input type="hidden" asp-for="EmpidForMgmtApproval12" />
										<select class="form-select" asp-for="EmpNameForMgmtApproval12" style="width:290px;">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
										<label asp-for="EmpNameForMgmtApproval13" class="form-label"> Employee Name For Mgmt Approval 3 </label>
										<input type="hidden" asp-for="EmpidForMgmtApproval13" />
										<select class="form-select" asp-for="EmpNameForMgmtApproval13" style="width:290px;">
											<option value="">-Select-</option>
										</select>
									</div>

									<div class="row">
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:240px;">
											<label asp-for="OnlyDirectorApproval" class="form-label" style="color:red">Only Director Approval Required*</label>
											<select class="form-select" asp-for="OnlyDirectorApproval">
												<option value="Y">Yes</option>
												<option value="N">No</option>
											</select>
										</div>
										<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:300px;">
											<label asp-for="EmpNameForDirectorApproval" class="form-label"> Employee Name For Director Approval </label>
											<input type="hidden" asp-for="EmpidForDirectorApproval" />
											<select class="form-select" asp-for="EmpNameForDirectorApproval" style="width:290px;">
												<option value="">-Select-</option>
											</select>
										</div>
									</div>
									

								</div>
							</div>
							
							
							
							
							
							
							<div class="accordion-item">
								

								<h2 class="accordion-header" id="H_SAGrid">
									<button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#ODGrid" aria-expanded="true" aria-controls="ODGrid">
										<strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
									</button>
								</h2>
								<div id="ODGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
									<div class="accordion-body">
										<div class="row g-2 gx-3" id="_ItemGrid">
											<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
												<label asp-for="ActualEntryByName" class="form-label">Actual Entered By</label>
												<input type="hidden" asp-for="ActualEntryByEmpId" class="form-control" readonly />
												<input asp-for="ActualEntryByName" class="form-control" readonly />
											</div>
											<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
												<label asp-for="ActualEntryDate" class="form-label">ActualEntryDate</label>
												<input asp-for="ActualEntryDate" class="form-control" value="@Model.ActualEntryDate" readonly />
											</div>
											<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
												<label asp-for="CC" class="form-label">Branch</label>
												<input asp-for="CC" class="form-control" value="@Model.CC" readonly />
											</div>
											<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
												<label asp-for="EntryByMachine" class="form-label">Machine Name</label>
												<input asp-for="EntryByMachine" class="form-control" value="@Environment.MachineName" readonly />
											</div>

											<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
												<label asp-for="LastUpdatedByName" class="form-label">Updated By</label>
											<input type="hidden" asp-for="LastUpdatedByEmpId" class="form-control" readonly />
												<input asp-for="LastUpdatedByName" class="form-control" readonly />
											</div>
											<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
											<label asp-for="LastUpdatedDate" class="form-label">Updated Date</label>
											<input asp-for="LastUpdatedDate" class="form-control" readonly />
											</div>
										
										</div>
									</div>

								</div>
							</div>
						</div>


					</div>
					<div class="card-footer p-3">
						<div class="row justify-content-between g-2">
							<div class="card-header card-headerBG text-light bg-gradient">
								<h5>
									<strong>PO Approval Policy</strong>
									<span class="d-flex float-end" style="margin-top:-2px;">

										@*<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">*@
										<a asp-controller="POApprovalPolicy" asp-action="POApprovalPolicyDashBoard" tabindex="-1" asp-route-ID="0" class="btn btn-secondary btn-sm DashBoard">
											<i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
											Dashboard
										</a>
										<div class="row justify-content-between g-2">
											<div class="col-auto">

												<a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
													<i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
													BACK
												</a>
											</div>
											@if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
											{
												<div class="col-auto">
													@*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
													<a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
														@* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
														<i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
														REFRESH
													</a>
												</div>
												@if (Model.Mode == "U")
												{
													@*Model.Mode = "U";*@
													<div class="col-auto">
														@* <button type="submit" class="btn btn-sm btn-outline-warning">*@
														<button type="submit" class="UpdateButton btn btn-sm btn-outline-light bg-gradient submitBTN">
															<i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
															UPDATE
														</button>
													</div>
												}
												else
												{
													<div class="col-auto">
														<button type="submit" class="btn btn-primary btn-sm submitBTN">
															<i class="fa-solid fa-chevron-circle-right"></i>
															SUBMIT
														</button>
													</div>
												}
											}
										</div>
									</span>
								</h5>
							</div>
						</div>
					</div>
				</div>
	</form>
</div>



@section Scripts {
	<script>
		$(document).ready(function () {
			//GetFormRights();
			console.log(" Document Ready Fired");
			if ($('#Mode').val() !== "U" && $('#Mode').val() !== "V") {
				setFormattedDate();
				FillEntryID();
				
			}
			FillItemName();
			FillPartCode();
			FillEmpName();
			FillCatName();
			FillGroupName();


			$('#CatName').select2();
			$('#PartCode').select2();
			$('#ItemName').select2();
			$('#GroupName').select2();
			$('#EmpName').select2();
			$('#FirstApprovalRequired').select2();
			$('#FinalApprovalRequired1').select2();
			$('#OnlyDirectorApproval').select2();
			$('#ONLY1stApprovalRequired').select2();
			$('#OnlyFinalApprovalRequired').select2();
			$('#All3ApprovalRequired').select2();
			$('#POTYPE').select2();
			$('#EmpNameForFirstApproval').select2();
			$('#EmpNameForFirstApproval1').select2();
			$('#EmpNameForFirstApproval2').select2();
			$('#EmpNameForFirstApproval3').select2();

			$('#EmpNameForFinalApproval').select2();
			$('#EmpNameForFinalApproval1').select2();
			$('#EmpNameForFinalApproval2').select2();
			$('#EmpNameForFinalApproval3').select2();

			$('#EmpNameForMgmtApproval1').select2();
			$('#EmpNameForMgmtApproval12').select2();
			$('#EmpNameForMgmtApproval13').select2();
			$('#EmpNameForDirectorApproval').select2();


			$('#totalRows').text($('#divStockGrid tr').length);

			function preventDuplicateSelection(groupSelectors, groupName) {
				$(groupSelectors.join(',')).on('change', function () {
					var selectedValues = [];
					var duplicateShown = false; // flag to prevent multiple notifications

					// Collect all selected values
					groupSelectors.forEach(function (selector) {
						var val = $(selector).val();
						if (val !== "") selectedValues.push(val);
					});

					// Check duplicates
					groupSelectors.forEach(function (selector) {
						var currentVal = $(selector).val();
						if (
							currentVal !== "" &&
							selectedValues.filter(v => v === currentVal).length > 1
						) {
							if (!duplicateShown) {
								$.notify(
									`Duplicate selection not allowed in ${groupName}!`,
									{ className: "error", globalPosition: "top right" }
								);
								duplicateShown = true; // show only once
							}

							// Reset the duplicate selection in Select2
							$(selector).val(null).trigger('change.select2');
						}
					});
				});
			}

			// Initialize for each approval group
			preventDuplicateSelection([
				'#EmpNameForFirstApproval1',
				'#EmpNameForFirstApproval2',
				'#EmpNameForFirstApproval3',
				'#EmpNameForFirstApproval'
			], 'First Approval');

			preventDuplicateSelection([
				'#EmpNameForFinalApproval1',
				'#EmpNameForFinalApproval2',
				'#EmpNameForFinalApproval3',
				'#EmpNameForFinalApproval'
			], 'Final Approval');

			preventDuplicateSelection([
				'#EmpNameForMgmtApproval1',
				'#EmpNameForMgmtApproval12',
				'#EmpNameForMgmtApproval13'
			], 'Management Approval');

			$('.submitBTN').click(function (e) {
				e.preventDefault();

				var firstApproval = $('#FirstApprovalRequired').val();
				var finalApproval = $('#FinalApprovalRequired1').val();
				var directorApproval = $('#OnlyDirectorApproval').val();

				var empFirst = $('#EmpidForFirstApproval1').val();
				var empFinal = $('#EmpidForFinalApproval1').val();
				var empMgmt = $('#EmpidForMgmtApproval1').val();
				var POTYPE = $('#POTYPE').val();

				var valid = true;
				var errorMsg = "";
				if(firstApproval !== 'Y') {
					valid = false;
					errorMsg += "First Approval must be 'Yes'\n";
				}
				if (finalApproval !== 'Y') {
					valid = false;
					errorMsg += "Final Approval must be 'Yes'\n";
				}
				if (directorApproval !== 'Y') {
					valid = false;
					errorMsg += "Only Director Approval must be 'Yes'\n";
				}
				if (!empFirst || parseInt(empFirst) <= 0) {
					valid = false;
					errorMsg += "Emp Name For First Approval is Required \n";
				}
				if (!empFinal || parseInt(empFinal) <= 0) {
					valid = false;
					errorMsg += "Emp Name For Final Approval is Required\n";
				}
				if (!empMgmt || parseInt(empMgmt) <= 0) {
					valid = false;
					errorMsg += "Emp Name For Mgmt Approval is Required\n";
				}
				if (!POTYPE || POTYPE === "") { 
					valid = false;
					errorMsg += "PO Type Is Mandatory";
				}

				if (!valid) {
					$.notify(errorMsg, "error");
					return false;
				}
				console.log("SubmitButton Click - Validation passed");
				$('form').submit();
			});
			var validator = $("form").data("validator");
			if (validator) {
				$('#Mode').rules("remove", "required");
				$('#EntryByMachine').rules("remove", "required");
				$('#GroupCode').rules("remove", "required");
				$('#CatId').rules("remove", "required");
				$('#ItemCode').rules("remove", "required");
				$('#EmpId').rules("remove", "required");
				$('#EntryId').rules("remove", "required");
				$('#EntryDate').rules("remove", "required");
				$('#YearCode').rules("remove", "required");
				$('#GroupName').rules("remove", "required");
				$('#CatName').rules("remove", "required");
				$('#PartCode').rules("remove", "required");
				$('#ItemName').rules("remove", "required");
				$('#EmpName').rules("remove", "required");

				$('#Uid').rules("remove", "required");
				$('#ApprovedByEmpId').rules("remove", "required");
				$('#ApprovedByEmpName').rules("remove", "required");
				$('#CC').rules("remove", "required");
				$('#ActualEntryByEmpId').rules("remove", "required");
				$('#ActualEntryByEmpName').rules("remove", "required");
				$('#ActualEntryDate').rules("remove", "required");
				$('#LastUpdatedbyEmpId').rules("remove", "required");
				$('#LastUpdatedbyEmpName').rules("remove", "required");
				$('#LastupDationDate').rules("remove", "required");
				$('#EntryByMachine').rules("remove", "required");
				$('#CustoidianEmpName').rules("remove", "required");
				$('#ActualEntryByName').rules("remove", "required");
				$('#ActualEntryByEmpId').rules("remove", "required");
				$('#ActualEntryDate').rules("remove", "required");
				$('#CC').rules("remove", "required");
				$('#EntryByMachine').rules("remove", "required");
				$('#LastUpdatedByName').rules("remove", "required");
				$('#LastUpdatedByEmpId').rules("remove", "required");
				$('#LastUpdatedDate').rules("remove", "required");

				$('#FirstApprovalRequired').rules("remove", "required");
				$('#FinalApprovalRequired1').rules("remove", "required");
				$('#OnlyDirectorApproval').rules("remove", "required");
				$('#ONLY1stApprovalRequired').rules("remove", "required");
				$('#OnlyFinalApprovalRequired').rules("remove", "required");
				$('#All3ApprovalRequired').rules("remove", "required");

				$('#EmpidForFirstApproval1').rules("remove", "required");
				$('#EmpidForFirstApproval2').rules("remove", "required");
				$('#EmpidForFirstApproval3').rules("remove", "required");
				$('#EmpidForFinalApproval1').rules("remove", "required");
				$('#EmpidForFinalApproval2').rules("remove", "required");
				$('#EmpidForFinalApproval3').rules("remove", "required");
				$('#EmpidForMgmtApproval1').rules("remove", "required");
				$('#EmpidForMgmtApproval12').rules("remove", "required");
				$('#EmpidForMgmtApproval13').rules("remove", "required");
				$('#EmpidForDirectorApproval').rules("remove", "required");
				$('#EmpidForFirstApproval').rules("remove", "required");
				$('#EmpidForFinalApproval').rules("remove", "required");
			}


			$('#ItemName').change(function () {
				$('#ItemCode').val($('#ItemName').val());
			});
			$('#PartCode').change(function () {
				$('#ItemCode').val($('#PartCode').val());
			});
			$('#EmpName').change(function () {
				$('#EmpId').val($('#EmpName').val());
			});
			$('#GroupName').change(function () {
				$('#GroupCode').val($('#GroupName').val());
			});
			$('#CatName').change(function () {
				$('#CatId').val($('#CatName').val());
			});
			$('#EmpNameForFirstApproval').change(function () {
				$('#EmpidForFirstApproval').val($('#EmpNameForFirstApproval').val());
			});
			$('#EmpNameForFirstApproval1').change(function () {
				$('#EmpidForFirstApproval1').val($('#EmpNameForFirstApproval1').val());
			});
			$('#EmpNameForFirstApproval2').change(function () {
				$('#EmpidForFirstApproval2').val($('#EmpNameForFirstApproval2').val());
			});
			$('#EmpNameForFirstApproval3').change(function () {
				$('#EmpidForFirstApproval3').val($('#EmpNameForFirstApproval3').val());
			});

			$('#EmpNameForFinalApproval').change(function () {
				$('#EmpidForFinalApproval').val($('#EmpNameForFinalApproval').val());
			});
			$('#EmpNameForFinalApproval1').change(function () {
				$('#EmpidForFinalApproval1').val($('#EmpNameForFinalApproval1').val());
			});
			$('#EmpNameForFinalApproval2').change(function () {
				$('#EmpidForFinalApproval2').val($('#EmpNameForFinalApproval2').val());
			});
			$('#EmpNameForFinalApproval3').change(function () {
				$('#EmpidForFinalApproval3').val($('#EmpNameForFinalApproval3').val());
			});

			$('#EmpNameForMgmtApproval1').change(function () {
				$('#EmpidForMgmtApproval1').val($('#EmpNameForMgmtApproval1').val());
			});
			$('#EmpNameForMgmtApproval12').change(function () {
				$('#EmpidForMgmtApproval12').val($('#EmpNameForMgmtApproval12').val());
			});
			$('#EmpNameForMgmtApproval13').change(function () {
				$('#EmpidForMgmtApproval13').val($('#EmpNameForMgmtApproval13').val());
			});
			$('#EmpNameForDirectorApproval').change(function () {
				$('#EmpidForDirectorApproval').val($('#EmpNameForDirectorApproval').val());
			});


			$(document).on('change', '#ItemName,#PartCode', function (e) {

				var cntId = e.target.id;
				if (cntId == 'ItemName') {
					AltItemNameChange(cntId);
				}
				else {
					AltPartCodeChange(cntId);
				}
			});

			function AltItemNameChange(ID) {
				SetAltPartCodeItemName(ID);
			}

			function AltPartCodeChange(ID) {
				$.when(SetAltPartCodeItemName(ID)).done(function () {
				});
			}
			function SetAltPartCodeItemName(ID) {
				if (!ID) return;
				var v = $('#' + ID).val();
				if (ID == "PartCode") {
					$("#ItemName").val(v).trigger("change.select2");
				}
				if (ID == "ItemName") {
					$("#PartCode").val(v).trigger("change.select2");
				}
			}
			// $('#GroupName').change(function () {
			// 	var groupName = $("#GroupName option:selected").text();
			// 	 if (groupName && groupName !== "-Select-") {
			// 		$.ajax({
			// 			url: '@Url.Action("CheckGroupExists", "POApprovalPolicy")',
			// 			type: 'POST',
			// 			data: { GroupName: groupName },
			// 			success: function (response) {
			// 				if (response.exists) {
			// 					$.notify("Old record found — switched to Update mode.", "info");
			// 					//FillFormWithExistingData(response.data); // your function to fill form fields
			// 				} else {
			// 					$.notify("No existing record found — new entry mode.", "success");
			// 				}
			// 			},
			// 			error: function () {
			// 				$.notify("Error while checking group data.", "error");
			// 			}
			// 		});
			// 	}
			// });
			$('#GroupName').change(function () {
				var groupName = $("#GroupName option:selected").text();

				if (groupName && groupName !== "-Select-") {
					$.ajax({
						url: '@Url.Action("CheckGroupExists", "POApprovalPolicy")',
						type: 'POST',
						data: { GroupName: groupName },
						success: function (response) {
							if (response.exists) {
								$.notify("Old record found — switched to Update mode.", "info");
								var id = response.id;
								window.location.href = `/POApprovalPolicy/Index?ID=${id}&Mode=U`;
							}
							else {
								$.notify("No existing record found — new entry mode.", "success");
							}
						},
						error: function () {
							$.notify("Error while checking group data.", "error");
						}
					});
				}
			});

			$('#FromAmt, #ToAmt').on('input', function () {
				var value = this.value;

				var numericValue = value.replace(/[^0-9.]/g, '');

				if ((numericValue.match(/\./g) || []).length > 1) {
					numericValue = numericValue.slice(0, -1);
				}

				if (numericValue < 0) {
					numericValue = '';
					$.notify("Negative values are not allowed!", "error");
				}

				if (value !== numericValue && value !== '') {
					$.notify("Only numeric values are allowed!", "error");
				}

				this.value = numericValue;
			});


		});
		
		function parseCustomDate(val) {
			if (!val) return null;
			var parts = val.split('/');
			if (parts.length !== 3) return null;

			var day = parseInt(parts[0], 10);
			var monthStr = parts[1];
			var year = parseInt(parts[2], 10);

			var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
			var month = monthNames.indexOf(monthStr);

			if (month < 0) return null;
			return new Date(year, month, day);
		}

		function setFormattedDate() {
			var today = new Date();
			var day = ('0' + today.getDate()).slice(-2);
			var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
			var month = monthNames[today.getMonth()];
			var year = today.getFullYear();

			var formattedDate = day + '/' + month + '/' + year;

			$('#LastupDationDate,#ActualEntryDate,#EntryDate')
				.datepicker({ dateFormat: 'dd/M/yy' })
				.val(formattedDate);
		}

		function FillCatName() {
			$.ajax({
				url: '@Url.Action("FillCatName", "POApprovalPolicy")',
				type: 'POST',
				async: false,
				success: function (response, status, error) {
					var Dropdown = $('#CatName');
					var obj = $.parseJSON(response);
					Dropdown.empty();
					Dropdown.append('<option value="">--Select--</option>');
					$.each(obj.Result, function (index, Val) {
						Dropdown.append('<option value="' + Val.Entry_id + '">' + Val.Type_Item + '</option>');
					});
					if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
						var CatName = '@Model.CatId';
						$('#CatName').val(CatName);
					}
				},
				error: function (xhr, status, error) {
					alert('Failed to load groups.');
				}
			});
		}
		function FillEmpName() {
			$.ajax({
				url: '@Url.Action("FillEmpName", "POApprovalPolicy")',
				type: 'POST',
				async: false,
				success: function (response, status, error) {
					var Dropdown = $('#EmpName');

					var EmpNameForFirstApproval = $('#EmpNameForFirstApproval');
					var EmpNameForFirstApproval1 = $('#EmpNameForFirstApproval1');
					var EmpNameForFirstApproval2 = $('#EmpNameForFirstApproval2');
					var EmpNameForFirstApproval3 = $('#EmpNameForFirstApproval3');

					var EmpNameForFinalApproval = $('#EmpNameForFinalApproval');
					var EmpNameForFinalApproval1 = $('#EmpNameForFinalApproval1');
					var EmpNameForFinalApproval2 = $('#EmpNameForFinalApproval2');
					var EmpNameForFinalApproval3 = $('#EmpNameForFinalApproval3');

					var EmpNameForMgmtApproval1 = $('#EmpNameForMgmtApproval1');
					var EmpNameForMgmtApproval12 = $('#EmpNameForMgmtApproval12');
					var EmpNameForMgmtApproval13 = $('#EmpNameForMgmtApproval13');
					var EmpNameForDirectorApproval = $('#EmpNameForDirectorApproval');

					var obj = $.parseJSON(response);

					Dropdown.empty();

					EmpNameForFirstApproval.empty();
					EmpNameForFirstApproval1.empty();
					EmpNameForFirstApproval2.empty();
					EmpNameForFirstApproval3.empty();

					EmpNameForFinalApproval.empty();
					EmpNameForFinalApproval1.empty();
					EmpNameForFinalApproval2.empty();
					EmpNameForFinalApproval3.empty();

					EmpNameForMgmtApproval1.empty();
					EmpNameForMgmtApproval12.empty();
					EmpNameForMgmtApproval13.empty();
					EmpNameForDirectorApproval.empty();

					Dropdown.append('<option value="">--Select--</option>');
					EmpNameForFirstApproval.append('<option value="">--Select--</option>');
					EmpNameForFirstApproval1.append('<option value="">--Select--</option>');
					EmpNameForFirstApproval2.append('<option value="">--Select--</option>');
					EmpNameForFirstApproval3.append('<option value="">--Select--</option>');

					EmpNameForFinalApproval.append('<option value="">--Select--</option>');
					EmpNameForFinalApproval1.append('<option value="">--Select--</option>');
					EmpNameForFinalApproval2.append('<option value="">--Select--</option>');
					EmpNameForFinalApproval3.append('<option value="">--Select--</option>');

					EmpNameForMgmtApproval1.append('<option value="">--Select--</option>');
					EmpNameForMgmtApproval12.append('<option value="">--Select--</option>');
					EmpNameForMgmtApproval13.append('<option value="">--Select--</option>');
					EmpNameForDirectorApproval.append('<option value="">--Select--</option>');


					$.each(obj.Result, function (index, Val) {
						Dropdown.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFirstApproval.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFirstApproval1.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFirstApproval2.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFirstApproval3.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFinalApproval.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFinalApproval1.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFinalApproval2.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForFinalApproval3.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForMgmtApproval1.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForMgmtApproval12.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForMgmtApproval13.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
						EmpNameForDirectorApproval.append('<option value="' + Val.EmpId + '">' + Val.EmpName + '</option>');
					});

					if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
						var EmpId = '@Model.EmpId';
						$('#EmpName').val(EmpId);
						var EmpidForFirstApproval = '@Model.EmpidForFirstApproval';
						$('#EmpNameForFirstApproval').val(EmpidForFirstApproval);
						var EmpidForFirstApproval1 = '@Model.EmpidForFirstApproval1';
						$('#EmpNameForFirstApproval1').val(EmpidForFirstApproval1);
						var EmpidForFirstApproval2 = '@Model.EmpidForFirstApproval2';
						$('#EmpNameForFirstApproval2').val(EmpidForFirstApproval2);
						var EmpidForFirstApproval3 = '@Model.EmpidForFirstApproval3';
						$('#EmpNameForFirstApproval3').val(EmpidForFirstApproval3);

						var EmpidForFinalApproval = '@Model.EmpidForFinalApproval';
						$('#EmpNameForFinalApproval').val(EmpidForFinalApproval);
						var EmpidForFinalApproval1 = '@Model.EmpidForFinalApproval1';
						$('#EmpNameForFinalApproval1').val(EmpidForFinalApproval1);
						var EmpidForFinalApproval2 = '@Model.EmpidForFinalApproval2';
						$('#EmpNameForFinalApproval2').val(EmpidForFinalApproval2);
						var EmpidForFinalApproval3 = '@Model.EmpidForFinalApproval3';
						$('#EmpNameForFinalApproval3').val(EmpidForFinalApproval3);

						var EmpidForMgmtApproval1 = '@Model.EmpidForMgmtApproval1';
						$('#EmpNameForMgmtApproval1').val(EmpidForMgmtApproval1);
						var EmpidForMgmtApproval12 = '@Model.EmpidForMgmtApproval12';
						$('#EmpNameForMgmtApproval12').val(EmpidForMgmtApproval12);
						var EmpidForMgmtApproval13 = '@Model.EmpidForMgmtApproval13';
						$('#EmpNameForMgmtApproval13').val(EmpidForMgmtApproval13);
						var EmpidForDirectorApproval = '@Model.EmpidForDirectorApproval';
						$('#EmpNameForDirectorApproval').val(EmpidForDirectorApproval);


					}	
				},
				error: function (xhr, status, error) {
					alert('Failed to load groups.');
				}
			});
		}
		function FillGroupName() {
			$.ajax({
				url: '@Url.Action("FillGroupName", "POApprovalPolicy")',
				type: 'POST',
				async: false,
				success: function (response, status, error) {
					var Dropdown = $('#GroupName');
					var obj = $.parseJSON(response);
					Dropdown.empty();
					Dropdown.append('<option value="">--Select--</option>');
					$.each(obj.Result, function (index, Val) {
						Dropdown.append('<option value="' + Val.GroupCode + '">' + Val.GroupName + '</option>');
					});
					if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
						var GroupCode = '@Model.GroupCode';
						$('#GroupName').val(GroupCode);
					}
				},
				error: function (xhr, status, error) {
					alert('Failed to load groups.');
				}
			});
		}

		function FillEntryID() {
			$.ajax({
				url: '@Url.Action("FillEntryId", "POApprovalPolicy")',
				type: 'POST',
				async: false,
				success: function (data, status, xhr) {
					var obj = $.parseJSON(data);
					if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
						$('#EntryId').val(obj.Result[0].EntryId || 0);
					}
				},
				error: function (xhr, status, error) {
					console.log('Failed to load Entry Id.');
				}
			});
		}

		function GetFormRights() {
			$.ajax({
				url: "@Url.Action("GetFormRights")",
				type: "POST",
				success: function (data) {
					if (data != null) {
						var obj = $.parseJSON(data);
						if (obj.Result.Table.length == 0) {
							$(".submitBTN").prop("disabled", true);
							$('.card-footer .submitBTN').prop("disabled", true);
							$(".DashBoard")
								.addClass("disabled-link")
								.on("click", function (e) {
									e.preventDefault(); // Prevents clicking the link
								});
						}
						else {
							// console.log(obj);
							var optAll = obj.Result.Table[0].OptAll;
							var optSave = obj.Result.Table[0].OptSave;
							var optUpdate = obj.Result.Table[0].OptUpdate;
							var optDelete = obj.Result.Table[0].OptDelete;
							var optView = obj.Result.Table[0].OptView;
							if (!optAll) {
								if (!optSave) {
									$("#submitBTN").prop("disabled", true);
									$('.card-footer #submitBTN').prop("disabled", true);
								}
								if (!(optUpdate || optDelete || optView)) {
									$(".DashBoard")
										.addClass("disabled-link")
										.on("click", function (e) {
											e.preventDefault(); // Prevents clicking the link
										});
								}
							}
						}
					}
				},
				error: function (errMsg) {
					$.notify(errMsg, { position: "top center", className: "error" });
				}
			});
		}


		function FillItemName() {
			$.ajax({
				url: '@Url.Action("FillItemName", "POApprovalPolicy")',
				type: 'POST',
				async: false,
				success: function (response, status, error) {
					var Dropdown = $('#ItemName');
					var obj = $.parseJSON(response);
					Dropdown.empty();
					Dropdown.append('<option value="">--Select--</option>');
					$.each(obj.Result, function (index, Val) {
						Dropdown.append('<option value="' + Val.itemcode + '">' + Val.ItemName + '</option>');
					});
					if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
						var ItemCode = '@Model.ItemCode';
						$('#ItemName').val(ItemCode);
					}
				},
				error: function (xhr, status, error) {
					alert('Failed to load groups.');
				}
			});
		}

		function FillPartCode() {
			$.ajax({
				url: '@Url.Action("FillPartCode", "POApprovalPolicy")',
				type: 'POST',
				async: false,
				success: function (response, status, error) {
					var Dropdown = $('#PartCode');
					var obj = $.parseJSON(response);
					Dropdown.empty();
					Dropdown.append('<option value="">--Select--</option>');
					$.each(obj.Result, function (index, Val) {
						Dropdown.append('<option value="' + Val.itemcode + '">' + Val.PartCode + '</option>');
					});
					if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
						var ItemCode = '@Model.ItemCode';
						$('#PartCode').val(ItemCode);
					}
				},
				error: function (xhr, status, error) {
					alert('Failed to load groups.');
				}
			});
		}
		

		// function SetAltPartCodeItemName(ID) {
		// 	if (!ID) return;
		// 	else {
		// 		var v = $('#' + ID).select2('val');
		// 		if (ID == "PartCode") {
		// 			$("#ItemName").val(v).trigger("change");
		// 		}

		// 		if (ID == "ItemName") {
		// 			$("#PartCode").val(v).trigger("change");
		// 		}
		// 	}
		// }

		


		
		function PressBack() {
			sessionStorage.setItem('FromDateBack', $('#FromDateBack').val());
			sessionStorage.setItem('ToDateBack', $('#ToDateBack').val());
			sessionStorage.setItem('GroupNameBack', $('#GroupNameBack').val());
			sessionStorage.setItem('LedgerNameBack', $('#LedgerNameBack').val());
			sessionStorage.setItem('OpeningYearCodeBack', $('#OpeningYearCodeBack').val());
			sessionStorage.setItem('PreviousAmountBack', $('#PreviousAmountBack').val());
			sessionStorage.setItem('DrCrBack', $('#DrCrBack').val());
			sessionStorage.setItem('GlobalSearchBack', $('#GlobalSearchBack').val());

			window.history.back();
		}
	</script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js" ></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate-unobtrusive/3.2.12/jquery.validate.unobtrusive.min.js"></script>

	<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

	<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
	<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>

	
}








