@model eTactWeb.DOM.Models.MaterialConversionModel;
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div class="card bg-gradient mb-3 border-light shadow-lg">
    <form asp-action="LedgerPartyWiseOpening" asp-controller="LedgerPartyWiseOpening" method="post" autocomplete="on" class="form-horizontal">
        <div class="card-header card-headerBG text-light bg-gradient">
            <div class="card-header card-headerBG text-light justify-content-center bg-gradient">
                <h5>
                    <strong>Material Conversion </strong>
                    <span class="d-flex float-end" style="margin-top:-2px;">
                        <a asp-controller="MaterialConversion" asp-action="MaterialConversionDashBoard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">
                            <i class="fa-solid fa-grip fa-fw fa-lg fa-beat" aria-hidden="true"></i>
                            Dashboard
                        </a>
                        <div class="row justify-content-between g-2">
                            <div class="col-auto">
                                <a href="#" class="btn btn-primary btn-sm" onclick="PressBack();">
                                    <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                    BACK
                                </a>
                            </div>
                            @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                            {
                                <div class="col-auto">
                                    <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                        <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                        REFRESH
                                    </a>
                                </div>
                                @if (Model.Mode == "U")
                                {
                                    Model.Mode = "U";
                                    <div class="col-auto">
                                        <button type="submit" class="UpdateButton btn btn-sm btn-outline-light bg-gradient submitBTN">
                                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                            UPDATE
                                        </button>
                                    </div>
                                }

                                else
                                {
                                    <div class="col-auto">
                                        <button type="submit" class="btn btn-primary btn-sm submitBTN">
                                            <i class="fa-solid fa-chevron-circle-right"></i>
                                            SUBMIT
                                        </button>
                                    </div>
                                }
                            }
                        </div>
                    </span>
                </h5>
            </div>
            <div class="card-body bg-light">
                <div class="accordion shadow-lg" id="accordionItemCategory">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="H_ItemCategoryDetail">
                            <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_ItemCategoryDetail"
                                    aria-expanded="true" aria-controls="B_ItemCategoryDetail">
                                <strong><i class="fa fa-fw pr35 fa-book fa-lg" aria-hidden="true"></i>Material Conversion</strong>
                                <small class="p-3"></small>
                            </button>
                        </h2>
                        <div id="B_ItemCategoryDetail" class="accordion-collapse collapse pnl1 bg-gradient show" aria-labelledby="H_ItemCategoryDetail">
                            <div class="accordion-body">
                                <div class="row g-2">
                                    <input type="hidden" value="@Model.Mode" asp-for="Mode" />
                                    <input type="hidden" value="@Environment.MachineName" asp-for="EntryByMachine" />
                                    
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="EntryId" class="form-label">Entry Id</label>
                                        <input asp-for="EntryId" class="form-control" readonly />
                                    </div>
                                   
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="OpeningYearCode" class="form-label">YearCode</label>
                                        <input asp-for="OpeningYearCode" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="SlipNo" class="form-label">SlipNo</label>
                                        <input asp-for="SlipNo" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="SlipDate" class="form-label">SlipDate</label>
                                        <input asp-for="SlipDate" class="form-control" readonly />
                                    </div>
                                      <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="StoreName" class="form-label">StoreName</label>
                                        <select class="form-control" asp-for="StoreName">
                                            <option value="">-Select-</option>
                                        </select>
                                    </div>
                                     <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="WorkCenterName" class="form-label">WorkCenterName</label>
                                        <select class="form-control" asp-for="WorkCenterName">
                                            <option value="">-Select-</option>
                                        </select>
                                    </div>


                                    <div class="accordion-item" style="margin-top: 5px;">
                                    <h2 class="accordion-header" id="H_SAGrid">
                                        <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
                                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Material Conversion Grid</strong>
                                        </button>
                                    </h2>

                                    <div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                                        <div class="accordion-body">
                                            <div class="row g-2 gx-3" id="_ItemGrid">
                                            </div>
                                            <div class="progress my-2 mb-3" style="height: 4px;">
                                                <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>
                                            <div class="card">
                                                <div class="card-body overflow-auto pb-0">
                                                    <table class="table table-hover table-bordered table-striped" id="TableGrid">
                                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap" id="GridLabels">
                                                            <tr>
                                                                
                                                                <th>OriginalItemCode</th>
                                                                <th>OriginalQty</th>
                                                                <th>Unit</th>
                                                                <th>AltItemCode</th>
                                                                <th>AltOriginalQty</th>
                                                                <th>AltUnit</th>
                                                                <th>OriginalStoreId</th>
                                                                <th>AltStoreId</th>
                                                                <th>OrginalWCID</th>
                                                                <th>AltWCID</th>
                                                                <th>BatchNo</th>
                                                                <th>UniqueBatchNo</th>
                                                                <th>BatchStock</th>
                                                                <th>TotalStock</th>
                                                                <th>AltStock</th>
                                                                <th>PlanNo</th>
                                                                <th>PlanYearCode</th>
                                                                <th>PlanDate</th>
                                                                <th>ProdSchNo</th>
                                                                <th>ProdSchYearCode</th>
                                                                <th>ProdSchDatetime</th>
                                                                <th>OrignalItemRate</th>
                                                                <th>Remark</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="GridControls">
                                                            <tr>
                                                              
                                                                
                                                                <td>
                                                                    <select class="form-select" asp-for="OriginalItemCode" style="width:100px;" onchange="FillCurrentBatchINStore(); GetTotalStockQty();">
                                                                        <option value="" disabled selected>-Select-</option>
                                                                    </select>
                                                                </td>
                                                                <td><input asp-for="OriginalQty" style="width:70px !important" /></td>
                                                                <td><input asp-for="Unit" style="width:70px !important" /></td>
                                                                <td>
                                                                    <select class="form-select" asp-for="AltItemCode" style="width:160px;">
                                                                        <option value="0">-Select-</option>
                                                                    </select>
                                                                </td>
                                                                <td><input asp-for="AltOriginalQty" /></td>
                                                                <td><input asp-for="AltUnit" /></td>
                                                                <td><input asp-for="OriginalStoreId" /></td>
                                                                <td><input asp-for="AltStoreId" /></td>
                                                                <td><input asp-for="OrginalWCID" /></td>
                                                                <td><input asp-for="AltWCID" /></td>
                                                               
                                                                <td>
                                                                    <select class="form-select" asp-for="BatchNo" style="width:250px;">
                                                                        <option value="0">-Select-</option>
                                                                    </select>
                                                                </td>
                                                                <td><input asp-for="UniqueBatchNo" /></td>
                                                                <td><input asp-for="BatchStock" /></td>
                                                                <td><input asp-for="TotalStock" /></td>
                                                                <td><input asp-for="AltStock" /></td>
                                                                <td><input asp-for="PlanNo" /></td>
                                                                <td><input asp-for="PlanYearCode" /></td>
                                                                <td><input asp-for="PlanDate" /></td>
                                                                <td><input asp-for="ProdSchNo" /></td>
                                                                <td><input asp-for="ProdSchYearCode" /></td>
                                                                <td><input asp-for="ProdSchDatetime" /></td>
                                                                <td><input asp-for="OrigItemRate" /></td>
                                                                <td><input asp-for="Remark" /></td>

                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="progress my-3 mb-3" style="height: 4px;">
                                                <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                            </div>

                                            <div class="d-flex">
                                                <div class="col-md-10">
                                                    <button type="button" class="GridButton btn btn-sm btn-outline-danger mt-1 mb-1">
                                                        <i class="fa-duotone fa-angle-double-down fa-fw fa-lg"></i> ADD TO GRID
                                                    </button>
                                                </div>
                                                <div class="col-md-2 mt-1 mb-1">
                                                    <input type="text" class="form-control" id="search-box" placeholder="Search..." style="background-color:#FFFACD;">
                                                </div>
                                            </div>

                                            <div class="card">
                                                <div class="card-body overflow-auto pb-0">
                                                    <table class="table table-hover table-bordered table-striped IssueNRGPTb">
                                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                                            <tr>
                                                                <th>Action</th>
                                                                <th>SR#</th>
                                                                        
                                                                        <th data-columnno="2" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>OriginalItemName
                                                                        </th>
                                                                        <th data-columnno="3" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>Unit
                                                                        </th>
                                                                        <th data-columnno="4" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>OriginalQty
                                                                        </th>
                                                                        <th data-columnno="5" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>AltItemName
                                                                        </th>
                                                                        
                                                                        <th data-columnno="7" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>AltOriginalQty
                                                                        </th>
                                                                    <th data-columnno="6" data-sortorder="asc" class="sortCol">
                                                                        <span style="padding:5px;margin:5px" class="sort-icon">
                                                                            <i class="fa" aria-hidden="true"></i>
                                                                        </span>AltUnit
                                                                    </th>
                                                                        <th data-columnno="8" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>OriginalStoreId
                                                                        </th>
                                                                        <th data-columnno="9" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>AltStoreId
                                                                        </th>
                                                                        <th data-columnno="10" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>OrginalWCID
                                                                        </th>
                                                                        <th data-columnno="11" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>AltWCID
                                                                        </th>
                                                                        <th data-columnno="12" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>BatchNo
                                                                        </th>
                                                                        <th data-columnno="13" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>UniqueBatchNo
                                                                        </th>
                                                                        <th data-columnno="14" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>BatchStock
                                                                        </th>
                                                                        <th data-columnno="15" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>TotalStock
                                                                        </th>
                                                                        <th data-columnno="16" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>AltStock
                                                                        </th>
                                                                        <th data-columnno="17" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>PlanNo
                                                                        </th>
                                                                        <th data-columnno="18" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>PlanYearCode
                                                                        </th>
                                                                        <th data-columnno="19" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>PlanDate
                                                                        </th>
                                                                        <th data-columnno="20" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>ProdSchNo
                                                                        </th>
                                                                        <th data-columnno="21" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>ProdSchYearCode
                                                                        </th>
                                                                        <th data-columnno="22" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>ProdSchDatetime
                                                                        </th>
                                                                        <th data-columnno="23" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>OrigItemRate
                                                                        </th>
                                                                        <th data-columnno="24" data-sortorder="asc" class="sortCol">
                                                                            <span style="padding:5px;margin:5px" class="sort-icon">
                                                                                <i class="fa" aria-hidden="true"></i>
                                                                            </span>Remark
                                                                        </th>
                                                                   

                                                            </tr>
                                                        </thead>
                                                        <tbody id="divStockGrid">
                                                            <partial name="_MaterialConversionGrid" />
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row g-2 gx-3">
                                            <div class="col-12 text-center">
                                                <strong>BASIC TOTAL : <i class="fa-solid fa-indian-rupee-sign"></i><span id="lblItemNetAmount"></span></strong>
                                                <strong>, TOTAL NO OF ITEMS : <span id="lblItemCount"></span></strong>
                                            </div>
                                        </div>
                                    </div>
                                   
                                </div>
                                

                            </div>


                        </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="OtherGrid">
                                        <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#OtherGridDetail" aria-expanded="true" aria-controls="OtherGridDetail">
                                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
                                        </button>
                                    </h2>
                                    <div id="OtherGridDetail" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="OtherGrid">
                                        <div class="accordion-body">
                                           
                                            <div class="row g-2 gx-3" id="_ItemGrid">

                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="Uid" class="form-label">UID</label>
                                                    <input asp-for="Uid" class="form-control" readonly />
                                                </div>
                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="ApprovedBy" class="form-label">ApprovedBy</label>
                                                    <input asp-for="ApprovedBy" class="form-control" readonly />
                                                </div>
                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="ActualEntryDate" class="form-label">Actual Entered Date</label>
                                                    <input asp-for="ActualEntryDate " class="form-control" readonly />
                                                </div>
                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="CC" class="form-label">CC</label>
                                                    <input asp-for="CC " class="form-control" readonly />
                                                </div>
                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="ActualEntryByEmpid" class="form-label">ActualEntryByEmpid</label>
                                                    <input asp-for="ActualEntryByEmpid " class="form-control" readonly />
                                                </div>
                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="ActualEntryDate" class="form-label">ActualEntryDate</label>
                                                    <input asp-for="ActualEntryDate " class="form-control" readonly />
                                                </div>

                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="UpdatedByEmpId" class="form-label">Updated By</label>
                                                    <input asp-for="UpdatedByEmpId" class="form-control" readonly />
                                                </div>

                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="UpdationDate" class="form-label">UpdationDate</label>
                                                    <input asp-for="UpdationDate" class="form-control" readonly />
                                                </div>
                                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                                    <label asp-for="EntryByMachine" class="form-label">Machine Name</label>
                                                    <input asp-for="EntryByMachine" class="form-control" value="@Environment.MachineName" readonly />
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                    </div>
                </div>
            </div>
           

            <div class="card-footer p-3">
                <div class="row justify-content-between g-2">
                    <div class="card-header card-headerBG text-light bg-gradient">
                        <h5>
                            <strong>Material Conversion</strong>
                            <span class="d-flex float-end" style="margin-top:-2px;">

                                @*<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">*@
                                <a asp-controller="MaterialConversion" asp-action="MaterialConversionDashBoard" tabindex="-1" asp-route-ID="0" class="btn btn-secondary btn-sm">
                                    <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                                    Dashboard
                                </a>
                                <div class="row justify-content-between g-2">
                                    <div class="col-auto">
                                      
                                        <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                            <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                            BACK
                                        </a>
                                    </div>
                                    @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                                    {
                                        <div class="col-auto">
                                            @*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
                                            <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                                @* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
                                                <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                                REFRESH
                                            </a>
                                        </div>
                                        @if (Model.Mode == "U")
                                        {
                                            @*Model.Mode = "U";*@
                                            <div class="col-auto">
                                                @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                                <button type="submit" class="UpdateButton btn btn-sm btn-outline-light bg-gradient submitBTN">
                                                    <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                                    UPDATE
                                                </button>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="col-auto">
                                                <button type="submit" class="btn btn-primary btn-sm submitBTN">
                                                    <i class="fa-solid fa-chevron-circle-right"></i>
                                                    SUBMIT
                                                </button>
                                            </div>
                                        }
                                    }
                                </div>
                            </span>
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>



@section Scripts {
    <script>
        $(document).ready(function () {
            if ($('#Mode').val() === "U") {

                $('#AccountCode').val($('#LedgerName').val());

                countAllTotal();
                ClearItems();

            }
            //$('#BillNo').removeClass('Valid');
            $('#WONO').select2();
            $('#WOYear').select2();
            $('#RsNo').select2();
            $('#RsYear').select2();
            $('#ParentRsNo').select2();
            $('#OriginalPartCode').select2();
            $('#OriginalItemName').select2();
            $('#FromStore').select2();
            $('#AltPartCode').select2();
            $('#AltItemName').select2();
            $('#AltItemName').select2();
            $('#ToStore').select2();

            $('#totalRows').text($('#divStockRegisterBody tr').length);
            FillLedgerName();
            // if ($("#Mode").val() !== "U") {
            //     FillLedgerName();
            // }

            var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ")[0]);
            $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", EntryDate);

            $('#BillDate').datepicker({ dateFormat: 'dd/mm/yy' });

            if ($('#Mode').val() == "U") {

                var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ")[0]);
                $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", EntryDate);

                $('#BillDate').datepicker({ dateFormat: 'dd/mm/yy' });
            }

            var previousValue = $("#LedgerName").val(); // Store initial value

            $("#LedgerName").change(function () {
                //GetAllDataAccountCodeWise();
            });

            $('.submitBTN').click(function (e) {
                validateBalance();
                if (!validateBalance()) {
                    e.preventDefault();
                }
                $('form').submit();
            });

        });

       

       

        function GetOpeningAmt() {

            var OpeningYearCode = $('#OpeningYearCode').val();
            var AccountCode = $('#AccountCode').val();
            $('#AccountCode').val(AccountCode);
            $.ajax({
                url: '@Url.Action("GetOpeningAmt", "LedgerPartyWiseOpening")',
                type: 'POST',
                data: {
                    OpeningYearCode: OpeningYearCode,
                    AccountCode: AccountCode
                },
                async: false,
                success: function (data, status, xhr) {
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {


                        $('#Balance').val(obj.Result[0].Amount || 0);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load opening amount.');
                }
            });
        }
        function GetOpeningAmtDRCR() {
            var OpeningYearCode = $('#OpeningYearCode').val();
            var AccountCode = $('#AccountCode').val();
            $.ajax({
                url: '@Url.Action("GetOpeningAmt", "LedgerPartyWiseOpening")',
                type: 'POST',
                data: {
                    OpeningYearCode: OpeningYearCode,
                    AccountCode: AccountCode
                },
                async: false,
                success: function (data, status, xhr) {
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {

                        $('#DRCR').val(obj.Result[0].DrCr || 0);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load opening amount.');
                }
            });
        }
       
        function FillLedgerName() {
            var OpeningYearCode = $('#OpeningYearCode').val();
            var Mode = $('#Mode').val();
            $.ajax({
                url: '@Url.Action("FillLedgerName", "LedgerPartyWiseOpening")',
                type: 'POST',
                data: { OpeningYearCode: OpeningYearCode },
                async: false,
                success: function (response, status, error) {
                    var StoreTypeDropdown = $('#LedgerName');
                    var obj = $.parseJSON(response);
                    StoreTypeDropdown.empty();
                    StoreTypeDropdown.append('<option value="">--Select--</option>');
                    $.each(obj.Result, function (index, LedgerName) {
                        StoreTypeDropdown.append('<option value="' + LedgerName.Account_Code + '">' + LedgerName.Account_Name + '</option>');
                    });

                    if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                      
                        //$('#LedgerName').val(LedgerName).trigger("change");
                        $('#LedgerName').val(LedgerName);
                        GetOpeningAmt();
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

       
        function ClearItems() {
            $('#BillYear,#BillNetAmt,#PendAmt').val(0);
            $('#BillNo,#BillDate,#Type,#TransactionType,#DueDate,#Unit').val('');
        }

      


        function TotalNoOfRows() {
            var Row = $('#divStockGrid tr').length;
            var tdCount = $('#divStockGrid tr td').length;
            $('#lblTotalNoOfBelowItems').text(tdCount >= 1 ? Row : 0);
        }
        function ClearGrid() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("ClearGrid")",
                success: function (result, status, error) {
                    $('#divStockGrid').empty();
                    var NoData = '<tr class="text-center"><td colspan="32" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
                    $('#divStockGrid').html(NoData);
                    // BasicTotal();
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        }
        function CheckBeforeUpdate() {
            $.ajax({
                url: '@Url.Action("CheckBeforeUpdate")',
                type: "POST",
                data: { Type: $('#Entry_id').val() },
                success: function (data) {
                    var obj = $.parseJSON(data);
                    if (obj.Result?.Table[0]?.Column1 > 0) {
                        $.notify("You cannot update this Category as Item with this category already exists", "error");
                    } else {
                        $('form').submit();
                    }
                },
                error: function (response) {
                    alert(response.responseText);
                }
            });
        }

        var EditEachItem = false;

        function EditItemRow(SrNO) {

            if (EditEachItem) {
                $.notify('Cannot edit item while another item is being added to the grid!', "error");
                return;
            }

            $.ajax({
                url: '@Url.Action("EditItemRow")',
                type: "POST",
                data: { SrNO: SrNO, Mode: "U" },
                success: function (data) {
                    var obj = $.parseJSON(data);
                    if (obj != null) {
                        EditEachItem = true;

                        $('#BillNo').val(obj[0].BillNo).trigger("change");
                        $('#BillDate').val(obj[0].BillDate).trigger("change");
                        $('#BillYear').val(obj[0].BillYear).trigger("change");
                        $('#BillNetAmt').val(obj[0].BillNetAmt).trigger("change");
                        $('#PendAmt').val(obj[0].PendAmt).trigger("change");
                        $('#Type').val(obj[0].Type).trigger("change");
                        $('#TransactionType').val(obj[0].TransactionType).trigger("change");
                        $('#DueDate').val(obj[0].DueDate).trigger("change");
                        $('#Unit').val(obj[0].Unit).trigger("change");
                        //$('#EntryDate').val(obj[0].EntryDate).trigger("change");
                        $('#U_S').val(obj[0].U_S).trigger("change");
                        $('#Adjustment').val(obj[0].Adjustment).trigger("change");
                        //$('#SrNO').val(obj[0].SrNO).trigger("change");
                        // var currentSrNo = $('#SrNO').val();
                        // var newSrNo = obj[0].SrNO;
                        // if (currentSrNo !== newSrNo) {
                        //     $('#SrNO').val(newSrNo).trigger("change");
                        // }
                        var rowCount = $('#divStockGrid tr').length;
                        for (var i = 1; i <= rowCount + 1; i++) {
                            $('#editItemGrid-' + i).css("pointer-events", "none");
                            $('#editItemGrid-' + i).css("cursor", "not-allowed");
                        }

                        DeleteItemRow(SrNO);
                    }
                },
                error: function (response) {
                    $.notify(response.responseText, "error");
                }
            });
        }
        async function DeleteItemRow(SrNO) {

            $.ajax({
                url: '@Url.Action("DeleteItemRow")',
                type: "POST",
                data: { SrNO: SrNO, Mode: "U" },
                success: function (data, status, xhr) {
                    $('#divStockGrid').html(data);
                    $.notify("Process deleted from Grid", "info");
                    // EditEachItem = false;
                    // $('[id^=editItemGrid-]').css("pointer-events", "auto");
                    // $('[id^=editItemGrid-]').css("cursor", "pointer");

                    // setTimeout(function () {
                    //     $('[id^=editItemGrid-]').css("pointer-events", "auto").css("cursor", "pointer");
                    // }, 100);

                },
                error: function (response, status, xhr) {

                    $.notify("Cannot delete item that exists in Tax Grid!!!", "error");
                },
                failure: function (response, status, xhr) {
                    alert(response.responseText);
                    $.notify(response.responseText, "error");
                }
            });
        }
        //var editingNow = false;

        // function EditItemRow(SrNO) {
        //
        //     if (!editingNow) {
        //         return new Promise((resolve, reject) => {
        //             $.ajax({
        //                 url: '@Url.Action("EditItemRow")',
        //                 type: "POST",
        //                 data: { SeqNo: SrNO, Mode: "U" }
        //             })
        //                 .done(function (data) {
        //                     editingNow = true;
        //                     var obj = $.parseJSON(data);
        //                     DeleteItemRow(SrNO)
        //                         .then(() => {
        //                             $('#BillNo').val(obj[0].BillNo).trigger('change');
        //                             $('#BillDate').val(obj[0].BillDate).trigger('change');
        //                             $('#BillYear').val(obj[0].BillYear).trigger('change');
        //                             $('#BillNetAmt').val(obj[0].BillNetAmt).trigger('change');
        //                             $('#PendAmt').val(obj[0].PendAmt).trigger('change');
        //                             $('#Type').val(obj[0].Type).trigger('change');
        //                             $('#TransactionType').val(obj[0].TransactionType).trigger('change');
        //                             $('#DueDate').val(obj[0].DueDate).trigger('change');
        //                             $('#Unit').val(obj[0].Unit).trigger('change');
        //                             $('#EntryDate').val(obj[0].EntryDate).trigger('change');
        //                             $('#U_S').val(obj[0].U_S).trigger('change');
        //                             $('#Adjustment').val(obj[0].Adjustment).trigger('change');

        //                             var currentSrNo = $('#SrNO').val();
        //                             var newSrNo = obj[0].SrNO;
        //                             if (currentSrNo !== newSrNo) {
        //                                 $('#SrNO').val(newSrNo).trigger('change');
        //                             }
        //                         })
        //                         .catch(reject);
        //                 })
        //                 .fail(reject);
        //             $.notify("Item Updated from Grid", "info");
        //         });
        //     } else {
        //         $.notify("Cannot edit as one item is already on above edit grid", "error");
        //     }
        // }

        function PressBack() {
            sessionStorage.setItem('FromDateBack', $('#FromDateBack').val());
            sessionStorage.setItem('ToDateBack', $('#ToDateBack').val());
            sessionStorage.setItem('GroupNameBack', $('#GroupNameBack').val());
            sessionStorage.setItem('LedgerNameBack', $('#LedgerNameBack').val());
            sessionStorage.setItem('OpeningYearCodeBack', $('#OpeningYearCodeBack').val());
            sessionStorage.setItem('PreviousAmountBack', $('#PreviousAmountBack').val());
            sessionStorage.setItem('DrCrBack', $('#DrCrBack').val());
            sessionStorage.setItem('GlobalSearchBack', $('#GlobalSearchBack').val());

            window.history.back();
        }
    </script>
}



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>




