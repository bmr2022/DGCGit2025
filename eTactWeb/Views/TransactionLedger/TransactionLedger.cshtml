@model eTactWeb.DOM.Models.TransactionLedgerModel;
@{
	ViewData["Title"] = "TransactionLedger";
	Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
@{
	var dynamicTitle = Model.ReportType; 
}
<style>

	.select2-container--default .select2-selection--single {
		background-color: #e0f2f1;
		border: 1.5px solid #0a0a0a !important;
		border-radius: 4px;
	}

		.select2-container--default .select2-selection--single .select2-selection__rendered {
			/* border-bottom: 1.5px solid #000 !important; */
			border-bottom: none !important;
		}

	.select2-container--default .select2-results > .select2-results__options {
		background-color: #e0f2f1; /* Dropdown background color */
		color: #000;
</style>
<head>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<div class="card bg-gradient mb-3 border-light shadow-lg">

	<div class="card-header card-headerBG text-light bg-gradient">
		<h5>
			<strong>Transaction Ledger</strong>
			<span class="d-flex float-end" style="margin-top:-2px;">
			</span>
		</h5>
	</div>
	<div>
	</div>
	<div class="card-body bg-light pt-0">
		<div class="accordion shadow-lg">
			<div class="card-body">
				<div class="card overflow-auto">
					<div class="card-body">
						<form id="SParam">
							<div class="row">
								<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-12 col-xs-12">
									<div class="row">
										<div class="col">
											<label class="form-label">From Date</label>
											<input asp-for="FromDate" class="form-control" />
										</div>
										<div class="col">
											<label class="form-label">To Date</label>
											<input asp-for="ToDate" class="form-control" />
										</div>
									</div>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:250px;">
									<label asp-for="ReportType" class="form-label" style="font-weight:bold">Report Type</label>
									<select class="form-control custom-select2" asp-for="ReportType">
										<option value="">-Select-</option>
										<option value="TransactionLedgerSummary" selected>Transaction Ledger Summary</option>
										<option value="MonthlySummary">Monthly Summary</option>
										<option value="TransactionLedgerDetail">Transaction Ledger Detail</option>
										<option value="GROUPSUMMARY">Group Transaction Summary</option>
										<option value="GROUPDETAIL">Group Transaction Detail</option>
										<option value="BalanceConfirmation">Balance Confirmation</option>
									</select>
								</div>
								<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12" style="width:100px;">
									<label asp-for="Group_Ledger" class="form-label">Group/Ledger</label>
									<select asp-for="Group_Ledger" id="Group_Ledger" class="form-select">
										<option value="Group">Group</option>
										<option value="Ledger">Ledger</option>
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
									<label asp-for="ParentLedgerName" class="form-label">Parent Ledger List</label>
									<input asp-for="ParentAccountCode" class="form-control" type="hidden" value="@Model.AccountCode" />
									<select asp-for="ParentLedgerName" class="form-control">
										<option value="@Model.ParentAccountCode">-Select-</option>
										@if (Model.Mode == "U" || Model.Mode == "V")
										{
											<option value="@Model.ParentAccountCode" selected>@Model.ParentLedgerName</option>
										}
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
									<label asp-for="LedgerName" class="form-label" id="LedgerNameMain">Ledger List*</label>
									<input asp-for="AccountCode" class="form-control" type="hidden" value="@Model.AccountCode" />
									<select asp-for="LedgerName" class="form-control">
										<option value="@Model.AccountCode">-Select-</option>
										@if (Model.Mode == "U" || Model.Mode == "V")
										{
											<option value="@Model.AccountCode" selected>@Model.LedgerName</option>
										}
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:140px;">
									<label asp-for="VoucherType" class="form-label">Voucher Type</label>
									<select asp-for="VoucherType" class="form-control">
										<option value="@Model.VoucherType">-Select-</option>
										</select>
									@* <input asp-for="VoucherType" class="form-control" /> *@
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:140px;">
									<label asp-for="VoucherNo" class="form-label">Voucher No</label>
									<input asp-for="VoucherNo" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:120px;">
									<label asp-for="INVNo" class="form-label">INV No</label>
									<input asp-for="INVNo" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:120px;">
									<label asp-for="Narration" class="form-label">Narration</label>
									<input asp-for="Narration" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:120px;">
									<label asp-for="Amount" class="form-label">Amount</label>
									<input asp-for="Amount" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:120px;">
									<label asp-for="Dr" class="form-label">Dr</label>
									<input asp-for="Dr" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="width:120px;">
									<label asp-for="Cr" class="form-label">Cr</label>
									<input asp-for="Cr" class="form-control" />
								</div>

								<div class="col-sm-2 col-md-6 col-lg-4 col-xl-2">
									<label class="form-label">Global search</label>
									<input type="text" class="form-control" id="search-box" style="background-color:#FFFACD" placeholder="Search...">
								</div>

								<div class=" d-flex justify-content-center   mt-3 col-sm-5 col-md-8 col-lg-6 col-xl-4" width="inherit">

									<button class="btn btn-sm btn-outline-info" type="button" style="padding:0px;height:30px;width:100px;" onclick="validateAndFetchData();">
										<i class="fa-solid fa-magnifying-glass fa-fw fa-lg"></i>SEARCH
									</button>
									<button class="btn btn-sm btn-outline-success" style="padding:3px;height:30px;width:100px;margin-left:20px;" type="button" id="sendToExcel">
										<i class="fa-solid fa-upload fa-fw fa-lg "></i>EXCEL
									</button>
									<a class="btn btn-sm btn-outline-danger" style="padding:3px;height:30px;width:100px;margin-left:20px;" asp-controller="TransactionLedger" asp-action="TransactionLedger">
										<i class="fa-solid fa-rotate fa-fw fa-lg"></i>RESET
									</a>
									<a href="#" class="btn btn-primary btn-sm ms-3" onclick="PressBack();" id="BackButton">
										<i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
										BACK
									</a>
								</div>
								<div asp-validation-summary="ModelOnly" class="text-danger"></div>
							</div>
							<div class="progress my-2 mb-3" style="height: 4px;">
								<div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
							</div>
							<div class="accordion-item">
								<h2 class="accordion-header" id="H_SAGrid">
									<button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
										<strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i><span id="reportTitle">Transaction Ledger Summary</span> Grid</strong>
									</button>
								</h2>

								<div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradientn show" aria-labelledby="H_SAGrid">
									<div class="accordion-body">
										<div class="card-body" id="divPendingMRP">
											<div class="row">
												<div class="col-md-12 divStockRegister" id="divStockMainRegister">
													<partial name="_TransactionLedgerGrid" />
												</div>
											</div>
											<div class="d-flex justify-content-end mt-2 " style="margin-right:400px;">
												<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12 ms-2" id="opnDRDiv" style="width:150px;">
													<label class="form-label">Total Dr Amt</label>
													<input id="totDr" class="form-control" readonly />
												</div>
												<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12" id="opnCRDiv" style="width:150px;margin-left:10px;">
													<label class="form-label">Total Cr Amt</label>
													<input id="totCr" class="form-control" readonly />
												</div>
												<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12 ms-2" id="opnTBDiv" style="width:150px;">
													<label class="form-label">Total Balance</label>
													<input id="totBal" class="form-control" readonly />
												</div>
											</div>

											<div class="d-flex justify-content-end mt-2 " style="margin-right:400px;">
												<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12 ms-2" id="totalOpening" style="width:150px;">
													<label class="form-label">Total Opening</label>
													<input id="totOpen" class="form-control" readonly />
												</div>
												<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12" id="netCurrentAmt" style="width:150px;margin-left:10px;">
													<label class="form-label">Net Current Amt</label>
													<input id="netCurrentAmt" class="form-control" readonly />
												</div>
												<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12 ms-2" id="netAmount" style="width:150px;">
													<label class="form-label">Net Amount</label>
													<input id="netAmt" class="form-control" readonly />
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>


</div>

@section Scripts
{
	<script>

		 $(document).ready(function () {
			debugger  
			 console.log("Ready");
			 var currentDate = new Date();
			 var firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
			 $('#totalRows').text($('#divStockRegisterBody tr').length);
			 $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", formatDate1(firstDayOfMonth));
			 $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
			 $('#LedgerName').select2();
			 $('#ParentLedgerName').select2();
			 $('#ReportType').select2();
			 $('#VoucherType').select2();
			 $('#Group_Ledger').select2();
			$('#totalOpening').hide();
			$('#netCurrentAmt').hide();
			$('#netAmount').hide();
			 var currentDate = new Date();
			 var firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
			 FillLedgerName();
			 updateGroupLedger();
			 FillVoucherName();
			 FillParentLedgerName();
			let accountName = sessionStorage.getItem('AccountName');
			let reportType = sessionStorage.getItem('ReportType');
			let parentCode = sessionStorage.getItem('ParentCode');
			
			if (reportType) {
				$('#ReportType').val(reportType).trigger('change');
				$('#BackButton').show();
			}

			if (parentCode) {
				$('#ParentLedgerName').val(parentCode).trigger('change');
				$('#BackButton').show();
			}

			if (accountName) {
				$('#LedgerName').val(accountName).trigger('change');
				$('#BackButton').show();
			}

			// Optional: clear the storage if no longer needed
			sessionStorage.removeItem('AccountName');
			sessionStorage.removeItem('ReportType');
			sessionStorage.removeItem('ParentCode');
			 var LedgerNameBack= sessionStorage.getItem('LedgerNameBack')
			 if (LedgerNameBack != null  &&  LedgerNameBack != ''){
			  $('#FromDate').val(sessionStorage.getItem('FromDateBack'));
						 $('#ToDate').val(sessionStorage.getItem('ToDateBack'));
			$('#ReportType').val(sessionStorage.getItem('ReportTypeBack'));
			$('#Group_Ledger').val(sessionStorage.getItem('GroupLedgerBack'));
			$('#ParentLedgerName').val(sessionStorage.getItem('ParentLedgerNameBack'));
			$('#LedgerName').val(sessionStorage.getItem('LedgerNameBack'));
			$('#VoucherType').val(sessionStorage.getItem('VoucherTypeBack'));
			$('#VoucherNo').val(sessionStorage.getItem('VoucherNoBack'));
			$('#INVNo').val(sessionStorage.getItem('INVNoBack'));
			$('#Narration').val(sessionStorage.getItem('NarrationBack'));
			$('#Amount').val(sessionStorage.getItem('AmountBack'));
			$('#Dr').val(sessionStorage.getItem('DrBack'));
			$('#Cr').val(sessionStorage.getItem('CrBack'));
			$('#search-box').val(sessionStorage.getItem('GlobalSearchBack'));
			$('#AccountCode').val($('#LedgerName').val());
				GetDetailsData();
			}
				sessionStorage.removeItem('FromDateBack');
				sessionStorage.removeItem('ToDateBack');
				sessionStorage.removeItem('ReportTypeBack');
				sessionStorage.removeItem('GroupLedgerBack');
				sessionStorage.removeItem('ParentLedgerNameBack');
				sessionStorage.removeItem('LedgerNameBack');
				sessionStorage.removeItem('VoucherTypeBack');
				sessionStorage.removeItem('VoucherNoBack');
				sessionStorage.removeItem('INVNoBack');
				sessionStorage.removeItem('NarrationBack');
				sessionStorage.removeItem('AmountBack');
				sessionStorage.removeItem('DrBack');
				sessionStorage.removeItem('CrBack');
				sessionStorage.removeItem('GlobalSearchBack');

			 $('#BackButton').hide();
				 var dynamicTitle = "Sales Invoice Ledger"; // Example dynamic value
				$('#ledgerTitle').text(dynamicTitle);
		 });

				 $('#ReportType').on('change', function () {
			var selectedText = $(this).find("option:selected").text();
			$('#reportTitle').text(selectedText === "-Select-" ? "Report" : selectedText);
		});
		   function BackButtonData(event) {

			event.preventDefault();

		sessionStorage.setItem('FromDateBack', $('#FromDate').val());
		sessionStorage.setItem('ToDateBack', $('#ToDate').val());
		sessionStorage.setItem('ReportTypeBack', $('#ReportType').val());
		sessionStorage.setItem('GroupLedgerBack', $('#Group_Ledger').val());
		sessionStorage.setItem('ParentLedgerNameBack', $('#ParentLedgerName').val());
		sessionStorage.setItem('LedgerNameBack', $('#LedgerName').val());
		sessionStorage.setItem('VoucherTypeBack', $('#VoucherType').val());
		sessionStorage.setItem('VoucherNoBack', $('#VoucherNo').val());
		sessionStorage.setItem('INVNoBack', $('#INVNo').val());
		sessionStorage.setItem('NarrationBack', $('#Narration').val());
		sessionStorage.setItem('AmountBack', $('#Amount').val());
		sessionStorage.setItem('DrBack', $('#Dr').val());
		sessionStorage.setItem('CrBack', $('#Cr').val());
		sessionStorage.setItem('GlobalSearchBack', $('#search-box').val());

			var urlHref = $(event.currentTarget).attr("href");
			var linkUrl = urlHref;
			window.location.href = linkUrl;
		}
		    function confirmEdit(event) {
            event.preventDefault();
			sessionStorage.setItem('FromDateBack', $('#FromDate').val());
		sessionStorage.setItem('ToDateBack', $('#ToDate').val());
		sessionStorage.setItem('ReportTypeBack', $('#ReportType').val());
		sessionStorage.setItem('GroupLedgerBack', $('#Group_Ledger').val());
		sessionStorage.setItem('ParentLedgerNameBack', $('#ParentLedgerName').val());
		sessionStorage.setItem('LedgerNameBack', $('#LedgerName').val());
		sessionStorage.setItem('VoucherTypeBack', $('#VoucherType').val());
		sessionStorage.setItem('VoucherNoBack', $('#VoucherNo').val());
		sessionStorage.setItem('INVNoBack', $('#INVNo').val());
		sessionStorage.setItem('NarrationBack', $('#Narration').val());
		sessionStorage.setItem('AmountBack', $('#Amount').val());
		sessionStorage.setItem('DrBack', $('#Dr').val());
		sessionStorage.setItem('CrBack', $('#Cr').val());
		sessionStorage.setItem('GlobalSearchBack', $('#search-box').val());
            var urlHref = $(event.currentTarget).attr("href");
            var linkUrl = urlHref;
         
            window.location.href = linkUrl;
        }

		function formatDate(date) {
				  var day = ("0" + date.getDate()).slice(-2);
				  var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				  var month = monthNames[date.getMonth()];
				  var year = date.getFullYear();
				  return day + "/" + month + "/" + year;
		   }

		function GetMonthWiseData(monthly)
		  {
			 var Monthly = monthly;
			 var monthNames = [
				"January", "Feburary", "March", "April", "May", "June",
				"July", "Aug", "September", "October", "November", "December"
			 ];

			var monthIndex = monthNames.indexOf(monthly);
			if (monthIndex === -1) {
				alert("Invalid month name: " + monthly);
				return;
			}
			var currentYear = new Date().getFullYear(); // You can change this logic if needed
			var firstDayOfMonth = new Date(currentYear, monthIndex, 1);
			var lastDayOfMonth = new Date(currentYear, monthIndex + 1, 0);

			$('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", formatDate1(firstDayOfMonth));
			$('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", formatDate1(lastDayOfMonth));
			if ($("#ReportType option[value='TransactionLedgerSummary']").length === 0) {
					$('#ReportType').append(new Option('Transaction Ledger Summary', 'TransactionLedgerSummary'));
			}

			$('#ReportType').val('TransactionLedgerSummary').trigger('change');
			GetDetailsData();
			$('#BackButton').show();
		  }

		   function PressBack() {
				$('#ReportType').val('MonthlySummary').trigger('change');
				GetTransactionLedgerMonthlySummaryDetailsData();
				$('#BackButton').hide(); // Hide back button
			}

		$('#ParentLedgerName').change(function () {
			FillLedgerName();
		})

		function FillVoucherName() {
			var FromDate = $('#FromDate').val();
			var ToDate = $('#ToDate').val();
			$.ajax({
				url: '@Url.Action("FillVoucherName", "TransactionLedger")', // Action that returns FillGroup data
				/* data: {
					FromDate: FromDate,
					ToDate: ToDate
				}, */
				type: 'GET',
				async: false,
				success: function (response, status, error) {

					var VoucherTypeDropdown = $('#VoucherType');
					var obj = $.parseJSON(response);
					VoucherTypeDropdown.empty();
					VoucherTypeDropdown.append('<option value="">--Select--</option>');

					$.each(obj.Result, function (index, Voucher) {

						VoucherTypeDropdown.append('<option value="' + Voucher.vouchertype + '">' + Voucher.vouchertype + '</option>');
					});

				},
				error: function (xhr, status, error) {
					alert('Failed to load groups.');
				}
			});
		}

		 function updateGroupLedger() {

			 var selectedReport = $("#ReportType").val().trim();
			 var ledgerReports = ["TransactionLedgerSummary", "MonthlySummary", "TransactionLedgerDetail"];
			var groupReports = ["GROUPSUMMARY", "GROUPDETAIL", "BalanceConfirmation"];

			 if (ledgerReports.includes(selectedReport)) {
				 $("#Group_Ledger").val("Ledger").change();;
			 } else if (groupReports.includes(selectedReport)) {
				 $("#Group_Ledger").val("Group").change();;
			 } else {
				 $("#Group_Ledger").val("");
			 }
			 console.log("Updated Group_Ledger value:", $("#Group_Ledger").val());
		 }

		 $('#LedgerName').change(function () {
			 $('#AccountCode').val($('#LedgerName').val());
		 });
		 $('#ParentLedgerName').change(function () {
			 $('#ParentAccountCode').val($('#ParentLedgerName').val());
		 });
		function validateAndFetchData() {
			 ;
			var selectedReport = $('#ReportType').val().trim();
			var accountCode = $('#AccountCode').val();
			var ledgerDropdown = $('#LedgerNameMain');

			// Report types jema AccountCode mandatory che
			var reportTypesToCheck = ["TransactionLedgerSummary", "TransactionLedgerDetail"];

			// Report types jema Group summary call karvanu che
			var groupReportTypes = ["GROUPSUMMARY", "GROUPDETAIL"];

			if (reportTypesToCheck.includes(selectedReport) && (!accountCode || accountCode === '0')) {
				$.notify('Account Code is mandatory to display details data', "error");
				ledgerDropdown.css('color', 'red');
			} else {
				if (groupReportTypes.includes(selectedReport)) {
					GetTransactionLedgerGroupSummaryDetailsData();
				} else {
					GetDetailsData();
				}
				ledgerDropdown.css('color', 'black');
			}
		}

		 $('#LedgerName').change(function () {
			 validateAndFetchData();
		 });

		 $("#ReportType").change(updateGroupLedger);
		 $('#ReportType').change(function () {
			 validateAndFetchData();
		 });
		 function selection(CurrentRow) {

			 $(CurrentRow).css({ 'background-color': '#00bcd4' });
			 $("#divStockRegisterBody tr").not(CurrentRow).css({ 'background-color': 'blanchedalmond' });
		 }

		function FillLedgerName() {

			 //var FromDate = $('#FromDate').val();
			 //var ToDate = $('#ToDate').val();
			 $.ajax({
				 url: '@Url.Action("GetLedgerName", "TransactionLedger")',
				 type: 'GET',
				 async: false,
				 success: function (response, status, error) {

					 var ledgerNameDropdown = $('#LedgerName');
					 var obj = $.parseJSON(response);
					 ledgerNameDropdown.empty();
					 ledgerNameDropdown.append('<option value="">--Select--</option>');

					 $.each(obj.Result, function (index, ledger) {
						 ledgerNameDropdown.append('<option value="' + ledger.Account_Code + '">' + ledger.LedgerName + '</option>');
					 });

				 },
				 error: function (xhr, status, error) {
					 alert('Failed to load groups.');
				 }
			 });
		 }
		function FillParentLedgerName() {

			 //var FromDate = $('#FromDate').val();
			 //var ToDate = $('#ToDate').val();
			 $.ajax({
				 url: '@Url.Action("FillLedgerName", "TransactionLedger")',
				 type: 'GET',
				 async: false,
				 success: function (response, status, error) {

					 var ledgerNameDropdown = $('#ParentLedgerName');
					 var obj = $.parseJSON(response);
					 ledgerNameDropdown.empty();
					 ledgerNameDropdown.append('<option value="">--Select--</option>');

					 $.each(obj.Result, function (index, ledger) {
						 ledgerNameDropdown.append('<option value="' + ledger.Account_Code + '">' + ledger.ParentLedger + '</option>');
					 });


				 },
				 error: function (xhr, status, error) {
					 alert('Failed to load groups.');
				 }
			 });
		 }

		 function GetDetailsData() {
			  
			 var ReportType = $('#ReportType').val();
			 var FromDate = $('#FromDate').val();
			 var ToDate = $('#ToDate').val();
			 var AccountCode = $('#AccountCode').val();
			var Ledger = $('#ParentLedgerName').val();
			var VoucherType = $('#VoucherType').val();
			 if (ReportType === "MonthlySummary") {
				if ($('#LedgerName').val() == "TransactionLedgerSummary" || $('#LedgerName').val() == "TransactionLedgerDetail" ) {
					 $.notify('Account Code is mandatory to display details data', "error");
				 }
				else if ($('#ReportType').val() == "GROUPSUMMARY" || $('#ReportType').val() == "GROUPDETAIL") {
					 GetTransactionLedgerGroupSummaryDetailsData();
				 }
				 else{
					 GetTransactionLedgerMonthlySummaryDetailsData();
				 }
			 }
			 else {

				   $.ajax({
					 type: 'POST',
					 url: '@Url.Action("GetDetailsData", "TransactionLedger")',
					 data: {
						 "FromDate": FromDate,
						 "ToDate": ToDate,
						 "AccountCode": AccountCode,
						 "ReportType": ReportType,
						  "Ledger" : Ledger,
						"VoucherType" : VoucherType,
					 },
					 success: function (response) {
						 $('#divStockMainRegister').html(response);
						$('#opnDRDiv').show();
						$('#opnCRDiv').show();
						$('#opnTBDiv').show();
						$('#totalOpening').hide();
						$('#netCurrentAmt').hide();
						$('#netAmount').hide();
						 var totalRows = $('#divStockMainRegister tr').length;
						 $('#totalRows').text(totalRows);
						 countAllTotal();
					 },
					 error: function (xhr, status, error) {
						 console.error("Error fetching BOM tree data:", error);
					 }
				   });
			 }
		 }
		 function GetTransactionLedgerMonthlySummaryDetailsData() {

			 var FromentryDate = $('#FromDate').val();
			 var ToEntryDate = $('#ToDate').val();
			 var AccountCode = $('#AccountCode').val();
			 //var VoucherType = $('#VoucherType').val();
			 //var CrAmt = $('#CrAmt').val();
			 //var DrAmt = $('#DrAmt').val();

				 $.ajax({
				 type: 'POST',
				 url: '@Url.Action("GetTransactionLedgerMonthlySummaryDetailsData", "TransactionLedger")',
				 data: {
					 FromentryDate: FromentryDate,
					 ToEntryDate: ToEntryDate,
					 AccountCode: AccountCode,
					 //CrAmt: CrAmt,
					 //DrAmt: DrAmt
				 },
				 success: function (response) {
					 $('#divStockMainRegister').html(response);

					 var totalRows = $('#divStockMainRegister tr').length;
					 $('#totalRows').text(totalRows);
					 countAllTotal();
				 },
				 error: function (xhr, status, error) {
					 console.error("Error fetching BOM tree data:", error);
				 }
			 });

		 }

		function GetTransactionLedgerGroupSummaryDetailsData() {

			var FromDate = $('#FromDate').val();
			var ToDate = $('#ToDate').val();
			var ReportType = $('#ReportType').val();
			var LedgerGroup = parseInt($('#ParentLedgerName').val());
			var AccountCode = parseInt($('#LedgerName').val());
			var VoucherType = $('#VoucherType').val();

			$.ajax({
				type: 'POST',
				url: '@Url.Action("GetTransactionLedgerGroupSummaryDetailsData", "TransactionLedger")',
				data: {
					FromDate: FromDate,
					ToDate: ToDate,
					ReportType : ReportType,
					LedgerGroup:LedgerGroup,
					AccountCode: AccountCode,
					VoucherType: VoucherType
				},
				success: function (response) {
					$('#divStockMainRegister').html(response);
					$('#opnDRDiv').hide();
					$('#opnCRDiv').hide();
					$('#opnTBDiv').hide();
					$('#totalOpening').show();
					$('#netCurrentAmt').show();
					$('#netAmount').show();
					var totalRows = $('#divStockMainRegister tr').length;
					$('#totalRows').text(totalRows);
					countGroupAllTotal();
				},
				error: function (xhr, status, error) {
					console.error("Error fetching BOM tree data:", error);
				}
			});

		}

		 function DeleteRow(i) {

			 var indexToRemove = i - 1;
			 $('#SAGridRow-' + i).remove();
			 $('#ReportTable tbody tr').each(function (index) {
				 $(this).attr('id', 'SAGridRow-' + (index + 1));


				 $(this).find('td:first-child a:first-child').each(function (tdIndex) {
					 $(this).attr('id', (index + 1));
				 });

				 $(this).find('td[id^="amount-"]').each(function (tdIndex) {
					 $(this).attr('id', 'amount-' + (index + 1));
				 });

			 });
			 countAllTotal();
			 $('#totalRows').text($('#divStockMainRegister tr').length - 1);
		 }

		 function GetServerDate() {
			 $.ajax({
				 type: "GET",
				 url: "@Url.Action("GetServerDate")",
				 async: false,
				 success: function (result, status, error) {
					 console.log(result);
					 if (result != null) {
						 // $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);
						 //$('#InvoiceDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);

						 var firstDayOfMonth = getFirstDayOfMonth(result);
						 $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", firstDayOfMonth);

						 $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);

					 }
				 }
			 });
		 }

		 function getFirstDayOfMonth(dateString) {
			 const [day, month, year] = dateString.split('/');

			 // Create a new Date object (months are 0-indexed, so subtract 1 from the month)
			 const currentDate = new Date(year, month - 1, day);

			 // Set the date to the 1st day of the month
			 currentDate.setDate(1);

			 // Format the result as dd/mm/YYYY
			 const firstDayOfMonth = `${currentDate.getDate().toString().padStart(2, '0')}/${(currentDate.getMonth() + 1).toString().padStart(2, '0')}/${currentDate.getFullYear()}`;

			 return firstDayOfMonth;
		 }

		 $('#sendToExcel').click(function () {
			 let table = $("#ReportTable");
			 console.log(table);
			 TableToExcel.convert(table[0], {
				 name: `ReportTable.xlsx`,
				 sheet: {
					 name: 'ReportTable'
				 }
			 });
		 });
		 function formatDate1(date) {
			 var day = ("0" + date.getDate()).slice(-2);
			 var month = ("0" + (date.getMonth() + 1)).slice(-2);
			 var year = date.getFullYear();
			 var dateString = day + "/" + month + "/" + year;
			 return dateString;
		 }

		 $(document).on("click", ".sortCol", function () {
			 ;
			 var $column = $(this).parent().closest("th");
			 var colno = $(this).data('columnno');
			 var currentOrder = $(this).data('sortorder');

			 $('.sortCol').css('color', 'white');
			 if (currentOrder === 'asc') {
				 sortTable(colno, false);
				 $(this).data('sortorder', 'desc');
				 $(this).css('color', 'yellow'); // Visual indication of descending order
				 //$(this).css('font-size', 'larger'); // Visual indication of descending order
				 $(this).find('i:first').removeClass('fa-arrow-up');
				 $(this).find('i:first').addClass('fa-arrow-down');
			 } else {
				 sortTable(colno, true);
				 $(this).data('sortorder', 'asc');
				 $(this).css('color', 'yellow');
				 // $(this).css('font-size', 'larger'); // Visual indication of ascending order
				 $(this).find('i:first').removeClass('fa-arrow-down');
				 $(this).find('i:first').addClass('fa-arrow-up');
			 }
		 });

		 function sortTable(columnIndex, ascending) {

			 var table = $('#ReportTable');
			 var rows = table.find('#divStockRegisterBody > tr').toArray();

			 rows.sort(function (a, b) {
				 var aValue = $(a).find('td').eq(columnIndex).text();
				 var bValue = $(b).find('td').eq(columnIndex).text();

				 var aIntValue = 0;
				 var bIntValue = 0;
				 if (/^\d*\.?\d+$/.test(aValue) && /^\d*\.?\d+$/.test(bValue)) {
					 aIntValue = parseInt(aValue, 10);
					 bIntValue = parseInt(bValue, 10);
				 }

				 if (aIntValue > 0) {
					 if (ascending) {
						 return aValue - bValue;
					 } else {
						 return bValue - aValue;
					 }
				 } else {
					 if (ascending) {
						 return aValue.localeCompare(bValue);
					 } else {
						 return bValue.localeCompare(aValue);
					 }
				 }
			 });

			 $.each(rows, function (index, row) {
				 table.children('#divStockRegisterBody').append(row);
			 });
		 }
		function countAllTotal() {
			var rowCount = $('#divStockRegisterBody tr').length;

			var TotCr = 0;
			var TotDr = 0;

			for (var i = 1; i <= rowCount; i++) {
				TotCr += $('#totCrG-' + i).text() == '' ? 0 : parseFloat($('#totCrG-' + i).text());
				TotDr += $('#totDrG-' + i).text() == '' ? 0 : parseFloat($('#totDrG-' + i).text());
			}

			
			var TotBal = TotDr - TotCr;

			
			$('#totCr').val(0);
			$('#totDr').val(0);
			$('#totBal').val(0);

			
			$('#totCr').val(isNaN(TotCr) ? 0 : TotCr.toFixed(2));
			$('#totDr').val(isNaN(TotDr) ? 0 : TotDr.toFixed(2));
			$('#totBal').val(isNaN(TotBal) ? 0 : TotBal.toFixed(2));
		}


		function countGroupAllTotal() {

			var rowCount = $('#divStockRegisterBody tr').length;

			var TotOpen = 0;
			var NetCurrentAmt = 0;
			var NetAmt = 0;
			for (var i = 1; i <= rowCount; i++) {

				TotOpen += $('#TotOpen-' + i).text() == '' ? 0 : parseFloat($('#TotOpen-' + i).text());
				NetCurrentAmt += $('#NetCurrentAmt-' + i).text() == '' ? 0 : parseFloat($('#NetCurrentAmt-' + i).text());
				NetAmt += $('#NetAmt-' + i).text() == '' ? 0 : parseFloat($('#NetAmt-' + i).text());
			}


			$('#totOpen').val(isNaN(TotOpen) ? 0 : TotOpen.toFixed(2));
			$('#netCurrentAmt').val(isNaN(NetCurrentAmt) ? 0 : NetCurrentAmt.toFixed(2));
			$('#netAmt').val(isNaN(NetAmt) ? 0 : NetAmt.toFixed(2));
		}

		 var currentSearchColumn = null;

		 $("#search-box").on("keyup", function () {
			 var value = $(this).val().toLowerCase();
			 $("#divStockRegisterBody tr").filter(function () {
				 if (currentSearchColumn !== null) {
					 var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
					 $(this).toggle(columnText.indexOf(value) > -1);
				 } else {
					 $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
				 }
			 });
		 });

		 $(document).on("click", "th[data-columnno]", function () {
			 currentSearchColumn = $(this).data('columnno');
			 $("#search-box").val('').trigger('keyup'); // Reset search box and trigger the search
		 });




		 function DeleteRow(i) {

			 var indexToRemove = i - 1;
			 $('#SAGridRow-' + i).remove();
			 $('#ReportTable tbody tr').each(function (index) {
				 $(this).attr('id', 'SAGridRow-' + (index + 1));


				 $(this).find('td:first-child a:first-child').each(function (tdIndex) {
					 $(this).attr('id', (index + 1));
				 });

				 $(this).find('td[id^="amount-"]').each(function (tdIndex) {
					 $(this).attr('id', 'amount-' + (index + 1));
				 });

			 });
			 //$('#ReportTable tr:eq(' + indexToRemove + ')').remove();
			 countAllTotal();
			 $('#totalRows').text($('#divStockMainRegister tr').length - 1);
		 }


	</script>


	<!-- jQuery, Select2, and table-to-excel scripts -->
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>

	.sort-icon {
		padding: 5px;
		margin: 5px;
		vertical-align: top;
	}

	.ascCol {
		font-size: 15px;
		vertical-align: bottom;
	}

	.descCol {
		font-size: 15px;
		vertical-align: super;
	}

	.custom-select2 + .select2-container .select2-selection--single {
		background-color: #eacd78;
		font-weight:bold;
	}

</style>
