@using Microsoft.AspNetCore.Http
@using System.Reflection.PortableExecutable
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "SS Approval";
}

@{
    string branchName = HttpContextAccessor.HttpContext.Session.GetString("Branch");
    string empName = HttpContextAccessor.HttpContext.Session.GetString("EmpName");
    string yearCode = HttpContextAccessor.HttpContext.Session.GetString("YearCode");
    int EmpID = Convert.ToInt32(HttpContextAccessor.HttpContext.Session.GetString("EmpID"));
    string typeOfApproval = HttpContextAccessor.HttpContext.Request.Query["TypeOfApproval"];
    int EntryID = Convert.ToInt32(HttpContextAccessor.HttpContext.Request.Query["ShowPSDetail"]);
    int YC = Convert.ToInt32(HttpContextAccessor.HttpContext.Request.Query["YC"]);
    string SchNo = HttpContextAccessor.HttpContext.Request.Query["SchNo"];
    string SONO = HttpContextAccessor.HttpContext.Request.Query["SONO"];
    string VendorName = HttpContextAccessor.HttpContext.Request.Query["VendorName"];
    if (typeOfApproval == "listofApp")
    {
        typeOfApproval = "UnApproval";
    }
    if (typeOfApproval == "listofUnApp")
    {
        typeOfApproval = "Approval";
    }
    if (typeOfApproval == "listofAppAmd")
    {
        typeOfApproval = "Unapproving Amendment";
    }
    if (typeOfApproval == "listofUnAppAmd")
    {
        typeOfApproval = "Approving Amendment";
    }


    string url = HttpContextAccessor.HttpContext.Request.Path;

    int valueFromUrl = Convert.ToInt32(url.Split('/').Last());

}
<div class="card-body">
    <div class="card overflow-auto">
        <div class="card-body">
            <form id="SParam">
                <center><h4>Approval/Unapproval</h4></center>
                <div class="row">
                    <div class="col-xl-3 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                        <input id="approvePO" type="checkbox" style="margin-left:30px;width:15px !important;height:15px !important;" />
                        <label class="form-label" style="display: inline-block;"><strong>Click for @typeOfApproval</strong></label>
                    </div>
                    <div class="col-xl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                        <label class="form-label">Approve Date</label>
                        <input id="approveDate" style="display: inline-block;" class="form-control" />
                    </div>
                    <div class="col-xl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                        <label class="form-label">Approved By</label>
                        <input type="hidden" id="approvedById" value="@EmpID" />
                        <input id="approvedBy" style="display: inline-block;" readonly value="@($"{empName} --> {EmpID}")" class="form-control" />
                    </div>
                    <div class="col-xl-3 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
                        <div class="d-flex justify-content-right">
                            <a class="btn btn-sm btn-outline-info" style="height:30px;width:100px;margin-top:15px !important;" asp-controller="SSApproval" asp-action="SaveApproval" asp-route-EntryId="@valueFromUrl" asp-route-YC="@YC" asp-route-SchNo="@SchNo" asp-route-type="@typeOfApproval" asp-route-SONO="@SONO" asp-route-VendorName="@VendorName" onclick="checkCondition(event)">
                                <i class="fa-solid fa-chevron-circle-right fa-fw fa-lg"></i>SAVE
                            </a>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="card-body">
    <div class="card overflow-auto">
        <div class="card-body" id="divDashboardGrid">
            <div class="table-responsive" style="max-height:350px;">
                <table class="table table-hover table-bordered table-striped TbCss text-nowrap mb-0">
                    <thead class="bg-gradient card-headerBG text-light">
                        <tr>
                            <th>Sr#</th>
                            <th>SchNo</th>
                            <th>SONO</th>
                            <th>Vendor Name</th>
                            <th>SODate</th>
                            <th>Quantity</th>
                            <th>Rate</th>
                            <th>Deilvery Date</th>
                            <th>Part Code</th>
                            <th>Item Name</th>
                            <th>Sch Date</th>
                            <th>Sch Year</th>
                            <th>Sch Eff From</th>
                            <th>Sch Eff Till</th>
                            <th>Created By</th>
                            <th>Delivery Address</th>
                        </tr>
                    </thead>
                    <tbody id="gateDashboardtable">
                        @{
                            var @Cntr = 0;
                            if (Model == null || Model.Count == 0)
                            {
                                <tr class="text-center"><td colspan="26" class="text-black-50"><strong>NO DATA FOUND</strong></td></tr>
                            }
                            else
                            {
                                foreach (var item in Model)
                                {

                                    Cntr = Cntr + 1;
                                    <tr id="dashTableGridRow-@Cntr">
                                        <th>@Cntr<input type="hidden" id="typeOfApp-@Cntr" value="@typeOfApproval" /></th>
                                        <td>@item.SchNo</td>

                                        <td>@item.SONO</td>
                                        <td>@item.CustomerName</td>
                                        @if (item.SODate != null)
                                        {
                                            <td>@item.SODate.Split(" ")[0]</td>
                                        }
                                        else
                                        {
                                            <td>@item.SODate</td>
                                        }
                                        <td>@item.SchQty</td>
                                        <td>@item.Rate</td>
                                        <td>@item.DeliveryDate.Split(" ")[0]</td>
                                        <td>@item.PartCode</td>
                                        <td>@item.ItemName</td>
                                        @if (item.SchDate != null)
                                        {
                                            <td>@item.SchDate.Split(" ")[0]</td>
                                        }
                                        else
                                        {
                                            <td>@item.SchDate</td>
                                        }
                                        <td>@item.SchYear</td>
                                        @if (item.SchEffFromDate != null)
                                        {
                                            <td>@item.SchEffFromDate.Split(" ")[0]</td>
                                        }
                                        else
                                        {
                                            <td>@item.SchEffFromDate</td>
                                        }
                                        @if (item.SchEffTillDate != null)
                                        {
                                            <td>@item.SchEffTillDate.Split(" ")[0]</td>
                                        }
                                        else
                                        {
                                            <td>@item.SchEffTillDate</td>
                                        }
                                        <td>@item.CreatedBy</td>
                                        <td>@item.DeliveryAddress</td>

                                    </tr>
                                }
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@section Scripts
    {
    <script>
        $(document).ready(function () {
            $('#approveDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
            $('#approveDate').datepicker("option", "minDate", 'now');
            $('#approveDate').datepicker("option", "maxDate", 'now');
        });



        function checkCondition(event) {
            if ($('#approvePO').is(":checked")) {
                return true;
            } else {
                event.preventDefault();
                $.notify("Please check for approval/unapproval", "error");
                return false;
            }
        }
    </script>
}

<style>
    .color-box {
        width: 10px;
        height: 10px;
    }
</style>