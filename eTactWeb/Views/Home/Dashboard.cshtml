@model eTactWeb.DOM.Models.DashboardModel

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Combined Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-gauge@3.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>

        :root {
            --primary-color: #4f46e5;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --dark-color: #1e293b;
            --sales-primary: #4361ee;
            --sales-secondary: #3f37c9;
            --sales-accent: #4895ef;
            --sales-dark: #212529;
            --sales-light: #f8f9fa;
            --sales-track: #e0e0e0;
            --label-color: #212529;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f7f9fa;
            margin: 20px;
        }

        h2 {
            text-align: center;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 10px;
        }

        .card {
            background: white;
            padding: 1px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

            .card h3 {
                margin: 0;
                font-size: 1rem;
                color: #555;
            }

            .card .value {
                font-size: 2rem;
                font-weight: bold;
                margin-top: 10px;
            }

        .wide-card {
            grid-column: span 2;
        }

        canvas {
            margin-top: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

            table th, table td {
                padding: 8px;
                border-bottom: 1px solid #eee;
                text-align: left;
            }

        ul {
            padding-left: 20px;
        }

        .highlight-red {
            color: red;
            font-weight: bold;
        }

        .card-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .dashboard-card {
            display: flex;
            flex: 1 1 250px; /* grows and shrinks, minimum width 250px */
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            min-width: 280px;
            overflow: hidden;
            min-height: 80px;
        }

            .dashboard-card .icon-box {
                width: 80px;
                background-color: #7ba5e7;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 40px;
                cursor: pointer;
            }

            .dashboard-card.red .icon-box {
                background-color: #d06359;
            }

            .dashboard-card .card-content {
                padding: 12px 15px;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

                .dashboard-card .card-content h3 {
                    font-size: 15px;
                    margin: 0;
                    color: #333;
                }

                .dashboard-card .card-content .value {
                    font-size: 20px;
                    font-weight: bold;
                    color: #111;
                }

        /* Chart section */
        .chart-section {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        canvas {
            width: 100% !important;
            height: 300px !important;
        }

        .table-container {
            width: 100%;
            max-width: 1000px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .custom-table {
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            width: 100%;
            border-collapse: collapse;
        }

            .custom-table tbody tr:nth-child(even) {
                background-color: #c9d6eb;
            }

        .custom-table-scroll {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 8px;
        }

        .custom-table thead th {
            position: sticky;
            top: 0;
            background-color: #4a6fa5;
            color: white;
            padding: 5px 10px; /* tighter */
            text-align: left;
            z-index: 2;
            font-weight: 600;
        }

        .custom-table tbody td {
            padding: 5px 10px; /* less padding */
            color: #333;
            border-bottom: 1px solid #ddd;
            font-weight: 650;
            font-size: 10px;
        }

        .pending-table thead th {
            position: sticky;
            top: 0;
            background-color: #4a6fa5;
            color: white;
            padding: 5px 10px; /* tighter */
            text-align: left;
            z-index: 2;
            font-weight: 600;
        }

        .tab-nav {
            display: flex;
            border-bottom: 2px solid #ccc;
        }

            .tab-nav .tab-link {
                display: flex;
                align-items: center;
                padding: 0px 8px;
                cursor: pointer;
                background: #f2f2f2;
                border: none;
                outline: none;
                font-weight: 600;
                border-radius: 12px;
                color: #333;
                border-radius: 8px 8px 0 0;
                transition: background 0.3s;
                gap: 12px;
            }

                .tab-nav .tab-link.active {
                    background: #c7d9ed;
                    color: #fff;
                }

        /* Tab Content Area */
        .tab-content {
            display: none;
            padding: 20px;
            background: #fff;
            border: 2px solid #ccc;
            border-top: none;
            border-radius: 0 0 8px 8px;
        }

            .tab-content.active {
                display: block;
            }

        .tab-icon-container {
            width: 35px;
            height: 35px;
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            flex-shrink: 0;
        }

        .bg-icon {
            background-color: #325db0;
        }

        .tab-text {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .card-row {
            display: flex;
            gap: 20px; /* space between cards */
            flex-wrap: wrap; /* for responsiveness on smaller screens */
            margin: 10px;
        }

        .card-header {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            background-color: #99b1d6;
            color: #333;
        }

        .card-icon {
            font-size: 24px;
            margin-right: 12px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.2);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .card-body {
            padding: 8px;
        }

        .metrics-container {
            display: flex;
            justify-content: space-between;
        }

        .metric {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            position: relative;
        }

            .metric:first-child {
                margin-right: 10px;
                background-color: rgba(16, 185, 129, 0.1);
            }

            .metric:nth-child(2) {
                margin: 0 10px;
                background-color: rgba(234, 179, 8, 0.1); /* yellowish for completed */
            }

            .metric:last-child {
                margin: 0 10px;
                background-color: rgba(79, 70, 229, 0.1);
            }

        .metric-period {
            font-size: 15px;
            font-weight: 500;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            color: var(--text-light);
        }

        .metric-value {
            font-size: 18px;
            font-weight: 700;
            margin: 8px 0 4px;
            color: var(--text-dark);
        }

        .metric-change {
            font-size: 12px;
            display: flex;
            align-items: center;
        }

        .positive-change {
            color: green;
        }

        .negative-change {
            color: #ef4444;
        }

        .metric-icon {
            margin-right: 6px;
        }

        .purchase-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            flex: 1 1 calc(33.33% - 16px);
            min-width: 280px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

            .purchase-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }

        .app-version-card {
            width: 300px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 16px;
            font-family: Arial, sans-serif;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

            .app-version-card .header {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .app-version-card h3 {
                margin: 0;
                font-size: 16px;
                color: #333;
            }

        .sub-header {
            margin: 10px 0;
            font-size: 13px;
            color: #666;
        }

        .version-bar {
            display: flex;
            align-items: center;
            margin: 6px 0;
        }

            .version-bar .label {
                width: 60px;
                font-size: 12px;
                color: #333;
            }

        .bar-container {
            flex: 1;
            height: 10px;
            background: #eee;
            border-radius: 2px;
            overflow: hidden;
        }

        .bar {
            height: 100%;
            background: #4a6fa5;
            border-radius: 2px;
        }

        .version-bar .value {
            width: 40px;
            font-size: 12px;
            text-align: right;
            color: #333;
        }

        .vendors-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
        }

        .vendor-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 12px;
            transition: transform 0.2s ease;
            overflow-wrap: break-word; /* Wrap long words */
            word-break: break-word; /* Break long PONOs or names */
            display: flex;
            flex-direction: column;
        }

            .vendor-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            }

        .vendor-header {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            flex-wrap: wrap; /* Allows long names to wrap below the badge */
        }

        .vendor-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e7ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #4a6bff;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .vendor-header h3 {
            margin: 0;
            font-size: 12px;
            white-space: normal;
            overflow-wrap: break-word;
            flex: 1;
        }

        .new-badge {
            position: absolute;
            top: -20px;
            right: 0;
            background: #acc3e6;
            color: #020202;
            padding: 0px 8px;
            border-radius: 7px;
            font-size: 0.7rem;
            white-space: nowrap;
        }

        .vendor-details {
            display: grid;
            gap: 6px;
            font-size: 10px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            word-break: break-word; /* Prevent overflow */
        }

            .detail-item span {
                color: #666;
                margin-right: 5px;
            }

        .dashboard-wrapper {
            padding: 30px;
            max-width: 1200px;
            margin: auto;
        }

        .dashboard-title {
            font-size: 26px;
            margin-bottom: 5px;
        }

        .sales-section,
        .performance-section,
        .invoice-section,
        .trend-section,
        .customer-order-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .sales-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            flex: 1;
            min-width: 250px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .sales-card-SO-Dispatch {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            flex: 1;
            min-width: 1000px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .sales-card-title {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .sales-card-value {
            font-size: 28px;
            font-weight: bold;
        }

        .sales-card-badge {
            background-color: #e0f7e9;
            color: #34a853;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .sales-card-badge-red {
            background-color: #fdecea;
            color: #e63946;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .sales-card-subtitle {
            font-size: 14px;
            color: #777;
        }

        .sales-card-icon {
            margin-right: 5px;
            color: #888;
        }

        .sales-card-bar {
            height: 6px;
            background: #eee;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .sales-card-bar-inner {
            height: 6px;
            border-radius: 5px;
        }

        .bar-blue {
            background: #3b82f6;
        }

        .bar-green {
            background: #10b981;
        }

        .bar-purple {
            background: #8b5cf6;
        }

        .bar-yellow {
            background: #facc15;
        }

        .bar-red {
            background: #e63946;
        }

        .dashboard-header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .dashboard-select-refresh {
            display: flex;
            gap: 10px;
        }

        .dashboard-select, .dashboard-refresh-btn {
            padding: 6px 10px;
            font-size: 14px;
        }

        .card-lightblue {
            background-color: #e0edff;
        }

        .card-lightgreen {
            background-color: #e0f7e9;
        }

        .card-lightyellow {
            background-color: #fff7e0;
        }

        .card-lightred {
            background-color: #fdecea;
        }

        .supplier-card {
            background: white;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            border-left: 3px solid var(--primary-color);
            margin-bottom: 10px;
        }

            .supplier-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            }

        .supplier-name {
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.9rem;
            margin-bottom: 6px;
        }

        .supplier-code {
            background-color: #e0e7ff;
            color: var(--primary-color);
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 5px;
        }

        .rating-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .rating-item {
            flex: 1;
            min-width: 60px;
        }

        .rating-title {
            font-size: 0.7rem;
            color: #64748b;
            margin-bottom: 3px;
        }

        .rating-value {
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--dark-color);
        }

        .rating-bar {
            height: 4px;
            background-color: #e2e8f0;
            border-radius: 2px;
            margin-top: 3px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            border-radius: 3px;
        }

        .price-fill {
            background-color: #3d3dcd;
        }

        .delivery-fill {
            background-color: #379637;
        }

        .quality-fill {
            background-color: #ea9a08;
        }

        .final-fill {
            background: linear-gradient(90deg, #3d3dcd, #379637);
        }

        .supplier-grid {
            display: flex;
            flex-wrap: wrap;
            max-height: 300px;
            overflow-y: auto;
            padding: 5px;
            justify-content: space-between;
        }

            .supplier-grid > div {
                flex: 0 0 calc(50% - 8px); /* 2 cards per row with small gap */
            }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .soft-style {
            text-align: center;
            padding: 15px;
            color: #aaa;
            font-size: 15px;
        }

            .soft-style .icon {
                font-size: 35px;
                color: #ccc;
                margin-bottom: 5px;
            }

        .sales-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .sales-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: all 0.3s ease;
        }

            .sales-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            }

        .sales-card-header {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            cursor:pointer;
        }

            .sales-card-header h2 {
                font-size: 15px;
            }

            .sales-card-header i {
                font-size: 20px;
                color: var(--sales-primary);
                margin-right: 12px;
                width: 35px;
                height: 35px;
                background: rgba(67, 97, 238, 0.1);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

        .sales-metric {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 0;
            .sales-card-header h2
        }

            .sales-metric i {
                font-size: 15px;
                color: var(--sales-accent);
                background: rgba(72, 149, 239, 0.1);
                padding: 8px;
                border-radius: 8px;
            }

        .sales-metric-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--sales-dark);
        }

        .sales-metric-label {
            font-size: 15px;
            color: #6c757d;
            margin-top: 2px;
        }

        .sales-badge {
            background: #4361ee;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 8px;
        }

        .sales-with-badge .metric-value {
            display: flex;
            align-items: center;
        }

        .sales-order-stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .sales-order-stat-item {
            border-radius: 8px;
            padding: 15px;
            background: #d2e0ee;
            text-align: center;
        }

            .sales-order-stat-item.success {
                background: rgba(40, 167, 69, 0.1);
                color: #28a745;
            }

            .sales-order-stat-item.warning {
                background: rgba(255, 193, 7, 0.1);
                color: #ffc107;
            }

        .sales-order-total {
            border-radius: 8px;
            padding: 15px;
            background: #d2e0ee;
            text-align: center;
            width: 300px;
        }

        .sales-time-period-comparison {
            display: flex;
            gap: 20px;
        }

        .sales-time-period {
            flex: 1;
        }

            .sales-time-period h3 {
                font-size: 16px;
                margin-bottom: 10px;
                color: var(--sales-primary);
                display: flex;
                align-items: center;
                gap: 8px;
            }

        .sales-progress-container {
            width: 100%;
            max-width: 400px;
            margin: 10px 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .sales-progress-track {
            background-color: var(--sales-track);
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
            position: relative;
        }

        .sales-progress-bar {
            height: 100%;
            background-color: var(--sales-primary);
            width: 0; /* default width if not inline */
            transition: width 0.5s ease-in-out;
        }

        .sales-progress-label {
            margin-top: 5px;
            font-size: 14px;
            font-weight: 500;
            color: var(--label-color);
            text-align: right;
        }

        canvas#gaugeChart {
            max-width: 100%;
            height: auto;
        }

        .gauge-summary-text {
            text-align: center;
            font-size: 14px;
            font-weight: 600;
            margin-top: 8px;
            color: #333;
        }

        .initials-badge {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #4f709f;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }

        /* Make metric icons smaller */
        .small-icon {
            font-size: 14px;
            margin-right: 6px;
            color: #666; /* optional muted color */
        }

        /* Align icon and text vertically */
        .sales-metric {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .sales-stat-value {
            font-size: 15px;
        }

        .sales-order-stats-container + .sales-order-stats-container {
            margin-top: 10px;
        }

        .success {
            background-color: #28a745; /* Green */
        }

        .warning {
            background-color: #ffc107; /* Yellow */
            color: black;
        }

        .info {
            background-color: #17a2b8; /* Blue */
        }

        .danger {
            background-color: #bce8f0; /* Red */
        }

    </style>
</head>
<body>
    <div>
        <a asp-controller="Wren" asp-action="Index">Ask Question</a>
    </div>
    <div class="tab-nav">
        <button class="tab-link active" data-target="#inventoryTab">
            <div class="tab-icon-container bg-icon" onclick="RefreshInventoryAllData()">
                <i class="fa fa-boxes refreshIcon" style="font-size: 24px; cursor: pointer;"></i>
            </div>
            <div class="tab-text">
                Inventory Dashboard
            </div>
        </button>
        <button class="tab-link" data-target="#purchaseTab">
            <div class="tab-icon-container bg-icon" onclick="RefreshPOAllData()">
                <i class="fas fa-file-invoice refreshPOIcon"></i>
            </div>
            <div class="tab-text">
                Purchase Dashboard
            </div>
        </button>
        <button class="tab-link" data-target="#salesTab">
            <div class="tab-icon-container bg-icon" onclick="RefreshSalesAllData()">
                <i class="fas fa-file-invoice-dollar refreshSaleIcon" style="font-size: 24px; cursor: pointer;"></i>
            </div>
            <div class="tab-text">
                Sales Dashboard
            </div>
        </button>
        <button onclick="ExportPdfForDashBoard()" class="btn btn-danger">
            <i class="fas fa-file-pdf"></i> Export to PDF
        </button>
    </div>
    <div id="inventoryTab" class="tab-content active">
        <!-- Inventory Dashboard -->
        <div class="card-container">
            <input type="hidden" id="TotalRMValue" />
            <input type="hidden" id="TotalFGValue" />
            <input type="hidden" id="TotalStockValue" />
            <input type="hidden" id="TotalConsValue" />
            <input type="hidden" id="TotalToolsValue" />
            <input type="hidden" id="TotalOthersValue" />
            <input type="hidden" id="TotalItemQtyOfDeadStock" />
            <input type="hidden" id="TotalItemQtyOfFastMovingStock" />
            <input type="hidden" id="RefreshInventoryAllData" />
            <div class="dashboard-card">
                <div class="icon-box" onclick="StockValuation()" title="Refresh No Of Item In Stock">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="card-content">
                    <h3>Total Stock Value (₹)</h3>
                    <div class="value TotalStockValue" id="TotalStockValue">0</div>
                </div>
            </div>
            <div class="dashboard-card">
                <div class="icon-box" onclick="FillNoOfItemInStock()">
                    <i class="fas fa-box"></i>
                </div>
                <div class="card-content">
                    <h3>Total Items in Stock</h3>
                    <div class="value" id="TotalNoofItemInStock"></div>
                </div>
            </div>
            <div class="dashboard-card red">
                <div class="icon-box" onclick="DeadStockInventoryTask()">
                    <i class="fas fa-triangle-exclamation"></i>
                </div>
                <div class="card-content">
                    <h3>Dead Stock Items</h3>
                    <div class="value" id="TotalNoOfDeadStockItems"></div>
                </div>
            </div>
            <div class="dashboard-card red">
                <div class="icon-box" onclick="DeadStockInventoryTask()">
                    <i class="fas fa-circle-exclamation"></i>
                </div>
                <div class="card-content">
                    <h3>Dead Stock Value (₹)</h3>
                    <div class="value" id="TotalValueOfDeadStock"></div>
                </div>
            </div>
        </div>
        <div class="dashboard">
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3 style="margin: 0;">Valuation By Category</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-list-alt " style="font-size: 24px;cursor:pointer;" onclick="StockValuation()"></i>
                    </div>
                </div>
                <div class="card-body">
                    <h3>Total Stock Value (₹): <span class="TotalStockValue">0</span></h3>
                    <canvas id="valuationByCategoryChart"></canvas>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3 style="margin: 0;">Inventory by Category</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="StockValuation()"></i>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="inventoryByCategoryChart"></canvas>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3 style="margin: 0;">Fast vs Slow Moving Items</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-clock" style="font-size: 24px;cursor:pointer;" onclick="FastVsSlowMovingTask()"></i>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="fastSlowChart"></canvas>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>Pending</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-hourglass-half" style="font-size: 24px;cursor:pointer;" onclick="PendingInventoryTask()"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:300px;overflow-y: auto;">
                    <table class="pending-table">
                        <thead><tr><th>Form</th><th>Qty</th></tr></thead>
                        <tbody>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="PendingRequisitionToIssue" asp-controller="PendingRequisitionToIssue" id="MaterialtoIssueWOBOM" target="_blank">Req Without BOM</a></td>
                                <td><span id="PendRequisitionWithoutBOM">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="PendingMaterialToIssueThrBOM" asp-controller="PendingMaterialToIssueThrBOM" id="MaterialtoIssueThrBOM" target="_blank">Req Against BOM</a></td>
                                <td><span id="PendingReqAgainstBOM">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="PendingProductionSchedule" asp-controller="PendingProductionSchedule" id="IssueAgainstProdSchedule" target="_blank">Against Plan</a></td>
                                <td><span id="PendingAgainstPlan">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="MaterialReceipt" asp-controller="MaterialReceipt" id="MaterialReceiptNote" target="_blank">Gate Entry For MRN</a></td>
                                <td><span id="PendingGateEntryForMRN">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="PendingMRNtoQc" asp-controller="PendingMRNtoQc" id="MRIR" target="_blank">MRN For Qc</a></td>
                                <td><span id="PendingMRNForQc">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="JobWorkReceive" asp-controller="JobWorkReceive" id="JobWorkReceive" target="_blank">Gate Entry For JW MRN</a></td>
                                <td><span id="PendingGateEntryForJWMrn">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="PendingToReceiveItem" asp-controller="PendingToReceiveItem" id="ReceiveItemInStore" target="_blank">ReceiveItem In Store</a></td>
                                <td><span id="PendingToReceiveItemInStore">0</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="dashboard">
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>Top Items by Stock Value</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="StockValuation()"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:300px;overflow-y: auto;">
                    <table class="custom-table custom-table-scroll" style="width: 100%;">
                        <thead style="background-color:#7493c3">
                            <tr>
                                <th>PartCode</th>
                                <th>ItemName</th>
                                <th>Stock</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody id="TopItemByStockValue">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>Top Items Below Min Level</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-arrow-down" style="font-size: 24px;cursor:pointer" onclick="StockValuation()"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:300px;overflow-y: auto;">
                    <table class="custom-table" style="width: 100%;">
                        <thead style="background-color:#7493c3">
                            <tr>
                                <th>PartCode</th>
                                <th>ItemName</th>
                                <th>Stock</th>
                            </tr>
                        </thead>
                        <tbody id="TopItemBelowMinLevel">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>Top Fast Moving Item</h3>
                    <div class="tab-icon-container bg-icon" onclick="FastMovingItemsListTask()">
                        <i class="fas fa-chart-line" style="font-size: 24px;"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:300px;overflow-y: auto;">
                    <table class="custom-table" style="width: 100%;">
                        <thead style="background-color:#7493c3">
                            <tr>
                                <th>PartCode</th>
                                <th>ItemName</th>
                                <th>IssQty</th>
                                <th>Transaction</th>
                            </tr>
                        </thead>
                        <tbody id="TopFastMovingItem">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="purchaseTab" class="tab-content">
        <input type="hidden" id="RefreshPOAllData" />
        <input type="hidden" id="ApprovalTypeHidden" name="ApprovalType" />

        <div class="card-row">
            <div class="purchase-card">
                <div class="card-header">
                    <div class="card-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h3 class="card-title">Purchase Order Value</h3>
                </div>
                <div class="card-body">
                    <div class="metrics-container">
                        <div class="metric">
                            <div class="metric-period">
                                <i class="fas fa-calendar-alt metric-icon"></i>
                                Annual
                            </div>
                            <div class="metric-value" id="TotalNoofAnualPONetValue">0</div>
                            <div class="metric-change positive-change" id="YearlyChangeContainer">
                                <i class="fas fa-arrow-up metric-icon" id="YearlyChangeIcon"></i>
                                <span id="YearlyChangeSign">+</span><span id="YearlyIncInValuePercent">0</span>% from last year
                            </div>
                            <div class="metric-footer">Previous Year  PO Value : <span id="TotalNoofPreviousYearAnualPONetValue">0</span></div>
                        </div>
                        <div class="metric">
                            <div class="metric-period">
                                <i class="fas fa-calendar-week metric-icon"></i>
                                Monthly
                            </div>
                            <div class="metric-value" id="ToatalNoOfMonthlyPONetValue">0</div>
                            <div class="metric-change positive-change" id="MonthlyChangeContainer">
                                <i class="fas fa-arrow-up metric-icon" id="MonthlyChangeIcon"></i>
                                <span id="MonthlyChangeSign">+</span><span id="MonthlyIncInValuePercent">0</span>% from last month
                            </div>
                            <div class="metric-footer">Previous Month  PO Value : <span id="ToatalNoOfPreviousMonthlyPONetValue">0</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="purchase-card">
                <div class="card-header">
                    <div class="card-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <h3 class="card-title">Purchase Order Qty</h3>
                </div>
                <div class="card-body">
                    <div class="metrics-container">
                        <div class="metric">
                            <div class="metric-period">
                                <i class="fas fa-calendar-alt metric-icon"></i>
                                Annual
                            </div>
                            <div class="metric-value" id="TotalNoOfAnualPOQty">0</div>
                            <div class="metric-change positive-change" id="YearlyQtyChangeContainer">
                                <i class="fas fa-arrow-up metric-icon" id="YearlyQtyChangeIcon"></i>
                                <span id="YearlyQtyChangeSign">+</span><span id="YearlyIncInQtyPercent">0</span>% from last year
                            </div>
                            <div class="metric-footer">Previous Year  PO Qty : <span id="TotalNoOfPreviousYearAnualPOQty">0</span></div>
                        </div>
                        <div class="metric">
                            <div class="metric-period">
                                <i class="fas fa-calendar-week metric-icon"></i>
                                Monthly
                            </div>
                            <div class="metric-value" id="ToatalNoOfMonthlyPOQty">0</div>
                            <div class="metric-change positive-change" id="MonthlyQtyChangeContainer">
                                <i class="fas fa-arrow-up metric-icon" id="MonthlyQtyChangeIcon"></i>
                                <span id="MonthlyQtyChangeSign">+</span><span id="MonthlyIncInQtyPercent">0</span>% from last month
                            </div>
                            <div class="metric-footer">Previous Month  PO Qty : <span id="ToatalNoOfPreviousMonthlyPOQty">0</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="purchase-card">
                <div class="card-header">
                    <div class="card-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <h3 class="card-title">Purchase Order Status</h3>
                </div>
                <div class="card-body">
                    <div class="metrics-container">
                        <div class="metric">
                            <div class="metric-period">
                                <i class="fas fa-list-alt metric-icon"></i>
                                Total
                            </div>
                            <div class="metric-value" id="TotalPOPendingAndComplted">0</div>
                            <div class="metric-change positive-change">
                                <i class="fas fa-arrow-up metric-icon"></i>
                                +8.7% from last year
                            </div>
                            <div class="metric-footer">Total Orders 2023</div>
                        </div>
                        <div class="metric">
                            <div class="metric-period">
                                <i class="fas fa-check-circle metric-icon"></i>
                                Completed
                            </div>
                            <div class="metric-value" id="CompletedPOAndSchedule">0</div>
                            <div class="metric-change positive-change">
                                <i class="fas fa-arrow-up metric-icon"></i>
                                +5.1% from last month
                            </div>
                            <div class="metric-footer">October 2023</div>
                        </div>
                        <div class="metric">
                            <div class="metric-period">
                                <i class="fas fa-hourglass-half metric-icon"></i>
                                Pending
                            </div>
                            <div class="metric-value" id="PendingPOAndSchedule">0</div>
                            <div class="metric-change positive-change">
                                <i class="fas fa-arrow-up metric-icon"></i>
                                +5.1% from last month
                            </div>
                            <div class="metric-footer">October 2023</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="dashboard">
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3 style="margin: 0;">PO Value by Category</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="SavePOCategoryWise()"></i>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="poTopItemByValueChart"></canvas>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3 style="margin: 0;">PO Trend</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-clock" style="font-size: 24px;cursor:pointer;" onclick="SavePOMonthlyTrend()"></i>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="purchaseTrendChart"></canvas>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>Pending</h3>
                    <div class="tab-icon-container bg-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
                        <i class="fas fa-hourglass-half" style="font-size: 24px;cursor:pointer;" onclick="PendingInventoryTask()"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:300px;overflow-y: auto;">
                    <table class="pending-table">
                        <thead>
                            <tr>
                                <th>Form</th>
                                <th>Qty</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a class="table-link link-primary" asp-controller="Indent" target="_blank" asp-action="Indent" id="Indent">Indent For PO</a></td>
                                <td><span id="PendingIndentForPO">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="POApproval" target="_blank" asp-controller="POApproval" asp-route-ID="0" id="PO&AmendmentApproval" data-approvalType="firstLvlApproval">PO Approval For First Approvak</a></td>
                                <td><span id="PendingPOApprovalForFirstApproval">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="POApproval" target="_blank" asp-controller="POApproval" id="POApprovalForMgmtApproval" data-approvalType="finalApproval">PO Approval For Mgmt Approval</a></td>
                                <td><span id="PendingPOApprovalForMgmtApproval">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="POApproval" asp-controller="POApproval" target="_blank" asp-route-ID="0" id="PSApproval" data-approvalType="amdApproval">Amendment PO For Approval</a></td>
                                <td><span id="PendingAmendmentPOForApproval">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="SOApproval" asp-controller="SOApproval" target="_blank" asp-route-ID="0" id="SOApproval" data-approvalType="UnAppSO">Schedule For Approval</a></td>
                                <td><span id="PendingScheduleForApproval">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="SOApproval" asp-controller="SOApproval" target="_blank" id="SSApproval" data-approvalType="AppAmmSO">Amendment Schedule For Approval</a></td>
                                <td><span id="PendingAmendmentScheduleForApproval">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="PendingMRP" asp-controller="PendingMRP" target="_blank" id="PendingMRP">SO For MRP</a></td>
                                <td><span id="PendingSOForMRP">0</span></td>
                            </tr>
                            <tr>
                                <td><a class="table-link link-primary" asp-action="AutoGenerateSchedule" asp-controller="AutoGenerateSchedule" target="_blank" id="MRPForPO">MRP For PO</a></td>
                                <td><span id="PendingMRPForPO">0</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="dashboard">
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>Top 10 Items Value</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SaveTop10ItemForPO()"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:300px;overflow-y: auto;">
                    <table class="custom-table custom-table-scroll" style="width: 100%;">
                        <thead style="background-color:#7493c3">
                            <tr>
                                <th>PartCode</th>
                                <th>ItemName</th>
                                <th>Qty</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="TopItemByStockValueForPO">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>Top Vendors Value</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SaveTop10VendorForPO()"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:300px;overflow-y: auto;">
                    <table class="custom-table custom-table-scroll" style="width: 100%;">
                        <thead style="background-color:#7493c3">
                            <tr>
                                <th>VendorName</th>
                                <th>Qty</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody id="Top10VendorByValue">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3 style="margin: 0;">Top 10 Best Vendors</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="SaveBestAndWorstSupplier()"></i>
                    </div>
                </div>
                <div class="supplier-grid" id="supplierContainer">
                    <!-- Supplier cards will be dynamically inserted here -->
                </div>
            </div>
        </div>
        <div class="dashboard">
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3 style="margin: 0;">Worst Vendors</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="SaveBestAndWorstSupplier()"></i>
                    </div>
                </div>
                <div class="supplier-grid" id="supplierWorstContainer">
                    <!-- Supplier cards will be dynamically inserted here -->
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>New Vendor In this Month</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SaveNewVendorOfTheMonth()"></i>
                    </div>
                </div>

                <div class="vendors-container" style="max-height:300px;overflow-y: auto;padding:15px;">
                </div>
            </div>
            <div class="card">
                <div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
                    <h3>PO vs Consumption</h3>
                    <div class="tab-icon-container bg-icon">
                        <i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SavePOVsConsumption()"></i>
                    </div>
                </div>
                <div class="table-container" style="max-height:350px;overflow-y:auto;">
                    <table class="custom-table custom-table-scroll" style="width: 100%;">
                        <thead style="background-color:#7493c3">
                            <tr>
                                <th>PartCode</th>
                                <th>ItemName</th>
                                <th>PO Qty</th>
                                <th>Cons Qty</th>
                            </tr>
                        </thead>
                        <tbody id="PoVsConsumption">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="salesTab" class="tab-content">
        <input type="hidden" id="RefreshSalesAllData" />
        <div class="sales-container">
            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveDisplaySalesHeading()">
                    <i class="fas fa-chart-line"></i>
                    <h2>Sales Overview</h2>
                </div>
                <div class="sales-card-content">
                    <div class="sales-time-period-comparison">
                        <div class="sales-time-period">
                            <h3><i class="fas fa-calendar-alt"></i> Yearly</h3>
                            <div class="sales-metric">
                                <i class="fas fa-shopping-cart small-icon"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalSaleOrderItemQtyofYear">0</div>
                                    <div class="sales-metric-label">Items</div>
                                </div>
                            </div>
                            <div class="sales-metric">
                                <i class="fas fa-dollar-sign small-icon"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalSaleOrderValueofYear">0</div>
                                    <div class="sales-metric-label">Revenue</div>
                                </div>
                            </div>
                        </div>
                        <div class="sales-time-period">
                            <h3><i class="fas fa-calendar-week"></i> Monthly</h3>
                            <div class="sales-metric">
                                <i class="fas fa-shopping-cart small-icon"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalSaleOrderItemQtyofMonth">0</div>
                                    <div class="sales-metric-label">Items</div>
                                </div>
                            </div>
                            <div class="sales-metric">
                                <i class="fas fa-wallet small-icon"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalSaleOrderValueofMonth">0</div>
                                    <div class="sales-metric-label">Revenue</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveDisplaySalesHeading()">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <h2>Invoice Overview</h2>
                </div>
                <div class="sales-card-content">
                    <div class="sales-time-period-comparison">
                        <div class="sales-time-period">
                            <h3><i class="fas fa-calendar-alt"></i> Yearly</h3>
                            <div class="sales-metric">
                                <i class="fas fa-boxes"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalInvoiceItemQtyofYear">0</div>
                                    <div class="sales-metric-label">Items</div>
                                </div>
                            </div>
                            <div class="sales-metric">
                                <i class="fas fa-money-bill-wave"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalInvoiceValueofYear">0</div>
                                    <div class="sales-metric-label">Revenue</div>
                                </div>
                            </div>
                        </div>
                        <div class="sales-time-period">
                            <h3><i class="fas fa-calendar-week"></i> Monthly</h3>
                            <div class="sales-metric">
                                <i class="fas fa-boxes"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalInvoiceItemQtyofMonth">0</div>
                                    <div class="sales-metric-label">Items</div>
                                </div>
                            </div>
                            <div class="sales-metric">
                                <i class="fas fa-cash-register"></i>
                                <div>
                                    <div class="sales-metric-value" id="TotalInvoiceValueofMonth">0</div>
                                    <div class="sales-metric-label">Revenue</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveDisplaySalesHeading()">
                    <i class="fas fa-clipboard-list"></i>
                    <h2>Order Status    </h2>
                </div>
                <div class="sales-card-content">
                    <div class="sales-order-stats-container">
                        <div class="sales-order-stat-item success">
                            <div class="sales-stat-value" id="TotalCompletedNoOfSaleorderOfMonth">0</div>
                            <div class="sales-stat-label">Completed</div>
                        </div>
                        <div class="sales-order-stat-item warning">
                            <div class="sales-stat-value" id="TotalPendingNoOfSaleorderOfMonth">0</div>
                            <div class="sales-stat-label">Pending</div>
                        </div>
                    </div>
                    <div class="sales-order-stats-container">
                        <div class="sales-order-total">
                            <div class="sales-stat-value" id="TotalNoOfSaleorderOfMonth">0</div>
                            <div class="sales-stat-label">Total Orders</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveDisplaySalesHeading()">
                    <i class="fas fa-users"></i>
                    <h2>Customer Insights</h2>
                </div>
                <div class="sales-card-content">
                    <div class="sales-metric">
                        <i class="fas fa-star"></i>
                        <div>
                            <div class="sales-metric-value" id="BestCustomerOfMonth">0</div>
                            <div class="sales-metric-label">Best Customer of Month</div>
                        </div>
                    </div>
                    <div class="sales-metric">
                        <i class="fas fa-user-plus"></i>
                        <span>New Customers (Year): <strong id="NewCustomersAddinYear"></strong></span>
                    </div>
                    <div class="sales-metric">
                        <i class="fas fa-user-clock"></i>
                        <span>New Customers (Month): <strong id="NewCustomersAddinMonth"></strong></span>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveDisplaySalesHeading()">
                    <i class="fas fa-trophy"></i>
                    <h2>Performance Metrics</h2>
                </div>
                <div class="sales-card-content">

                    <!-- 🔶 Product Section -->
                    <div class="section-title">🏆 Best Product</div>
                    <div class="sales-metric with-badge product-section">
                        <i class="fas fa-box-open" style="color:#ff6b6b; background:rgba(255,107,107,0.1)"></i>
                        <div>
                            <div class="sales-metric-value" id="BestSoldItemOfMonth">
                                <span class="sales-badge">Best Product of Month</span>
                            </div>
                        </div>
                    </div>

                    <!-- 🔷 Seller Section -->
                    <div class="section-title">👤 Best Seller</div>
                    <div class="sales-metric seller-section">
                        <i class="fas fa-user-tie" style="color:#20c997; background:rgba(32,201,151,0.1)"></i>
                        <div>
                            <div class="sales-metric-value" id="BestSalesPersonOfMonth">
                                <span class="sales-badge">Best Seller of Month</span>
                            </div>
                            <div class="sales-metric-label">
                                Generated <span style="color:black;font-weight:bold;" id="BestSalePersonOrderValue">0</span> this month
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveDisplaySalesHeading()">
                    <i class="fas fa-exchange-alt"></i>
                    <h2>Dispatch & Returns</h2>
                </div>
                <div class="sales-card-content">
                    <div class="sales-order-stats-container">
                        <div class="sales-order-stat-item success">
                            <div class="sales-stat-value" id="TotalCompletedNoOfSaleorderOfMonth">0</div>
                            <div class="sales-stat-label">Pend Dispatch Qty Of Month</div>
                        </div>
                        <div class="sales-order-stat-item warning">
                            <div class="sales-stat-value" id="TotalPendingNoOfSaleorderOfMonth">0</div>
                            <div class="sales-stat-label">Pend Dispatch Value Of Month</div>
                        </div>
                        <div class="sales-order-stat-item primary">
                            <div class="sales-stat-value" id="TotalPendingNoOfSaleorderOfMonth">0</div>
                            <div class="sales-stat-label">Monthly Returns</div>
                        </div>
                        <div class="sales-order-stat-item danger">
                            <div class="sales-stat-value" id="TotalPendingNoOfSaleorderOfMonth">0</div>
                            <div class="sales-stat-label">Yearly Returns</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveTop10SaleCustomer()">
                    <i class="fa fa-chart-area"></i>
                    <h2>Top 10 Sale Customer</h2>
                </div>
                <div class="sales-card-content">
                    <div class="table-container" style="max-height:300px; overflow-y:auto; overflow-x:auto;">
                        <table class="custom-table custom-table-scroll" style="width: 100%;">
                            <thead style="background-color:#7493c3">
                                <tr>
                                    <th>Customer Name</th>
                                    <th>Sale Bill Amount</th>
                                </tr>
                            </thead>
                            <tbody id="Top10SALECUSTOMER">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveTop10SoldItem()">
                    <i class="fa fa-chart-area"></i>
                    <h2>Top 10 Sold Item</h2>
                </div>
                <div class="sales-card-content">
                    <div class="table-container" style="max-height:300px; overflow-y:auto; overflow-x:auto;">
                        <table class="custom-table custom-table-scroll" style="width: 100%;">
                            <thead style="background-color:#7493c3">
                                <tr>
                                    <th>PartCode</th>
                                    <th>Item Name</th>
                                    <th>Amt</th>
                                </tr>
                            </thead>
                            <tbody id="Top10SOLDItem">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" style="display: flex; align-items: center; gap: 10px;" onclick="SaveSaleMonthlyTrend()">
                    <i class="fa fa-chart-area" style="font-size: 20px; color: #0d6efd;"></i>
                    <h2>Monthly Sales Trend</h2>
                </div>

                <div class="sales-card-content">
                    <!-- Chart canvas -->
                    <canvas id="SALEMonthlyTrend" width="300" height="150"></canvas>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveTop10SalesPerson()">
                    <i class="fa fa-chart-area"></i>
                    <h2>Top 10 Sales Person</h2>
                </div>
                <div class="sales-card-content">
                    <div class="table-container" style="max-height:300px; overflow-y:auto; overflow-x:auto;">
                        <table class="custom-table custom-table-scroll" style="width: 100%;">
                            <thead style="background-color:#7493c3">
                                <tr>
                                    <th>Sale Person</th>
                                    <th>Sale Bill Amount</th>
                                </tr>
                            </thead>
                            <tbody id="Top10SALESPERSON">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="sales-card">
                <div class="sales-card-header" onclick="SaveNewCustomerOfTheMonth()">
                    <i class="fa fa-chart-area"></i>
                    <h2>New Customer In this Month</h2>
                </div>
                <div class="sales-card-content">
                    <div class="vendors-container" style="max-height:300px;overflow-y: auto;padding:15px;">
                    </div>
                </div>
            </div>

             <div class="sales-card">
                <div class="sales-card-header" style="display: flex; align-items: center; gap: 10px;">
                    <i class="fa fa-chart-area" style="font-size: 20px; color: #0d6efd;"></i>
                    <h2>Monthly Rejection Trend</h2>
                </div>

                <div class="sales-card-content">
                    <!-- Chart canvas -->
                    <canvas id="MonthlyRejectionTrend" width="300" height="150"></canvas>
                </div>
            </div>  

            <div class="sales-card-SO-Dispatch">
                <div class="sales-card-header" onclick="SaveSaleOrderVsDispatch()">
                    <i class="fa fa-chart-area"></i>
                    <h2>SaleOrder Vs Dispatch</h2>
                </div>
                <div class="sales-card-content">
                    <div class="table-container" style="max-height:300px; overflow-y:auto; overflow-x:auto;">
                        <table class="custom-table custom-table-scroll" style="width: 100%;">
                            <thead style="background-color:#7493c3">
                                <tr>
                                    <th>Party Name</th>
                                    <th>Part Code</th>
                                    <th>Item Name</th>
                                    <th>OrderQty</th>
                                    <th>DispQty</th>
                                    <th>PendQty</th>
                                    <th>Order Value</th>
                                    <th>Pend OrderValue</th>
                                </tr>
                            </thead>
                            <tbody id="SaleOrderVsDispatch">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

@section Scripts {

    <!-- Chart JS Scripts -->
    <script>

        $(".table-link").on("click", function () {
             
            var approvalType = $(this).data("approvaltype"); // get data-approvalType
            if (approvalType) {
                $("#ApprovalTypeHidden").val(approvalType); // set value in hidden input
                localStorage.setItem('ApprovalType', approvalType);
            }
        });

        function ExportPdfForDashBoard() {
            const { jsPDF } = window.jspdf;

            const activeTabButton = document.querySelector(".tab-link.active");
            if (!activeTabButton) {
                alert("No active tab found!");
                return;
            }

            const targetId = activeTabButton.getAttribute("data-target");
            const tabContent = document.querySelector(targetId);

            if (!tabContent) {
                alert("Tab content not found!");
                return;
            }

            const tabNameElement = activeTabButton.querySelector(".tab-text");
            let dashboardName = "Dashboard Export";
            let fileName = "DashboardExport.pdf";
            if (tabNameElement) {
                dashboardName = tabNameElement.textContent.trim();
                fileName = `${dashboardName.replace(/\s+/g, '_')}.pdf`;
            }

            // Scroll to top
            window.scrollTo(0, 0);

            // Save original style to restore later
            const originalStyle = {
                height: tabContent.style.height,
                maxHeight: tabContent.style.maxHeight,
                overflow: tabContent.style.overflow,
            };

            // Expand container to full content to avoid clipping
            tabContent.style.height = 'auto';
            tabContent.style.maxHeight = 'none';
            tabContent.style.overflow = 'visible';
            tabContent.style.backgroundColor = "#ffffff";

            html2canvas(tabContent, {
                scale: 2,
                useCORS: true,
                backgroundColor: '#ffffff',
                scrollY: -window.scrollY
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');

                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();

                const imgWidth = pageWidth;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                const marginTop = 20;
                let position = marginTop + 10;
                let heightLeft = imgHeight;

                // Add header
                pdf.setFont("helvetica", "bold");
                pdf.setFontSize(16);
                pdf.text(dashboardName, pageWidth / 2, marginTop, { align: "center" });

                // Add first page
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= (pageHeight - position);

                // Add more pages if needed
                while (heightLeft > 0) {
                    position = 10;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                // Restore original styles
                tabContent.style.height = originalStyle.height;
                tabContent.style.maxHeight = originalStyle.maxHeight;
                tabContent.style.overflow = originalStyle.overflow;

                pdf.save(fileName);
            });
        }

        document.addEventListener("DOMContentLoaded", function () {
            const tabLinks = document.querySelectorAll(".tab-link");
            const tabContents = document.querySelectorAll(".tab-content");

            function activateTab(tabId) {
                // Remove "active" from all links and contents
                tabLinks.forEach(link => link.classList.remove("active"));
                tabContents.forEach(content => {
                    content.style.display = "none";
                    content.classList.remove("active");
                });

                // Activate selected tab
                const activeLink = [...tabLinks].find(link => link.dataset.target === `#${tabId}`);
                const activeContent = document.getElementById(tabId);
                if (activeLink) activeLink.classList.add("active");
                if (activeContent) {
                    activeContent.style.display = "block";
                    activeContent.classList.add("active");
                }

                // Load tab-specific data
                if (tabId === "purchaseTab") {
                    $('#RefreshPOAllData').val(false);
                    FillPurchaseDashboardData();
                    FillPurchaseDashboardTop10ItemData();
                    FillPurchaseDashboardTop10VendorData();
                    FillPurchaseDashboardDataMonthlyTrend();
                    FillPurchaseDashboardDataByCategoryValue();
                    FillPurchaseDashboardNewVendorInThisMonthData();
                    FillPurchaseVsConsumptionDashboardData();
                    FillBestSupplier();
                    FillWorstSupplier();
                } else if (tabId === "inventoryTab") {
                    $('#RefreshInventoryAllData').val(false);
                    FillInventoryDashboardData();
                    FillInventoryDashboardForPendingData();
                    FillInventoryByCategory();
                    GetTopItemByStockValue();
                    GetTopItemBelowMinLevel();
                    GetTopFastMovingItem();
                } else if (tabId === "salesTab") {
                    $('#RefreshSalesAllData').val(false);
                    FillDisplaySalesHeading();
                    FillSALEMonthlyTrend();
                    FillTop10SALECUSTOMER();
                    FillTop10SOLDItem();
                    FillTop10SALESPERSON();
                    FillNEWCustomerOFTHEMONTH();
                    FillMonthlyRejectionTrend();
                    FillSaleOrderVsDispatch();
                }
            }

            // On initial load
            const hash = window.location.hash || "#inventoryTab";
            activateTab(hash.substring(1));

            // On tab click
            tabLinks.forEach(link => {
                link.addEventListener("click", function () {
                    const targetId = link.dataset.target.substring(1);
                    activateTab(targetId);
                    history.replaceState(null, null, '#' + targetId);
                });
            });
        });

        //Inventory Dashboard//

        function FillInventoryDashboardData() {
            $.ajax({
                url: '@Url.Action("FillInventoryDashboardData", "Home")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        $('.TotalStockValue').text(obj.Result[0].TotalStockValue);
                        $('#TotalNoofItemInStock').text(obj.Result[0].TotalNoofItemInStock);
                        $('#TotalNoOfDeadStockItems').text(obj.Result[0].TotalNoOfDeadStockItems);
                        $('#TotalValueOfDeadStock').text(obj.Result[0].TotalValueOfDeadStock);
                        $('#TotalRMValue').val(obj.Result[0].TotalRMValue);
                        $('#TotalFGValue').val(obj.Result[0].TotalFGValue);
                        $('#TotalConsValue').val(obj.Result[0].TotalConsValue);
                        $('#TotalToolsValue').val(obj.Result[0].TotalToolsValue);
                        $('#TotalOthersValue').val(obj.Result[0].TotalOthersValue);
                        $('#TotalItemQtyOfDeadStock').val(obj.Result[0].TotalItemQtyOfDeadStock);
                        $('#TotalItemQtyOfFastMovingStock').val(obj.Result[0].TotalItemQtyOfFastMovingStock);

                        var TotalStock = parseInt($('.TotalStockValue').text());

                        var dataMap = {
                            RM: $('#TotalRMValue').val(),
                            FG: $('#TotalFGValue').val(),
                            Cons: $('#TotalConsValue').val(),
                            Tools: $('#TotalToolsValue').val(),
                            Others: $('#TotalOthersValue').val()
                        };

                        var xValues = Object.entries(dataMap).map(([key, val]) => {
                            return `${key} - ${val}`;
                        });
                        var yValues = Object.values(dataMap);
                        var barColors = [
                            "#f28ea3",
                            "#6a92cc",
                            "#f3ddd8",
                            "#4da97b",
                            "#ffbb4d"
                        ];

                        new Chart("valuationByCategoryChart", {
                            type: "pie",
                            data: {
                                labels: xValues,
                                datasets: [{
                                    backgroundColor: barColors,
                                    hoverBackgroundColor: barColors,
                                    data: yValues
                                }]
                            },
                            options: {
                                title: {
                                    display: true,
                                    text: "Valuation by Category"
                                }
                            }
                        });
                    }

                    // Get dynamic values from your input fields
                    let slowMovingQty = parseInt($('#TotalItemQtyOfDeadStock').val()) || 0;
                    let fastMovingQty = parseInt($('#TotalItemQtyOfFastMovingStock').val()) || 0;

                    // Create the doughnut chart with dynamic data
                    new Chart("fastSlowChart", {
                        type: "doughnut",
                        data: {
                            labels: ["Fast Movers", "Slow Movers"],
                            datasets: [{
                                backgroundColor: ["#1abc9c", "#e67e22"],
                                data: [fastMovingQty, slowMovingQty]
                            }]
                        }
                    });
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }

            });
        }

        function FillInventoryDashboardForPendingData() {
            $.ajax({
                url: '@Url.Action("FillInventoryDashboardForPendingData", "Home")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        $('#PendRequisitionWithoutBOM').text(obj.Result[0].PendRequisitionWithoutBOM);
                        $('#PendingReqAgainstBOM').text(obj.Result[0].PendingReqAgainstBOM);
                        $('#PendingAgainstPlan').text(obj.Result[0].PendingAgainstPlan);
                        $('#PendingGateEntryForMRN').text(obj.Result[0].PendingGateEntryForMRN);
                        $('#PendingMRNForQc').text(obj.Result[0].PendingMRNForQc);
                        $('#PendingGateEntryForJWMrn').text(obj.Result[0].PendingGateEntryForJWMrn);
                        $('#PendingToReceiveItemInStore').text(obj.Result[0].PendingToReceiveItemInStore);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function FillInventoryByCategory() {
            $.ajax({
                url: '@Url.Action("FillInventoryByCategory", "Home")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        var result = obj.Result;
                        var xValues = result.map(x => x.ItemCategory);
                        var yValues = result.map(x => x.CategoryStock);

                        var barColors = ["#f28ea3", "#66d9d0", "#7fa6d9", "#f4dcd6", "#6fcf97", "#fbd490"];

                        new Chart("inventoryByCategoryChart", {
                            type: "bar",
                            data: {
                                labels: xValues,
                                datasets: [{
                                    backgroundColor: barColors,
                                    hoverBackgroundColor: barColors,
                                    data: yValues,
                                    barThickness: 25, // Force specific bar width (px)
                                }]
                            },
                            options: {
                                maintainAspectRatio: false, // Allow custom height/width
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    title: {
                                        display: true,
                                        text: "Inventory By Category"
                                    }
                                },
                                scales: {
                                    x: {
                                        categoryPercentage: 0.5, // Reduce spacing between bars
                                        barPercentage: 1.0,      // Use full width inside category
                                        ticks: {
                                            autoSkip: false,
                                            maxRotation: 30,
                                            minRotation: 30
                                        }
                                    },
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function GetTopItemByStockValue() {

            $.ajax({
                url: '@Url.Action("GetTopItemByStockValue", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr onclick="handleRowClick(\'' + item.Itemcode + '\')" style="cursor:pointer;">';
                        html += '<td><input type="hidden" value="' + item.Itemcode + '">' + item.PartCode + '</td>';
                        html += '<td>' + item.ItemName + '</td>';
                        html += '<td>' + item.Stock + '</td>';
                        html += '<td>' + item.StockValue + '</td>';
                        html += '</tr>';
                    });
                    $('#TopItemByStockValue').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function GetTopItemBelowMinLevel() {

            $.ajax({
                url: '@Url.Action("GetTopItemBelowMinLevel", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr onclick="handleRowClickMinValue(\'' + item.PartCode + '\')" style="cursor:pointer;">';
                        html += '<td><input type="hidden" value="' + item.Itemcode + '">' + item.PartCode + '</td>';
                        html += '<td>' + item.ItemName + '</td>';
                        html += '<td>' + item.Stock + '</td>';
                        html += '</tr>';
                    });
                    $('#TopItemBelowMinLevel').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function GetTopFastMovingItem() {

            $.ajax({
                url: '@Url.Action("GetTopFastMovingItem", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr onclick="handleRowClickMinValue(\'' + item.PartCode + '\')" style="cursor:pointer;">';
                        html += '<td><input type="hidden" value="' + item.Itemcode + '">' + item.PartCode + '</td>';
                        html += '<td>' + item.ItemName + '</td>';
                        html += '<td>' + item.IssQty + '</td>';
                        html += '<td>' + item.NoOfTransaction + '</td>';
                        html += '</tr>';
                    });
                    $('#TopFastMovingItem').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function handleRowClick(ItemCode) {
            localStorage.setItem('SelectedItemCode', ItemCode);
            var url = '/StockValuation/Index';
            window.location.href = url;
        }

        function handleRowClickMinValue(PartCode) {
            localStorage.setItem('SelectedMinItemCode', PartCode);
            var url = '/MinimumMaximaumLevel/Index';
            window.location.href = url;
        }

        function RefreshInventoryAllData() {
            var icon = $('.refreshIcon');

            // Change icon to spinner
            icon.removeClass('fa-boxes').addClass('fa-spinner fa-spin');

            // Disable click interaction
            icon.css('pointer-events', 'none'); // Disable pointer
            icon.css('opacity', '0.6');         // Optional: show visually it's disabled

            // Let the browser render the spinner first
            setTimeout(function () {
                $('#RefreshInventoryAllData').val(true);

                // Call your inventory functions
                FillNoOfItemInStock();
                StockValuation();
                DeadStockInventoryTask();
                PendingInventoryTask();
                FastVsSlowMovingTask();
                FastMovingItemsListTask();

                $.notify('Successfully refreshed all Inventory Data...!', {
                    position: "top center",
                    className: "success"
                });

                // Reload the page
                setTimeout(function () {
                    location.reload();
                }, 1000);

            }, 10);
        }

        function FillNoOfItemInStock() {
             
            $.ajax({
                url: '@Url.Action("NoOfItemInStock", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshInventoryAllData').val() == "false") {
                            $.notify('Successfully Refresh No Of item In Stock...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function StockValuation() {
            $.ajax({
                url: '@Url.Action("StockValuation", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshInventoryAllData').val() == "false") {
                            $.notify('Successfully Refresh Stock Valuation...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function PendingInventoryTask() {
            $.ajax({
                url: '@Url.Action("PendingInventoryTask", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshInventoryAllData').val() == "false") {
                            $.notify('Successfully Refresh Pending Item Job List...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function DeadStockInventoryTask() {
            $.ajax({
                url: '@Url.Action("DeadStockInventoryTask", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshInventoryAllData').val() == "false") {
                            $.notify('Successfully Refresh Dead item In Stock...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function FastMovingItemsListTask() {
            $.ajax({
                url: '@Url.Action("FastMovingItemsListTask", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshInventoryAllData').val() == "false") {
                            $.notify('Successfully Refresh FastMoving ItemList...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function FastVsSlowMovingTask() {
            $.ajax({
                url: '@Url.Action("FastVsSlowMovingTask", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshInventoryAllData').val() == "false") {
                            $.notify('Successfully Refresh Fast Vs Slow Moving Task...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        //Purchase Order Dashboard//

        function FillPurchaseDashboardData() {
            $.ajax({
                url: '@Url.Action("FillPurchaseDashboardData", "Home")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        $('#TotalNoofAnualPONetValue').text(obj.Result[0].TotalNoofAnualPONetValue);
                        $('#TotalNoOfAnualPOQty').text(obj.Result[0].TotalNoOfAnualPOQty);
                        $('#ToatalNoOfMonthlyPONetValue').text(obj.Result[0].ToatalNoOfMonthlyPONetValue);
                        $('#ToatalNoOfMonthlyPOQty').text(obj.Result[0].ToatalNoOfMonthlyPOQty);
                        $('#TotalNoofPreviousYearAnualPONetValue').text(obj.Result[0].TotalNoofPreviousYearAnualPONetValue);
                        $('#TotalNoOfPreviousYearAnualPOQty').text(obj.Result[0].TotalNoOfPreviousYearAnualPOQty);
                        $('#ToatalNoOfPreviousMonthlyPOQty').text(obj.Result[0].ToatalNoOfPreviousMonthlyPOQty);
                        $('#ToatalNoOfPreviousMonthlyPONetValue').text(obj.Result[0].ToatalNoOfPreviousMonthlyPONetValue);
                        $('#YearlyIncInValuePercent').text(obj.Result[0].YearlyIncInValuePercent);
                        $('#YearlyIncInQtyPercent').text(obj.Result[0].YearlyIncInQtyPercent);
                        $('#MonthlyIncInValuePercent').text(obj.Result[0].MonthlyIncInValuePercent);
                        $('#MonthlyIncInQtyPercent').text(obj.Result[0].MonthlyIncInQtyPercent);
                        $('#TotalClosePOCompleted').text(obj.Result[0].TotalClosePOCompleted);
                        $('#TotalClosePOPending').text(obj.Result[0].TotalClosePOPending);
                        $('#TotalScheduleCompleted').text(obj.Result[0].TotalScheduleCompleted);
                        $('#TotalSchedulePending').text(obj.Result[0].TotalSchedulePending);
                        $('#PendingIndentForPO').text(obj.Result[0].PendingIndentForPO);
                        $('#PendingPOApprovalForFirstApproval').text(obj.Result[0].PendingPOApprovalForFirstApproval);
                        $('#PendingPOApprovalForMgmtApproval').text(obj.Result[0].PendingPOApprovalForMgmtApproval);
                        $('#PendingAmendmentPOForApproval').text(obj.Result[0].PendingAmendmentPOForApproval);
                        $('#PendingScheduleForApproval').text(obj.Result[0].PendingScheduleForApproval);
                        $('#PendingAmendmentScheduleForApproval').text(obj.Result[0].PendingAmendmentScheduleForApproval);
                        $('#PendingSOForMRP').text(obj.Result[0].PendingSOForMRP);
                        $('#PendingMRPForPO').text(obj.Result[0].PendingMRPForPO);

                        updateYearlyValueChange(obj.Result[0].YearlyIncInValuePercent);
                        updateMonthlyValueChange(obj.Result[0].MonthlyIncInValuePercent);
                        updateYearlyQtyChange(obj.Result[0].YearlyIncInQtyPercent);
                        updateMonthlyQtyChange(obj.Result[0].MonthlyIncInQtyPercent);

                        var TotalPOPendingAndComplted = obj.Result[0].TotalClosePOCompleted + obj.Result[0].TotalClosePOPending + obj.Result[0].TotalScheduleCompleted + obj.Result[0].TotalSchedulePending;
                        $('#TotalPOPendingAndComplted').text(TotalPOPendingAndComplted);

                        var CompletedPOAndSchedule = obj.Result[0].TotalClosePOCompleted + obj.Result[0].TotalScheduleCompleted;
                        $('#CompletedPOAndSchedule').text(CompletedPOAndSchedule);

                        var PendingPOAndSchedule = obj.Result[0].TotalClosePOPending + obj.Result[0].TotalSchedulePending;
                        $('#PendingPOAndSchedule').text(PendingPOAndSchedule);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function updateYearlyValueChange(percent) {
            const container = document.getElementById("YearlyChangeContainer");
            const icon = document.getElementById("YearlyChangeIcon");
            const sign = document.getElementById("YearlyChangeSign");
            const percentSpan = document.getElementById("YearlyIncInValuePercent");

            // Set percent value
            percentSpan.textContent = Math.abs(percent);

            if (percent < 0) {
                icon.classList.remove("fa-arrow-up");
                icon.classList.add("fa-arrow-down");
                container.classList.remove("positive-change");
                container.classList.add("negative-change");
                sign.textContent = "-";
            } else {
                icon.classList.remove("fa-arrow-down");
                icon.classList.add("fa-arrow-up");
                container.classList.remove("negative-change");
                container.classList.add("positive-change");
                sign.textContent = "+";
            }
        }

        function updateMonthlyValueChange(percent) {
            const container = document.getElementById("MonthlyChangeContainer");
            const icon = document.getElementById("MonthlyChangeIcon");
            const sign = document.getElementById("MonthlyChangeSign");
            const percentSpan = document.getElementById("MonthlyIncInValuePercent");

            // Set absolute value
            percentSpan.textContent = Math.abs(percent);

            if (percent < 0) {
                icon.classList.remove("fa-arrow-up");
                icon.classList.add("fa-arrow-down");
                container.classList.remove("positive-change");
                container.classList.add("negative-change");
                sign.textContent = "-";
            } else {
                icon.classList.remove("fa-arrow-down");
                icon.classList.add("fa-arrow-up");
                container.classList.remove("negative-change");
                container.classList.add("positive-change");
                sign.textContent = "+";
            }
        }

        function updateYearlyQtyChange(percent) {
            const container = document.getElementById("YearlyQtyChangeContainer");
            const icon = document.getElementById("YearlyQtyChangeIcon");
            const sign = document.getElementById("YearlyQtyChangeSign");
            const percentSpan = document.getElementById("YearlyIncInValuePercent"); // rename if needed

            percentSpan.textContent = Math.abs(percent);

            if (percent < 0) {
                icon.classList.remove("fa-arrow-up");
                icon.classList.add("fa-arrow-down");
                container.classList.remove("positive-change");
                container.classList.add("negative-change");
                sign.textContent = "-";
            } else {
                icon.classList.remove("fa-arrow-down");
                icon.classList.add("fa-arrow-up");
                container.classList.remove("negative-change");
                container.classList.add("positive-change");
                sign.textContent = "+";
            }
        }

        function updateMonthlyQtyChange(percent) {
            const container = document.getElementById("MonthlyQtyChangeContainer");
            const icon = document.getElementById("MonthlyQtyChangeIcon");
            const sign = document.getElementById("MonthlyQtyChangeSign");
            const percentSpan = document.getElementById("MonthlyIncInQtyPercent");

            percentSpan.textContent = Math.abs(percent);

            if (percent < 0) {
                icon.classList.remove("fa-arrow-up");
                icon.classList.add("fa-arrow-down");
                container.classList.remove("positive-change");
                container.classList.add("negative-change");
                sign.textContent = "-";
            } else {
                icon.classList.remove("fa-arrow-down");
                icon.classList.add("fa-arrow-up");
                container.classList.remove("negative-change");
                container.classList.add("positive-change");
                sign.textContent = "+";
            }
        }

        function FillPurchaseDashboardDataByCategoryValue() {
            $.ajax({
                url: '@Url.Action("FillPurchaseDashboardDataByCategoryValue", "Home")',
                type: 'POST',
                success: function (data) {
                    const parsed = JSON.parse(data);

                    const xValues = parsed.Result.map(item => item.ItemCategory);
                    const yQtyValues = parsed.Result.map(item => item.POQty);
                    const yAmtValues = parsed.Result.map(item => item.POAmount);

                    setTimeout(function () {
                        const canvas = document.getElementById("poTopItemByValueChart");
                        if (!canvas) {
                            console.warn("Canvas with id 'poTopItemByValueChart' not found.");
                            return;
                        }

                        const ctx = canvas.getContext("2d");

                        if (window.poTopItemByValueChart instanceof Chart) {
                            window.poTopItemByValueChart.destroy();
                        }

                        window.poTopItemByValueChart = new Chart(ctx, {
                            type: "bar",
                            data: {
                                labels: xValues,
                                datasets: [
                                    {
                                        label: "PO Quantity",
                                        data: yQtyValues,
                                        backgroundColor: "rgba(54, 162, 235, 0.8)", // blue
                                        yAxisID: 'y'
                                    },
                                    {
                                        label: "PO Amount (₹)",
                                        data: yAmtValues,
                                        backgroundColor: "rgba(255, 159, 64, 0.8)", // orange
                                        yAxisID: 'y1'
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    x: {
                                        ticks: {
                                            maxRotation: 45,
                                            minRotation: 45
                                        },
                                        title: {
                                            display: true,
                                            text: "Item Category"
                                        }
                                    },
                                    y: {
                                        position: 'left',
                                        title: {
                                            display: true,
                                            text: "PO Quantity"
                                        },
                                        ticks: {
                                            callback: value => value.toLocaleString('en-IN')
                                        }
                                    },
                                    y1: {
                                        position: 'right',
                                        title: {
                                            display: true,
                                            text: "PO Amount (₹)"
                                        },
                                        ticks: {
                                            callback: value => '₹' + (value / 1000000).toFixed(1) + 'M'
                                        },
                                        grid: {
                                            drawOnChartArea: false
                                        }
                                    }
                                },
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Top PO Items by Category'
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function (context) {
                                                const value = context.raw;
                                                if (context.dataset.label === "PO Amount (₹)") {
                                                    return `${context.dataset.label}: ₹${value.toLocaleString('en-IN')}`;
                                                } else {
                                                    return `${context.dataset.label}: ${value.toLocaleString('en-IN')}`;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }, 100);
                },
                error: function () {
                    alert('Failed to load PO Category chart data.');
                }
            });
        }

        function FillPurchaseDashboardTop10ItemData() {

            $.ajax({
                url: '@Url.Action("FillPurchaseDashboardTop10ItemData", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr onclick="handleRowClick(\'' + item.itemcode + '\')" style="cursor:pointer;">';
                        html += '<td><input type="hidden" value="' + item.itemcode + '">' + item.Partcode + '</td>';
                        html += '<td>' + item.ItemName + '</td>';
                        html += '<td>' + item.POQTY + '</td>';
                        html += '<td>' + item.POAmount + '</td>';
                        html += '</tr>';
                    });
                    $('#TopItemByStockValueForPO').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function FillPurchaseDashboardTop10VendorData() {

            $.ajax({
                url: '@Url.Action("FillPurchaseDashboardTop10VendorData", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr onclick="handleRowClick(\'' + item.AccountCode + '\')" style="cursor:pointer;">';
                        html += '<td><input type="hidden" value="' + item.AccountCode + '">' + item.AccountName + '</td>';
                        html += '<td>' + item.POQTY + '</td>';
                        html += '<td>' + item.POAmount + '</td>';
                        html += '</tr>';
                    });
                    $('#Top10VendorByValue').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function FillPurchaseDashboardDataMonthlyTrend() {
            $('#purchaseTrendLoader').show(); // Show loading indicator

            $.ajax({
                url: '@Url.Action("FillPurchaseDashboardDataMonthlyTrend", "Home")',
                type: 'POST',
                success: function (data) {
                    $('#purchaseTrendLoader').hide(); // Hide loading indicator

                    var parsed = JSON.parse(data);
                    var labels = parsed.Result.map(item => item.MonthCompName);
                    var poQtyValues = parsed.Result.map(item => item.POQty);
                    var poAmountValues = parsed.Result.map(item => item.POAmount);

                    setTimeout(function () {
                        const canvas = document.getElementById("purchaseTrendChart");
                        if (!canvas) {
                            console.warn("Canvas with id 'purchaseTrendChart' not found.");
                            return;
                        }

                        const ctx = canvas.getContext("2d");
                        if (window.purchaseTrendChart instanceof Chart) {
                            window.purchaseTrendChart.destroy();
                        }

                        window.purchaseTrendChart = new Chart(ctx, {
                            type: "line",
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: "PO Quantity",
                                        data: poQtyValues,
                                        borderColor: "rgba(54, 162, 235, 0.8)",
                                        backgroundColor: "rgba(54, 162, 235, 0.2)",
                                        yAxisID: 'y',
                                        fill: false,
                                        tension: 0.3,
                                        pointRadius: 4,
                                        pointHoverRadius: 6
                                    },
                                    {
                                        label: "PO Amount (₹)",
                                        data: poAmountValues,
                                        borderColor: "rgba(255, 99, 132, 0.8)",
                                        backgroundColor: "rgba(255, 99, 132, 0.2)",
                                        yAxisID: 'y1',
                                        fill: false,
                                        tension: 0.3,
                                        pointRadius: 4,
                                        pointHoverRadius: 6
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: {
                                    mode: 'index',
                                    intersect: false,
                                },
                                scales: {
                                    x: {
                                        title: {
                                            display: true,
                                            text: "Month",
                                            font: { weight: 'bold' }
                                        },
                                        grid: { display: false }
                                    },
                                    y: {
                                        type: 'linear',
                                        display: true,
                                        position: 'left',
                                        title: {
                                            display: true,
                                            text: "PO Quantity",
                                            font: { weight: 'bold' }
                                        },
                                        grid: { drawOnChartArea: false }
                                    },
                                    y1: {
                                        type: 'linear',
                                        display: true,
                                        position: 'right',
                                        title: {
                                            display: true,
                                            text: "PO Amount (₹)",
                                            font: { weight: 'bold' }
                                        },
                                        grid: { drawOnChartArea: false },
                                        ticks: {
                                            callback: function (value) {
                                                return '₹' + (value / 1000000).toFixed(1) + 'M';
                                            }
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            padding: 20
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function (context) {
                                                let label = context.dataset.label + ': ';
                                                let value = context.raw;
                                                if (context.datasetIndex === 1) {
                                                    label += '₹' + value.toLocaleString('en-IN');
                                                } else {
                                                    label += value;
                                                }
                                                return label;
                                            }
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'Monthly Purchase Order Trend'
                                    }
                                }
                            }
                        });
                    }, 100);
                },
                error: function () {
                    $('#purchaseTrendLoader').hide();
                    alert('Failed to load Monthly PO Trend data.');
                }
            });
        }

        function FillPurchaseDashboardNewVendorInThisMonthData() {
            $.ajax({
                url: '@Url.Action("FillPurchaseDashboardNewVendorInThisMonthData", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';

                    const currentDate = new Date();

                    if (!obj.Result || obj.Result.length === 0) {
                        html = `
                                                                                                                                                    <div class="no-vendors-found soft-style">
                                                                                                                                                        <i class="fas fa-box-open icon"></i>
                                                                                                                                                        <p>No new vendors added this month</p>
                                                                                                                                                    </div>`;
                    } else {
                        $.each(obj.Result, function (i, item) {
                            // Generate initials from name
                            let initials = '';
                            if (item.AccountName) {
                                initials = item.AccountName
                                    .split(' ')
                                    .map(word => word.charAt(0))
                                    .join('')
                                    .toUpperCase();
                            }

                            // Calculate date difference in days
                            let badgeHtml = '';
                            if (item.CreatedByDate) {
                                const createdDate = new Date(item.CreatedByDate);
                                const timeDiff = currentDate - createdDate;
                                const dayDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));

                                if (dayDiff >= 0) {
                                    badgeHtml = `<span class="new-badge">${dayDiff} day${dayDiff === 1 ? '' : 's'} ago</span>`;
                                }
                            }

                            html += `
                                                                                                                                                        <div class="vendor-card">
                                                                                                                                                            <div class="vendor-header">
                                                                                                                                                                <div class="vendor-logo">${initials}</div>
                                                                                                                                                                <h3>${item.AccountName}</h3>
                                                                                                                                                                ${badgeHtml}
                                                                                                                                                            </div>
                                                                                                                                                            <div class="vendor-details">
                                                                                                                                                                <div class="detail-item"><span>PO Amount:</span><strong>$${item.POAmount}</strong></div>
                                                                                                                                                                <div class="detail-item"><span>PO Number:</span><strong>${item.PONO}</strong></div>
                                                                                                                                                                <div class="detail-item"><span>Quantity:</span><strong>${item.POQTY}</strong></div>
                                                                                                                                                            </div>
                                                                                                                                                        </div>`;
                        });
                    }

                    $('.vendors-container').empty().append(html);
                },
                error: function () {
                    alert('Failed to load vendor cards.');
                }
            });
        }

        function FillPurchaseVsConsumptionDashboardData() {

            $.ajax({
                url: '@Url.Action("FillPurchaseVsConsumptionDashboardData", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr>';
                        html += '<td>' + item.PartCode + '</td>';
                        html += '<td>' + item.ItemName + '</td>';
                        html += '<td>' + item.POQty + '</td>';
                        html += '<td>' + item.ConsumptionQty + '</td>';
                        html += '</tr>';
                    });
                    $('#PoVsConsumption').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function FillBestSupplier() {
            $.ajax({
                url: '@Url.Action("FillBestSupplier", "Home")',
                type: 'POST',
                success: function (data) {
                    var obj = $.parseJSON(data);
                    var best = obj.Result || [];

                    let html = '';
                    if (best.length === 0) {
                        html = '<div class="col-12 text-center text-muted">No Best Suppliers Found</div>';
                    } else {
                        $.each(best, function (i, item) {
                            html += `
                                                                                                                                                                               <div class="supplier-card relative">

                                                                                                                                                                            <div class="supplier-name">${item.AccountName}</div>

                                                                                                                                                                    <div class="rating-container">
                                                                                                                                                                        <div class="rating-item">
                                                                                                                                                                            <div class="rating-title">Price Rating</div>
                                                                                                                                                                                    <div class="rating-value">${item.VendorPriceRating.toFixed(1)}</div>
                                                                                                                                                                            <div class="rating-bar">
                                                                                                                                                                                        <div class="rating-fill price-fill" style="width: ${item.VendorPriceRating}%"></div>
                                                                                                                                                                            </div>
                                                                                                                                                                        </div>

                                                                                                                                                                        <div class="rating-item">
                                                                                                                                                                            <div class="rating-title">Delivery Rating</div>
                                                                                                                                                                                    <div class="rating-value">${item.VendorDeliveryRating.toFixed(1)}</div>
                                                                                                                                                                            <div class="rating-bar">
                                                                                                                                                                                        <div class="rating-fill delivery-fill" style="width: ${item.VendorDeliveryRating}%"></div>
                                                                                                                                                                            </div>
                                                                                                                                                                        </div>

                                                                                                                                                                        <div class="rating-item">
                                                                                                                                                                            <div class="rating-title">Quality Rating</div>
                                                                                                                                                                                    <div class="rating-value">${item.VendorQualityRating.toFixed(1)}</div>
                                                                                                                                                                            <div class="rating-bar">
                                                                                                                                                                                        <div class="rating-fill quality-fill" style="width: ${item.VendorQualityRating}%"></div>
                                                                                                                                                                            </div>
                                                                                                                                                                        </div>

                                                                                                                                                                        <div class="rating-item">
                                                                                                                                                                            <div class="rating-title">Final Rating</div>
                                                                                                                                                                                    <div class="rating-value">${item.VendorFinalRating.toFixed(1)}</div>
                                                                                                                                                                            <div class="rating-bar">
                                                                                                                                                                                        <div class="rating-fill final-fill" style="width: ${item.VendorFinalRating}%"></div>
                                                                                                                                                                            </div>
                                                                                                                                                                        </div>
                                                                                                                                                                    </div>
                                                                                                                                                                </div>
                                                                                                                                                                    `;
                        });
                    }

                    $('#supplierContainer').html(html);
                },
                error: function () {
                    $('#supplierContainer').html('<div class="col-12 text-danger text-center">Failed to load vendor data</div>');
                }
            });
        }

        function FillWorstSupplier() {
            $.ajax({
                url: '@Url.Action("FillWorstSupplier", "Home")',
                type: 'POST',
                success: function (data) {
                    var obj = $.parseJSON(data);
                    var worst = obj.Result || [];

                    let html = '';
                    if (worst.length === 0) {
                        html = '<div class="col-12 text-center text-muted">No worst Suppliers Found</div>';
                    } else {
                        $.each(worst, function (i, item) {
                            html += `
                                                                                                                                                                                       <div class="supplier-card relative">

                                                                                                                                                                                    <div class="supplier-name">${item.AccountName}</div>

                                                                                                                                                                            <div class="rating-container">
                                                                                                                                                                                <div class="rating-item">
                                                                                                                                                                                    <div class="rating-title">Price Rating</div>
                                                                                                                                                                                            <div class="rating-value">${item.VendorPriceRating.toFixed(1)}</div>
                                                                                                                                                                                    <div class="rating-bar">
                                                                                                                                                                                                <div class="rating-fill price-fill" style="width: ${item.VendorPriceRating}%"></div>
                                                                                                                                                                                    </div>
                                                                                                                                                                                </div>

                                                                                                                                                                                <div class="rating-item">
                                                                                                                                                                                    <div class="rating-title">Delivery Rating</div>
                                                                                                                                                                                            <div class="rating-value">${item.VendorDeliveryRating.toFixed(1)}</div>
                                                                                                                                                                                    <div class="rating-bar">
                                                                                                                                                                                                <div class="rating-fill delivery-fill" style="width: ${item.VendorDeliveryRating}%"></div>
                                                                                                                                                                                    </div>
                                                                                                                                                                                </div>

                                                                                                                                                                                <div class="rating-item">
                                                                                                                                                                                    <div class="rating-title">Quality Rating</div>
                                                                                                                                                                                            <div class="rating-value">${item.VendorQualityRating.toFixed(1)}</div>
                                                                                                                                                                                    <div class="rating-bar">
                                                                                                                                                                                                <div class="rating-fill quality-fill" style="width: ${item.VendorQualityRating}%"></div>
                                                                                                                                                                                    </div>
                                                                                                                                                                                </div>

                                                                                                                                                                                <div class="rating-item">
                                                                                                                                                                                    <div class="rating-title">Final Rating</div>
                                                                                                                                                                                            <div class="rating-value">${item.VendorFinalRating.toFixed(1)}</div>
                                                                                                                                                                                    <div class="rating-bar">
                                                                                                                                                                                                <div class="rating-fill final-fill" style="width: ${item.VendorFinalRating}%"></div>
                                                                                                                                                                                    </div>
                                                                                                                                                                                </div>
                                                                                                                                                                            </div>
                                                                                                                                                                        </div>
                                                                                                                                                                            `;
                        });
                    }

                    $('#supplierWorstContainer').html(html);
                },
                error: function () {
                    alert('Failed to load supplier data.');
                }
            });
        }

        function SaveNoOfPOItemsAndPending() {
            $.ajax({
                url: '@Url.Action("SaveNoOfPOItemsAndPending", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh Total PO and Pending PO...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveTop10ItemForPO() {
            $.ajax({
                url: '@Url.Action("SaveTop10ItemForPO", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh Top 10 Items For PO...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveTop10VendorForPO() {
            $.ajax({
                url: '@Url.Action("SaveTop10VendorForPO", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh Top 10 Vendors For PO...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SavePOMonthlyTrend() {
            $.ajax({
                url: '@Url.Action("SavePOMonthlyTrend", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh PO Monthly Trend...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SavePOCategoryWise() {
            $.ajax({
                url: '@Url.Action("SavePOCategoryWise", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh PO Category...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SavePOVsConsumption() {
            $.ajax({
                url: '@Url.Action("SavePOVsConsumption", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh PO Vs Consumption...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveNewVendorOfTheMonth() {
            $.ajax({
                url: '@Url.Action("SaveNewVendorOfTheMonth", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh New Vendor Of The Month...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveBestAndWorstSupplier() {
            $.ajax({
                url: '@Url.Action("SaveBestAndWorstSupplier", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshPOAllData').val() == "false") {
                            $.notify('Successfully Refresh New Vendor Of The Month...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function RefreshPOAllData() {
            var icon = $('.refreshPOIcon');

            // Change icon to spinner
            icon.removeClass('fa-file-invoice').addClass('fa-spinner fa-spin');

            // Disable click interaction
            icon.css('pointer-events', 'none'); // Disable pointer
            icon.css('opacity', '0.6');         // Optional: show visually it's disabled

            // Let the browser render the spinner first
            setTimeout(function () {
                $('#RefreshPOAllData').val(true);

                // Call your inventory functions
                SaveNoOfPOItemsAndPending();
                SaveTop10ItemForPO();
                SaveTop10VendorForPO();
                SavePOMonthlyTrend();
                SavePOCategoryWise();
                SavePOVsConsumption();
                SaveNewVendorOfTheMonth();
                SaveBestAndWorstSupplier();

                $.notify('Successfully refreshed all PO Data...!', {
                    position: "top center",
                    className: "success"
                });

                // Reload the page
                setTimeout(function () {
                    location.reload();
                }, 1000);

            }, 10);
        }

        //Sale Order Dashboard//

        function FillDisplaySalesHeading() {
            $.ajax({
                url: '@Url.Action("FillDisplaySalesHeading", "Home")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {
                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        $('#TotalSaleOrderItemQtyofYear').text(obj.Result[0].TotalSaleOrderItemQtyofYear);
                        $('#TotalSaleOrderItemQtyofMonth').text(obj.Result[0].TotalSaleOrderItemQtyofMonth);
                        $('#TotalSaleOrderValueofYear').text(obj.Result[0].TotalSaleOrderValueofYear);
                        $('#TotalSaleOrderValueofMonth').text(obj.Result[0].TotalSaleOrderValueofMonth);
                        $('#TotalInvoiceItemQtyofYear').text(obj.Result[0].TotalInvoiceItemQtyofYear);
                        $('#TotalInvoiceItemQtyofMonth').text(obj.Result[0].TotalInvoiceItemQtyofMonth);
                        $('#TotalInvoiceValueofYear').text(obj.Result[0].TotalInvoiceValueofYear);
                        $('#TotalInvoiceValueofMonth').text(obj.Result[0].TotalInvoiceValueofMonth);
                        $('#BestCustomerOfMonth').text(obj.Result[0].BestCustomerOfMonth);
                        $('#BestCustomerAccountCode').text(obj.Result[0].BestCustomerAccountCode);
                        $('#BestSoldItemOfMonth').text(obj.Result[0].BestSoldItemOfMonth);
                        $('#BestSoldItemIdofMonth').text(obj.Result[0].BestSoldItemIdofMonth);
                        $('#BestSalesPersonOfMonth').text(obj.Result[0].BestSalesPersonOfMonth);
                        $('#BestSalesPersonofMonthEmpid').text(obj.Result[0].BestSalesPersonofMonthEmpid);
                        $('#BestSalePersonOrderValue').text(obj.Result[0].BestSalePersonOrderValue);
                        $('#NewCustomersAddinYear').text(obj.Result[0].NewCustomersAddinYear);
                        $('#NewCustomersAddinMonth').text(obj.Result[0].NewCustomersAddinMonth);
                        $('#PendDispatchQtyOfMonth').text(obj.Result[0].PendDispatchQtyOfMonth);
                        $('#PendDispatchValueOfMonth').text(obj.Result[0].PendDispatchValueOfMonth);
                        $('#ReturnSaleValueoftheMonth').text(obj.Result[0].ReturnSaleValueoftheMonth);
                        $('#ReturnSaleValueoftheYear').text(obj.Result[0].ReturnSaleValueoftheYear);
                        $('#TotalNoOfSaleorderOfMonth').text(obj.Result[0].TotalNoOfSaleorderOfMonth);
                        $('#TotalPendingNoOfSaleorderOfMonth').text(obj.Result[0].TotalPendingNoOfSaleorderOfMonth);
                        $('#TotalCompletedNoOfSaleorderOfMonth').text(obj.Result[0].TotalCompletedNoOfSaleorderOfMonth);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }

            });
        }

        function FillSALEMonthlyTrend() {
            $.ajax({
                url: '@Url.Action("FillSALEMonthlyTrend", "Home")',
                type: 'POST',
                success: function (data) {
                    var parsed = JSON.parse(data);

                    if (!parsed.Result || parsed.Result.length === 0) {
                        console.warn("No data available for SALE Monthly Trend.");
                        return;
                    }

                    const labels = parsed.Result.map(item => item.MonthCompName);
                    const saleAmounts = parsed.Result.map(item => item.salebillAmt);
                    const saleQtys = parsed.Result.map(item => item.TotalNoofSaleInv);

                    setTimeout(function () {
                        const canvas = document.getElementById("SALEMonthlyTrend");
                        if (!canvas) {
                            console.warn("Canvas with id 'SALEMonthlyTrend' not found.");
                            return;
                        }

                        const ctx = canvas.getContext("2d");
                        if (window.SALEMonthlyTrend instanceof Chart) {
                            window.SALEMonthlyTrend.destroy();
                        }

                        window.SALEMonthlyTrend = new Chart(ctx, {
                            type: "line",
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: "Sale Amount (₹)",
                                        data: saleAmounts,
                                        borderColor: "rgba(255, 165, 0, 0.9)",          // Orange border
                                        backgroundColor: "rgba(255, 165, 0, 0.3)",       // Light orange fill
                                        yAxisID: 'y',
                                        fill: false,
                                        tension: 0.4,
                                        pointRadius: 5,
                                        pointHoverRadius: 7
                                    },
                                    {
                                        label: "Sale Qty",
                                        data: saleQtys,
                                        borderColor: "rgba(34, 139, 34, 0.9)",           // Forest green border
                                        backgroundColor: "rgba(34, 139, 34, 0.3)",       // Light green fill
                                        yAxisID: 'y1',
                                        fill: false,
                                        tension: 0.4,
                                        pointRadius: 5,
                                        pointHoverRadius: 7
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            padding: 20
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function (context) {
                                                const label = context.dataset.label || '';
                                                const value = context.raw;
                                                if (label === "Sale Amount (₹)") {
                                                    return `${label}: ₹${value.toLocaleString('en-IN')}`;
                                                } else {
                                                    return `${label}: ${value}`;
                                                }
                                            }
                                        }
                                    },
                                    title: {
                                        display: true,
                                        text: 'Monthly Sale Order Trend (Line Chart)'
                                    }
                                },
                                scales: {
                                    x: {
                                        title: {
                                            display: true,
                                            text: "Month",
                                            font: { weight: 'bold' }
                                        },
                                        grid: { display: false }
                                    },
                                    y: {
                                        type: 'linear',
                                        position: 'left',
                                        title: {
                                            display: true,
                                            text: "Sale Amount (₹)",
                                            font: { weight: 'bold' }
                                        },
                                        ticks: {
                                            callback: function (value) {
                                                return '₹' + (value / 1000).toFixed(1) + 'K';
                                            }
                                        },
                                        grid: {
                                            drawOnChartArea: true
                                        }
                                    },
                                    y1: {
                                        type: 'linear',
                                        position: 'right',
                                        title: {
                                            display: true,
                                            text: "Sale Qty",
                                            font: { weight: 'bold' }
                                        },
                                        grid: {
                                            drawOnChartArea: false
                                        }
                                    }
                                }
                            }
                        });
                    }, 100);
                },
                error: function () {
                    alert('Failed to load Monthly Sale Trend data.');
                }
            });
        }

        function FillTop10SALECUSTOMER() {
            $.ajax({
                url: '@Url.Action("FillTop10SALECUSTOMER", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        var initials = item.AccountName
                            .split(' ')
                            .map(word => word[0])
                            .join('')
                            .substring(0, 2)
                            .toUpperCase();

                        html += '<tr>';
                        html += '<td>';
                        html += '<div style="display: flex; align-items: center;">';
                        html += '  <div class="initials-badge">' + initials + '</div>'; // ⬅️ RIGHT HERE
                        html += '  <div style="margin-left: 10px;">' + item.AccountName + '</div>';
                        html += '</div>';
                        html += '</td>';
                        html += '<td>' + item.SalebillAmt + '</td>';
                        html += '</tr>';
                    });
                    $('#Top10SALECUSTOMER').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load customer data.');
                }
            });
        }

        function FillTop10SOLDItem() {

            $.ajax({
                url: '@Url.Action("FillTop10SOLDItem", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr>';
                        html += '<td><input type="hidden" value="' + item.Itemcode + '">' + item.PartCode + '</td>';
                        html += '<td>' + item.ItemName + '</td>';
                        html += '<td>' + item.SalebillAmt + '</td>';
                        html += '</tr>';
                    });
                    $('#Top10SOLDItem').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function FillTop10SALESPERSON() {
            $.ajax({
                url: '@Url.Action("FillTop10SALESPERSON", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        var initials = item.SalesPersonname
                            ? item.SalesPersonname
                                .split(' ')
                                .map(word => word[0] || '')
                                .join('')
                                .substring(0, 2)
                                .toUpperCase()
                            : 'NA';

                        html += '<tr>';
                        html += '<td>';
                        html += '<div style="display: flex; align-items: center;">';
                        html += '  <div class="initials-badge">' + initials + '</div>'; // ⬅️ RIGHT HERE
                        html += '  <div style="margin-left: 10px;">' + item.SalesPersonname + '</div>';
                        html += '</div>';
                        html += '</td>';
                        html += '<td>' + item.SalebillAmt + '</td>';
                        html += '</tr>';
                    });
                    $('#Top10SALESPERSON').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load customer data.');
                }
            });
        }

        function FillNEWCustomerOFTHEMONTH() {
            $.ajax({
                url: '@Url.Action("FillNEWCustomerOFTHEMONTH", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';

                    const currentDate = new Date();

                    if (!obj.Result || obj.Result.length === 0) {
                        html = `
                                                                                                                                                            <div class="no-vendors-found soft-style">
                                                                                                                                                                <i class="fas fa-box-open icon"></i>
                                                                                                                                                                <p>No new Customer added this month</p>
                                                                                                                                                            </div>`;
                    } else {
                        $.each(obj.Result, function (i, item) {
                            // Generate initials from name
                            let initials = '';
                            if (item.AccountName) {
                                initials = item.AccountName
                                    .split(' ')
                                    .map(word => word.charAt(0))
                                    .join('')
                                    .toUpperCase()
                                    .substring(0, 2); // Only first 2 initials
                            }

                            // Calculate date difference in days
                            let badgeHtml = '';
                            if (item.CreatedByDate) {
                                const createdDate = new Date(item.CreatedByDate);
                                const timeDiff = currentDate - createdDate;
                                const dayDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));

                                if (dayDiff >= 0) {
                                    badgeHtml = `<span class="new-badge">${dayDiff} day${dayDiff === 1 ? '' : 's'} ago</span>`;
                                }
                            }

                            html += `
                                                                                                                                                                <div class="vendor-card">
                                                                                                                                                                    <div class="vendor-header">
                                                                                                                                                                        <div class="vendor-logo">${initials}</div>
                                                                                                                                                                        <h3>${item.AccountName}</h3>
                                                                                                                                                                        ${badgeHtml}
                                                                                                                                                                    </div>
                                                                                                                                                                    <div class="vendor-details">
                                                                                                                                                                                <div class="detail-item"><span>Sale Amount:</span><strong>$${item.SalebillAmt}</strong></div>
                                                                                                                                                                                        <div class="detail-item"><span>Quantity:</span><strong>${item.SaleBillQty}</strong></div>
                                                                                                                                                                    </div>
                                                                                                                                                                </div>`;
                        });
                    }

                    $('.vendors-container').empty().append(html);
                },
                error: function () {
                    alert('Failed to load vendor cards.');
                }
            });
        }

        function FillMonthlyRejectionTrend() {
            $.ajax({
                url: '@Url.Action("FillMonthlyRejectionTrend", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var salesData = $.parseJSON(data);

                    var months = salesData.Result.map(item => item.MonthCompName);
                    var salesAmounts = salesData.Result.map(item => item.salebillAmt);
                    var invoiceCounts = salesData.Result.map(item => item.TotalNoofSaleInv * 1000); // Scale for visibility

                    var ctx = document.getElementById('MonthlyRejectionTrend').getContext('2d');

                    // Destroy existing chart instance if exists
                    if (window.myChart) {
                        window.myChart.destroy();
                    }

                    window.myChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: months,
                            datasets: [
                                {
                                    label: 'Sales Amount (₹)',
                                    data: salesAmounts,
                                    backgroundColor: 'rgba(54, 162, 235, 0.6)', // Blue
                                    borderColor: 'rgba(54, 162, 235, 1)',
                                    borderWidth: 1,
                                    yAxisID: 'y',
                                    barPercentage: 0.4,        // 👈 Bar thickness
                                    categoryPercentage: 0.5    // 👈 Space between categories
                                },
                                {
                                    label: 'Total Invoices',
                                    data: invoiceCounts,
                                    backgroundColor: 'rgba(255, 99, 132, 0.4)', // Pink
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 2,
                                    type: 'line',
                                    fill: false,
                                    tension: 0.4,
                                    pointRadius: 5,
                                    pointHoverRadius: 7,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Month'
                                    },
                                    ticks: {
                                        autoSkip: false
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Sales Amount (₹)'
                                    }
                                },
                                y1: {
                                    position: 'right',
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Invoice Count'
                                    },
                                    grid: {
                                        drawOnChartArea: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    position: 'top'
                                },
                                tooltip: {
                                    mode: 'index',
                                    intersect: false
                                }
                            }
                        }
                    });
                },
                error: function (xhr, status, error) {
                    alert('Failed to load customer data.');
                }
            });
        }

        function FillSaleOrderVsDispatch() {

            $.ajax({
                url: '@Url.Action("FillSaleOrderVsDispatch", "Home")',
                type: 'POST',
                async: false,
                success: function (data, status, error) {
                    var obj = $.parseJSON(data);
                    var html = '';
                    $.each(obj.Result, function (i, item) {
                        html += '<tr>';
                        html += '<td><input type="hidden" value="' + item.AccountCode + '">' + item.AccountName + '</td>';
                        html += '<td>' + item.PartCode + '</td>';
                        html += '<td>' + item.ItemName + '</td>';
                        html += '<td>' + item.SOQty + '</td>';
                        html += '<td>' + item.SaleBillQty + '</td>';
                        html += '<td>' + item.PendQtyForSaleBill + '</td>';
                        html += '<td>' + item.SaleOrderValue + '</td>';
                        html += '<td>' + item.PendingOrderValue  + '</td>';
                        html += '</tr>';
                    });
                    $('#SaleOrderVsDispatch').empty().append(html);
                },
                error: function (xhr, status, error) {
                    alert('Failed to load ledger names.');
                }
            });
        }

        function SaveDisplaySalesHeading() {
            $.ajax({
                url: '@Url.Action("SaveDisplaySalesHeading", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshSalesAllData').val() == "false") {
                            $.notify('Successfully Refresh Display Sales Heading...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveNewCustomerOfTheMonth() {
            $.ajax({
                url: '@Url.Action("SaveNewCustomerOfTheMonth", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshSalesAllData').val() == "false") {
                            $.notify('Successfully Refresh New Customer of the Month...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveTop10SaleCustomer() {
            $.ajax({
                url: '@Url.Action("SaveTop10SaleCustomer", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshSalesAllData').val() == "false") {
                            $.notify('Successfully Refresh Top 10 Sale Customer...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveTop10SoldItem() {
            $.ajax({
                url: '@Url.Action("SaveTop10SoldItem", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshSalesAllData').val() == "false") {
                            $.notify('Successfully Refresh Top 10 Sold Items...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveSaleMonthlyTrend() {
            $.ajax({
                url: '@Url.Action("SaveSaleMonthlyTrend", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshSalesAllData').val() == "false") {
                            $.notify('Successfully Refresh Monthly Trend...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveTop10SalesPerson() {
            $.ajax({
                url: '@Url.Action("SaveTop10SalesPerson", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {
                     
                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshSalesAllData').val() == "false") {
                            $.notify('Successfully Refresh Top 10 Sales Person...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function SaveSaleOrderVsDispatch() {
            $.ajax({
                url: '@Url.Action("SaveSaleOrderVsDispatch", "XONDashboard")',
                type: 'POST',
                async: false,
                data: {},
                success: function (response, status, error) {

                    var obj = $.parseJSON(response);
                    if (obj.StatusCode == 200 && obj.StatusText === 'Success') {
                        if ($('#RefreshSalesAllData').val() == "false") {
                            $.notify('Successfully Refresh SaleOrder Vs Dispatch...!', { position: "top center", className: "success" });
                            setTimeout(function () {
                                location.reload(); // Refresh after 2 seconds
                            }, 1000);
                        }
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to save data.');
                }
            });
        }

        function RefreshSalesAllData() {
            var icon = $('.refreshSaleIcon');

            // Change icon to spinner
            icon.removeClass('fa-file-invoice-dollar').addClass('fa-spinner fa-spin');

            // Disable click interaction
            icon.css('pointer-events', 'none'); // Disable pointer
            icon.css('opacity', '0.6');         // Optional: show visually it's disabled

            // Let the browser render the spinner first
            setTimeout(function () {
                $('#RefreshSalesAllData').val(true);

                // Call your inventory functions
                SaveDisplaySalesHeading();
                SaveNewCustomerOfTheMonth();
                SaveTop10SaleCustomer();
                SaveTop10SoldItem();
                SaveSaleMonthlyTrend();
                SaveTop10SalesPerson();
                SaveSaleOrderVsDispatch();

                $.notify('Successfully refreshed all SO Data...!', {
                    position: "top center",
                    className: "success"
                });

                // Reload the page
                setTimeout(function () {
                    location.reload();
                }, 1000);

            }, 10);
        }

    </script>
}