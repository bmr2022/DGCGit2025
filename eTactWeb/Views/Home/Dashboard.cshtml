@model eTactWeb.DOM.Models.DashboardModel

@{
	ViewData["Title"] = "Dashboard";
	Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Combined Dashboard</title>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<style>
		body {
			font-family: 'Segoe UI', sans-serif;
			background-color: #f7f9fa;
			margin: 20px;
		}

		h2 {
			text-align: center;
			font-size: 28px;
			margin-bottom: 20px;
		}

		.dashboard {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
			gap: 20px;
			margin: 10px;
		}

		.card {
			background: white;
			padding: 1px;
			border-radius: 12px;
			box-shadow: 0 2px 8px rgba(0,0,0,0.05);
		}

			.card h3 {
				margin: 0;
				font-size: 1rem;
				color: #555;
			}

			.card .value {
				font-size: 2rem;
				font-weight: bold;
				margin-top: 10px;
			}

		.wide-card {
			grid-column: span 2;
		}

		canvas {
			margin-top: 10px;
		}

		table {
			width: 100%;
			border-collapse: collapse;
			font-size: 0.9rem;
		}

			table th, table td {
				padding: 8px;
				border-bottom: 1px solid #eee;
				text-align: left;
			}

		ul {
			padding-left: 20px;
		}

		.highlight-red {
			color: red;
			font-weight: bold;
		}

		.card-container {
			display: flex;
			gap: 20px;
			justify-content: center;
			flex-wrap: wrap;
			margin-bottom: 30px;
		}

		.dashboard-card {
			display: flex;
			flex: 1 1 250px; /* grows and shrinks, minimum width 250px */
			background-color: white;
			border-radius: 10px;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
			max-width: 450px;
			overflow: hidden;
			min-height: 80px;
		}

			.dashboard-card .icon-box {
				width: 80px;
				background-color: #7ba5e7;
				color: white;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 40px;
				cursor: pointer;
			}

			.dashboard-card.red .icon-box {
				background-color: #d06359;
			}

			.dashboard-card .card-content {
				padding: 12px 15px;
				display: flex;
				flex-direction: column;
				justify-content: center;
			}

				.dashboard-card .card-content h3 {
					font-size: 15px;
					margin: 0;
					color: #333;
				}

				.dashboard-card .card-content .value {
					font-size: 20px;
					font-weight: bold;
					color: #111;
				}

		/* Chart section */
		.chart-section {
			max-width: 800px;
			margin: 0 auto;
			background-color: #fff;
			border-radius: 10px;
			padding: 20px;
			box-shadow: 0 2px 6px rgba(0,0,0,0.1);
		}

		canvas {
			width: 100% !important;
			height: 300px !important;
		}

		.table-container {
			width: 100%;
			max-width: 1000px;
			background: white;
			border-radius: 6px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
			overflow: hidden;
		}

		.custom-table {
			font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
			font-size: 14px;
			width: 100%;
			border-collapse: collapse;
		}

			.custom-table tbody tr:nth-child(even) {
				background-color: #c9d6eb;
			}

		.custom-table-scroll {
			max-height: 400px;
			overflow-y: auto;
			border-radius: 8px;
		}

		.custom-table thead th {
			position: sticky;
			top: 0;
			background-color: #4a6fa5;
			color: white;
			padding: 5px 10px; /* tighter */
			text-align: left;
			z-index: 2;
			font-weight: 600;
		}

		.custom-table tbody td {
			padding: 5px 10px; /* less padding */
			color: #333;
			border-bottom: 1px solid #ddd;
			font-weight: 650;
			font-size: 10px;
		}

		.pending-table thead th {
			position: sticky;
			top: 0;
			background-color: #4a6fa5;
			color: white;
			padding: 5px 10px; /* tighter */
			text-align: left;
			z-index: 2;
			font-weight: 600;
		}

		.tab-nav {
			display: flex;
			border-bottom: 2px solid #ccc;
		}

			.tab-nav .tab-link {
				display: flex;
				align-items: center;
				padding: 0px 8px;
				cursor: pointer;
				background: #f2f2f2;
				border: none;
				outline: none;
				font-weight: 600;
				border-radius: 12px;
				color: #333;
				border-radius: 8px 8px 0 0;
				transition: background 0.3s;
				gap: 12px;
			}

				.tab-nav .tab-link.active {
					background: #c7d9ed;
					color: #fff;
				}

		/* Tab Content Area */
		.tab-content {
			display: none;
			padding: 20px;
			background: #fff;
			border: 2px solid #ccc;
			border-top: none;
			border-radius: 0 0 8px 8px;
		}

			.tab-content.active {
				display: block;
			}

		.tab-icon-container {
			width: 35px;
			height: 35px;
			border-radius: 6px;
			display: flex;
			justify-content: center;
			align-items: center;
			color: white;
			font-size: 18px;
			flex-shrink: 0;
		}

		.bg-icon {
			background-color: #325db0;
		}

		.tab-text {
			font-size: 16px;
			font-weight: 500;
			color: #333;
		}

		.card-row {
			display: flex;
			gap: 20px; /* space between cards */
			flex-wrap: wrap; /* for responsiveness on smaller screens */
			margin: 10px;
		}

		.card-header {
			padding: 16px 20px;
			display: flex;
			align-items: center;
			background-color: #99b1d6;
			color: #333;
		}

		.card-icon {
			font-size: 24px;
			margin-right: 12px;
			width: 40px;
			height: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 8px;
			background-color: rgba(255, 255, 255, 0.2);
		}

		.card-title {
			font-size: 16px;
			font-weight: 600;
			margin: 0;
		}

		.card-body {
			padding: 8px;
		}

		.metrics-container {
			display: flex;
			justify-content: space-between;
		}

		.metric {
			flex: 1;
			padding: 12px;
			border-radius: 8px;
			position: relative;
		}

			.metric:first-child {
				margin-right: 10px;
				background-color: rgba(16, 185, 129, 0.1);
			}

			.metric:nth-child(2) {
				margin: 0 10px;
				background-color: rgba(234, 179, 8, 0.1); /* yellowish for completed */
			}

			.metric:last-child {
				margin: 0 10px;
				background-color: rgba(79, 70, 229, 0.1);
			}

		.metric-period {
			font-size: 15px;
			font-weight: 500;
			margin-bottom: 6px;
			display: flex;
			align-items: center;
			color: var(--text-light);
		}

		.metric-value {
			font-size: 18px;
			font-weight: 700;
			margin: 8px 0 4px;
			color: var(--text-dark);
		}

		.metric-change {
			font-size: 12px;
			display: flex;
			align-items: center;
		}

		.positive-change {
			color: var(--secondary-color);
		}

		.negative-change {
			color: #ef4444;
		}

		.metric-icon {
			margin-right: 6px;
		}

		.purchase-card {
			background: white;
			border-radius: 12px;
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
			overflow: hidden;
			width: 100%;
			max-width: 450px;
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

			.purchase-card:hover {
				transform: translateY(-5px);
				box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
			}

		.app-version-card {
			width: 300px;
			background: #fff;
			border: 1px solid #ddd;
			border-radius: 6px;
			padding: 16px;
			font-family: Arial, sans-serif;
			box-shadow: 0 2px 4px rgba(0,0,0,0.05);
		}

			.app-version-card .header {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.app-version-card h3 {
				margin: 0;
				font-size: 16px;
				color: #333;
			}

		.sub-header {
			margin: 10px 0;
			font-size: 13px;
			color: #666;
		}

		.version-bar {
			display: flex;
			align-items: center;
			margin: 6px 0;
		}

			.version-bar .label {
				width: 60px;
				font-size: 12px;
				color: #333;
			}

		.bar-container {
			flex: 1;
			height: 10px;
			background: #eee;
			border-radius: 2px;
			overflow: hidden;
		}

		.bar {
			height: 100%;
			background: #4a6fa5;
			border-radius: 2px;
		}

		.version-bar .value {
			width: 40px;
			font-size: 12px;
			text-align: right;
			color: #333;
		}

		.vendors-container {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 12px;
			width: 100%;
		}

		.vendor-card {
			background: white;
			border-radius: 8px;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
			padding: 12px;
			transition: transform 0.2s ease;
			overflow-wrap: break-word; /* Wrap long words */
			word-break: break-word; /* Break long PONOs or names */
			display: flex;
			flex-direction: column;
		}

			.vendor-card:hover {
				transform: translateY(-5px);
				box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
			}

		.vendor-header {
			display: flex;
			align-items: center;
			gap: 8px;
			position: relative;
			flex-wrap: wrap; /* Allows long names to wrap below the badge */
		}

		.vendor-logo {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			background: #e0e7ff;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: bold;
			color: #4a6bff;
			font-size: 0.9rem;
			flex-shrink: 0;
		}

		.vendor-header h3 {
			margin: 0;
			font-size: 12px;
			white-space: normal;
			overflow-wrap: break-word;
			flex: 1;
		}

		.new-badge {
			position: absolute;
			top: -20px;
			right: 0;
			background: #acc3e6;
			color: #020202;
			padding: 0px 8px;
			border-radius: 7px;
			font-size: 0.7rem;
			white-space: nowrap;
		}

		.vendor-details {
			display: grid;
			gap: 6px;
			font-size: 10px;
		}

		.detail-item {
			display: flex;
			justify-content: space-between;
			word-break: break-word; /* Prevent overflow */
		}

			.detail-item span {
				color: #666;
				margin-right: 5px;
			}

	</style>
</head>
<body>
	<div class="tab-nav">
		<button class="tab-link active" data-target="#inventoryTab">
			<div class="tab-icon-container bg-icon" onclick="RefreshInventoryAllData()">
				<i class="fa fa-boxes refreshIcon" style="font-size: 24px; cursor: pointer;"></i>
			</div>
			<div class="tab-text">
				Inventory Dashboard
			</div>
		</button>
		<button class="tab-link" data-target="#supplyChainTab">
			<div class="tab-icon-container bg-icon">
				<i class="fas fa-truck"></i>
			</div>
			<div class="tab-text">
				Supply Chain Dashboard
			</div>
		</button>
		<button class="tab-link" data-target="#purchaseTab">
			<div class="tab-icon-container bg-icon">
				<i class="fas fa-file-invoice"></i>
			</div>
			<div class="tab-text">
				Purchase Dashboard
			</div>
		</button>
	</div>
	<div id="inventoryTab" class="tab-content active">
		<!-- Inventory Dashboard -->
		<div class="card-container">
			<input type="hidden" id="TotalRMValue" />
			<input type="hidden" id="TotalFGValue" />
			<input type="hidden" id="TotalStockValue" />
			<input type="hidden" id="TotalConsValue" />
			<input type="hidden" id="TotalToolsValue" />
			<input type="hidden" id="TotalOthersValue" />
			<input type="hidden" id="TotalItemQtyOfDeadStock" />
			<input type="hidden" id="TotalItemQtyOfFastMovingStock" />
			<input type="hidden" id="RefreshInventoryAllData" />
			<div class="dashboard-card">
				<div class="icon-box" onclick="FillNoOfItemInStock()" title="Refresh No Of Item In Stock">
					<i class="fas fa-coins"></i>
				</div>
				<div class="card-content">
					<h3>Total Stock Value (₹)</h3>
					<div class="value TotalStockValue" id="TotalStockValue">0</div>
				</div>
			</div>
			<div class="dashboard-card">
				<div class="icon-box" onclick="StockValuation()">
					<i class="fas fa-box"></i>
				</div>
				<div class="card-content">
					<h3>Total Items in Stock</h3>
					<div class="value" id="TotalNoofItemInStock"></div>
				</div>
			</div>
			<div class="dashboard-card red">
				<div class="icon-box" onclick="DeadStockInventoryTask()">
					<i class="fas fa-triangle-exclamation"></i>
				</div>
				<div class="card-content">
					<h3>Dead Stock Items</h3>
					<div class="value" id="TotalNoOfDeadStockItems"></div>
				</div>
			</div>
			<div class="dashboard-card red">
				<div class="icon-box" onclick="DeadStockInventoryTask()">
					<i class="fas fa-circle-exclamation"></i>
				</div>
				<div class="card-content">
					<h3>Dead Stock Value (₹)</h3>
					<div class="value" id="TotalValueOfDeadStock"></div>
				</div>
			</div>
		</div>
		<div class="dashboard">
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3 style="margin: 0;">Valuation By Category</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-list-alt " style="font-size: 24px;cursor:pointer;" onclick="StockValuation()"></i>
					</div>
				</div>
				<div class="card-body">
					<h3>Total Stock Value (₹): <span class="TotalStockValue">0</span></h3>
					<canvas id="valuationByCategoryChart"></canvas>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3 style="margin: 0;">Inventory by Category</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="StockValuation()"></i>
					</div>
				</div>
				<div class="card-body">
					<canvas id="inventoryByCategoryChart"></canvas>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3 style="margin: 0;">Fast vs Slow Moving Items</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-clock" style="font-size: 24px;cursor:pointer;" onclick="FastVsSlowMovingTask()"></i>
					</div>
				</div>
				<div class="card-body">
					<canvas id="fastSlowChart"></canvas>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>Pending</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-hourglass-half" style="font-size: 24px;cursor:pointer;" onclick="PendingInventoryTask()"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:300px;overflow-y: auto;">
					<table class="pending-table">
						<thead><tr><th>Form</th><th>Qty</th></tr></thead>
						<tbody>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingRequisitionToIssue" asp-controller="PendingRequisitionToIssue" id="MaterialtoIssueWOBOM" target="_blank">Req Without BOM</a></td>
								<td><span id="PendRequisitionWithoutBOM">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingMaterialToIssueThrBOM" asp-controller="PendingMaterialToIssueThrBOM" id="MaterialtoIssueThrBOM" target="_blank">Req Against BOM</a></td>
								<td><span id="PendingReqAgainstBOM">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingProductionSchedule" asp-controller="PendingProductionSchedule" id="IssueAgainstProdSchedule" target="_blank">Against Plan</a></td>
								<td><span id="PendingAgainstPlan">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="MaterialReceipt" asp-controller="MaterialReceipt" id="MaterialReceiptNote" target="_blank">Gate Entry For MRN</a></td>
								<td><span id="PendingGateEntryForMRN">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingMRNtoQc" asp-controller="PendingMRNtoQc" id="MRIR" target="_blank">MRN For Qc</a></td>
								<td><span id="PendingMRNForQc">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="JobWorkReceive" asp-controller="JobWorkReceive" id="JobWorkReceive" target="_blank">Gate Entry For JW MRN</a></td>
								<td><span id="PendingGateEntryForJWMrn">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingToReceiveItem" asp-controller="PendingToReceiveItem" id="ReceiveItemInStore" target="_blank">ReceiveItem In Store</a></td>
								<td><span id="PendingToReceiveItemInStore">0</span></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="dashboard">
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>Top Items by Stock Value</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="StockValuation()"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:300px;">
					<table class="custom-table custom-table-scroll" style="width: 100%;">
						<thead style="background-color:#7493c3">
							<tr>
								<th>PartCode</th>
								<th>ItemName</th>
								<th>Stock</th>
								<th>Value</th>
							</tr>
						</thead>
						<tbody id="TopItemByStockValue">
						</tbody>
					</table>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>Top Items Below Min Level</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-arrow-down" style="font-size: 24px;cursor:pointer" onclick="StockValuation()"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:300px;">
					<table class="custom-table" style="width: 100%;">
						<thead style="background-color:#7493c3">
							<tr>
								<th>PartCode</th>
								<th>ItemName</th>
								<th>Stock</th>
							</tr>
						</thead>
						<tbody id="TopItemBelowMinLevel">
						</tbody>
					</table>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>Top Fast Moving Item</h3>
					<div class="tab-icon-container bg-icon" onclick="FastMovingItemsListTask()">
						<i class="fas fa-chart-line" style="font-size: 24px;"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:300px;overflow-y: auto;">
					<table class="custom-table" style="width: 100%;">
						<thead style="background-color:#7493c3">
							<tr>
								<th>PartCode</th>
								<th>ItemName</th>
								<th>IssQty</th>
								<th>Transaction</th>
							</tr>
						</thead>
						<tbody id="TopFastMovingItem">
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
	<div id="supplyChainTab" class="tab-content">
		<!-- Supply Chain Dashboard -->
		<div class="dashboard">
			<div class="card">
				<h3>Perfect Orders</h3>
				<canvas id="perfectOrdersChart"></canvas>
				<p>In Time, Meet Quality/Quantity, Correct Invoice</p>
			</div>
			<div class="card">
				<h3>Total Shipping Cost</h3>
				<div class="value">770.7K</div>
			</div>
			<div class="card">
				<h3>Total Quantity Shipped</h3>
				<div class="value">1.52M</div>
			</div>
			<div class="card">
				<h3>Total International Shipment</h3>
				<div class="value">1.07M</div>
			</div>
			<div class="card">
				<h3>Perfect Orders by Warehouse</h3>
				<canvas id="warehouseBarChart"></canvas>
			</div>
			<div class="card">
				<h3>Return by Product Type</h3>
				<canvas id="returnByProdChart"></canvas>
			</div>
			<div class="card">
				<h3>Total Return & Trend</h3>
				<canvas id="returnTrendChart"></canvas>
			</div>
		</div>
	</div>
	<div id="purchaseTab" class="tab-content">
		<input type="hidden" id="RefreshPOAllData" />
		<div class="card-row">
			<div class="purchase-card">
				<div class="card-header">
					<div class="card-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
						<i class="fas fa-money-bill-wave"></i>
					</div>
					<h3 class="card-title">Purchase Order Value</h3>
				</div>
				<div class="card-body">
					<div class="metrics-container">
						<div class="metric">
							<div class="metric-period">
								<i class="fas fa-calendar-alt metric-icon"></i>
								Annual
							</div>
							<div class="metric-value" id="TotalNoofAnualPONetValue">0</div>
							<div class="metric-change positive-change">
								<i class="fas fa-arrow-up metric-icon"></i>
								+<span id="">0</span>% from last year
							</div>
							<div class="metric-footer">Total Orders 2023</div>
						</div>

						<div class="metric">
							<div class="metric-period">
								<i class="fas fa-calendar-week metric-icon"></i>
								Monthly
							</div>
							<div class="metric-value" id="ToatalNoOfMonthlyPONetValue">0</div>
							<div class="metric-change positive-change">
								<i class="fas fa-arrow-up metric-icon"></i>
								+5.1% from last month
							</div>
							<div class="metric-footer">October 2023</div>
						</div>
					</div>
				</div>
			</div>
			<div class="purchase-card">
				<div class="card-header">
					<div class="card-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
						<i class="fas fa-shopping-cart"></i>
					</div>
					<h3 class="card-title">Purchase Order Qty</h3>
				</div>
				<div class="card-body">
					<div class="metrics-container">
						<div class="metric">
							<div class="metric-period">
								<i class="fas fa-calendar-alt metric-icon"></i>
								Annual
							</div>
							<div class="metric-value" id="TotalNoOfAnualPOQty">0</div>
							<div class="metric-change positive-change">
								<i class="fas fa-arrow-up metric-icon"></i>
								+8.7% from last year
							</div>
							<div class="metric-footer">Total Orders 2023</div>
						</div>

						<div class="metric">
							<div class="metric-period">
								<i class="fas fa-calendar-week metric-icon"></i>
								Monthly
							</div>
							<div class="metric-value" id="ToatalNoOfMonthlyPOQty">0</div>
							<div class="metric-change positive-change">
								<i class="fas fa-arrow-up metric-icon"></i>
								+5.1% from last month
							</div>
							<div class="metric-footer">October 2023</div>
						</div>
					</div>
				</div>
			</div>
			<div class="purchase-card">
				<div class="card-header">
					<div class="card-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
						<i class="fas fa-tasks"></i>
					</div>
					<h3 class="card-title">Purchase Order Status</h3>
				</div>
				<div class="card-body">
					<div class="metrics-container">
						<div class="metric">
							<div class="metric-period">
								<i class="fas fa-list-alt metric-icon"></i>
								Total
							</div>
							<div class="metric-value" id="TotalPOPendingAndComplted">0</div>
							<div class="metric-change positive-change">
								<i class="fas fa-arrow-up metric-icon"></i>
								+8.7% from last year
							</div>
							<div class="metric-footer">Total Orders 2023</div>
						</div>
						<div class="metric">
							<div class="metric-period">
								<i class="fas fa-check-circle metric-icon"></i>
								Completed
							</div>
							<div class="metric-value" id="CompletedPOAndSchedule">0</div>
							<div class="metric-change positive-change">
								<i class="fas fa-arrow-up metric-icon"></i>
								+5.1% from last month
							</div>
							<div class="metric-footer">October 2023</div>
						</div>
						<div class="metric">
							<div class="metric-period">
								<i class="fas fa-hourglass-half metric-icon"></i>
								Pending
							</div>
							<div class="metric-value" id="PendingPOAndSchedule">0</div>
							<div class="metric-change positive-change">
								<i class="fas fa-arrow-up metric-icon"></i>
								+5.1% from last month
							</div>
							<div class="metric-footer">October 2023</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="dashboard">
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3 style="margin: 0;">PO Value by Category</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="SavePOCategoryWise()"></i>
					</div>
				</div>
				<div class="card-body">
					<canvas id="poTopItemByValueChart"></canvas>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3 style="margin: 0;">PO Trend</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-clock" style="font-size: 24px;cursor:pointer;" onclick="SavePOMonthlyTrend()"></i>
					</div>
				</div>
				<div class="card-body">
					<canvas id="purchaseTrendChart"></canvas>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>Pending</h3>
					<div class="tab-icon-container bg-icon" onclick="SaveNoOfPOItemsAndPending()" style="cursor:pointer">
						<i class="fas fa-hourglass-half" style="font-size: 24px;cursor:pointer;" onclick="PendingInventoryTask()"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:300px;overflow-y: auto;">
					<table class="pending-table">
						<thead>
							<tr>
								<th>Form</th>
								<th>Qty</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><a class="table-link link-primary" asp-controller="Indent" target="_blank" asp-action="Indent" id="Indent">Indent For PO</a></td>
								<td><span id="PendingIndentForPO">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="POApproval" target="_blank" asp-controller="POApproval" asp-route-ID="0" id="PO&AmendmentApproval">PO Approval For First Approvak</a></td>
								<td><span id="PendingPOApprovalForFirstApproval">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingPOApprovalForMgmtApproval" target="_blank" asp-controller="PendingPOApprovalForMgmtApproval" id="POApprovalForMgmtApproval">PO Approval For Mgmt Approval</a></td>
								<td><span id="PendingPOApprovalForMgmtApproval">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PSApproval" asp-controller="PSApproval" target="_blank" asp-route-ID="0" id="PSApproval">Amendment PO For Approval</a></td>
								<td><span id="PendingAmendmentPOForApproval">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="SOApproval" asp-controller="SOApproval" target="_blank" asp-route-ID="0" id="SOApproval">Schedule For Approval</a></td>
								<td><span id="PendingScheduleForApproval">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="SSApproval" asp-controller="SSApproval" target="_blank" id="SSApproval">Amendment Schedule For Approval</a></td>
								<td><span id="PendingAmendmentScheduleForApproval">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingMRP" asp-controller="PendingMRP" target="_blank" id="PendingMRP">SO For MRP</a></td>
								<td><span id="PendingSOForMRP">0</span></td>
							</tr>
							<tr>
								<td><a class="table-link link-primary" asp-action="PendingMRPForPO" asp-controller="PendingMRPForPO" target="_blank" id="MRPForPO">MRP For PO</a></td>
								<td><span id="PendingMRPForPO">0</span></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="dashboard">
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>Top 10 Items Value</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SaveTop10ItemForPO()"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:300px;">
					<table class="custom-table custom-table-scroll" style="width: 100%;">
						<thead style="background-color:#7493c3">
							<tr>
								<th>PartCode</th>
								<th>ItemName</th>
								<th>Qty</th>
								<th>Amount</th>
							</tr>
						</thead>
						<tbody id="TopItemByStockValueForPO">
						</tbody>
					</table>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>Top Vendors Value</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SaveTop10VendorForPO()"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:350px;">
					<table class="custom-table custom-table-scroll" style="width: 100%;">
						<thead style="background-color:#7493c3">
							<tr>
								<th>AccountName</th>
								<th>Qty</th>
								<th>Amount</th>
							</tr>
						</thead>
						<tbody id="Top10VendorByValue">
						</tbody>
					</table>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3 style="margin: 0;">Top 10 Best Vendors</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="StockValuation()"></i>
					</div>
				</div>
				<div class="card-body">
					<div class="version-bar">
						<span class="label">0.1.5.2</span>
						<div class="bar-container">
							<div class="bar" style="width: 80%;"></div>
						</div>
						<span class="value">123k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.3</span>
						<div class="bar-container">
							<div class="bar" style="width: 70%;"></div>
						</div>
						<span class="value">53k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.4</span>
						<div class="bar-container">
							<div class="bar" style="width: 65%;"></div>
						</div>
						<span class="value">23k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.5</span>
						<div class="bar-container">
							<div class="bar" style="width: 50%;"></div>
						</div>
						<span class="value">3k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.6</span>
						<div class="bar-container">
							<div class="bar" style="width: 40%;"></div>
						</div>
						<span class="value">1k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.2</span>
						<div class="bar-container">
							<div class="bar" style="width: 35%;"></div>
						</div>
						<span class="value">123k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.3</span>
						<div class="bar-container">
							<div class="bar" style="width: 30%;"></div>
						</div>
						<span class="value">53k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.4</span>
						<div class="bar-container">
							<div class="bar" style="width: 20%;"></div>
						</div>
						<span class="value">23k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.5</span>
						<div class="bar-container">
							<div class="bar" style="width: 10%;"></div>
						</div>
						<span class="value">3k</span>
					</div>
					<div class="version-bar">
						<span class="label">0.1.5.6</span>
						<div class="bar-container">
							<div class="bar" style="width: 5%;"></div>
						</div>
						<span class="value">1k</span>
					</div>
				</div>
			</div>
		</div>
		<div class="dashboard">
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3 style="margin: 0;">Worst Vendors</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fa fa-boxes" style="font-size: 24px;cursor:pointer;" onclick="StockValuation()"></i>
					</div>
				</div>
				<div class="card-body">
					<canvas id="inventoryByCategoryChart"></canvas>
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>New Vendor In this Month</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SaveNewVendorOfTheMonth()"></i>
					</div>
				</div>

				<div class="vendors-container" style="max-height:300px;overflow-y: auto;padding:15px;">					
				</div>
			</div>
			<div class="card">
				<div style="width: 100%; background-color: #f0f0f0; padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-radius: 8px;">
					<h3>PO vs Consumption</h3>
					<div class="tab-icon-container bg-icon">
						<i class="fas fa-sort-amount-up-alt" style="font-size: 24px;cursor:pointer" onclick="SavePOVsConsumption()"></i>
					</div>
				</div>
				<div class="table-container" style="max-height:350px;overflow-y:auto;">
					<table class="custom-table custom-table-scroll" style="width: 100%;">
						<thead style="background-color:#7493c3">
							<tr>
								<th>PartCode</th>
								<th>ItemName</th>
								<th>PO Qty</th>
								<th>Cons Qty</th>
							</tr>
						</thead>
						<tbody id="PoVsConsumption">
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>
</body>
</html>

@section Scripts {

	<!-- Chart JS Scripts -->
	<script>

				document.addEventListener("DOMContentLoaded", function () {
					const tabLinks = document.querySelectorAll(".tab-link");
					const tabContents = document.querySelectorAll(".tab-content");

					function activateTab(tabId) {
						// Remove "active" from all links and contents
						tabLinks.forEach(link => link.classList.remove("active"));
						tabContents.forEach(content => {
							content.style.display = "none";
							content.classList.remove("active");
						});

						// Activate selected tab
						const activeLink = [...tabLinks].find(link => link.dataset.target === `#${tabId}`);
						const activeContent = document.getElementById(tabId);
						if (activeLink) activeLink.classList.add("active");
						if (activeContent) {
							activeContent.style.display = "block";
							activeContent.classList.add("active");
						}

						// Load tab-specific data
						if (tabId === "purchaseTab") {
							$('#RefreshPOAllData').val(false);
							FillPurchaseDashboardData();
							FillPurchaseDashboardTop10ItemData();
							FillPurchaseDashboardTop10VendorData();
							FillPurchaseDashboardDataMonthlyTrend();
							FillPurchaseDashboardDataByCategoryValue();
							FillPurchaseDashboardNewVendorInThisMonthData();
							FillPurchaseVsConsumptionDashboardData();
						} else if (tabId === "inventoryTab") {
							$('#RefreshInventoryAllData').val(false);
							FillInventoryDashboardData();
							FillInventoryDashboardForPendingData();
							FillInventoryByCategory();
							GetTopItemByStockValue();
							GetTopItemBelowMinLevel();
							GetTopFastMovingItem();
						}
					}

					// On initial load
					const hash = window.location.hash || "#inventoryTab";
					activateTab(hash.substring(1));

					// On tab click
					tabLinks.forEach(link => {
						link.addEventListener("click", function () {
							const targetId = link.dataset.target.substring(1);
							activateTab(targetId);
							history.replaceState(null, null, '#' + targetId);
						});
					});
				});

				function FillInventoryDashboardData(){
					$.ajax({
								url: '@Url.Action("FillInventoryDashboardData", "Home")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										$('.TotalStockValue').text(obj.Result[0].TotalStockValue);
										$('#TotalNoofItemInStock').text(obj.Result[0].TotalNoofItemInStock);
										$('#TotalNoOfDeadStockItems').text(obj.Result[0].TotalNoOfDeadStockItems);
										$('#TotalValueOfDeadStock').text(obj.Result[0].TotalValueOfDeadStock);
										$('#TotalRMValue').val(obj.Result[0].TotalRMValue);
										$('#TotalFGValue').val(obj.Result[0].TotalFGValue);
										$('#TotalConsValue').val(obj.Result[0].TotalConsValue);
										$('#TotalToolsValue').val(obj.Result[0].TotalToolsValue);
										$('#TotalOthersValue').val(obj.Result[0].TotalOthersValue);
										$('#TotalItemQtyOfDeadStock').val(obj.Result[0].TotalItemQtyOfDeadStock);
										$('#TotalItemQtyOfFastMovingStock').val(obj.Result[0].TotalItemQtyOfFastMovingStock);

										var TotalStock = parseInt($('.TotalStockValue').text());

										var dataMap = {
										  RM: $('#TotalRMValue').val(),
										  FG: $('#TotalFGValue').val(),
										  Cons: $('#TotalConsValue').val(),
										  Tools: $('#TotalToolsValue').val(),
										  Others: $('#TotalOthersValue').val()
										};

										var xValues = Object.entries(dataMap).map(([key, val]) => {
											return `${key} - ${val}`;
										});
										var yValues = Object.values(dataMap);
										var barColors = [
											"#f28ea3",
											"#6a92cc",
											"#f3ddd8",
											"#4da97b",
											"#ffbb4d"
										];

										new Chart("valuationByCategoryChart", {
										  type: "pie",
										  data: {
											labels: xValues,
											datasets: [{
											  backgroundColor: barColors,
											  hoverBackgroundColor: barColors,
											  data: yValues
											}]
										  },
										  options: {
											title: {
											  display: true,
											  text: "Valuation by Category"
											}
										  }
										});
									}

									// Get dynamic values from your input fields
									let slowMovingQty = parseInt($('#TotalItemQtyOfDeadStock').val()) || 0;
									let fastMovingQty = parseInt($('#TotalItemQtyOfFastMovingStock').val()) || 0;

									// Create the doughnut chart with dynamic data
									new Chart("fastSlowChart", {
									  type: "doughnut",
									  data: {
										labels: ["Fast Movers", "Slow Movers"],
										datasets: [{
										  backgroundColor: ["#1abc9c", "#e67e22"],
										  data: [fastMovingQty, slowMovingQty]
										}]
									  }
									});
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}

							});
				}

				function FillInventoryDashboardForPendingData(){
					$.ajax({
								url: '@Url.Action("FillInventoryDashboardForPendingData", "Home")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										$('#PendRequisitionWithoutBOM').text(obj.Result[0].PendRequisitionWithoutBOM);
										$('#PendingReqAgainstBOM').text(obj.Result[0].PendingReqAgainstBOM);
										$('#PendingAgainstPlan').text(obj.Result[0].PendingAgainstPlan);
										$('#PendingGateEntryForMRN').text(obj.Result[0].PendingGateEntryForMRN);
										$('#PendingMRNForQc').text(obj.Result[0].PendingMRNForQc);
										$('#PendingGateEntryForJWMrn').text(obj.Result[0].PendingGateEntryForJWMrn);
										$('#PendingToReceiveItemInStore').text(obj.Result[0].PendingToReceiveItemInStore);
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

				function FillInventoryByCategory(){
					$.ajax({
								url: '@Url.Action("FillInventoryByCategory", "Home")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										var result = obj.Result;
										var xValues = result.map(x => x.ItemCategory);
										var yValues = result.map(x => x.CategoryStock);

										var barColors = ["#f28ea3", "#66d9d0", "#7fa6d9", "#f4dcd6", "#6fcf97", "#fbd490"];

										new Chart("inventoryByCategoryChart", {
												type: "bar",
												data: {
													labels: xValues,
													datasets: [{
														backgroundColor: barColors,
														hoverBackgroundColor: barColors,
														data: yValues,
														barThickness: 25, // Force specific bar width (px)
													}]
												},
												options: {
													maintainAspectRatio: false, // Allow custom height/width
													plugins: {
														legend: {
															display: false
														},
														title: {
															display: true,
															text: "Inventory By Category"
														}
													},
													scales: {
														x: {
															categoryPercentage: 0.5, // Reduce spacing between bars
															barPercentage: 1.0,      // Use full width inside category
															ticks: {
																autoSkip: false,
																maxRotation: 30,
																minRotation: 30
															}
														},
														y: {
															beginAtZero: true
														}
													}
												}
											});
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

				function GetTopItemByStockValue(){

					$.ajax({
								url: '@Url.Action("GetTopItemByStockValue", "Home")',
								type: 'POST',
								async: false,
								success: function (data, status, error) {
									var obj = $.parseJSON(data);
									var html = '';
									$.each(obj.Result, function (i, item) {
										html += '<tr onclick="handleRowClick(\'' + item.Itemcode + '\')" style="cursor:pointer;">';
										html += '<td><input type="hidden" value="' + item.Itemcode +'">' + item.PartCode + '</td>';
										html += '<td>' + item.ItemName + '</td>';
										html += '<td>' + item.Stock + '</td>';
										html += '<td>' + item.StockValue + '</td>';
										html += '</tr>';
									});
									$('#TopItemByStockValue').empty().append(html);
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

				function GetTopItemBelowMinLevel(){

					$.ajax({
								url: '@Url.Action("GetTopItemBelowMinLevel", "Home")',
								type: 'POST',
								async: false,
								success: function (data, status, error) {
									var obj = $.parseJSON(data);
									var html = '';
									$.each(obj.Result, function (i, item) {
										html += '<tr onclick="handleRowClickMinValue(\'' + item.PartCode + '\')" style="cursor:pointer;">';
										html += '<td><input type="hidden" value="' + item.Itemcode +'">' + item.PartCode + '</td>';
										html += '<td>' + item.ItemName + '</td>';
										html += '<td>' + item.Stock + '</td>';
										html += '</tr>';
									});
									$('#TopItemBelowMinLevel').empty().append(html);
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

				function GetTopFastMovingItem(){

					$.ajax({
								url: '@Url.Action("GetTopFastMovingItem", "Home")',
								type: 'POST',
								async: false,
								success: function (data, status, error) {
									var obj = $.parseJSON(data);
									var html = '';
									$.each(obj.Result, function (i, item) {
										html += '<tr onclick="handleRowClickMinValue(\'' + item.PartCode + '\')" style="cursor:pointer;">';
										html += '<td><input type="hidden" value="' + item.Itemcode +'">' + item.PartCode + '</td>';
										html += '<td>' + item.ItemName + '</td>';
										html += '<td>' + item.IssQty + '</td>';
										html += '<td>' + item.NoOfTransaction + '</td>';
										html += '</tr>';
									});
									$('#TopFastMovingItem').empty().append(html);
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

				function handleRowClick(ItemCode){
					localStorage.setItem('SelectedItemCode', ItemCode);
					var url = '/StockValuation/Index';
					window.location.href = url;
				}

				function handleRowClickMinValue(PartCode){
					localStorage.setItem('SelectedMinItemCode', PartCode);
					var url = '/MinimumMaximaumLevel/Index';
					window.location.href = url;
				}
				// Inventory Dashboard Charts


				// new Chart("movementChart", {
				//   type: "line",
				//   data: {
				// 	labels: ["Day 1", "Day 5", "Day 10", "Day 15", "Day 20", "Day 25", "Day 30"],
				// 	datasets: [
				// 	  { label: "Raw Materials", borderColor: "#3498db", fill: false, data: [100, 120, 140, 160, 180, 200, 220] },
				// 	  { label: "Finished Goods", borderColor: "#2ecc71", fill: false, data: [80, 100, 110, 130, 160, 180, 210] }
				// 	]
				//   },
				//   options: { legend: { display: true }, scales: { y: { beginAtZero: true } } }
				// });

				// Supply Chain Dashboard Charts
				new Chart("perfectOrdersChart", {
				  type: "doughnut",
				  data: {
					labels: ["Perfect", "Others"],
					datasets: [{
					  data: [90.1, 9.9],
					  backgroundColor: ["#2ecc71", "#ecf0f1"]
					}]
				  },
				  options: {
					cutout: '70%',
					plugins: { legend: { display: false } }
				  }
				});

				new Chart("warehouseBarChart", {
				  type: "bar",
				  data: {
					labels: ["California", "Texas", "Kansas", "New Jersey"],
					datasets: [{
					  label: "Perfect Orders",
					  data: [30, 25, 15, 10],
					  backgroundColor: "#3498db"
					}]
				  },
				  options: { scales: { y: { beginAtZero: true } } }
				});

				new Chart("returnByProdChart", {
				  type: "bar",
				  data: {
					labels: ["Type A", "Type B", "Type C", "Type D"],
					datasets: [
					  { label: "US", data: [10, 14, 8, 6], backgroundColor: "#e74c3c" },
					  { label: "Canada", data: [6, 9, 5, 4], backgroundColor: "#2ecc71" },
					  { label: "Germany", data: [4, 7, 3, 2], backgroundColor: "#f1c40f" }
					]
				  },
				  options: {
					plugins: { legend: { position: 'bottom' } },
					scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } }
				  }
				});

				new Chart("returnTrendChart", {
				  type: "line",
				  data: {
					labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
					datasets: [
					  {
						label: "Return Volume",
						data: [20000, 25000, 30000, 28000, 31000, 34000],
						borderColor: "#e67e22",
						fill: false,
						tension: 0.3
					  }
					]
				  },
				  options: { scales: { y: { beginAtZero: true } } }
				});

				function RefreshInventoryAllData() {
					var icon = $('.refreshIcon');

					// Change icon to spinner
					icon.removeClass('fa-boxes').addClass('fa-spinner fa-spin');

					// Disable click interaction
					icon.css('pointer-events', 'none'); // Disable pointer
					icon.css('opacity', '0.6');         // Optional: show visually it's disabled

					// Let the browser render the spinner first
					setTimeout(function () {
						$('#RefreshInventoryAllData').val(true);

						// Call your inventory functions
						FillNoOfItemInStock();
						StockValuation();
						DeadStockInventoryTask();
						PendingInventoryTask();
						FastVsSlowMovingTask();
						FastMovingItemsListTask();

						$.notify('Successfully refreshed all Inventory Data...!', {
							position: "top center",
							className: "success"
						});

						// Reload the page
						setTimeout(function () {
							location.reload();
						}, 1000);

					}, 10);
				}

				function FillNoOfItemInStock(){
					debugger
					$.ajax({
								url: '@Url.Action("NoOfItemInStock", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshInventoryAllData').val() == "false"){
											$.notify('Successfully Refresh No Of item In Stock...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function StockValuation(){
					$.ajax({
								url: '@Url.Action("StockValuation", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshInventoryAllData').val() == "false"){
											$.notify('Successfully Refresh No Of item In Stock...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function PendingInventoryTask(){
					$.ajax({
								url: '@Url.Action("PendingInventoryTask", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshInventoryAllData').val() == "false"){
											$.notify('Successfully Refresh Pending Item Job List...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function DeadStockInventoryTask(){
					$.ajax({
								url: '@Url.Action("DeadStockInventoryTask", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshInventoryAllData').val() == "false"){
											$.notify('Successfully Refresh Dead item In Stock...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function FastMovingItemsListTask(){
					$.ajax({
								url: '@Url.Action("FastMovingItemsListTask", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshInventoryAllData').val() == "false"){
											$.notify('Successfully Refresh FastMoving ItemList...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function FastVsSlowMovingTask(){
					$.ajax({
								url: '@Url.Action("FastVsSlowMovingTask", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshInventoryAllData').val() == "false"){
											$.notify('Successfully Refresh Fast Vs Slow Moving Task...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				//Purchase Order Dashboard//

				function FillPurchaseDashboardData(){
					$.ajax({
								url: '@Url.Action("FillPurchaseDashboardData", "Home")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										$('#TotalNoofAnualPONetValue').text(obj.Result[0].TotalNoofAnualPONetValue);
										$('#TotalNoOfAnualPOQty').text(obj.Result[0].TotalNoOfAnualPOQty);
										$('#ToatalNoOfMonthlyPONetValue').text(obj.Result[0].ToatalNoOfMonthlyPONetValue);
										$('#ToatalNoOfMonthlyPOQty').text(obj.Result[0].ToatalNoOfMonthlyPOQty);
										$('#TotalClosePOCompleted').text(obj.Result[0].TotalClosePOCompleted);
										$('#TotalClosePOPending').text(obj.Result[0].TotalClosePOPending);
										$('#TotalScheduleCompleted').text(obj.Result[0].TotalScheduleCompleted);
										$('#TotalSchedulePending').text(obj.Result[0].TotalSchedulePending);
										$('#PendingIndentForPO').text(obj.Result[0].PendingIndentForPO);
										$('#PendingPOApprovalForFirstApproval').text(obj.Result[0].PendingPOApprovalForFirstApproval);
										$('#PendingPOApprovalForMgmtApproval').text(obj.Result[0].PendingPOApprovalForMgmtApproval);
										$('#PendingAmendmentPOForApproval').text(obj.Result[0].PendingAmendmentPOForApproval);
										$('#PendingScheduleForApproval').text(obj.Result[0].PendingScheduleForApproval);
										$('#PendingAmendmentScheduleForApproval').text(obj.Result[0].PendingAmendmentScheduleForApproval);
										$('#PendingSOForMRP').text(obj.Result[0].PendingSOForMRP);
										$('#PendingMRPForPO').text(obj.Result[0].PendingMRPForPO);

										var TotalPOPendingAndComplted = obj.Result[0].TotalClosePOCompleted + obj.Result[0].TotalClosePOPending + obj.Result[0].TotalScheduleCompleted + obj.Result[0].TotalSchedulePending;
										$('#TotalPOPendingAndComplted').text(TotalPOPendingAndComplted);

										var CompletedPOAndSchedule = obj.Result[0].TotalClosePOCompleted + obj.Result[0].TotalScheduleCompleted;
										$('#CompletedPOAndSchedule').text(CompletedPOAndSchedule);

										var PendingPOAndSchedule = obj.Result[0].TotalClosePOPending + obj.Result[0].TotalSchedulePending;
										$('#PendingPOAndSchedule').text(PendingPOAndSchedule);
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

												function FillPurchaseDashboardDataByCategoryValue() {
			debugger;
			$.ajax({
				url: '@Url.Action("FillPurchaseDashboardDataByCategoryValue", "Home")',
				type: 'POST',
				async: false,
				success: function (data) {
					var parsed = JSON.parse(data);

					var xValues = parsed.Result.map(item => item.ItemCategory);
					var yValues = parsed.Result.map(item => item.POQty);
					var poAmounts = parsed.Result.map(item => item.POAmount);

					var barColors = [
						"#ffb3b3", "#66d9e8", "#7da6e5", "#f2d6cc", "#66cc99",
						"#ffc285", "#bfa5d8", "#7ddad2", "#e08e8e", "#79c7f2"
					];

					setTimeout(function () {
						const canvas = document.getElementById("poTopItemByValueChart");
						if (!canvas) {
							console.warn("Canvas with id 'poTopItemByValueChart' not found.");
							return;
						}

						const ctx = canvas.getContext("2d");

						if (window.poTopItemByValueChart instanceof Chart) {
							window.poTopItemByValueChart.destroy();
						}

						window.poTopItemByValueChart = new Chart(ctx, {
							type: "bar", // Changed to bar
							data: {
								labels: xValues,
								datasets: [{
									label: "PO Qty",
									data: yValues,
									backgroundColor: barColors.slice(0, xValues.length),
									poAmounts: poAmounts // for tooltip
								}]
							},
							options: {
								responsive: true,
								maintainAspectRatio: false,
								scales: {
									x: {
										title: {
											display: true,
											text: "Item Category"
										}
									},
									y: {
										beginAtZero: true,
										title: {
											display: true,
											text: "PO Quantity"
										}
									}
								},
								plugins: {
									legend: {
										display: false
									},
									title: {
										display: true,
										text: 'Top PO Items by Category'
									},
									tooltip: {
										callbacks: {
											label: function (context) {
												const qty = context.raw;
												const amt = context.dataset.poAmounts[context.dataIndex];
												return `Qty: ${qty}, Amt: ₹${amt.toLocaleString()}`;
											}
										}
									}
								}
							}
						});
					}, 100);
				},
				error: function () {
					alert('Failed to load PO Category chart data.');
				}
			});
		}


				function FillPurchaseDashboardTop10ItemData(){

					$.ajax({
								url: '@Url.Action("FillPurchaseDashboardTop10ItemData", "Home")',
								type: 'POST',
								async: false,
								success: function (data, status, error) {
									var obj = $.parseJSON(data);
									var html = '';
									$.each(obj.Result, function (i, item) {
										html += '<tr onclick="handleRowClick(\'' + item.itemcode + '\')" style="cursor:pointer;">';
										html += '<td><input type="hidden" value="' + item.itemcode +'">' + item.Partcode + '</td>';
										html += '<td>' + item.ItemName + '</td>';
										html += '<td>' + item.POQTY + '</td>';
										html += '<td>' + item.POAmount + '</td>';
										html += '</tr>';
									});
									$('#TopItemByStockValueForPO').empty().append(html);
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

				function FillPurchaseDashboardTop10VendorData(){

					$.ajax({
								url: '@Url.Action("FillPurchaseDashboardTop10VendorData", "Home")',
								type: 'POST',
								async: false,
								success: function (data, status, error) {
									var obj = $.parseJSON(data);
									var html = '';
									$.each(obj.Result, function (i, item) {
										html += '<tr onclick="handleRowClick(\'' + item.AccountCode + '\')" style="cursor:pointer;">';
										html += '<td><input type="hidden" value="' + item.AccountCode +'">' + item.AccountName + '</td>';
										html += '<td>' + item.POQTY + '</td>';
										html += '<td>' + item.POAmount + '</td>';
										html += '</tr>';
									});
									$('#Top10VendorByValue').empty().append(html);
								},
								error: function (xhr, status, error) {
									alert('Failed to load ledger names.');
								}
							});
				}

								function FillPurchaseDashboardDataMonthlyTrend() {
			$.ajax({
				url: '@Url.Action("FillPurchaseDashboardDataMonthlyTrend", "Home")',
				type: 'POST',
				success: function (data) {
					var parsed = JSON.parse(data);

					var xValues = parsed.Result.map(item => item.MonthCompName);
					var poQtyValues = parsed.Result.map(item => item.POQty);
					var poAmountValues = parsed.Result.map(item => item.POAmount);

					var lineColors = [
						"rgba(54, 162, 235, 0.8)", // Blue
						"rgba(75, 192, 192, 0.8)", // Teal
						"rgba(255, 99, 132, 0.8)", // Red
						"rgba(255, 206, 86, 0.8)", // Yellow
						"rgba(153, 102, 255, 0.8)" // Purple
					];

					setTimeout(function () {
						const canvas = document.getElementById("purchaseTrendChart");
						if (!canvas) {
							console.warn("Canvas with id 'purchaseTrendChart' not found.");
							return;
						}

						const ctx = canvas.getContext("2d");

						if (window.purchaseTrendChart instanceof Chart) {
							window.purchaseTrendChart.destroy();
						}

						window.purchaseTrendChart = new Chart(ctx, {
							type: "line",
							data: {
								labels: xValues,
								datasets: [
									{
										label: "PO Qty",
										data: poQtyValues,
										borderColor: lineColors[0],
										backgroundColor: lineColors[0],
										fill: false,
										tension: 0.3,
										poAmounts: poAmountValues // custom for tooltip
									}
								]
							},
							options: {
								responsive: true,
								maintainAspectRatio: false,
								scales: {
									x: {
										title: {
											display: true,
											text: "Month"
										}
									},
									y: {
										beginAtZero: true,
										title: {
											display: true,
											text: "PO Quantity"
										}
									}
								},
								plugins: {
									legend: {
										display: false
									},
									title: {
										display: true,
										text: 'Monthly PO Trend'
									},
									tooltip: {
										callbacks: {
											label: function (context) {
												const qty = context.raw;
												const amt = context.dataset.poAmounts[context.dataIndex];
												return `Qty: ${qty}, Amt: ₹${amt.toLocaleString()}`;
											}
										}
									}
								}
							}
						});
					}, 100);
				},
				error: function () {
					alert('Failed to load Monthly PO Trend data.');
				}
			});
		}

		function FillPurchaseDashboardNewVendorInThisMonthData() {
			$.ajax({
				url: '@Url.Action("FillPurchaseDashboardNewVendorInThisMonthData", "Home")',
				type: 'POST',
				async: false,
				success: function (data, status, error) {
					var obj = $.parseJSON(data);
					var html = '';

					const currentDate = new Date();

					$.each(obj.Result, function (i, item) {
						// Generate initials from name
						let initials = '';
						if (item.AccountName) {
							initials = item.AccountName
								.split(' ')
								.map(word => word.charAt(0))
								.join('')
								.toUpperCase();
						}

						// Calculate date difference in days
						let badgeHtml = '';
						if (item.CreatedByDate) {
							const createdDate = new Date(item.CreatedByDate);
							const timeDiff = currentDate - createdDate; // in ms
							const dayDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));

							if (dayDiff >= 0) {
								badgeHtml = `<span class="new-badge">${dayDiff} day${dayDiff === 1 ? '' : 's'} ago</span>`;
							}
						}

						html += `
							<div class="vendor-card">
								<div class="vendor-header">
									<div class="vendor-logo">${initials}</div>
									<h3>${item.AccountName}</h3>
									${badgeHtml}
								</div>
								<div class="vendor-details">
									<div class="detail-item"><span>PO Amount:</span><strong>$${item.POAmount}</strong></div>
									<div class="detail-item"><span>PO Number:</span><strong>${item.PONO}</strong></div>
									<div class="detail-item"><span>Quantity:</span><strong>${item.POQTY}</strong></div>
								</div>
							</div>`;
					});

					$('.vendors-container').empty().append(html);
				},
				error: function () {
					alert('Failed to load vendor cards.');
				}
			});
		}

				function FillPurchaseVsConsumptionDashboardData(){

							$.ajax({
												url: '@Url.Action("FillPurchaseVsConsumptionDashboardData", "Home")',
										type: 'POST',
										async: false,
										success: function (data, status, error) {
											var obj = $.parseJSON(data);
											var html = '';
											$.each(obj.Result, function (i, item) {
												html += '<tr>';
												html += '<td>' + item.PartCode + '</td>';
												html += '<td>' + item.ItemName + '</td>';
												html += '<td>' + item.POQty + '</td>';
												html += '<td>' + item.ConsumptionQty + '</td>';
												html += '</tr>';
											});
											$('#PoVsConsumption').empty().append(html);
										},
										error: function (xhr, status, error) {
											alert('Failed to load ledger names.');
										}
									});
				}

				function SaveNoOfPOItemsAndPending(){
					$.ajax({
								url: '@Url.Action("SaveNoOfPOItemsAndPending", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshPOAllData').val() == "false"){
											$.notify('Successfully Refresh Total PO and Pending PO...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function SaveTop10ItemForPO(){
					$.ajax({
								url: '@Url.Action("SaveTop10ItemForPO", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshPOAllData').val() == "false"){
											$.notify('Successfully Refresh Top 10 Items For PO...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function SaveTop10VendorForPO(){
					$.ajax({
								url: '@Url.Action("SaveTop10VendorForPO", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshPOAllData').val() == "false"){
											$.notify('Successfully Refresh Top 10 Vendors For PO...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function SavePOMonthlyTrend(){
					$.ajax({
								url: '@Url.Action("SavePOMonthlyTrend", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshPOAllData').val() == "false"){
											$.notify('Successfully Refresh PO Monthly Trend...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function SavePOCategoryWise(){
					$.ajax({
								url: '@Url.Action("SavePOCategoryWise", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshPOAllData').val() == "false"){
											$.notify('Successfully Refresh PO Category...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function SavePOVsConsumption(){
					$.ajax({
								url: '@Url.Action("SavePOVsConsumption", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshPOAllData').val() == "false"){
											$.notify('Successfully Refresh PO Vs Consumption...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}

				function SaveNewVendorOfTheMonth(){
					$.ajax({
								url: '@Url.Action("SaveNewVendorOfTheMonth", "XONDashboard")',
								type: 'POST',
								async: false,
								data: {},
								success: function (response, status, error) {

									var obj = $.parseJSON(response);
									if (obj.StatusCode == 200 && obj.StatusText === 'Success'){
										if($('#RefreshPOAllData').val() == "false"){
											$.notify('Successfully Refresh New Vendor Of The Month...!', { position: "top center", className: "success" });
											setTimeout(function () {
												location.reload(); // Refresh after 2 seconds
											}, 1000);
										}
									}
								},
								error: function (xhr, status, error) {
									alert('Failed to save data.');
								}
							});
				}
	</script>
}