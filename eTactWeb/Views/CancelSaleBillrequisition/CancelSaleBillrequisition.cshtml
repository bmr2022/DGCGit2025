@model eTactWeb.DOM.Models.CancelSaleBillrequisitionModel;
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div class="card bg-gradient mb-3 border-light shadow-lg">
    <form asp-action="CancelSaleBillrequisition" asp-controller="CancelSaleBillrequisition" method="post" autocomplete="on" class="form-horizontal">
        <div class="card-header card-headerBG text-light bg-gradient">
            <div class="card-header card-headerBG text-light justify-content-center bg-gradient">
                <h5>
                    <strong>Cancel Sale Bill Requisition</strong>
                    <span class="d-flex float-end" style="margin-top:-2px;">
                        <a asp-controller="CancelSaleBillrequisition" asp-action="CancelSaleBillrequisitionDashBoard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">
                            <i class="fa-solid fa-grip fa-fw fa-lg fa-beat" aria-hidden="true"></i>
                            Dashboard
                        </a>
                        <div class="row justify-content-between g-2">
                            <div class="col-auto">
                                <a href="#" class="btn btn-primary btn-sm" onclick="PressBack();">
                                    <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                    BACK
                                </a>
                            </div>
                            @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                            {
                                <div class="col-auto">
                                    <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                        <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                        REFRESH
                                    </a>
                                </div>
                                @if (Model.Mode == "U"  )
                                {
                                    Model.Mode = "U";
                                    <div class="col-auto">
                                        <button type="submit" class="UpdateButton btn btn-sm btn-outline-light bg-gradient submitBTN">
                                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                            UPDATE
                                        </button>
                                    </div>
                                }

                                else
                                {
                                    <div class="col-auto">
                                        <button type="submit" class="btn btn-primary btn-sm submitBTN">
                                            <i class="fa-solid fa-chevron-circle-right"></i>
                                            SUBMIT
                                        </button>
                                    </div>
                                }
                            }
                        </div>
                    </span>
                </h5>
            </div>
            <div class="card-body bg-light">
                <div class="accordion shadow-lg" id="accordionItemCategory">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="H_ItemCategoryDetail">
                            <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_ItemCategoryDetail"
                                    aria-expanded="true" aria-controls="B_ItemCategoryDetail">
                                <strong><i class="fa fa-fw pr35 fa-book fa-lg" aria-hidden="true"></i>Cancel SaleBill requisition</strong>
                                <small class="p-3"></small>
                            </button>
                        </h2>
                        <div id="B_ItemCategoryDetail" class="accordion-collapse collapse pnl1 bg-gradient show" aria-labelledby="H_ItemCategoryDetail">
                            <div class="accordion-body">
                                <div class="row g-2">
                                     
                                    <input type="hidden" value="@Model.Mode" asp-for="Mode" /> 
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="CanSaleBillReqEntryid" class="form-label">Entry Id</label>
                                        <input type="text" asp-for="CanSaleBillReqEntryid" readonly class="form-control" />
                                        <input type="hidden" asp-for="ReqNo" id="ReqNo" class="form-control" />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="CanSaleBillReqYearcode" class="form-label">  Yearcode</label>
                                        <input asp-for="CanSaleBillReqYearcode" class="form-control"  readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:120px;">
                                        <label asp-for="CanSaleBillReqDate" class="form-label">Requisition Date</label>
                                        <input asp-for="CanSaleBillReqDate" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" type="date"  readonly/>
                                    </div>

                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:140px;">
                                        <label asp-for="CanRequisitionNo" class="form-label"> Requisition No</label>
                                        <input asp-for="CanRequisitionNo" class="form-control"  readonly/>
                                    </div>
                                    @* <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12" style="display:none">
                                        <label asp-for="AccountCode" class="form-label"></label>
                                        <select class="form-control" asp-for="AccountCode">
                                            <option value="">-Select-</option>
                                            @if (Model.Mode == "U" || Model.Mode == "V")
                                            {
                                                <option value="@Model.AccountCode" selected>@Model.AccountCode</option>
                                            }
                                        </select>
                                    </div> *@
                                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                        <label asp-for="CustomerName" class="form-label">Customer Name</label>
                                         <input type="hidden" asp-for="AccountCode" id="AccountCode" class="form-control" value="@Model.AccountCode" /> 
                                        <select class="form-control" id="CustomerName" asp-for="CustomerName">
                                            <option value="@Model.AccountCode">-Select-</option>
                                            @if (Model.Mode == "U" || Model.Mode == "V")
                                            {
                                                <option value="@Model.AccountCode" selected>@Model.CustomerName</option>
                                            }
                                        </select>
                                    </div>

                                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                        <label asp-for="SaleBillNo" class="form-label">Sale Bill No</label>
                                        <select class="form-control" asp-for="SaleBillNo">
                                            <option value="@Model.SaleBillNo">-Select-</option>
                                            @if (Model.Mode == "U" || Model.Mode == "V")
                                            {
                                                <option value="@Model.SaleBillNo" selected>@Model.SaleBillNo</option>
                                            }
                                        </select>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:140px;">
                                        <label asp-for="SaleBillYearCode" class="form-label">SaleBill YearCode</label>
                                        <input asp-for="SaleBillYearCode" class="form-control" id="SaleBillYearCode" readonly value="@Model.SaleBillYearCode" />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:115px;">
                                        <label asp-for="SaleBillDate" class="form-label">SaleBill Date</label>
                                        <input asp-for="SaleBillDate" class="form-control"  readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="SaleBillEntryId" class="form-label">SaleBill EntryId</label>
                                        <input asp-for="SaleBillEntryId" class="form-control" readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="BillAmt" class="form-label">BillAmt</label>
                                        <input asp-for="BillAmt" class="form-control"  readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="INVNetAmt" class="form-label">INV NetAmt</label>
                                        <input asp-for="INVNetAmt" class="form-control"  readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:140px;">
                                        <label asp-for="ReasonOfCancel" class="form-label">Reason Of Cancel</label>
                                        <input asp-for="ReasonOfCancel" class="form-control"  />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="ApprovedBy" class="form-label">Approved By</label>
                                        <input asp-for="ApprovedBy" class="form-control"  readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="CC" class="form-label">CC</label>
                                        <input asp-for="CC" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="uid" class="form-label">UID</label>
                                        <input asp-for="uid" class="form-control"  readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="Canceled" class="form-label">Canceled</label>
                                        <input asp-for="Canceled" class="form-control" value="No" readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="VoucherType" class="form-label">Voucher Type</label>
                                        <input asp-for="VoucherType" class="form-control" value="any" readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="ApprovalDate" class="form-label">Approval Date</label>
                                        <input asp-for="ApprovalDate" class="form-control" value="10/dec/2024" readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="CancelDate" class="form-label">Cancel Date</label>
                                        <input asp-for="CancelDate" class="form-control" value="13/dec/2024" readonly/>
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:170px;">
                                        <label asp-for="MachineName" class="form-label">MachineName</label>
                                        <input asp-for="MachineName" class="form-control" value="@Environment.MachineName" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:170px;">
                                        <label asp-for="Requisitionby" class="form-label">Requisitionby</label>
                                        <input asp-for="Requisitionby" class="form-control"   />
                                    </div>

                                    

                                    
                                    @* <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 col-xs-12">
                                        <label class="form-label" asp-for="Requisitionby">Requisition by</label>
                                      
                                        <select class="form-control" asp-for="Requisitionby" >
                                            <option value="@Model.Requisitionby">-Select-</option>
                                            @if (Model.Mode == "U" || Model.Mode == "V")
                                            {
                                                <option value="@Model.Requisitionby" selected>@Model.Requisitionby</option>
                                            }
                                        </select>
                                    </div> *@
                                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
            <div class="progress my-3 mb-3" style="height: 4px;">
                <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
           
            <div class="card-footer p-3">
                <div class="row justify-content-between g-2">
                    <div class="card-header card-headerBG text-light bg-gradient">
                        <h5>
                            <strong>Cancel Sale bill Requisition</strong>

                            <span class="d-flex float-end" style="margin-top:-2px;">
                                <div class="col-auto">
                                    @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                    <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="PrintButton">
                                        <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                        PRINT
                                    </button>
                                </div>
                                @*<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">*@
                                <a asp-controller="CancelSalebillRequisition" asp-action="CancelSalebillRequisitionDashBoard" tabindex="-1" asp-route-ID="0" class="btn btn-secondary btn-sm">
                                    <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                                    Dashboard
                                </a>
                                @*<partial name="_FormsButton" />*@
                                <div class="row justify-content-between g-2">
                                    <div class="col-auto">
                                        @*  <input asp-for="FromDateBack" type="hidden" value="@Model.FromDateBack" />
                                        <input asp-for="ToDateBack" type="hidden" value="@Model.ToDateBack" />
                                        <input asp-for="GroupNameBack" type="hidden" value="@Model.GroupNameBack" />
                                        <input asp-for="LedgerNameBack" type="hidden" value="@Model.LedgerNameBack" />
                                        <input asp-for="OpeningForYearBack" type="hidden" value="@Model.OpeningForYearBack" />
                                        <input asp-for="PreviousAmountBack" type="hidden" value="@Model.PreviousAmountBack" />
                                        <input asp-for="DrCrBack" type="hidden" value="@Model.DrCrBack" />
                                        <input asp-for="GlobalSearchBack" type="hidden" value="@Model.GlobalSearchBack" /> *@

                                        @*<a href="#" class="btn offer-listbtn hvr-sweep-to-right btn-sm btn-secondary" onclick="back();">*@
                                        <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                            <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                            BACK
                                        </a>
                                    </div>
                                    @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                                    {
                                        <div class="col-auto">
                                            @*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
                                            <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                                @* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
                                                <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                                REFRESH
                                            </a>
                                        </div>
                                        @if (Model.Mode == "U"  )
                                        {
                                            @*Model.Mode = "U";*@
                                            <div class="col-auto">
                                                @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                                <button type="submit" class="UpdateButton btn btn-sm btn-outline-light bg-gradient submitBTN">
                                                    <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                                    UPDATE
                                                </button>
                                            </div>
                                        }
                                        else
                                        {
                                            <div class="col-auto">
                                                <button type="submit" class="btn btn-primary btn-sm submitBTN">
                                                    <i class="fa-solid fa-chevron-circle-right"></i>
                                                    SUBMIT
                                                </button>
                                            </div>
                                        }
                                    }
                                </div>
                            </span>
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </form>      
</div>



@section Scripts {
    <script>

        $('.submitBTN').click(function (e) {
            e.preventDefault();
            $('form').submit();
        });


        $(document).ready(function () {

            $('#SaleBillNo').rules("remove", "required");
            $('#CustomerName').rules("remove", "required");
            $('#CanSaleBillReqEntryid').rules("remove", "required");

            $('#SaleBillNo').select2();
            $('#CustomerName').select2();
            //$('#Requisitionby').select2();
            //$('#SaleBillYearCode').select2();
            if ($('#SaleBillNo').val() === "") { // Assuming an input field for Center Name
                $.notify("SaleBill Nunmber is required.", "warn");
            }
            
            FillCanSaleBillReqEntryid();
            FillCanRequisitionNo();
            FillSaleBillNo();
            FillCustomerName();
            
        });
        $('#CustomerName').change(function () {
            $('#AccountCode').val($('#CustomerName').val());
            });
        
        $('#SaleBillNo').change(function () {
            FillSaleBillNoYear();
            FillSaleBillNoDate();
            FillSaleBillINVNetAmt();
            FillSaleBillBillAmt();
            FillSaleBillEntryId();
        })

        function FillCanSaleBillReqEntryid() {
            var CanSaleBillReqYearcode = $("#CanSaleBillReqYearcode").val();
            $.ajax({
                url: '@Url.Action("FillCanSaleBillReqEntryid", "CancelSaleBillrequisition")', // Action that returns FillGroup data
                data: {
                    CanSaleBillReqYearcode: CanSaleBillReqYearcode
                },
                type: 'POST',
                async: false,
                success: function (data, status, xhr) {
                    console.log(data);
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                        $('#CanSaleBillReqEntryid').val(0);
                        $('#CanSaleBillReqEntryid').val(obj.Result[0].EntryId);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });
        }
        function FillCanRequisitionNo() {
            var CanSaleBillReqYearcode = $("#CanSaleBillReqYearcode").val();
            $.ajax({
                url: '@Url.Action("FillCanSaleBillReqEntryid", "CancelSaleBillrequisition")', // Action that returns FillGroup data
                data: {
                    CanSaleBillReqYearcode: CanSaleBillReqYearcode
                },
                type: 'POST',
                async: false,
                success: function (data, status, xhr) {
                    console.log(data);
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                        $('#CanRequisitionNo').val(0);
                        $('#CanRequisitionNo').val(obj.Result[0].ReqNo);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });
        }
        function FillSaleBillNoDate() {
            var SaleBillYearCode = $("#SaleBillYearCode").val();
            var SaleBillNo = $("#SaleBillNo").val();
            $.ajax({
                url: '@Url.Action("FillSaleBillNoDate", "CancelSaleBillrequisition")', // Action that returns FillGroup data
                data: {
                    SaleBillYearCode: SaleBillYearCode,
                    SaleBillNo: SaleBillNo
                },
                type: 'POST',
                async: false,
                success: function (data, status, xhr) {
                    console.log(data);
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                        $('#SaleBillDate').val(0);
                        $('#SaleBillDate').val(obj.Result[0].SaleBillDate);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });
        } 
        function FillSaleBillINVNetAmt() {
            var SaleBillYearCode = $("#SaleBillYearCode").val();
            var SaleBillNo = $("#SaleBillNo").val();
            $.ajax({
                url: '@Url.Action("FillSaleBillNoDate", "CancelSaleBillrequisition")', // Action that returns FillGroup data
                data: {
                    SaleBillYearCode: SaleBillYearCode,
                    SaleBillNo: SaleBillNo
                },
                type: 'POST',
                async: false,
                success: function (data, status, xhr) {
                    console.log(data);
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                        $('#INVNetAmt').val(0);
                        $('#INVNetAmt').val(obj.Result[0].INVNetAmt);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });
        }
        function FillSaleBillBillAmt() {
            var SaleBillYearCode = $("#SaleBillYearCode").val();
            var SaleBillNo = $("#SaleBillNo").val();
            $.ajax({
                url: '@Url.Action("FillSaleBillNoDate", "CancelSaleBillrequisition")', // Action that returns FillGroup data
                data: {
                    SaleBillYearCode: SaleBillYearCode,
                    SaleBillNo: SaleBillNo
                },
                type: 'POST',
                async: false,
                success: function (data, status, xhr) {
                    console.log(data);
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                        $('#BillAmt').val(0);
                        $('#BillAmt').val(obj.Result[0].BillAmt);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });
        }
        function FillSaleBillEntryId() {
            var SaleBillYearCode = $("#SaleBillYearCode").val();
            var SaleBillNo = $("#SaleBillNo").val();
            $.ajax({
                url: '@Url.Action("FillSaleBillNoDate", "CancelSaleBillrequisition")', // Action that returns FillGroup data
                data: {
                    SaleBillYearCode: SaleBillYearCode,
                    SaleBillNo: SaleBillNo
                },
                type: 'POST',
                async: false,
                success: function (data, status, xhr) {
                    console.log(data);
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                        $('#SaleBillEntryId').val(0);
                        $('#SaleBillEntryId').val(obj.Result[0].SaleBillEntryId);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });
        }
        function FillSaleBillNoYear() {
            var SaleBillNo = $("#SaleBillNo").val();
            $.ajax({
                url: '@Url.Action("FillSaleBillNoYear", "CancelSaleBillrequisition")', // Action that returns FillGroup data
               data:{
                    SaleBillNo: SaleBillNo
               },
                type: 'POST',
                async: false,
                success: function (data, status, xhr) {
                    console.log(data);
                    var obj = $.parseJSON(data);
                    if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                         
                        $('#SaleBillYearCode').val(0);
                        $('#SaleBillYearCode').val(obj.Result[0].SaleBillYearCode);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });


        }
        function FillSaleBillNo() {
            $.ajax({
                url: '@Url.Action("FillSaleBillNo", "CancelSaleBillrequisition")', // Action that returns FillGroup data
               
                type: 'POST',
                async: false,
                success: function (response, status, error) {

                    var SaleBillNoDropdown = $('#SaleBillNo');
                    var obj = $.parseJSON(response);
                    SaleBillNoDropdown.empty();
                     
                    SaleBillNoDropdown.append('<option value="">--Select--</option>');
                    $.each(obj.Result, function (index, SaleBillNo) {
                        SaleBillNoDropdown.append('<option value="' + SaleBillNo.SaleBillNo + '">' + SaleBillNo.SaleBillNo + '</option>');
                    });
                    if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                         
                        var SaleBillNo = '@Model.SaleBillNo';
                        $('#SaleBillNo').val(SaleBillNo).trigger("change");
                        $('#SaleBillNo').val(SaleBillNo);
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load groups.');
                }
            });
        }
        // function FillCustomerName() {
        //     $.ajax({
        //         url: '@Url.Action("FillCustomerName", "CancelSaleBillrequisition")', // Action that returns FillGroup data
        //         type: 'POST',
        //         async: false,
        //         success: function (response, status, error) {
        //             var ledgerDropdown = $('#CustomerName');
        //             var obj = $.parseJSON(response);
        //             ledgerDropdown.empty();
        //             ledgerDropdown.append('<option value="">--Select--</option>');

        //             console.log(obj);
        //             $.each(obj.Result, function (index, Customer) {
        //                 ledgerDropdown.append('<option value="' + Customer.Account_Code + '">' + Customer.Account_Name + '</option>');
        //             });

        //             if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
        //                  
        //                 var CustomerName = '@Model.CustomerName';
        //                 $('#CustomerName').val(CustomerName).trigger("change");
        //                 $('#CustomerName').val(CustomerName);
                     
        //             }
        //         },
        //         error: function (xhr, status, error) {
        //             alert('Failed to load customers.');
        //         }
        //     });
        // }
        function FillCustomerName() {
            $.ajax({
                url: '@Url.Action("FillCustomerName", "CancelSaleBillrequisition")', // Action to fetch customer data
                type: 'POST',
                async: false,
                success: function (response) {
                    var ledgerDropdown = $('#CustomerName'); // Dropdown element
                    var accountCodeInput = $('#AccountCode'); // Hidden input for AccountCode
                    var obj = $.parseJSON(response);

                    ledgerDropdown.empty();
                    ledgerDropdown.append('<option value="">--Select--</option>');

                    console.log(obj);

                    $.each(obj.Result, function (index, Customer) {
                        ledgerDropdown.append('<option value="' + Customer.Account_Code + '">' + Customer.Account_Name + '</option>');
                    });

                    // Preselect the old value for updates
                    if ($('#Mode').val() === "U" || $('#Mode').val() === "V") {
                         
                        var selectedAccountCode = '@Model.AccountCode'; 
                        ledgerDropdown.val(selectedAccountCode).trigger("change"); 
                    }
                },
                error: function (xhr, status, error) {
                    alert('Failed to load customers.');
                }
            });
        }

       


        function TotalNoOfRows() {
            var Row = $('#divStockGrid tr').length;
            var tdCount = $('#divStockGrid tr td').length;
            if (tdCount >= 1) {
                $('#lblTotalNoOfBelowItems').text(Row);
            } else {
                $('#lblTotalNoOfBelowItems').text(0);
            }
        }

        function CheckBeforeUpdate() {
            $.ajax({
                url: '@Url.Action("CheckBeforeUpdate")',
                type: "POST",
                data: { "Type": $('#Entry_id').val() },
                success: function (data) {
                    console.log("success");
                    if (data != null) {
                        var obj = $.parseJSON(data);
                        if (obj.Result != null) {
                            if (obj.Result.Table[0].Column1 > 0) {
                                $.notify("You cannot update this Category as Item with this category already exists", "error");
                            }
                            else {
                                $('form').submit();
                            }
                        }
                    }
                },
                error: function (response) {
                    alert(response.responseText);
                },
                failure: function (response) {
                    alert(response.responseText);
                }
            });
        }


       
        
        var isEditAllowed = "false";

        
        var editingNow = false;
        function EditItemRow(SrNO) {

            if (editingNow == false) {
                return new Promise((resolve, reject) => {
                    $.ajax({
                        url: '@Url.Action("EditItemRow")',
                        type: "POST",
                        data: { "SrNO": SrNO, "Mode": $('#Mode').val() },
                    })
                        .done(function (data, status, xhr) {
                            editingNow = true;
                            var obj = $.parseJSON(data);
                            DeleteItemRow(SeqNo)
                                .then(() => {
                                    $('#MainPartCode').val(obj[0].MainPartCode).trigger('change');
                                    $('#MainItemName').val(obj[0].MainItemName).trigger('change');
                                    $('#AltPartCode').val(obj[0].AltPartCode).trigger('change');
                                    $('#AltItemName').val(obj[0].AltItemName).trigger('change');
                                    var currentSrNo = $('#SrNO').val();
                                    var newSrNo = obj[0].SrNO;
                                    if (currentSrNo !== newSrNo) {
                                        $('#SrNO').val(newSrNo).trigger('change');
                                    }

                                })
                                .catch((error) => {
                                    reject(error);
                                });

                        })
                        .fail(function (response) {
                            reject(response.responseText);
                        });
                    $.notify("Item Updated from Grid", "info");
                });
            }
            else {
                $.notify("Cannot edit as one item is already on above edit grid", "error");
            }
        }

        function PressBack() {

            sessionStorage.setItem('FromDateBack', $('#FromDateBack').val());
            sessionStorage.setItem('ToDateBack', $('#ToDateBack').val());
            sessionStorage.setItem('GroupNameBack', $('#GroupNameBack').val());
            sessionStorage.setItem('LedgerNameBack', $('#LedgerNameBack').val());
            sessionStorage.setItem('OpeningForYearBack', $('#OpeningForYearBack').val());
            sessionStorage.setItem('PreviousAmountBack', $('#PreviousAmountBack').val());
            sessionStorage.setItem('DrCrBack', $('#DrCrBack').val());
            sessionStorage.setItem('GlobalSearchBack', $('#GlobalSearchBack').val());

            window.history.back();
        }



    </script>


}


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>


