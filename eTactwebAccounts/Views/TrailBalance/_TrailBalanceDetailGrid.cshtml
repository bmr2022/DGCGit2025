@model eTactWeb.DOM.Models.TrailBalanceModel

<div class="card-body table-responsive" style="max-height:300px;overflow-y:auto;">
    <table class="table table-responsive table-hover table-bordered PMRPGrid TbCss text-nowrap mb-0" id="ReportTable">
        <thead class="bg-gradient card-headerBG text-light PMRPThead" style="position:static;" id="dashRThead">
            <tr>
                <th>Action</th>
                <th>Sr#</th>
                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="1" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Group Name</span>
                    </div>
                </th>

                <th style="width:90px !important;">
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="2" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Parent Group Name</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="3" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Account Name</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="4" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Group Opn Dr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="5" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Group Opn Cr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="6" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Opn Dr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="7" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Opn Cr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="8" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Total Group Opening</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="9" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Total Opening</span>
                    </div>
                </th>

                <th style="width:40px !important;">
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="10" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Curr Dr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="11" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Curr Cr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="12" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Group Curr Dr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="13" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Group Curr Cr</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="14" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Net Amt</span>
                    </div>
                </th>

                <th>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="15" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Group Net Amt</span>
                    </div>
                </th>

                <th style="width:20px !important;">
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="16" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Sub Group Parent</span>
                    </div>
                </th>

                <th style="width:20px !important;">
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span class="toggle-col" data-col="17" title="Hide/Show Column" style="cursor:pointer;">
                            <i class="fa fa-eye-slash" aria-hidden="true"></i>
                        </span>
                        <span>Under Group</span>
                    </div>
                </th>

                @* <th data-columnno="21" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Group Id</th>
                <th data-columnno="22" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>TB Seq</th>
                <th data-columnno="24" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Group Ledger</th> *@
            </tr>
        </thead>
        <tbody id="divStockRegisterBody">
            @{
                var @Cntr = 0;
                if (Model.TrailBalanceGrid == null)
                {
                    <tr class="text-center"><td colspan="26" class="text-black-50"><strong>NO DATA FOUND</strong></td></tr>
                }
                else
                {
                    foreach (var item in Model.TrailBalanceGrid)
                    {
                        Cntr = Cntr + 1;
                        //bool isBold = item.GroupLedger == "G";
                        string rowClass = item.GroupLedger == "G" ? "bold-row" : "";
                        // <tr style="@((isBold) ? "font-weight: bold; font-size: 13px;" : "")" id="@Cntr" onclick="selection(this)">
                        <tr class="@(item.GroupLedger == "G" ? "bold-row" : "")" id="@Cntr" onclick="selection(this)">

                            
                            <td>
                                <a class="table-link link-success" asp-route-ID="@Cntr" asp-action="TrailBalance" asp-route-Mode="V" onclick="BackButtonData(event);">
                                    <span class="fa-stack">
                                        <i class="fa fa-square fa-stack-2x"></i>
                                        <i class="fa-solid fa-magnifying-glass fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                                <a class="table-link link-danger" onclick="DeleteRow(this.id)" id="@Cntr">
                                    <span class="fa-stack">
                                        <i class="fa fa-square fa-stack-2x"></i>
                                        <i class="fa-solid fa-trash fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </td>
                            <th>@Cntr</th>
                          <td>
                              <input id="TrailBalanceGroupCode-@Cntr" value="@item.TrailBalanceGroupCode" type="hidden" />
                              @item.TrailBalanceGroupName
                            </td>
                            <td>
  <a onclick="GetDataByParentGroupName(@Cntr)" class="table-link link-primary">
    <input type="hidden" value="@item.ParentAccountCode" id="ParentAccountCode-@Cntr"/>
    @item.ParentGroupName
  </a>
</td>
                            <td>
                              <a onclick="GetDataByAccountName(@Cntr)" class="table-link link-primary">
                                <input type="hidden" value="@item.AccountCode" id="AccountName-@Cntr"/>
                                @item.AccountName
                              </a>
                            </td>
                            <td id="totGroupOpnDrG-@Cntr" style="background-color:#D3D3D3">@item.GroupOpnDr</td>
                            <td id="totGroupOpnCrG-@Cntr" style="background-color:#D3D3D3">@item.GroupOpnCr</td>
                            <td id="totDrG-@Cntr" style="background-color:antiquewhite">@item.OpnDr</td>
                            <td id="totCrG-@Cntr" style="background-color:antiquewhite">@item.OpnCr</td>
                            <td id="totGroupOpeningG-@Cntr">@item.TotalGroupOpening</td>
                            <td id="totOpeningG-@Cntr">@item.TotalOpening</td>
                            <td id="totCurrDrG-@Cntr" style="background-color:#ADD8E6">@item.CurrDrAmt</td>
                            <td id="totCurrCrG-@Cntr" style="background-color:#ADD8E6">@item.CurrCrAmt</td>
                            <td id="totGroupCurrDrAmtG-@Cntr" style="background-color:#FFB6C1">@item.GroupCurrDrAmt</td>
                            <td id="totGroupCurrCrAmtG-@Cntr" style="background-color:#FFB6C1">@item.GroupCurrCrAmt</td>
                            <td id="totNetAmtG-@Cntr">@item.NetAmt</td>
                            <td id="totGroupNetAmtG-@Cntr">@item.GroupNetAmt</td>
                            <td style="display:none">@item.TrailBalanceGroupId</td>
                            <td style="display:none">@item.TBSeq</td>
                            <td style="display:none">@item.GroupLedger </td>
                            <td>@item.SubGroupParent</td>
                            <td>@item.UnderGroup</td>
                        </tr>
                    }
                }
            }

        </tbody>
    </table>
</div>

<center><strong>TOTAL ROWS : <span id="totalRows"></span></strong></center>

<style>
    .hidden-column {
        display: none !important;
    }
    .sort-icon {
        padding: 5px;
        margin: 5px;
        vertical-align: top;
    }

    .ascCol {
        font-size: 15px;
        vertical-align: bottom;
    }

    .descCol {
        font-size: 15px;
        vertical-align: super;
    }

    #dashRThead th {
        background-color: #127387;
        position: sticky;
        top: -18px;
        z-index: 1;
    }

    .bold-row td {
        font-weight: bold !important;
        font-size: 13px !important;
        color: green !important;
 
    }
</style>
<script>
    const hiddenCols = {};

    $(document).ready(function () {
        // Use event delegation to handle current and future .toggle-col elements
        $(document).on('click', '.toggle-col', function () {
            var $th = $(this).closest('th');
            var colIndex = $th.index() + 1; // real index in DOM (1-based)

            var $icon = $(this).find('i');

            const isVisible = !$('table tr th:nth-child(' + colIndex + ')').hasClass('hidden-column');

            if (isVisible) {
                $('table tr').each(function () {
                    $(this).find('th:nth-child(' + colIndex + '), td:nth-child(' + colIndex + ')').addClass('hidden-column');
                });
                $icon.removeClass('fa-eye-slash').addClass('fa-eye');
                hiddenCols[colIndex] = $th.text().trim();
                updateHiddenColPanel();
            } else {
                $('table tr').each(function () {
                    $(this).find('th:nth-child(' + colIndex + '), td:nth-child(' + colIndex + ')').removeClass('hidden-column');
                });
                $icon.removeClass('fa-eye').addClass('fa-eye-slash');
                delete hiddenCols[colIndex];
                updateHiddenColPanel();
            }
        });

        $('#toggle-hidden-cols-btn').on('click', function () {
            $('#hidden-cols-panel').toggle();
        });
    });


    function updateHiddenColPanel() {
        const $panel = $('#hidden-cols-panel');
        $panel.empty();

        if (Object.keys(hiddenCols).length === 0) {
            $panel.append('<em>No hidden columns</em>');
            return;
        }

        $.each(hiddenCols, function (index, name) {
            const btn = $('<button class="btn btn-sm btn-outline-primary" style="margin: 2px;"></button>')
                .text('Show: ' + name)
                .on('click', function () {
                    $('table tr').each(function () {
                        $(this).find('th:nth-child(' + index + '), td:nth-child(' + index + ')').removeClass('hidden-column');
                    });
                    $('.toggle-col').each(function () {
                        const $btn = $(this);
                        const colIndex = $btn.closest('th').index() + 1;
                        if (colIndex == index) {
                            $btn.find('i').removeClass('fa-eye').addClass('fa-eye-slash');
                        }
                    });
                    delete hiddenCols[index];
                    updateHiddenColPanel();
                });



            $panel.append(btn);
        });
    }
</script>
