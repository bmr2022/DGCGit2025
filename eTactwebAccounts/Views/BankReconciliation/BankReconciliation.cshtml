@model eTactWeb.DOM.Models.BankReconciliationModel;
@using Microsoft.AspNetCore.Http
@using System.Reflection.PortableExecutable
@inject IHttpContextAccessor HttpContextAccessor
@{
	var yearCode = Convert.ToInt32(HttpContextAccessor.HttpContext.Session.GetString("YearCode"));
}
@{
	ViewData["Title"] = "BankReconciliation";
	Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<style>

	.select2-container--default .select2-selection--single {
		background-color: #e0f2f1;
		border: 1.5px solid #0a0a0a !important;
		border-radius: 4px;
	}

		.select2-container--default .select2-selection--single .select2-selection__rendered {
			/* border-bottom: 1.5px solid #000 !important; */
			border-bottom: none !important;
		}

	.select2-container--default .select2-results > .select2-results__options {
		background-color: #e0f2f1; /* Dropdown background color */
		color: #000;
</style>
<head>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<div class="card bg-gradient mb-3 border-light shadow-lg">

	<div class="card-header card-headerBG text-light bg-gradient">
		<h5>
			<strong>Bank Reconcilation Register</strong>
			<span class="d-flex float-end" style="margin-top:-2px;">
				@*<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">*@

			</span>
		</h5>
	</div>

	<div class="card-body bg-light pt-0">
		<div class="accordion shadow-lg">
			<div class="card-body">
				<div class="card overflow-auto">
					<div class="card-body">
						<form asp-action="BankReconciliation" asp-controller="BankReconciliation" method="post" class="form-horizontal">
							<div class="row">
								@* <input type="hidden" value="@Model.YearCode" asp-for="YearCode" />
                                <input type="hidden" value="@Model.Storeid" asp-for="Storeid" /> *@

								<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-12 col-xs-12">
									<div class="row">
										<div class="col">
											<label class="form-label">From Date</label>
											<input asp-for="DateFrom" class="form-control" />
										</div>
										<div class="col">
											<label class="form-label">To Date</label>
											<input asp-for="DateTo" class="form-control" />
										</div>
									</div>
								</div>
								<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-12 col-xs-12">
									<label asp-for="NewOrEdit" class="form-label">New/Edit</label>
									<select class="form-control" asp-for="NewOrEdit">
										<option value="">-Select-</option>
										<option value="NEW" selected>NEW</option>
										<option value="EDIT">EDIT</option>

									</select>
								</div>
								<div class="col-xl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
									<label asp-for="BankName" class="form-label">Bank Name</label>
									<input asp-for="Account_Code" class="form-control" type="hidden" value="@Model.Account_Code" />
									<select asp-for="BankName" class="form-control">
										@* <option value="@Model.AccountCode">-Select-</option> *@
										<option value="@Model.Account_Code">-Select-</option>
										@if (Model.Mode == "U" || Model.Mode == "V")
										{
											<option value="@Model.Account_Code" selected>@Model.BankName</option>
										}
									</select>
								</div>

								<div class="col-xxl-2 col-xl-3 col-lg-3 col-md-6 col-sm-6 col-xs-12">
									<label asp-for="chequeNo" class="form-label">Cheque No</label>
									<select asp-for="chequeNo" class="form-control">
										@* <option value="@Model.AccountCode">-Select-</option> *@
										<option value="@Model.chequeNo">-Select-</option>
										@if (Model.Mode == "U" || Model.Mode == "V")
										{
											<option value="@Model.chequeNo" selected>@Model.chequeNo</option>
										}
									</select>
								</div>

								<div class="col-sm-2 col-md-6 col-lg-4 col-xl-2">
									<label class="form-label">Global search</label>
									<input type="text" class="form-control" id="search-box" style="background-color:#FFFACD" placeholder="Search...">
								</div>

								<div class=" d-flex justify-content-center   mt-3 col-sm-5 col-md-8 col-lg-6 col-xl-4" width="inherit">

									<button class="btn btn-sm btn-outline-info" type="button" style="padding:0px;height:30px;width:100px;" onclick="GetDetailsData();">
										<i class="fa-solid fa-magnifying-glass fa-fw fa-lg"></i>SEARCH
									</button>
									<button classs="btn btn-sm btn-outline-success" style="padding:3px;height:30px;width:100px;margin-left:20px;" type="button" id="sendToExcel">
										<i class="fa-solid fa-upload fa-fw fa-lg "></i>EXCEL
									</button>
									<a class="btn btn-sm btn-outline-danger" style="padding:3px;height:30px;width:100px;margin-left:20px;" asp-controller="BankReconciliation" asp-action="BankReconciliation">
										<i class="fa-solid fa-rotate fa-fw fa-lg"></i>RESET
									</a>
									<button type="submit" class="btn btn-primary btn-sm submitBTN" style="padding:3px;height:30px;width:100px;margin-left:20px;">
										<i class="fa-solid fa-chevron-circle-right"></i>
										SUBMIT
									</button>
								</div>
								<div asp-validation-summary="ModelOnly" class="text-danger"></div>
							</div>
							<div class="progress my-2 mb-3" style="height: 4px;">
								<div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
							</div>
							<div class="accordion-item">
								<h2 class="accordion-header" id="H_SAGrid">
									<button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
										<strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Summary Grid</strong>
									</button>
								</h2>

								<div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradientn show" aria-labelledby="H_SAGrid">
									<div class="accordion-body">
										<div class="card-body" id="divPendingMRP">
											<div class="row">
												<div class="col-md-12 divStockRegister" id="divStockMainRegister">
													<partial name="_BankReconciliationGrid" />
												</div>
											</div>
											<div class="container">
												<div class="row justify-content-center mb-3">
													<!-- Open Bal As Company Book -->
													<div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 text-center">
														<label class="form-label">Open Bal As Company Book</label><br />
														<div class="d-flex justify-content-center">
															<input id="openbal" class="form-control me-2 mb-1" style="width: 200px;" readonly />
															<input class="form-control text-center mb-1" style="width: 60px;" value="DR" readonly />
														</div>
													</div>

													<!-- Balance As Per Company Book -->
													<div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 text-center">
														<label class="form-label">Balance As Per Company Book</label><br />
														<div class="d-flex justify-content-center">
															<input id="balcompanbook" class="form-control me-2 mb-1" style="width: 200px;" readonly />
															<input class="form-control text-center mb-1" style="width: 60px;" value="DR" id="balcompanDRCR" readonly />
														</div>
													</div>

													<!-- Amount Not Reflected in Bank -->
													<div class="col-xl-6 col-lg-8 col-md-12 text-center">
														<label class="form-label">Amount Not Reflected in Bank</label><br />
														<div class="d-flex justify-content-center flex-wrap gap-2">
															<div class="d-flex">
																<input id="TotalDRAmount" class="form-control me-2 mb-1" style="width: 200px;" readonly />
																<input class="form-control text-center mb-1" style="width: 60px;" value="DR" readonly />
															</div>
															<div class="d-flex">
																<input id="TotalCRAmount" class="form-control me-2 mb-1" style="width: 200px;" readonly />
																<input class="form-control text-center mb-1" style="width: 60px;" value="CR" readonly />
															</div>
														</div>
													</div>
												</div>

												<div class="row justify-content-center mb-3">
													<!-- Balance As Per Bank -->
													<div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 text-center">
														<label class="form-label">Balance As Per Bank</label><br />
														<div class="d-flex justify-content-center">
															<input id="balanceasperAmount" class="form-control me-2 mb-1" style="width: 200px;" readonly />
															<input class="form-control text-center mb-1" style="width: 60px;" id="BalanceAsPerBankDRCR" readonly />
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts
{
	<script>

		$(document).ready(function () {
			console.log("Ready");
			// GetServerDate();

			var currentDate = new Date();
			var firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
			$('#totalRows').text($('#divStockRegisterBody tr').length);
			$('#DateFrom').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", formatDate1(firstDayOfMonth));
			$('#DateTo').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
			$('#NewOrEdit').select2();
			$('#chequeNo').select2();
			$('#BankName').select2();

			$('#BankName').change(function () {
				$('#Account_Code').val($('#BankName').val());
			});

			var currentDate = new Date();
			var firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
			function formatDate(date) {
				var day = ("0" + date.getDate()).slice(-2);
				var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
				var month = monthNames[date.getMonth()];
				var year = date.getFullYear();
				return day + "/" + month + "/" + year;
			}
			//$('#FromDate').datepicker({ dateFormat: 'dd/M/yy' }).datepicker("setDate", firstDayOfMonth); // Pass the Date object directly
			//$('#ToDate').datepicker({ dateFormat: 'dd/M/yy' }).datepicker("setDate", currentDate);

			FillBankName();

			GetDetailsData();

			//handleReportTypeChange();

			// When ReportType changes, automatically set Group_Ledger to 'Ledger' if required
			$("#ReportType").change(function () {

				handleReportTypeChange();
			});

			// Function to handle the logic for setting 'Ledger' based on ReportType
			function handleReportTypeChange() {

				var reportType = $("#ReportType").val().trim();
				var reportTypesToCheck = ["Summary", "Detail", "IndentWithPODetail"];

				// If the ReportType matches one of the required values, select 'Ledger'
				if (reportTypesToCheck.includes(reportType)) {
					$("#Group_Ledger").val("Ledger");
				}
			}

			$('#DateFrom').rules("remove", "required");
			$('#DateTo').rules("remove", "required");

		});

		$('#BankName').change(function(){
			GetLedgerBalance();
		})

		function GetLedgerBalance() {
			var OpeningYearCode = @yearCode;
			var AccountCode = parseInt($('#BankName').val());
			var VoucherDate = $('#DateTo').val();
			$.ajax({
				url: '@Url.Action("GetLedgerBalance", "BankReconciliation")',
				type: 'POST',
				data: {
					OpeningYearCode: OpeningYearCode,
					AccountCode: AccountCode,
					VoucherDate: VoucherDate
				},
				async: false,
				success: function (data, status, xhr) {
					var obj = $.parseJSON(data);
					if (obj.StatusCode == 200 && obj.StatusText === 'Success') {

						$('#balcompanbook').val(parseFloat(obj.Result[0].OpeningBal).toFixed(2));
						$('#balcompanDRCR').val(obj.Result[0].TypeDrCr);
					}
					else {
						$('#Balance').val(0);
					}
				},
				error: function (xhr, status, error) {
					alert('Failed to load opening amount.');
				}
			});
		}

		function TotalAmountDRCR(){
			var rowCount = $('#divStockRegisterBody tr').length;
			var TotCr = 0;
			var TotDr = 0;
			for (var i = 1; i <= rowCount; i++) {
				TotCr += $('#CrAmt-' + i).text() == '' ? 0 : parseFloat($('#CrAmt-' + i).text());
				TotDr += $('#DrAmt-' + i).text() == '' ? 0 : parseFloat($('#DrAmt-' + i).text());
			}
			$('#TotalCRAmount').val(isNaN(TotCr) ? 0 : TotCr.toFixed(2));
			$('#TotalDRAmount').val(isNaN(TotDr) ? 0 : TotDr.toFixed(2));
		}

		function BalanceAsPerBank()
		{
			if($('#balcompanDRCR').val() == 'DR'){
				var BalanceAsPerComBook = parseFloat($('#balcompanbook').val());
				var TotDR = parseFloat($('#TotalDRAmount').val());
				var TotCR = parseFloat($('#TotalCRAmount').val());
				var DiffAmt = BalanceAsPerComBook - TotDR + TotCR;
				$('#balanceasperAmount').val(DiffAmt);
				$('#BalanceAsPerBankDRCR').val('DR');
			}
			if($('#balcompanDRCR').val() == 'CR'){
				var BalanceAsPerComBook = parseFloat($('#balcompanbook').val());
				var TotDR = parseFloat($('#TotalDRAmount').val());
				var TotCR = parseFloat($('#TotalCRAmount').val());
				var DiffAmt = BalanceAsPerComBook - TotCR + TotDR;
				$('#balanceasperAmount').val(DiffAmt);
				$('#BalanceAsPerBankDRCR').val('DR');
			}
		}

		$('.submitBTN').click(function (e) {
			debugger
			e.preventDefault();
			var rowCount = $('#divStockRegisterBody tr').length;
			var ItemData = [];
			 for (var i = 1; i <= rowCount; i++) {
				ItemData.push({
				"SeqNo": i,
				"entryid": $('#AccEntryId-' + i).text(),
				"AccYearCode": $('#AccYearCode-' + i).text(),
				"VoucherNo": $('#VoucherNo-' + i).text(),
				"Type": $('#VoucherType-' + i).text(),
				"Account_Code": $('#AccountCode-' + i).val(),
				"chequeNo": $('#ChequeNo-' + i).text(),
				"DrAmt": parseFloat($('#DrAmt-' + i).text()),
				"CrAmt": parseFloat($('#CrAmt-' + i).text()),
				"ChequeClearDate": $('#BankRecoDate-' + i).val(),
				});
			}
			$.ajax({
				type: 'POST',
				url: '@Url.Action("BankReconciliation", "BankReconciliation")',
				data: { model: ItemData },
				success: function (response) {
					$.notify('Bank Reco is Saved Successfully.', "success");
					setTimeout(function () {
				location.reload();
			}, 1000); // reload after 1 second
				},
				error: function (xhr) {
					console.error("Error:", xhr.responseText);
					// Handle error
				}
			});
		});

		function selection(CurrentRow) {

			$(CurrentRow).css({ 'background-color': '#00bcd4' });
			$("#divStockRegisterBody tr").not(CurrentRow).css({ 'background-color': '' });
		}

		function RemoveRecodate(Id) {
			debugger
			// Get the input by ID
			var input = document.getElementById("BankRecoDate-" + Id);
			if (!input) return;

			// Clear the input value and hide it
			input.value = "";
			input.style.display = "none";

			// Get the span sibling with class 'bank-date-text' inside the same <td>
			var td = input.parentElement; // the <td>
			var span = td.querySelector(".bank-date-text");
			if (span) {
				span.textContent = "";          // Clear the span text
				span.style.display = "inline"; // Show the span again
			}
			// Find checkbox in the same <tr> and uncheck it if checked
			var tr = td.closest("tr");
			if (tr) {
				var checkbox = tr.querySelector('input[type="checkbox"]');
				if (checkbox && checkbox.checked) {
					checkbox.checked = false;
					// Optionally, trigger any change event if needed:
					// checkbox.dispatchEvent(new Event('change'));
				}
			}
			
		}

		function toggleDatePicker(checkbox, SeqNo) {

			const $checkbox = $(checkbox);
			const $row = $checkbox.closest("tr");
			const $dateInput = $row.find(".bank-date-input");
			const $dateText = $row.find(".bank-date-text");

			if ($checkbox.is(":checked")) {
			$dateInput.show();
			$dateText.hide();

			var minDate, maxDate;
			var VoucherDate = $('#VoucherDate-' + SeqNo).text();
			if (VoucherDate) {
				var [day, month, year] = VoucherDate.split('-').map(Number);
				minDate = new Date(year, month - 1, day);
				maxDate = new Date(minDate);              // clone date
				maxDate.setMonth(maxDate.getMonth() + 6); // add 6 months
			}
			if (!$dateInput.hasClass("hasDatepicker")) {
				$dateInput.datepicker({
				dateFormat: 'dd/M/yy',
				minDate: minDate,
				maxDate: maxDate
			});
			}

			$dateInput.datepicker("show"); // Optionally show it immediately
		} else {
			$dateInput.hide();
			$dateText.show();
		}
		}

		function FillBankName() {

			var DateFrom = $('#DateFrom').val();
			var DateTo = $('#DateTo').val();
			var NewOrEdit = $('#NewOrEdit').val();

			$.ajax({
				url: '@Url.Action("GetBankName", "BankReconciliation")',
				data:
				{
					"DateFrom": DateFrom,
					"DateTo": DateTo,
					"NewOrEdit": NewOrEdit,

				},
				type: 'GET',
				async: false,
				success: function (response, status, error) {

					var BankNameDropdown = $('#BankName');
					var obj = $.parseJSON(response);
					BankNameDropdown.empty();
					BankNameDropdown.append('<option value="">--Select--</option>');

					$.each(obj.Result, function (index, item) {
						BankNameDropdown.append('<option value="' + item.Account_Code + '">' + item.BankName + '</option>');
					});

				},
				error: function (xhr, status, error) {
					alert('Failed to load groups.');
				}
			});
		}



		function GetDetailsData() {

			var NewOrEdit = $('#NewOrEdit').val();
			var DateFrom = $('#DateFrom').val();
			var DateTo = $('#DateTo').val();
			var chequeNo = $('#chequeNo').val();
			var Account_Code = $('#Account_Code').val();

			$.ajax({
				type: 'POST',
				url: '@Url.Action("GetDetailsData", "BankReconciliation")',
				data: {
					"NewOrEdit": NewOrEdit,
					"DateFrom": DateFrom,
					"DateTo": DateTo,
					"chequeNo": chequeNo,
					"Account_Code": Account_Code

				},
				success: function (response) {
					$('#divStockMainRegister').html(response);

					var totalRows = $('#divStockMainRegister tr').length;
					$('#totalRows').text(totalRows);
					countAllTotal();
					TotalAmountDRCR();
					BalanceAsPerBank();
				},
				error: function (xhr, status, error) {
					console.error("Error fetching BOM tree data:", error);
				}
			});
		}

		function DeleteRow(i) {

			var indexToRemove = i - 1;
			$('#SAGridRow-' + i).remove();
			$('#ReportTable tbody tr').each(function (index) {
				$(this).attr('id', 'SAGridRow-' + (index + 1));


				$(this).find('td:first-child a:first-child').each(function (tdIndex) {
					$(this).attr('id', (index + 1));
				});

				$(this).find('td[id^="amount-"]').each(function (tdIndex) {
					$(this).attr('id', 'amount-' + (index + 1));
				});

			});
			//$('#ReportTable tr:eq(' + indexToRemove + ')').remove();
			countAllTotal();
			$('#totalRows').text($('#divStockMainRegister tr').length - 1);
		}
		function GetServerDate() {
			$.ajax({
				type: "GET",
				url: "@Url.Action("GetServerDate")",
				async: false,
				success: function (result, status, error) {
					console.log(result);
					if (result != null) {
						// $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);
						//$('#InvoiceDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);

						var firstDayOfMonth = getFirstDayOfMonth(result);
						$('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", firstDayOfMonth);

						$('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);

					}
				}
			});
		}

		function getFirstDayOfMonth(dateString) {
			const [day, month, year] = dateString.split('/');

			// Create a new Date object (months are 0-indexed, so subtract 1 from the month)
			const currentDate = new Date(year, month - 1, day);

			// Set the date to the 1st day of the month
			currentDate.setDate(1);

			// Format the result as dd/mm/YYYY
			const firstDayOfMonth = `${currentDate.getDate().toString().padStart(2, '0')}/${(currentDate.getMonth() + 1).toString().padStart(2, '0')}/${currentDate.getFullYear()}`;

			return firstDayOfMonth;
		}

		$('#sendToExcel').click(function () {
			let table = $("#ReportTable");
			console.log(table);
			TableToExcel.convert(table[0], {
				name: `ReportTable.xlsx`,
				sheet: {
					name: 'ReportTable'
				}
			});
		});
		function formatDate1(date) {
			var day = ("0" + date.getDate()).slice(-2);
			var month = ("0" + (date.getMonth() + 1)).slice(-2);
			var year = date.getFullYear();
			var dateString = day + "/" + month + "/" + year;
			return dateString;
		}

		$(document).on("click", ".sortCol", function () {
			;
			var $column = $(this).parent().closest("th");
			var colno = $(this).data('columnno');
			var currentOrder = $(this).data('sortorder');

			$('.sortCol').css('color', 'white');
			if (currentOrder === 'asc') {
				sortTable(colno, false);
				$(this).data('sortorder', 'desc');
				$(this).css('color', 'yellow'); // Visual indication of descending order
				//$(this).css('font-size', 'larger'); // Visual indication of descending order
				$(this).find('i:first').removeClass('fa-arrow-up');
				$(this).find('i:first').addClass('fa-arrow-down');
			} else {
				sortTable(colno, true);
				$(this).data('sortorder', 'asc');
				$(this).css('color', 'yellow');
				// $(this).css('font-size', 'larger'); // Visual indication of ascending order
				$(this).find('i:first').removeClass('fa-arrow-down');
				$(this).find('i:first').addClass('fa-arrow-up');
			}
		});

		function sortTable(columnIndex, ascending) {

			var table = $('#ReportTable');
			var rows = table.find('#divStockRegisterBody > tr').toArray();

			rows.sort(function (a, b) {
				var aValue = $(a).find('td').eq(columnIndex).text();
				var bValue = $(b).find('td').eq(columnIndex).text();

				var aIntValue = 0;
				var bIntValue = 0;
				if (/^\d*\.?\d+$/.test(aValue) && /^\d*\.?\d+$/.test(bValue)) {
					aIntValue = parseInt(aValue, 10);
					bIntValue = parseInt(bValue, 10);
				}

				if (aIntValue > 0) {
					if (ascending) {
						return aValue - bValue;
					} else {
						return bValue - aValue;
					}
				} else {
					if (ascending) {
						return aValue.localeCompare(bValue);
					} else {
						return bValue.localeCompare(aValue);
					}
				}
			});

			$.each(rows, function (index, row) {
				table.children('#divStockRegisterBody').append(row);
			});
		}
		function countAllTotal() {

			var rowCount = $('#divStockRegisterBody tr').length;

			var TotCr = 0;
			var TotDr = 0;
			var TotBal = 0;
			for (var i = 1; i <= rowCount; i++) {

				TotCr += $('#totCrG-' + i).text() == '' ? 0 : parseFloat($('#totCrG-' + i).text());
				TotDr += $('#totDrG-' + i).text() == '' ? 0 : parseFloat($('#totDrG-' + i).text());
				TotBal += $('#totBalG-' + i).text() == '' ? 0 : parseFloat($('#totBalG-' + i).text());
				//if(totAmount < 0){
				//    $('#SAGridRow-' + i).css('background-color', 'red');
				//}
			}


			$('#totCr').val(isNaN(TotCr) ? 0 : TotCr.toFixed(2));
			$('#totDr').val(isNaN(TotDr) ? 0 : TotDr.toFixed(2));
			$('#totBal').val(isNaN(TotBal) ? 0 : TotBal.toFixed(2));
		}
		var currentSearchColumn = null;

		$("#search-box").on("keyup", function () {
			var value = $(this).val().toLowerCase();
			$("#divStockRegisterBody tr").filter(function () {
				if (currentSearchColumn !== null) {
					var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
					$(this).toggle(columnText.indexOf(value) > -1);
				} else {
					$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
				}
			});
		});

		$(document).on("click", "th[data-columnno]", function () {
			currentSearchColumn = $(this).data('columnno');
			$("#search-box").val('').trigger('keyup'); // Reset search box and trigger the search
		});




		function DeleteRow(i) {

			var indexToRemove = i - 1;
			$('#SAGridRow-' + i).remove();
			$('#ReportTable tbody tr').each(function (index) {
				$(this).attr('id', 'SAGridRow-' + (index + 1));


				$(this).find('td:first-child a:first-child').each(function (tdIndex) {
					$(this).attr('id', (index + 1));
				});

				$(this).find('td[id^="amount-"]').each(function (tdIndex) {
					$(this).attr('id', 'amount-' + (index + 1));
				});

			});
			//$('#ReportTable tr:eq(' + indexToRemove + ')').remove();
			countAllTotal();
			$('#totalRows').text($('#divStockMainRegister tr').length - 1);
		}


	</script>


	<!-- jQuery, Select2, and table-to-excel scripts -->
}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />

<!-- jQuery, Select2, and table-to-excel scripts -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/linways/table-to-excel@v1.0.4/dist/tableToExcel.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.13/jquery.validate.unobtrusive.min.js"></script>
<style>

	.sort-icon {
		padding: 5px;
		margin: 5px;
		vertical-align: top;
	}

	.ascCol {
		font-size: 15px;
		vertical-align: bottom;
	}

	.descCol {
		font-size: 15px;
		vertical-align: super;
	}

</style>
