@model eTactWeb.DOM.Models.ProfitAndLossModel
@{
    var excludeColumns = new List<string> { "ParentAccountCode", "AccountCode", "PLseqNo" };
    var firstRow = Model?.ProfitAndLossGrid?.FirstOrDefault();
}

@if (Model?.ProfitAndLossGrid != null && Model.ProfitAndLossGrid.Any())
{
    <div class="row">
        <!-- Debit Table -->
        <div class="col-md-6 p-0">
            <div class="card-body table-responsive" style="max-height:300px;overflow-y:auto;padding:0 !important">
                <table class="table table-hover table-bordered text-nowrap mb-0">
                    <thead class="bg-gradient card-headerBG text-light" style="position:sticky; top:0; z-index:1;">
                        <tr>
                            <th>Sr#</th>
                            @if (firstRow?.DynamicColumns != null)
                            {
                                foreach (var colName in firstRow.DynamicColumns.Keys)
                                {
                                    if (!excludeColumns.Contains(colName) && colName.Contains("(Dr)"))
                                    {
                                        <th>@colName.Replace("(Dr)", "").Replace("(Cr)", "")</th>
                                    }
                                }
                            }
                        </tr>
                    </thead>
                    <tbody style="background-color:lightblue">
                        @{
                            var drRows = Model.ProfitAndLossGrid
                            .Where(x => x.DynamicColumns?["ProfitLossDRCRSide"]?.ToString() == "DR")
                            .ToList();
                            var drCounter = 0;

                            foreach (var row in drRows)
                            {
                                drCounter++;
                                <tr>
                                    <td>@drCounter</td>
                                    @if (row.DynamicColumns != null)
                                    {
                                        foreach (var col in row.DynamicColumns)
                                        {
                                            if (!excludeColumns.Contains(col.Key) && col.Key.Contains("(Dr)"))
                                            {
                                                var ledgGroup = row.DynamicColumns.ContainsKey("ledgGroup")
                                                ? row.DynamicColumns["ledgGroup"]?.ToString()
                                                : "";
                                                var parentCode = row.DynamicColumns.ContainsKey("ParentAccountCode")
                                                ? row.DynamicColumns["ParentAccountCode"]?.ToString()
                                                : "";
                                                if (ledgGroup == "PL" || parentCode == "0")
                                                {
                                                    <td>@col.Value</td>
                                                }
                                                else if (col.Key.Contains("Group(Dr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetProfitAndLossDataByGroup(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnParentAccountCode"
                                                               value="@row.DynamicColumns["ParentAccountCode"]" />
                                                        <input type="hidden" class="hdnLedgerGroup"
                                                               value="@row.DynamicColumns["ledgGroup"]" />
                                                    </td>
                                                }
                                                else if (col.Key.Contains("Ledger(Dr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetProfitAndLossDataByLedger(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnAccountCode"
                                                               value="@row.DynamicColumns["AccountCode"]" />
                                                    </td>
                                                }
                                                else
                                                {
                                                    <td>@col.Value</td>
                                                }
                                            }
                                        }
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <center>
                <strong>
                    TOTAL ROWS : <span id="totalRowsDr">@drRows.Count</span>
                </strong>
            </center>
        </div>

        <!-- Credit Table -->
        <div class="col-md-6 p-0">
            <div class="card-body table-responsive" style="max-height:300px;overflow-y:auto;padding:0 !important">
                <table class="table table-hover table-bordered text-nowrap mb-0">
                    <thead class="bg-gradient card-headerBG text-light" style="position:sticky; top:0; z-index:1;">
                        <tr>
                            <th>Sr#</th>
                            @if (firstRow?.DynamicColumns != null)
                            {
                                foreach (var colName in firstRow.DynamicColumns.Keys)
                                {
                                    if (!excludeColumns.Contains(colName) && colName.Contains("(Cr)"))
                                    {
                                        <th>@colName.Replace("(Dr)", "").Replace("(Cr)", "")</th>
                                    }
                                }
                            }
                        </tr>
                    </thead>
                    <tbody style="background-color:#b1c9ec">
                        @{
                            var crRows = Model.ProfitAndLossGrid
                            .Where(x => x.DynamicColumns?["ProfitLossDRCRSide"]?.ToString() == "CR")
                            .ToList();
                            var crCounter = 0;

                            foreach (var row in crRows)
                            {
                                crCounter++;
                                <tr>
                                    <td>@crCounter</td>
                                    @if (row.DynamicColumns != null)
                                    {
                                        foreach (var col in row.DynamicColumns)
                                        {
                                            if (!excludeColumns.Contains(col.Key) && col.Key.Contains("(Cr)"))
                                            {
                                                var ledgGroup = row.DynamicColumns.ContainsKey("ledgGroup")
                                                ? row.DynamicColumns["ledgGroup"]?.ToString()
                                                : "";
                                                var parentCode = row.DynamicColumns.ContainsKey("ParentAccountCode")
                                                ? row.DynamicColumns["ParentAccountCode"]?.ToString()
                                                : "";
                                                if (ledgGroup == "PL" || parentCode == "0")
                                                {
                                                    <td>@col.Value</td>
                                                }
                                                else if (col.Key.Contains("Group(Cr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetProfitAndLossDataByGroup(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnParentAccountCode"
                                                               value="@row.DynamicColumns["ParentAccountCode"]" />
                                                        <input type="hidden" class="hdnLedgerGroup"
                                                               value="@row.DynamicColumns["ledgGroup"]" />
                                                    </td>
                                                }
                                                else if (col.Key.Contains("Ledger(Cr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetProfitAndLossDataByLedger(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnAccountCode"
                                                               value="@row.DynamicColumns["AccountCode"]" />
                                                    </td>
                                                }
                                                else
                                                {
                                                    <td>@col.Value</td>
                                                }
                                            }
                                        }
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <center>
                <strong>
                    TOTAL ROWS : <span id="totalRowsCr">@crRows.Count</span>
                </strong>
            </center>
        </div>
    </div>
}
else
{
    <div class="alert text-center" style="background-color:#ffcc80; color:#000;">
        No Profit and Loss records found.
    </div>
}

<style>
    .header-icons {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .hidden-column {
        display: none !important;
    }

    .sort-icon, .toggle-col {
        cursor: pointer;
    }

    .sort-icon {
        padding: 5px;
        margin: 5px;
        vertical-align: top;
    }

    .ascCol {
        font-size: 15px;
        vertical-align: bottom;
    }

    .descCol {
        font-size: 15px;
        vertical-align: super;
    }

    #dashRThead th {
        background-color: #127387;
        position: sticky;
        top: -18px;
        z-index: 1;
    }

</style>