@model eTactWeb.DOM.Models.BalanceSheetModel
@{
    var firstRow = Model?.BalanceSheetGrid?.FirstOrDefault();
}

@if (Model?.BalanceSheetGrid != null && Model.BalanceSheetGrid.Any())
{
    <div class="row">
        <!-- Liabilities Table (CR Side) -->
        <div class="col-md-6 p-0">
            <div class="card-body table-responsive" style="max-height:300px;overflow-y:auto;padding:0 !important">
                <table class="table table-hover table-bordered text-nowrap mb-0">
                    <thead class="bg-gradient card-headerBG text-light" style="position:sticky; top:0; z-index:1;">
                        <tr>
                            <th>Sr#</th>
                            @if (firstRow?.DynamicColumns != null)
                            {
                                var colIndex = 1;
                                foreach (var colName in firstRow.DynamicColumns.Keys)
                                {
                                    if ((colName.Contains("(Cr)") || colName.Contains("Liabilities")))
                                    {
                                        <th data-columnno="@colIndex">
                                            <div class="header-icons" style="display:flex; align-items:center; gap:6px;">
                                                <span class="toggle-col" data-col="@colIndex" title="Hide/Show Column" style="cursor:pointer;">
                                                    <i class="fa fa-eye-slash"></i>
                                                </span>
                                                <span>@colName.Replace("(Dr)", "").Replace("(Cr)", "")</span>
                                            </div>
                                        </th>
                                    }
                                    colIndex++;
                                }
                            }
                        </tr>
                    </thead>
                    <tbody style="background-color:#b1c9ec">
                        @{
                            var crRows = Model.BalanceSheetGrid
                            .Where(x => x.DynamicColumns?["ProfitLossDRCRSide"]?.ToString() == "LIB")
                            .ToList();
                            var crCounter = 0;

                            foreach (var row in crRows)
                            {
                                crCounter++;
                                <tr>
                                    <td>@crCounter</td>
                                    @if (row.DynamicColumns != null)
                                    {
                                        foreach (var col in row.DynamicColumns)
                                        {
                                            if (col.Key.Contains("(Cr)") || col.Key.Contains("Liabilities"))
                                            {
                                                var ledgGroup = row.DynamicColumns.ContainsKey("LedgGroup")
                                                ? row.DynamicColumns["LedgGroup"]?.ToString()
                                                : "";
                                                var parentCode = row.DynamicColumns.ContainsKey("ParentAccountCode")
                                                ? row.DynamicColumns["ParentAccountCode"]?.ToString()
                                                : "";

                                                if (ledgGroup == "PL" || parentCode == "0")
                                                {
                                                    <td>@col.Value</td>
                                                }
                                                else if (col.Key.Contains("Liabilities"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetBalanceSheetDataByBalParentCode(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnBalParentAccountCode"
                                                               value="@row.DynamicColumns["BalParentAccountCode"]" />
                                                    </td>
                                                }
                                                else if (col.Key.Contains("ParentAccountName(Cr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetBalanceSheetDataByParentCode(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnParentAccountCode"
                                                               value="@row.DynamicColumns["ParentAccountCode"]" />
                                                    </td>
                                                }
                                                else if (col.Key.Contains("LedgerName(Cr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetBalanceSheetDataByLedger(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnAccountCode"
                                                               value="@row.DynamicColumns["AccountCode"]" />
                                                    </td>
                                                }
                                                else
                                                {
                                                    <td>@col.Value</td>
                                                }
                                            }
                                        }
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <center>
                <strong>
                    TOTAL ROWS : <span id="totalRowsCr">@crRows.Count</span>
                </strong>
            </center>
        </div>

        <!-- Assets Table (DR Side) -->
        <div class="col-md-6 p-0">
            <div class="card-body table-responsive" style="max-height:300px;overflow-y:auto;padding:0 !important">
                <table class="table table-hover table-bordered text-nowrap mb-0">
                    <thead class="bg-gradient card-headerBG text-light" style="position:sticky; top:0; z-index:1;">
                        <tr>
                            <th>Sr#</th>
                            @if (firstRow?.DynamicColumns != null)
                            {
                                var colIndex = 1;
                                foreach (var colName in firstRow.DynamicColumns.Keys)
                                {
                                    if ((colName.Contains("(Dr)") || colName.Contains("Assets")))
                                    {
                                        <th data-columnno="@colIndex">
                                            <div class="header-icons" style="display:flex; align-items:center; gap:6px;">
                                                <span class="toggle-col" data-col="@colIndex" title="Hide/Show Column" style="cursor:pointer;">
                                                    <i class="fa fa-eye-slash"></i>
                                                </span>
                                                <span>@colName.Replace("(Dr)", "").Replace("(Cr)", "")</span>
                                            </div>
                                        </th>
                                    }
                                    colIndex++;
                                }
                            }
                        </tr>
                    </thead>
                    <tbody style="background-color:lightblue">
                        @{
                            var drRows = Model.BalanceSheetGrid
                            .Where(x => x.DynamicColumns?["ProfitLossDRCRSide"]?.ToString() == "ASS")
                            .ToList();
                            var drCounter = 0;

                            foreach (var row in drRows)
                            {
                                drCounter++;
                                <tr>
                                    <td>@drCounter</td>
                                    @if (row.DynamicColumns != null)
                                    {
                                        foreach (var col in row.DynamicColumns)
                                        {
                                            if (col.Key.Contains("(Dr)") || col.Key.Contains("Assets"))
                                            {
                                                var ledgGroup = row.DynamicColumns.ContainsKey("LedgGroup")
                                                ? row.DynamicColumns["LedgGroup"]?.ToString()
                                                : "";
                                                var parentCode = row.DynamicColumns.ContainsKey("ParentAccountCode")
                                                ? row.DynamicColumns["ParentAccountCode"]?.ToString()
                                                : "";

                                                if (ledgGroup == "PL" || parentCode == "0")
                                                {
                                                    <td>@col.Value</td>
                                                }
                                                else if (col.Key.Contains("Assets"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetBalanceSheetDataByBalParentCode(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnBalParentAccountCode"
                                                               value="@row.DynamicColumns["BalParentAccountCode"]" />
                                                    </td>
                                                }
                                                else if (col.Key.Contains("ParentAccountName(Dr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetBalanceSheetDataByParentCode(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnParentAccountCode"
                                                               value="@row.DynamicColumns["ParentAccountCode"]" />
                                                    </td>
                                                }
                                                else if (col.Key.Contains("LedgerName(Dr)"))
                                                {
                                                    <td style="cursor:pointer;color:blue;" onclick="GetBalanceSheetDataByLedger(this)">
                                                        @col.Value
                                                        <input type="hidden" class="hdnAccountCode"
                                                               value="@row.DynamicColumns["AccountCode"]" />
                                                    </td>
                                                }
                                                else
                                                {
                                                    <td>@col.Value</td>
                                                }
                                            }
                                        }
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
            <center>
                <strong>
                    TOTAL ROWS : <span id="totalRowsDr">@drRows.Count</span>
                </strong>
            </center>
        </div>
    </div>
}
else
{
    <div class="alert text-center" style="background-color:#ffcc80; color:#000;">
        No Profit and Loss records found.
    </div>
}

<style>
    .header-icons {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .hidden-column {
        display: none !important;
    }

    .sort-icon, .toggle-col {
        cursor: pointer;
    }

    .sort-icon {
        padding: 5px;
        margin: 5px;
        vertical-align: top;
    }

    .ascCol {
        font-size: 15px;
        vertical-align: bottom;
    }

    .descCol {
        font-size: 15px;
        vertical-align: super;
    }

    #dashRThead th {
        background-color: #127387;
        position: sticky;
        top: -18px;
        z-index: 1;
    }

</style>