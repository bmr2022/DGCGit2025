@model eTactWeb.DOM.Models.SaleOrderModel

@{
	if (Model.Mode == "SOA" || Model.Mode == "SAU")
	{
		ViewData["Title"] = "Sale Order Amendment";
	}
	else
	{
		ViewData["Title"] = "Sale Order Detail";
	}

	Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<style>

	.select2-container--default .select2-selection--single {
		background-color: #e0f2f1;
		border: 1.5px solid #0a0a0a !important;
		border-radius: 4px;
	}

		.select2-container--default .select2-selection--single .select2-selection__rendered {
			/* border-bottom: 1.5px solid #000 !important; */
			border-bottom: none !important;
		}

	.select2-container--default .select2-results > .select2-results__options {
		background-color: #e0f2f1; /* Dropdown background color */
		color: #000;
</style>
<div class="card bg-gradient mb-3 border-light shadow-lg">
	<partial name="_SODelivery" />
	<partial name="_SOMultiBuyersModal" />
	<form asp-action="OrderDetail" autocomplete="off" class="form-horizontal" id="SOForm">
		<input type="hidden" asp-for="ExRate" />
		<input type="hidden" asp-for="Mode" value="@Model.Mode" />
		<div class="card-header card-headerBG text-light bg-gradient">
			<h5>
				@if (Model.Mode != "SOA" && Model.Mode != "SAU")
				{

					<strong>@ViewData["Title"] - @Model.YearCode</strong>
				}
				else
				{
					<strong>@ViewData["Title"] - @Model.AmmYearCode</strong>
				}
				<span class="d-flex float-end" style="margin-top:-2px;">
					@if (Model.Mode == "SOA" || Model.Mode == "SOC")
					{
						<a asp-action="SOAmmCompleted" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient me-2">
							<i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
							Dashboard
						</a>
					}
					else
					{
						<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient me-2">
							<i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
							Dashboard
						</a>
					}
					<div class="col-auto me-2">
						@if (Model.Mode != "V" && Model.Mode != "SOA" && Model.Mode != "SOC")
						{
							<button type="button" class="PartialSave btn btn-secondary btn-sm mr-2" style="color:white!important">
								<i class="fa-solid fa-floppy-disk-pen fa-fw fa-lg" style="--fa-secondary-color: crimson; --fa-secondary-opacity: 1.0;"></i>
								PARTIAL SAVE
							</button>
						}

					</div>
					<partial name="_FormsButton" />
				</span>
			</h5>
		</div>
		<div class="card-body bg-light pt-0">
			@* <div asp-validation-summary="All" class="text-danger pt-1"></div> *@
			<div class="accordion shadow-lg">
				<div class="accordion-item">
					<h2 class="accordion-header" id="H_RParameter">
						<button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_RParameter" aria-expanded="true" aria-controls="B_RParameter">
							<i class="fa-brands fa-wpforms fa-lg fa-fw pr35"></i>
							Required Parameter
						</button>
					</h2>
					@if (Model.Mode == "SOA" || Model.Mode == "SAU")
					{
						<div id="B_RParameter" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_RParameter">
							<div class="accordion-body">
								<div class="row g-2 gx-3">
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<input type="hidden" asp-for="FinFromDate" value="@Model.FinFromDate" />
										<input type="hidden" asp-for="FinToDate" value="@Model.FinToDate" />
										<input type="hidden" asp-for="TypeOfSave" value="" />
										<label asp-for="EntryID" class="form-label">SOEntry ID</label>
										<input asp-for="EntryID" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="YearCode" class="form-label"> SOYear</label>
										<input asp-for="YearCode" class="form-control" value="@Model.YearCode" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="EntryDate" class="form-label">Entry Date</label>
										<input asp-for="EntryDate" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="EntryTime" class="form-label">Time</label>
										<input asp-for="EntryTime" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Branch" class="form-label">Branch</label>
										<input asp-for="Branch" value="@Model.Branch" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SOFor" class="form-label" style="color:  red;">SO For</label>
										<select class="form-select" asp-for="SOFor" asp-items="@(new SelectList(Model.SOForList,"Value","Text"))" readonly disabled></select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SOType" class="form-label" style="color:  red;">SO Type</label>
										<select class="form-select" asp-for="SOType" asp-items="@(new SelectList(Model.SOTypeList,"Value","Text"))" readonly disabled></select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SONo" class="form-label" style="color:  red;">SO No</label>
										<input asp-for="SONo" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="OrderType" class="form-label" style="color:  red;">Order Type</label>
										<select class="form-select" asp-for="OrderType" asp-items="Model.OrderTypeList" readonly disabled></select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="CurrencyID" class="form-label" style="color:  red;">Currency</label>
										<select class="form-select" asp-for="CurrencyID" readonly disabled></select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="CustOrderNo" class="form-label"> Order No</label>
										<input asp-for="CustOrderNo" class="form-control" readonly  style="background-color: lightblue !important;" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SODate" class="form-label" style="color:  red;">SO Date</label>
										<input asp-for="SODate" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="AccountCode" class="form-label" style="color:  red;">Party Name</label>
										<div class="form-check form-switch mx-3 w-auto position-absolute d-inline" style="width:180px">
											<input asp-for="PN1" class="form-check-input" type="checkbox" role="switch" readonly disabled />Show All
										</div>
										<select class="form-select" asp-for="AccountCode" style="width:220px;" asp-items="@(new SelectList(Model.AccountList,"Value","Text"))" readonly disabled>
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="Address" class="form-label" style="color:  red;">Address</label>
										<input asp-for="Address" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="DeliveryAddress" class="form-label" style="color:  red;">Delivery Address</label>
										<input asp-for="DeliveryAddress" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="WEF" class="form-label">WEF</label>
										<input asp-for="WEF" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SOCloseDate" class="form-label"> Close Date</label>
										<input asp-for="SOCloseDate" class="form-control" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="QuotNo" class="form-label">Quot No</label>
										<select class="form-select" asp-for="QuotNo" asp-items="@(new SelectList(Model.QuotList,"Value","Text"))" onchange="QuotChange(this.id);" readonly disabled>
											<option value="0">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="QuotYear" class="form-label">Quotation Year</label>
										<select class="form-select" asp-for="QuotYear" asp-items="@(new SelectList(Model.QuotYearList,"Value","Text"))" readonly disabled>
											<option value="0">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label class="form-label">Quote Date</label>
										<input asp-for="QDate" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AmmNo" class="form-label">Amm No</label>
										<input asp-for="AmmNo" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AmmEffDate" class="form-label">Amm Date</label>
										<input asp-for="AmmEffDate" class="form-control" />
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SOConfirmDate" class="form-label">SO Confirm Date</label>
										<input asp-for="SOConfirmDate" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="ConsigneeAccountCode" class="form-label">Consignee</label>
										<div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
											<input asp-for="PN2" class="form-check-input" type="checkbox" role="switch" readonly disabled />Show All
										</div>
										<select class="form-select" asp-for="ConsigneeAccountCode" data-val="false" asp-items="@(new SelectList(Model.AccountList,"Value","Text"))" readonly disabled>
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="ConsigneeAddress" class="form-label">Consignee Address</label>
										<input asp-for="ConsigneeAddress" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<button type="button" class="MultiBuyers btn btn-sm btn-outline-success mt-3">
											<i class="fa-solid fa-calendar-clock fa-fw fa-lg"></i> Multiple Buyers
										</button>
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<button type="button" class="btn btn-sm btn-outline-danger btnClearTax mt-3" style="margin-top:10px;">
											<i class="fa-solid fa-hand-sparkles fa-fw fa-lg"></i>
											CLEAR TAX
										</button>
									</div>
								</div>
							</div>
						</div>
					}
					else
					{
						<div id="B_RParameter" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_RParameter">
							<div class="accordion-body">
								<div class="row g-2 gx-3">
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<input type="hidden" asp-for="FinFromDate" value="@Model.FinFromDate" />
										<input type="hidden" asp-for="FinToDate" value="@Model.FinToDate" />
										<input type="hidden" asp-for="TypeOfSave" value="" />
										<label asp-for="EntryID" class="form-label">Entry ID</label>
										<input asp-for="EntryID" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="YearCode" class="form-label">Year</label>
										<input asp-for="YearCode" class="form-control" value="@Model.YearCode" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="EntryDate" class="form-label">Entry Date</label>
										<input asp-for="EntryDate" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="EntryTime" class="form-label">Time</label>
										<input asp-for="EntryTime" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Branch" class="form-label">Branch</label>
										@*<select class="form-select" asp-for="Branch" asp-items="@(new SelectList(Model.BranchList,"Value","Text"))"></select>*@
										<input asp-for="Branch" value="@Model.Branch" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-2 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SOFor" class="form-label" style="color:  red;">SO For</label>
										<select class="form-select" asp-for="SOFor" asp-items="@(new SelectList(Model.SOForList,"Value","Text"))"></select>
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SOType" class="form-label" style="color:  red;">SO Type</label>
										<select class="form-select" asp-for="SOType" asp-items="@(new SelectList(Model.SOTypeList,"Value","Text"))"></select>
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SONo" class="form-label" style="color:  red;">SO No</label>
										<input asp-for="SONo" class="form-control" readonly="readonly" />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="OrderType" class="form-label" style="color:  red;">Order Type</label>
										<select class="form-select" asp-for="OrderType" asp-items="Model.OrderTypeList"></select>
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="CurrencyID" class="form-label" style="color:  red;" `>Currency</label>
										<select class="form-select" asp-for="CurrencyID"></select>
										@if (Model.Mode == "U" || Model.Mode == "V")
										{
											<input asp-for="CurrencyID" value="@Model.CurrencyID" type="hidden" id="hiddenCurrency" />
										}
									</div>

									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="CustOrderNo" class="form-label" style="color:  red;"> Order No</label>
										<input asp-for="CustOrderNo" class="form-control" style="background-color: lightblue !important;" />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="SODate" class="form-label" style="color:  red;">SO Date</label>
										<input asp-for="SODate" class="form-control" onchange="WEFDateChange()" readonly />
									</div>
									<div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="AccountCode" class="form-label" style="color:  red;">Party Name</label>
										<div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
											<input asp-for="PN1" class="form-check-input" type="checkbox" role="switch" />Show All
										</div>
										<select class="form-select" asp-for="AccountCode" asp-items="@(new SelectList(Model.AccountList,"Value","Text"))">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="Address" class="form-label" style="color:  red;">Address</label>
										<input asp-for="Address" class="form-control" readonly />
									</div>
									<div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="DeliveryAddress" class="form-label" style="color:  red;">Delivery Address</label>
										<input asp-for="DeliveryAddress" class="form-control" />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="WEF" class="form-label" style="color:  red;">WEF</label>
										<input asp-for="WEF" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										@if (Model.Mode == "U" || Model.Mode == "V")
										{
											<input type="hidden" value="@Model.SOCloseDate" id="hiddenSOCloseDate">
										}
										<label asp-for="SOCloseDate" class="form-label" style="color:  red;">Exp. Date</label>
										<input asp-for="SOCloseDate" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="QuotNo" class="form-label">Quot No</label>
										<select class="form-select" asp-for="QuotNo" asp-items="@(new SelectList(Model.QuotList,"Value","Text"))" onchange="QuotChange(this.id);">
											<option value="0">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="QuotYear" class="form-label">Quot Year</label>
										<select class="form-select" asp-for="QuotYear" asp-items="@(new SelectList(Model.QuotYearList,"Value","Text"))">
											<option value="0">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label class="form-label">Quote Date</label>
										<input asp-for="QDate" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AmmNo" class="form-label">Amm No</label>
										<input asp-for="AmmNo" class="form-control" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AmmEffDate" class="form-label">Amm Date</label>
										<input asp-for="AmmEffDate" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12" style="width:120px">
										<label asp-for="SOConfirmDate" class="form-label">SO Confirm Date</label>
										<input asp-for="SOConfirmDate" class="form-control" readonly />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="ConsigneeAccountCode" class="form-label">Consignee</label>
										<div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
											<input asp-for="PN2" class="form-check-input" type="checkbox" role="switch" />Show All
										</div>
										<select class="form-select" asp-for="ConsigneeAccountCode" data-val="false" asp-items="@(new SelectList(Model.AccountList,"Value","Text"))">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="ConsigneeAddress" class="form-label">Consignee Address</label>
										<input asp-for="ConsigneeAddress" class="form-control" />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<button type="button" class="MultiBuyers btn btn-sm btn-outline-success mt-3">
											<i class="fa-solid fa-calendar-clock fa-fw fa-lg"></i> Multiple Buyers
										</button>
									</div>
								</div>
							</div>
						</div>
					}
				</div>
				<div class="accordion-item">
					<h2 class="accordion-header" id="H_SAGrid">
						<button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
							<strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Item Detail Grid</strong>
						</button>
					</h2>
					@if (Model.Mode == "SOA" || Model.Mode == "SAU")
					{
						<div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
							<div class="accordion-body">
								<div class="row g-2 gx-3" id="_ItemGrid">
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="PartCode" class="form-label" style="color:  red;">Part Code*</label>
										<select class="form-select custom-width-select" asp-for="PartCode" asp-items="@(new SelectList(Model.PartCodeList,"Text","Value"))">
											<option value="0">-Select-</option>
										</select>
									</div>
									<div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-6">
										<label asp-for="ItemCode" class="form-label" style="color:  red;">Item Name*</label>
										<div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
											<label id="IN12" class="form-label">Show All</label>
											<input asp-for="IN1" class="form-check-input" type="checkbox" role="switch" />
										</div>
										<div class="col-xl-12">
											<select class="form-select" style="height:190px;width:290px;" asp-for="ItemCode" asp-items="@(new SelectList(Model.ItemNameList,"Text","Value"))">
												<option value="0">-Select-</option>
											</select>
										</div>
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="HSNNo" class="form-label" style="color:  red;">HSN No*</label>
										<input asp-for="HSNNo" class="form-control" value="0" />
									</div>
									<div class="col-xl-1 col-lg-1 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Qty" class="form-label" style="color:  red;">Qty*</label>
										<input asp-for="Qty" class="form-control" min=0 value="0" onkeyup="CalculateRate();" data-val="false" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Unit" class="form-label" style="color:  red;">Unit*</label>
										<input asp-for="Unit" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AltQty" class="form-label">Alt Qty</label>
										<input asp-for="AltQty" class="form-control" onkeyup="CalculateRate();" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AltUnit" class="form-label">Alt Unit</label>
										<input asp-for="AltUnit" class="form-control" value="NA" readonly="readonly" aria-readonly="readonly" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Rate" class="form-label" style="color:  red;">Rate*</label>
										<input asp-for="Rate" class="form-control" onkeyup="CalculateRate();" />
									</div>
									<div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="UnitRate" class="form-label" style="color:  red;">Rate/Unit*</label>
										<select class="form-select" asp-for="UnitRate" asp-items="Model.UnitRateList" onchange="CalculateRate();"></select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="OtherRateCurr" class="form-label">FX Rate</label>
										<input asp-for="OtherRateCurr" class="form-control" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="DiscPer" class="form-label">Disc %</label>
										<input asp-for="DiscPer" class="form-control" value="0" min="0" max="100" onchange="CalculateRate();" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="DiscRs" class="form-label">Disc Rs.</label>
										<input asp-for="DiscRs" class="form-control" onchange="CalculateRate();" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Amount" class="form-label" style="color:  red;">Amount*</label>
										<input asp-for="Amount" class="form-control" value="0.00" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="TolLimit" class="form-label">Tol Limit</label>
										<input asp-for="TolLimit" class="form-control" />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="Remark" class="form-label">Remark</label>
										<input asp-for="Remark" class="form-control" />
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Description" class="form-label">Description</label>
										<input asp-for="Description" class="form-control" />
									</div>
									@* <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12"> *@
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AmendmentReason" class="form-label">Amendment Reason</label>
										<input asp-for="AmendmentReason" class="form-control" />
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12 text-center">
										<button type="button" class="ItemBtn btn btn-sm btn-outline-danger">
											<i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
										</button>
									</div>
									@if (Model.Mode == "SOA" || Model.Mode == "SSA")
									{
										<div class="col-auto">
											<button type="button" class="EXPORT btn btn-sm btn-outline-success" id="sendToExcel">
												<i class="fa-solid fa-angles-down fa-fw fa-lg"></i> EXPORT
											</button>
										</div>
										<div class="col-auto">
											<input class="form-control" type="file" id="ExcelFile" />
										</div>
										<div class="col-auto">
											<button type="button" class="Importbtn btn btn-sm btn-outline-success" onclick="UploadExcel()">
												<i class="fa-solid fa-angles-down fa-fw fa-lg"></i> Import From Excel
											</button>
										</div>
									}
									
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12 text-center">
										<div class="form-check form-switch d-flex justify-content-center mt-2">
											<input asp-for="SH" class="form-check-input" type="checkbox" role="switch" />
										</div>
										<label class="form-label">Show/Hide Fields</label>
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12 text-center">
										<button type="button" class="Schedule btn btn-sm btn-outline-success mt-3">
											<i class="fa-solid fa-calendar-clock fa-fw fa-lg"></i> SCHEDULE
										</button>
									</div>
									<div class="clearfix"></div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="StoreName" class="form-label">Store Name</label>
										<select class="form-select" asp-for="StoreName" asp-items="@(new SelectList(Model.StoreList,"Value","Text"))" onchange="StoreChange()">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="StockQty" class="form-label">Stock Qty</label>
										<input asp-for="StockQty" class="form-control" readonly disabled />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Color" class="form-label">Color</label>
										<input asp-for="Color" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Rejper" class="form-label">Rejper</label>
										<input asp-for="Rejper" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Excessper" class="form-label">Excessper</label>
										<input asp-for="Excessper" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="ProjQty1" class="form-label">Proj Qty1</label>
										<input asp-for="ProjQty1" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="ProjQty2" class="form-label">Proj Qty2</label>
										<input asp-for="ProjQty2" class="form-control" />
									</div>
								</div>
								<div class="progress my-2 mb-3" style="height: 4px;">
									<div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
								</div>

								<div class="card">
									<div class="card-body overflow-auto pb-0">
										<table class="table table-hover table-bordered table-striped" id="SaleOrderTbl">
											<thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
												<tr>
													<th>Action</th>
													<th>Seq No</th>
													<th>Part Code</th>
													<th>Item Name</th>
													<th>HSN No</th>
													<th>Qty</th>
													<th>Unit</th>
													<th>Alt Qty</th>
													<th>Alt Unit</th>
													<th>Rate</th>
													<th>Rate in FX</th>
													<th>Rate/Unit</th>
													<th>Disc%</th>
													<th>Disc Rs</th>
													<th>Amount</th>
													<th>Tol Limit</th>
													<th>Description</th>
													<th>Remark</th>
													<th>Amendment No</th>
													<th>Amendment Date</th>
													<th>Amendment Reason</th>
													<th>Color</th>
													<th>Rejper</th>
													<th>Excessper</th>
													<th>Proj Qty1</th>
													<th>Proj Qty2</th>
												</tr>
											</thead>
											<tbody id="divSaleItemGrid">
												<partial name="_SaleItemGrid" />
											</tbody>
										</table>
									</div>
								</div>
								<div class="progress my-3 mb-3" style="height: 4px;">
									<div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<div class="row g-2 gx-3">
									<div class="col-12 text-center">
										<strong>BASIC TOTAL : <i class="fa-solid fa-indian-rupee-sign fa-fw fa-1x"></i><span id="lblItemNetAmount"></span></strong>
										<strong>, Total No Of Items : <span id="lblTotalNoOfItems"></span></strong>
									</div>
								</div>
							</div>
						</div>
					}
					else
					{
						<div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
							<div class="accordion-body">
								<div class="row g-2 gx-3" id="_ItemGrid">
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="PartCode" class="form-label" style="color:  red;">Part Code*</label>
										<select class="form-select custom-width-select" asp-for="PartCode" asp-items="@(new SelectList(Model.PartCodeList,"Text","Value"))">
											<option value="0">-Select-</option>
										</select>
									</div>
									<div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-6">
										<label asp-for="ItemCode" class="form-label" style="color:  red;">Item Name*</label>
										<div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
											<label id="IN12" class="form-label">Show All</label>
											<input asp-for="IN1" class="form-check-input" type="checkbox" role="switch" />
										</div>
										<div class="col-xl-12">
											<select class="form-select" style="height:190px;width:290px;" asp-for="ItemCode" asp-items="@(new SelectList(Model.ItemNameList,"Text","Value"))">
												<option value="0">-Select-</option>
											</select>
										</div>
									</div>

									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="HSNNo" class="form-label" style="color:  red;">HSN No*</label>
										<input asp-for="HSNNo" class="form-control" value="0" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Qty" class="form-label" style="color:  red;">Qty*</label>
										<input asp-for="Qty" class="form-control" type="number" step="any" min=0 value="0" onkeyup="CalculateRate();" data-val="false" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Unit" class="form-label" style="color:  red;">Unit*</label>
										<input asp-for="Unit" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AltQty" class="form-label">Alt Qty</label>
										<input asp-for="AltQty" class="form-control" onkeyup="CalculateRate();" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AltUnit" class="form-label">Alt Unit</label>
										<input asp-for="AltUnit" class="form-control" value="NA" readonly="readonly" aria-readonly="readonly" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Rate" class="form-label" style="color:  red;">Rate*</label>
										<input asp-for="Rate" type="number" step="any" min="0" class="form-control" onkeyup="CalculateRate();" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="UnitRate" class="form-label" style="color:  red;">Rate/Unit*</label>
										<select class="form-select" asp-for="UnitRate" asp-items="Model.UnitRateList" onchange="CalculateRate();"></select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="OtherRateCurr" class="form-label">Rate In FX</label>
										<input asp-for="OtherRateCurr" type="number" step="any" min="0" class="form-control" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="DiscPer" class="form-label">Disc %</label>
										<input asp-for="DiscPer" type="number" step="any" class="form-control" value="0" min="0" max="100" onchange="CalculateRate();" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="DiscRs" class="form-label">Disc Rs.</label>
										<input asp-for="DiscRs" type="number" step="any" min="0" class="form-control" onkeyup="CalculateRateA();" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Amount" class="form-label" style="color:  red;">Amount*</label>
										<input asp-for="Amount" class="form-control" value="0.00" readonly disabled />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="TolLimit" class="form-label">Tol Limit</label>
										<input asp-for="TolLimit" class="form-control" />
									</div>
									<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="Remark" class="form-label">Remark</label>
										<input asp-for="Remark" class="form-control" />
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Description" class="form-label">Description</label>
										<input asp-for="Description" class="form-control" />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="StoreName" class="form-label">Store Name</label>
										<select class="form-select" asp-for="StoreName" asp-items="@(new SelectList(Model.StoreList,"Value","Text"))" onchange="StoreChange()">
											<option value="">-Select-</option>
										</select>
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="StockQty" class="form-label">Stock Qty</label>
										<input asp-for="StockQty" class="form-control" readonly disabled />
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12 text-center">
										<button type="button" class="ItemBtn btn btn-sm btn-outline-danger mt-3">
											<i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
										</button>
									</div>
									<div class="col-lg-3 col-md-3 col-sm-3 text-center ImportExcel">

										<div class="input_container">
											<label for="files" class="btn btn-sm btn-outline-success mt-2">Import Excel</label>
											<input id="files" class="Execllbl BtnUploadExl btn btn-sm btn-outline-success" style="display:none;" type="file">
										</div>
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12 text-center">
										<div class="form-check form-switch d-flex justify-content-center mt-2">
											<input asp-for="SH" class="form-check-input" type="checkbox" role="switch" />
										</div>
										<label class="form-label">Show/Hide Additional Fields</label>
									</div>
									<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12 text-center">
										<button type="button" class="Schedule btn btn-sm btn-outline-success mt-3">
											<i class="fa-solid fa-calendar-clock fa-fw fa-lg"></i> SCHEDULE
										</button>
									</div>
									<div class="clearfix"></div>
									<div class="AF col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
										<label asp-for="AmendmentReason" class="form-label">Amendment Reason</label>
										<input asp-for="AmendmentReason" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Color" class="form-label">Color</label>
										<input asp-for="Color" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Rejper" class="form-label">Rejper</label>
										<input asp-for="Rejper" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="Excessper" class="form-label">Excessper</label>
										<input asp-for="Excessper" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="ProjQty1" class="form-label">Proj Qty1</label>
										<input asp-for="ProjQty1" class="form-control" />
									</div>
									<div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="ProjQty2" class="form-label">Proj Qty2</label>
										<input asp-for="ProjQty2" class="form-control" />
									</div>
								</div>
								<div class="progress my-2 mb-3" style="height: 4px;">
									<div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<div class="d-flex justify-content-end mb-2">
									<div class="col-md-2 me-3">
										<input type="text" class="form-control" id="search-box" placeholder="Search..." style="background-color:#FFFACD;">
									</div>
									<a class="btn btn-secondary btn-sm ImportExcel" onclick="ExportSaleOrderFormate();">
										<i class="fa-solid fa-floppy-disk-pen fa-fw fa-lg" style="--fa-secondary-color: crimson; --fa-secondary-opacity: 1.0;"></i>
										IMPORT FORMAT
									</a>
								</div>
								<div class="card">
									<div class="card-body overflow-auto pb-0">
										<div class="table-responsive" style="max-height:150px;">
											<table class="table table-hover table-bordered table-striped" id="ItemTable">
												<thead class="bg-gradient card-headerBG text-light small" id="ItemThead" style="white-space:nowrap">
													<tr>
														<th>Action</th>
														<th data-columnno="1" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Seq No</th>
														<th data-columnno="2" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>Part Code</th>
														<th data-columnno="3" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>Item Name</th>
														<th data-columnno="4" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>HSN No</th>
														<th data-columnno="5" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>Qty</th>
														<th data-columnno="6" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>Unit</th>
														<th data-columnno="7" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Alt Qty</th>
														<th data-columnno="8" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Alt Unit</th>
														<th data-columnno="9" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>Rate</th>
														<th data-columnno="10" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Other Rate Curr.</th>
														<th data-columnno="11" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>Rate/Unit</th>
														<th data-columnno="12" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Disc%</th>
														<th data-columnno="13" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Disc Rs</th>
														<th data-columnno="14" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon" style="color:  red;"><i class="fa" aria-hidden="true"></i></span>Amount</th>
														<th data-columnno="15" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Tol Limit</th>
														<th data-columnno="16" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Description</th>
														<th data-columnno="17" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Remark</th>
														<th data-columnno="18" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Amendment No</th>
														<th data-columnno="19" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Amendment Date</th>
														<th data-columnno="20" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Amendment Reason</th>
														<th data-columnno="21" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Color</th>
														<th data-columnno="22" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Rejper</th>
														<th data-columnno="23" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Excessper</th>
														<th data-columnno="24" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Proj Qty1</th>
														<th data-columnno="25" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Proj Qty2</th>
													</tr>
												</thead>
												<tbody id="divSaleItemGrid">
													<partial name="_SaleItemGrid" />
												</tbody>
											</table>
											<div class="col-lg-2 col-md-3 col-sm-3 text-center mt-3 ms-auto">
												<button class="btn btn-sm btn-outline-success me-3" style="padding:3px;height:30px;width:100px;" type="button" id="btnGridExcel">
													<i class="fa-solid fa-upload fa-fw fa-lg "></i> EXCEL
												</button>
											</div>
										</div>
									</div>
								</div>
								<div class="progress my-3 mb-3" style="height: 4px;">
									<div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
								</div>
								<div class="row g-2 gx-3">
									<div class="col-12 text-center">
										<strong>BASIC TOTAL : <i class="fa-solid fa-indian-rupee-sign fa-fw fa-1x"></i><span id="lblItemNetAmount"></span></strong>,
										<strong>Total No Of Items : <span id="lblTotalNoOfItems"></span></strong>
									</div>
								</div>
							</div>
						</div>
					}
				</div>
				<div class="accordion-item">
					<h2 class="accordion-header" id="H_TaxDetail">
						<button class="accordion-button collapsed text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_TaxDetail" aria-expanded="true" aria-controls="B_TaxDetail">
							<strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Tax Detail</strong>
						</button>
					</h2>
					<div id="B_TaxDetail" class="accordion-collapse collapse pnl1 bg-gradient" aria-labelledby="H_TaxDetail">
						@*<partial name="_TaxDetail" />*@

						<div class="accordion-body">
							@await Html.PartialAsync("_TaxDetail")
							<div class="progress my-3" style="height: 4px;">
								<div class="progress-bar progress-bar-striped bg-danger" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
							</div>
							<div class="row g-2 gx-3 justify-content-around">
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="TotalRoundOff" class="form-label">RoundOff</label>
									<select class="form-select" asp-for="TotalRoundOff" asp-items="Model.YesNo">
										<option value="0">-Select-</option>
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="TotalDiscountPercentage" class="form-label">Discount %</label>
									<input asp-for="TotalDiscountPercentage" class="form-control" value="0" min="0" max="100" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="TotalAmtAftrDiscount" class="form-label">Amt Aftr Discount</label>
									<input asp-for="TotalAmtAftrDiscount" class="form-control" value="0.00" readonly disabled />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="NetTotal" class="form-label">Net Total</label>
									<input asp-for="NetTotal" class="form-control" readonly />
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="accordion-item">
					<h2 class="accordion-header" id="H_SODetail">
						<button class="accordion-button text-light pnl4BG bg-gradient collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#B_SODetail" aria-expanded="false" aria-controls="B_SODetail">
							<strong style="text-transform:uppercase"><i class="fa-solid fa-hourglass-clock fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
						</button>
					</h2>
					<div id="B_SODetail" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SODetail">
						<div class="accordion-body">
							<div class="row g-2 gx-3">
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="FreightPaidBy" class="form-label">Freight Paid By</label>
									<select class="form-select" asp-for="FreightPaidBy" asp-items="Model.FreightByList">
										<option value="0">-Select-</option>
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="PackingChgApplicable" class="form-label">Packing Chg Applicable</label>
									<select class="form-select" asp-for="PackingChgApplicable" asp-items="Model.YesNo">
										<option value="0">-Select-</option>
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="TransportMode" class="form-label">Mode Transport</label>
									<select class="form-select" asp-for="TransportMode" asp-items="Model.TransportModeList">
										<option value="0">-Select-</option>
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="DeliverySch" class="form-label">Delivery Sch</label>
									<input asp-for="DeliverySch" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="DeliveryTerms" class="form-label">Delivery Terms</label>
									<input asp-for="DeliveryTerms" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="PreparedBy" class="form-label">Prepared By</label>
									@*<select class="form-select" asp-for="PreparedBy" asp-items="@(new SelectList(Model.PreparedByList,"Value","Text"))">
                                    <option value="">-Select-</option>
                                    </select>*@
									<input type="hidden" asp-for="PreparedBy" value="@Model.PreparedBy">
									<input asp-for="PreparedByName" class="form-control" value="@Model.PreparedByName" readonly />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="PortOfDischarge" class="form-label">Port Of Discharge</label>
									<input asp-for="PortOfDischarge" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="ResponsibleSalesPersonID" class="form-label">Responsible Sales Person</label>
									<select class="form-select" asp-for="ResponsibleSalesPersonID" asp-items="@(new SelectList(Model.ResponsibleSalesPersonList,"Value","Text"))">
										<option value="0">-Select-</option>
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="CustContactPerson" class="form-label">Cust Contact Person</label>
									<input asp-for="CustContactPerson" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="SaleDocType" class="form-label">Sale Doc Type</label>
									<select class="form-select" asp-for="SaleDocType" asp-items="@(new SelectList(Model.SaleDocTypeList,"Value","Text"))">
										<option value="0">-Select-</option>
									</select>
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="OtherDetail" class="form-label">Other Detail</label>
									<input asp-for="OtherDetail" class="form-control" />
								</div>

								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="Port2Loading" class="form-label">Port To Loading</label>
									<input asp-for="Port2Loading" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="InsuApplicable" class="form-label">Insurance Applicable</label>
									<input asp-for="InsuApplicable" class="form-control" />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="SODeliveryDate" class="form-label">SO Delivery Date</label>
									<input asp-for="SODeliveryDate" class="form-control" required />
								</div>
								<div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
									<label asp-for="SORemark" class="form-label">Remark</label>
									<input asp-for="SORemark" class="form-control" />
								</div>
								@if (Model.Mode == "SOA" || Model.Mode == "SAU")
								{
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AmmEntryId" class="form-label">AmmEntry ID</label>
										<input asp-for="AmmEntryId" class="form-control" readonly />
									</div>
									<div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
										<label asp-for="AmmYearCode" class="form-label">Amm Year</label>
										<input asp-for="AmmYearCode" class="form-control" value="@Model.AmmYearCode" readonly />
									</div>
								}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="card-footer p-3">
			@* <partial name="_FormsButton" model="Model" />*@
			<div class="card-header card-headerBG text-light bg-gradient">
				<h5>
					<strong>@ViewData["Title"] - @Model.YearCode</strong>
					<span class="d-flex float-end" style="margin-top:-2px;">
						@if (Model.Mode == "SOA" || Model.Mode == "SOC")
						{
							<a asp-action="SOAmmCompleted" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient me-2">
								<i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
								Dashboard
							</a>
						}
						else
						{
							<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient me-2">
								<i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
								Dashboard
							</a>
						}
						<div class="col-auto me-2">
							@if (Model.Mode != "V" && Model.Mode != "SOA" && Model.Mode != "SOC")
							{
								<button type="button" class="PartialSave btn btn-secondary btn-sm mr-2" style="color:white!important">
									<i class="fa-solid fa-floppy-disk-pen fa-fw fa-lg" style="--fa-secondary-color: crimson; --fa-secondary-opacity: 1.0;"></i>
									PARTIAL SAVE
								</button>
							}
						</div>
						@if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
						{
							<div class="col-auto">
								<a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
									<i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
									REFRESH
								</a>
							</div>
							@if (Model.Mode == "U")
							{
								<div class="col-auto">
									<button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="UpdateButton">
										<i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
										UPDATE
									</button>
								</div>
							}

							else
							{
								<div class="col-auto">
									<button type="submit" class="btn btn-primary btn-sm" id="submitBTNFooter">
										<i class="fa-solid fa-chevron-circle-right"></i>
										SUBMIT
									</button>
								</div>
							}
						}
						@* <partial name="_FormsButton" /> *@
					</span>
				</h5>

			</div>
			@*<span class="d-flex float-end mb-2 mr-2">*@

			@*<div class="col-auto" style="margin-right:8px;">
            @if (@Model.Mode != "V")
            {
            <button type="button" class="PartialSave btn btn-secondary btn-sm" style="color:white!important">
            <i class="fa-solid fa-floppy-disk-pen fa-fw fa-lg" style="--fa-secondary-color: crimson; --fa-secondary-opacity: 1.0;"></i>
            PARTIAL SAVE
            </button>
            }
            </div>*@
			@*<partial name="_FormsButton" />*@
			@*</span>*@

			@*<div class="row justify-content-between g-2">
            <div class="col-auto">
            <a href="#" class="btn offer-listbtn hvr-sweep-to-right btn-sm btn-secondary" onclick="back();">
            <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
            BACK
            </a>
            </div>
            @if (@Model.Mode != "V")
            {
            <div class="col-auto">
            <a class="btn btn-sm btn-outline-danger" asp-action="OrderDetail">
            <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
            REFRESH
            </a>
            </div>
            @if (@Model.Mode == "U")
            {
            Model.Mode = "U";
            <div class="col-auto">
            <button type="submit" class="btn btn-sm btn-outline-warning">
            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
            UPDATE
            </button>
            </div>
            }
            else
            {
            <div class="col-auto">
            <button type="submit" class="btn btn-sm btn-outline-primary">
            <i class="fa-solid fa-chevron-circle-right fa-fw fa-lg"></i>
            SUBMIT
            </button>
            </div>
            }
            }
            </div>*@
			<partial name="_SOmodal" />
		</div>
	</form>
</div>

<style>
	.custom-width-select {
		width: 190px !important;
	}

	/* .select2-dropdown {
		z-index: 9999 !important; /* Adjust the value as needed */
		background-color: #e0f2f1 !important;
	} */

	.select2-search__field {
		z-index: 10000 !important; /* Adjust the value as needed */
	}

	#ItemTable {
		width: 100%;
		border-collapse: collapse;
	}

	#ItemThead th {
		background-color: #127387;
		position: sticky;
		top: 0;
		z-index: 1;
	}

    .select2-container--default .select2-selection--single {
        background-color: #e0f2f1;
        border: 1.5px solid #0a0a0a !important;
        border-radius: 4px;
    }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            /* border-bottom: 1.5px solid #000 !important; */
            border-bottom: none !important;
        }

    .select2-container--default .select2-results > .select2-results__options {
        background-color: #e0f2f1; /* Dropdown background color */
        color: #000;
	}
	.modal {
		z-index: 9998 !important;
	}

	tbody td {
		/*/ Table cell styles /*/
	}
</style>
@section Scripts
{
	<script>
		$(function () {
			//alert("inside")
			if ('@Model.Mode' != '' && parseInt('@Model.ID') != 0) {
				GetTaxPartItem();
				$('#lblItemNetAmount').text($('#ItemNetAmount').val());
				if ($('#SOType').val() == 'OPEN') {
					$('#Qty,#AltQty').val('0').prop('disabled', true).attr('readonly', 'readonly');
					$('.Schedule').fadeOut();
				}
			}
			else {
				window.setInterval(function () {
					var Dat = new Date();
					let am_pm = (Dat.getHours() >= 12) ? "PM" : "AM";
					var time = Dat.getHours() + ":" + Dat.getMinutes() + ":" + Dat.getSeconds() + " - " + am_pm;
					//console.log(time);
					$('#EntryTime').val(time);
				}, 1000);
			}
		});

		 function ExportSaleOrderFormate() {
            ;
			$('#divSaleItemGrid').empty();
            var wb = XLSX.utils.book_new();

            var ws = XLSX.utils.json_to_sheet([], { header: ["Part Code", "Unit", "Ori. MRP", "PO No.", "Date"] });

            //ws['!ref'] = 'A1:I1';

            XLSX.utils.book_append_sheet(wb, ws, "Sheet 1");

            XLSX.writeFile(wb, "ImportSaleOrderFormat.xlsx");
        }

		function NewEntryId() {

			var YearCode = $('#YearCode').val();
			$.ajax({
				type: "POST",
				data: { "YearCode": YearCode },
				url: "@Url.Action("NewEntryId")",
				dataType: "json",
				success: function (result, status, error) {

					if (result != null) {
						var obj = $.parseJSON(result);
						$('#EntryID').val("");
						$('#EntryID').val(obj.Result[0].EntryId);
						$('#SONo').val("");
						$('#SONo').val(obj.Result[0].SONo);
					}
				}
			});
		}
		function NewAmmEntryId() {

			$.ajax({
				type: "POST",
				url: "@Url.Action("NewAmmEntryId")",
				dataType: "json",
                data:{"YearCode" : $('#YearCode').val()},
				success: function (result, status, error) {

					if (result != null) {
						var obj = $.parseJSON(result);
						$('#AmmEntryId').val("");
						$('#AmmEntryId').val(obj.Result[0].AmmEntryId);
					}
				}
			});
		}


		function GetFormRights() {

			$.ajax({
				url: "@Url.Action("GetFormRights")",
				type: "POST",
				success: function (data) {

					if (data != null) {
						var obj = $.parseJSON(data);
						if (obj.Result.Table.length == 0) {
							$("button[type='submit'").prop("disabled", true);
						} else {
							console.log(obj);
							var optAll = obj.Result.Table[0].OptAll;
							var optSave = obj.Result.Table[0].OptSave;
							var optUpdate = obj.Result.Table[0].OptUpdate;
							var optDelete = obj.Result.Table[0].OptDelete;
							var optView = obj.Result.Table[0].OptView;
							if (!optAll) {
								if (!optSave) {
									$("button[type='submit'").prop("disabled", true);
								}
							}
						}
					}
				},
				error: function (errMsg) {
					$.notify(errMsg, { position: "top center", className: "error" });
				}
			});
		}


		function StoreChange() {

			var storeValue = parseInt($('#StoreName').val());
			var ItemCode = parseInt($('#ItemCode').val());
			$.ajax({
				type: "POST",
				data: { "store": storeValue, "Itemcode": ItemCode },
				url: "@Url.Action("GetTotalStock")",
				dataType: "json",
				success: function (result, status, error) {
					console.log(result);
					if (result != null) {
						var obj = $.parseJSON(result);
						$('#StockQty').val("");
						$('#StockQty').val(obj.Result[0].STOCK);
					}
				}
			});
		}

		function AllowMultiBuyerSO() {

			$.ajax({
				type: "POST",
				url: "@Url.Action("GetAllowMultiBuyerProp")",
				dataType: "json",
				success: function (result, status, error) {
					if (result != null) {
						var obj = $.parseJSON(result);
						if (obj.Result[0].AllowMultipleBuyerInSaleOrder == "Y") {
							$('.MultiBuyers').fadeIn();
						}
						else {
							$('.MultiBuyers').fadeOut();
						}
					}
				}
			});
		}


		var SOOrder;
		//$('#SOType').on('change', function () {
		//
		//    $('#SOConfirmationBox').modal('show');
		//    SOOrder = true;

		//});




		function CancelButton() {

			if (SOOrder == true) {
				if ($('#SOType').val() === "OPEN") {
					$('#SOType').val("CLOSE");
				} else {
					$('#SOType').val("OPEN");
				}
			} else {
				if ($('#OrderType').val() === "Domestic") {
					$('#OrderType').val("Export");
				} else {
					$('#OrderType').val("Domestic");
				}
				FillCurrency();
			}

		}

		function ConfirmBtn() {

			if (SOOrder == true) {
				$('.Schedule').fadeOut();
				ClearItemTax();
				if ($('#SOType').val() == "OPEN") {

					$('#Qty,#AltQty').val('0').prop('disabled', true).attr('readonly', 'readonly');
				}
				else {
					$('#Qty,#AltQty').val('0').prop('disabled', false).removeAttr('readonly');
				}
			} else {
				$('#OrderType').val() == "Domestic" ? $('#CurrencyID').prop('selectedIndex', 0).change() : $('#CurrencyID').prop('selectedIndex', 2).change();
				ClearItemTax();
				// $(this).val() == "Domestic" ? $('#OtherRateCurr').prop('readonly',true) :  $('#Rate').prop('readonly',true);
				if ($('#OrderType').val() == "Domestic") {
					$('#OtherRateCurr').prop('readonly', true);
					$('#Rate').prop('readonly', false);
				} else {
					$('#OtherRateCurr').prop('readonly', false);
					$('#Rate').prop('readonly', true);
				}
				var hiddenCurrency = $('#hiddenCurrency').val();
				if ($('#Mode').val() == 'U' || $('#Mode').val() == 'V') {
					var selectedText = $('#CurrencyID option[value="' + hiddenCurrency + '"]').text();
					//$('#CurrencyID').val(selectedText);
				} else {
					FillCurrency();
				}
			}
		}
		$('#SOBillToShipTo').on('shown.bs.modal', function () {

			$('#MBillToAccountCode').select2({
				dropdownParent: $('#SOBillToShipTo')
			});
			$('#MShiptoAccountCode').select2({
				dropdownParent: $('#SOBillToShipTo')
			});

		});

		$('#OtherRateCurr').on('change', function () {

			var Currency = $('#CurrencyID').val();
			$.ajax({
				type: "POST",
				data: { "Currency": Currency },
				url: "@Url.Action("GetCurrency")",
				dataType: "json",
				success: function (result, status, error) {

					if (result != null) {
						//var obj = $.parseJSON(result);
						//$('#Rate').val("");
						//$('#Rate').val(obj.Result[0].Rate);
						if ($('#OtherRateCurr').val() == ".") {
							$('#Amount').val(0.00);
						}
					}
				}
			});
		});

		$('.btnClearTax').click(function (e) {
			ClearTxGrid();
		});

		function ClearTxGrid() {
			$.ajax({
				type: "POST",
				url: "@Url.Action("GetClearTxGrid")",
				data: { Code: 0 },
				dataType: "json",
				success: function (result, status, error) {
					console.log(result);
					$('#divTaxGrid').empty();
					$('#TotalRoundOff').prop('selectedIndex', 0);
					var INA = parseFloat($('#ItemNetAmount').val());
					var rowCount = $('#divSaleItemGrid tr').length;
					var taxRowCount = $('#divTaxGrid tr').length;
					var sum = 0.00;
					for (var i = 1; i <= rowCount; i++) {

						sum += parseFloat($('#GridAmount-' + i).text() == '.00' ? 0 : $('#GridAmount-' + i).text());
					}
					$('#ItemNetAmount').val(sum);
					var txSum = 0.00;
					if ($('#divTaxGrid tr td').length > 1) {
						for (var i = 1; i <= taxRowCount; i++) {
							txSum += parseFloat($('#txGridAmount-' + i).text() == '.00' ? 0 : $('#txGridAmount-' + i).text());
						}
					}
					$('#lblItemNetAmount').text(sum.toFixed(2));
					var txTotal = sum + txSum;
					$('#NetTotal').val(txTotal.toFixed(2));
					$('#TotalDiscountPercentage').val(0);
					$('#TotalAmtAftrDiscount').val(0);
				}
			});
		}

		$('#sendToExcel').click(function () {

			//   TableToExcel.convert($("#poTable"), {
			//  name: "PurchaseOrderTableAmm.xlsx",
			//  sheet: {
			//  name: "Sheet1"
			//  }
			//});
			let table = $("#SaleOrderTbl");
			console.log(table);
			;
			TableToExcel.convert(table[0], {
				name: `SaleOrderAmm.xlsx`,
				sheet: {
					name: 'SaleOrderAmm'
				}
			});
			// $("#poTable").table2excel({
			//    filename: "PurchaseOrderTableAmm.xls"
			//});
		});


		function UploadExcel() {
			var fileInput = $('#ExcelFile');
			var file = fileInput.prop("files")[0];

			var formData = new FormData();
			formData.append("excelFile", file);
			formData.append("Currency", $('#CurrencyID').find(":selected").text());

			var Err = 0;

			if ($('#ExcelFile').val() == '') {
				AddErrorCls('ExcelFile');
				Err = 1;
				return;
			}
			else {
				RemoveErrorCls('ExcelFile');
			}

			$.ajax({
				url: "@Url.Action("UploadExcel")",
				type: "POST",
				data: formData,
				processData: false,
				contentType: false,
				success: function (result) {
					if (result == "Duplicate") {

						$.notify("Duplicate Item Not allowed", "error");
					}
					else if (result == "Partcode not available") {
						$.notify("Imported Partcode is not available, Please check!!!", "error");
					} else {
						$('#divSaleItemGrid').empty();
						$('#divSaleItemGrid').html(result);
					}

				}
			});
		}

		$(document).ready(function () {
			// alert('inside load');
			$('#AccountCode').select2();
			//$('#MBillToAccountCode').select2();
			$('#PartCode').select2();
			$('#ItemCode').select2();

			//fillSaleBill();
			GetFormRights();
			ShowHideFields();
			if ($('#Mode').val() == 'SOA') {
				var SOClosedate = $('#SOCloseDate').val().split(" ")[0].replace(/-/g, "/");
				$('#SOCloseDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(SOClosedate));
				$('#SOCloseDate').datepicker("option", "minDate", parseDateToFormat(SOClosedate));
			}
			var SOClosedate = $('#SOCloseDate').val().split(" ")[0].replace(/-/g, "/");
			$('#SOCloseDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#SOCloseDate').val()));
			$('#SOCloseDate').datepicker("option", "minDate", parseDateToFormat(SOClosedate));
			// NewEntryId();
			if ($('#Mode').val() != "U" && $('#Mode').val() != "V" && $('#Mode').val() != "SOA" && $('#Mode').val() != "SAU") {

				NewEntryId();
				GetServerDate();
				$('#OtherRateCurr').prop('readonly', true);
				$('#Rate').prop('readonly', false);

			}
			else if ($('#Mode').val() == "SAU" || $('#Mode').val() == "SOA") {

				NewAmmEntryId();
			}
			else {
				if ($('#OrderType').val() == "Domestic") {
					$('#OtherRateCurr').prop('readonly', true);
					$('#Rate').prop('readonly', false);
				} else {
					$('#OtherRateCurr').prop('readonly', false);
					$('#Rate').prop('readonly', true);
				}
			}
			AllowMultiBuyerSO();

			//$('#SOBillToShipTo').on('shown.bs.modal', function () {
			//        $('#MBillToAccountCode').select2('open').select2('focus');

			//    setTimeout(function () {
			//        $('#MBillToAccountCode').select2('open').select2('focus');
			//    }, 100);
			//});



			$('.MultiBuyers').click(function () {

				$('.modal-header').addClass('bg-graident bg-warning');
				$('.modal-title').text('Multiple Buyers');


				$('#SOBillToShipTo').modal("show");
			});

			FillCurrency();

			$('#AmmEffDate').on("keydown", function (event) {
				if (event.key === "Tab") {
					$('#SOConfirmDate').focus();
					event.preventDefault();
				}
			});
			$('#ProjQty2').on("keydown", function (event) {
				if (event.key === "Tab") {
					$('.ItemBtn').focus();
					event.preventDefault();
				}
			});

			$('#DiscRs').on("keydown", function () {
				CalculateRate();
			});


			$('#SOForm').keypress(function (event) {
				if (event.keyCode === 13) {
					event.preventDefault(); // Prevent form submission
				}
			});

			LockedFincialYear();

			//$("#AmmDate").datepicker(), $("#").datepicker(), $("#").datepicker(), $("#").datepicker(), $("#").datepicker();

			$('#AmmEffDate').val($('#AmmEffDate').val().split(' ')[0]);
			$('#QDate').val(parseDateToFormat($('#QDate').val().split(' ')[0]));
			$('#SODate').val(parseDateToFormat($('#SODate').val().split(' ')[0]));
			//alert($('#WEF').val());
			$('#WEF').val(parseDateToFormat($('#WEF').val().split(' ')[0]));
			// $('#WEF').val($('#WEF').val().split(' ')[0]);
			//$('#SOCloseDate').val($('#SOCloseDate').val().split(' ')[0]);
			$('#SOConfirmDate').val(parseDateToFormat($('#SOConfirmDate').val().split(' ')[0]));
			$('#SODeliveryDate').val(parseDateToFormat($('#SODeliveryDate').val().split(' ')[0]));
			$('#AmmEffDate,#QDate,#SODate,#SOConfirmDate,#SODeliveryDate').datepicker({ dateFormat: 'dd/mm/yy' });

			//$("#QDate").datepicker({ dateFormat: 'dd/mm/yy' });
			//$("#SODate").datepicker({ dateFormat: 'dd/mm/yy' });
			//$("#WEF").datepicker({ dateFormat: 'dd/mm/yy' });
			//$("#SOConfirmDate").datepicker({ dateFormat: 'dd/mm/yy' });
			//$("#SODeliveryDate").datepicker({ dateFormat: 'dd/mm/yy' });

			var hiddenCurrency = $('#hiddenCurrency').val();
			if ($('#Mode').val() == 'U' || $('#Mode').val() == 'V') {
				$('#CurrencyID').val(hiddenCurrency);
			}

			var soGridrow = $('#divSaleItemGrid tr').length;
			if (soGridrow >= 1) {
				$('#lblTotalNoOfItems').text(soGridrow);
			} else {
				$('#lblTotalNoOfItems').text(0);
			}

			//$("#SOCloseDate").datepicker({
			//    //changeMonth: true,
			//    //changeYear: true,
			//    //showButtonPanel: true,
			//    dateFormat: 'dd/mm/yy',
			//    //onClose: function(dateText, inst) {
			//    //    $(this).datepicker('setDate', new Date(inst.selectedYear, inst.selectedMonth, 1));
			//    //}
			//});


			//$('#SOCloseDate').val($('#SOCloseDate').val().split(' ')[0]);

			var finFromDate = $('#FinFromDate').val();
			var finToDate = $('#FinToDate').val();
			var WEFDate = $('#WEF').val();
			var soCloseDate = $('#SOCloseDate').val();

			var WEFParts = WEFDate.split("/");
			var dateParts1 = finFromDate.split("/");
			var soCloseDateparts = finFromDate.split("/");
			var monthNames = {
				"Jan": "01",
				"Feb": "02",
				"Mar": "03",
				"Apr": "04",
				"May": "05",
				"Jun": "06",
				"Jul": "07",
				"Aug": "08",
				"Sep": "09",
				"Oct": "10",
				"Nov": "11",
				"Dec": "12"
			};
			// alert(' dateParts1[0] '+ dateParts1[0] );
			// alert(' dateParts1[2] '+ dateParts1[2] );
			// alert(' dateParts1[1] '+ dateParts1[1] );
			var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
		  //  alert('formattedDate1'+formattedDate1);
			var dateParts2 = finToDate.split("/");

			var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];
		   // alert('formattedDate2'+formattedDate2);

			$('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
			$('#SODate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

			$('#EntryDate').datepicker("option", "minDate", formattedDate1);
			$('#EntryDate').datepicker("option", "maxDate", formattedDate2);
			 $('#SODate').datepicker("option", "minDate", formattedDate1);
			 $('#SODate').datepicker("option", "maxDate", formattedDate2);

			/* $('#SODate').datepicker({
			dateFormat: 'dd/mm/yy',  // Ensure correct format
			minDate: formattedDate1,
			maxDate: formattedDate2,
			onSelect: function(dateText) {
				$(this).val(dateText);
			}
			}); */
		var date = new Date();
			// $('#SODate').datepicker('setDate', new Date());
		//             $('#SODate').datepicker({
		//     dateFormat: 'dd/mm/yy' // Set date format
		// }).datepicker('setDate', new Date());
		// 	var formattedDate = ('0' + date.getDate()).slice(-2) + '/' +
		// 		('0' + (date.getMonth() + 1)).slice(-2) + '/' +
		// 		date.getFullYear();

		// $('#SODate').datepicker({
		// 	dateFormat: 'dd/mm/yy'
		// }).val(formattedDate);

			var formattedWEF = WEFParts[0] + "/" + monthNames[WEFParts[1]] + "/" + WEFParts[2];
			var formattedSOCLOSE = soCloseDateparts[0] + "/" + monthNames[soCloseDateparts[1]] + "/" + soCloseDateparts[2];

			if ($('#Mode').val() == 'U' || $('#Mode').val() == 'V') {

				WEFParts = WEFDate.split("-");
				formattedWEF = WEFParts[0] + "/" + WEFParts[1] + "/" + WEFParts[2];
				var VSOCloseDt = $('#hiddenSOCloseDate').val().split(" ")[0].replace(/-/g, '/');
				$('#WEF').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(formattedWEF));
				$('#SOCloseDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(formattedWEF));

				$('#WEF').datepicker("option", "minDate", parseDateToFormat(formattedDate1));
				$('#WEF').datepicker("option", "maxDate", parseDateToFormat(formattedDate2));

				$('#SOCloseDate').datepicker("option", "minDate", parseDateToFormat(formattedDate1));
				$('#SOCloseDate').datepicker("option", "maxDate", parseDateToFormat(formattedDate2));


			}

			if ($('#Mode').val() != 'U' && $('#Mode').val() != 'V') {
				WEFDateChange();
			}

			$('.AF').fadeOut();
			$('.Schedule').fadeOut();
			$('#divSaleItemGrid tr td:first-child').text() == 'NO DATA ADDED' ? $('.Schedule').fadeOut() : $('.Schedule').fadeIn();


			//$('#Qty').blur(function()
			//{
			//    if($('#Qty').val().trim())
			//    {
			//        $('.modal-header').addClass('bg-graident bg-warning');
			//        $('.modal-title').text('DELIVERY SCHEDULE');
			//        $('#DTQty').val($('#Qty').val().trim());
			//        $('#DDate').val(new Date().toISOString().substring(0, 10));
			//        $('#PopupModel').modal("show");
			//    }
			//});
			GetCurrencyDetail();

			//if ($('#Mode').val() == 'U' || $('#Mode').val() == 'V') {
			//    var today = new Date();
			//    $('#SOCloseDate').datepicker("option", "minDate", today);
			//} else {

			//    $('#WEF').datepicker("option", "maxDate", $('#SOCloseDate').val());
			//}

		});//ready end here


		var currentSearchColumn = null;

		$("#search-box").on("keyup", function () {

			var value = $(this).val().toLowerCase();
			$("#divSaleItemGrid tr").filter(function () {
				if (currentSearchColumn !== null) {
					var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
					$(this).toggle(columnText.indexOf(value) > -1);
				} else {
					$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
				}
			});
		});

		$(document).on("click", "th[data-columnno]", function () {

			currentSearchColumn = $(this).data('columnno');
			$("#search-box").val('').trigger('keyup');
		});

		$(document).on("click", ".sortCol", function () {
			var $column = $(this).parent().closest("th");
			var colno = $(this).data('columnno');
			var currentOrder = $(this).data('sortorder');

			$('.sortCol').css('color', 'white');

			if (currentOrder === 'asc') {
				sortTable(colno, false);
				$(this).data('sortorder', 'desc');
				$(this).css('color', 'yellow');
				//$(this).css('font-size', 'larger');
				$(this).find('i:first').removeClass('fa-arrow-up');
				$(this).find('i:first').addClass('fa-arrow-down');
			} else {
				sortTable(colno, true);
				$(this).data('sortorder', 'asc');
				$(this).css('color', 'yellow');
				// $(this).css('font-size', 'larger');
				$(this).find('i:first').removeClass('fa-arrow-down');
				$(this).find('i:first').addClass('fa-arrow-up');
			}
		});

		function sortTable(columnIndex, ascending) {

			var table = $('#ItemTable');
			var rows = table.find('#divSaleItemGrid > tr').toArray();

			rows.sort(function (a, b) {
				var aValue = $(a).find('td').eq(columnIndex).text().trim();
				var bValue = $(b).find('td').eq(columnIndex).text().trim();

				var aIntValue = 0;
				var bIntValue = 0;
				if (/^\d+$/.test(aValue) && /^\d+$/.test(bValue)) {
					aIntValue = parseInt(aValue, 10);
					bIntValue = parseInt(bValue, 10);
				}

				if (aIntValue > 0) {
					if (ascending) {
						return aValue - bValue;
					} else {
						return bValue - aValue;
					}
				} else {
					if (ascending) {
						return aValue.localeCompare(bValue);
					} else {
						return bValue.localeCompare(aValue);
					}
				}
			});

			$.each(rows, function (index, row) {
				table.children('#divSaleItemGrid').append(row);
			});
		}

		$(document).on('select2:select', '#ItemCode,#PartCode', function (e) {
			var cntId = e.target.id;

			if (cntId == 'ItemCode') {
				ItemNameChange(cntId);
			}
			else {
				PartCodeChange(cntId);
			}

		});

		function GetServerDate() {
			$.ajax({
				type: "GET",
				url: "@Url.Action("GetServerDate")",
				async: false,
				success: function (result, status, error) {
					$('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);
				}
			});
		}

		$('#SOCloseDate').change(function () {
			$('#WEF').datepicker("option", "maxDate", $(this).val());
			$('#QuotNo').focus();

		});
		$('#SODate').change(function () {
			$('#AccountCode').select2('open');
		});
		$('#WEF').change(function () {
			$('#SOCloseDate').focus();
		});
		$('#AmmEffDate').change(function () {
			$('#SOConfirmDate').focus();
		});
		$('#SOConfirmDate').change(function () {
			$('#ConsigneeAccountCode').focus();
		});

		function FillCurrency() {

			var CTRL = $('#OrderType').val();
			$.ajax({
				type: "GET",
				url: "@Url.Action("GetFillCurrency")",
				async: false,
				data: { "CTRL": CTRL },
				dataType: "json",
				success: function (result, status, error) {
					console.log(result);
					if (result != null) {
						var obj = $.parseJSON(result);

						$('#CurrencyID').empty();

						$.each(obj.Result, function (index, item) {
							$('#CurrencyID').append($('<option>', {
								value: item.entry_id,
								text: item.Currency
							}));
						});



					}
				}
			});
		}
		//$('.PartialSave').click(function () {
		//    $('form').submit();
		//});

		//$('#SODate').change(function(){
		//    var minDate = $('#SODate').datepicker('getDate');
		//        $('#WEF').datepicker("option","minDate",minDate);
		//});

		function WEFDateChange() {
			 
			var minDate = $('#SODate').val();
			//$('#WEF').datepicker("setDate", parseDateToFormat(minDate));
			$('#WEF').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(minDate));

			$('#WEF').datepicker("option", "minDate", parseDateToFormat(minDate));
		}

		$('#WEF').change(function () {
			var wefDate = $('#WEF').datepicker('getDate');
			var socloseDate = wefDate;
			socloseDate.setFullYear(socloseDate.getFullYear() + 1);
			//$("#SOCloseDate").datepicker('option', 'minDate', socloseDate);
		});

		//function fillSaleBill(){
		//    $.ajax({
		//        type: "POST",
		//        data: { "YearCode": YearCode },
		//        url: "@Url.Action("GetLockedYear")",
		//        dataType: "json",
		//        success: function (result, status, error) {
		//            console.log(result);
		//            if (result != null) {
		//                var obj = $.parseJSON(result);
		//                if (obj.Result[0] != undefined) {
		//                    if (obj.Result[0].ClosedForAllusers == "Y") {
		//                        $('#submitBTN').prop('disabled', true);
		//                        $('.card-footer #submitBTN').prop('disabled', true);
		//                        $('.PartialSave').prop('disabled', true);
		//                        $('#UpdateButton').prop('disabled', true);
		//                        $('.card-footer #UpdateButton').prop('disabled', true);
		//                    }
		//                }
		//            }
		//        }
		//    });
		//}


		function LockedFincialYear() {
			var YearCode = parseInt($('#YearCode').val());
			$.ajax({
				type: "POST",
				data: { "YearCode": YearCode },
				url: "@Url.Action("GetLockedYear")",
				dataType: "json",
				success: function (result, status, error) {
					console.log(result);
					if (result != null) {
						var obj = $.parseJSON(result);
						if (obj.Result[0] != undefined) {
							if (obj.Result[0].ClosedForAllusers == "Y") {
								$('#submitBTN').prop('disabled', true);
								$('.card-footer #submitBTN').prop('disabled', true);
								$('.PartialSave').prop('disabled', true);
								$('#UpdateButton').prop('disabled', true);
								$('.card-footer #UpdateButton').prop('disabled', true);
							}
						}
					}
				}
			});
		}

		$('form').submit(function (event) {
			//event.preventDefault(); // Prevent the form from submitting via the browser
			var form = $(this);
			var url = form.attr('action');
			$("form :input").prop("disabled", false);
		});

		//$('button[type="submit"]').click(function (e) {
		//    $('#TypeOfSave').val("NPS");
		//    e.preventDefault();
		//    var soGrid = $('#divSaleItemGrid tr td').length;
		//    var taxGrid = $('#divTaxGrid tr td').length;
		//    //var txRowCount = $('#divTaxGrid tr').length;
		//    //for (var i = 1; i <= txRowCount; i++) {
		//    //    var txType = $('#txgridtype-' + i).text();
		//    //    var txname = $('#txgridname-' + i).text();
		//    //    if (txType == '' || txname == '') {
		//    //        $.notify("TaxType Or TaxName cannot be null", "error");
		//    //        return;
		//    //    }
		//    //}
		//    //if (!checkPartCodeMusthaveAtLeastOneTax()) {
		//    //    return false;
		//    //}
		//    if (soGrid <= 1) {
		//        $.notify("SO Grid should at least have one item", "error");
		//        return;
		//    } else {
		//        $("form").submit();
		//    }
		//    //else if (taxGrid <= 1) {
		//    //    $.notify("Tax Grid should at least have one item", "error");
		//    //    return;
		//    //}
		//});

		$(document).on('click', '.submitBTN,#submitBTNFooter', function (e) {
			 
			$('#TypeOfSave').val("NPS");
			e.preventDefault();
			var soGrid = $('#divSaleItemGrid tr td').length;
			var taxGrid = $('#divTaxGrid tr td').length;
			//var txRowCount = $('#divTaxGrid tr').length;
			//for (var i = 1; i <= txRowCount; i++) {
			//    var txType = $('#txgridtype-' + i).text();
			//    var txname = $('#txgridname-' + i).text();
			//    if (txType == '' || txname == '') {
			//        $.notify("TaxType Or TaxName cannot be null", "error");
			//        return;
			//    }
			//}

			if (!checkPartCodeMusthaveAtLeastOneTax()) {
				return;
			}
			else if ($('#CustOrderNo').val() == '') {
				$.notify("Cust order no is required..!", "error");
				return;
			} else if (soGrid <= 1) {
				$.notify("SO Grid should at least have one item", "error");
				return;
			}
			else {
				$("form").submit();
			}
			//else if (taxGrid <= 1) {
			//    $.notify("Tax Grid should at least have one item", "error");
			//    return;
			//}


		});

		function checkPartCodeMusthaveAtLeastOneTax() {

			var errorPartCode = [];
			$('.divSOItemListPartCode').each(function (i, data) {
				var partcode = $(data).text();
				var taxes = $("td[data-txPartCode='" + partcode + "']");
				if (!taxes || taxes.length == 0) {
					errorPartCode.push(partcode)
				}
			});
			if (errorPartCode.length > 0) {
				$.notify("No tax available for " + errorPartCode.join(", ") + " part code(s).", "error");
			}
			return errorPartCode.length == 0;
		}

		$(document).on('click', '.AmendButton', function (e) {

			e.preventDefault();
			if (!checkPartCodeMusthaveAtLeastOneTax()) {
				return false;
			}
			else {
				$("form").submit();
			}
		});

		$(document).on('click', '.PartialSave', function (e) {

			$('#TypeOfSave').val("PS");
			e.preventDefault();
			var soGrid = $('#divSaleItemGrid tr td').length;
			var taxGrid = $('#divTaxGrid tr td').length;
			//var txRowCount = $('#divTaxGrid tr').length;
			//for (var i = 1; i <= txRowCount; i++) {
			//    var txType = $('#txgridtype-' + i).text();
			//    var txname = $('#txgridname-' + i).text();
			//    if (txType == '' || txname == '') {
			//        $.notify("TaxType Or TaxName cannot be null", "error");
			//        return;
			//    }
			//}
			if (!checkPartCodeMusthaveAtLeastOneTax()) {
				return false;
			}
			else if (soGrid <= 1) {
				$.notify("SO Grid should at least have one item", "error");
				return;
			} else {
				$("form").submit();
			}



		});

		$(document).on('click', '.UpdateButton', function (e) {

			$('#TypeOfSave').val("NPS");
			e.preventDefault();

			var soGrid = $('#divSaleItemGrid tr td').length;
			var taxGrid = $('#divTaxGrid tr td').length;
			//var txRowCount = $('#divTaxGrid tr').length;
			//for (var i = 1; i <= txRowCount; i++) {
			//    var txType = $('#txgridtype-' + i).text();
			//    var txname = $('#txgridname-' + i).text();
			//    if (txType == '' || txname == '') {
			//        $.notify("TaxType Or TaxName cannot be null", "error");
			//        return;
			//    }
			//}

			if (!checkPartCodeMusthaveAtLeastOneTax()) {
				return false;
			}
			else if (soGrid <= 1) {
				$.notify("SO Grid should at least have one item", "error");
				return;
			}
			else {
				$('#Mode').val("U");
				$("form").submit();
			}
			//else if (taxGrid <= 1) {
			//    $.notify("Tax Grid should at least have one item", "error");
			//    return;
			//}


		});

		$('#SODate,#AmmEffDate').on('keydown', function (e) {
			$('#AccountCode').focus();
			e.preventDefault();
			return false;
		});

		function PartCodeChange(ID) {
			$.when(SetPartCodeItem(ID)).done(function () {
				GetItemPartCode(ID)
			});
			// copyToClipboardForDropdown("#PartCode");
			if ($('#StoreName').prop("selectedIndex") !== 0) {
				StoreChange();
			}
			$('#Qty').val(0);
			$('#AltQty').val(0.00);
		}

		function ItemNameChange(ID) {
			SetPartCodeItem(ID);
			GetItemPartCode(ID);
			if ($('#StoreName').prop("selectedIndex") !== 0) {
				StoreChange();
			}
			$('#Qty').val(0);
			$('#AltQty').val(0.00);

		}

		async function SetPartCodeItem(ID) {
			if (!ID) return;
			else {
				var v = $('#' + ID).val();
				var t = $('#' + ID + ' option:selected').text();

				if (ID == "PartCode") {
					$('#ItemCode').val(v).trigger("change");
				}

				if (ID == "ItemCode") {
					$('#PartCode').val(v).trigger("change");
				}
			}
		}

		async function GetItemPartCode(ID) {
			//
			$.getJSON({
				url: "@Url.Action("GetItemPartCode")",
				data: { Code: $('#' + ID).val() },
				success: function (result, status, xhr) {
					if (result) {
						var obj = JSON.parse(result);
						if (!obj) {
							$('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
						}
						else if (obj.StatusCode == 200 && obj.StatusText == "Success") {
							$('#Unit').val(obj.Result[0].Unit);
							$('#HSNNo').val(obj.Result[0].HSNNo);
							$('#AltUnit').val(obj.Result[0].AltUnit == null ? 'NA' : obj.Result[0].AltUnit);
							!$('#AltUnit').val() ? $('#UnitRate').prop('disabled', true) : $('#UnitRate').prop('disabled', false);
						}
					}
				},
				error: function (result, status, xhr) {
					$.notify(result.responseText, "error");
				},
			});
		}

		function ClearItem() {
			$('#PartCode').prop('selectedIndex', 0).removeClass('is-invalid').change(), $('#HSNNo').val('0'), $('#Qty').val('0'), $('#Rate').val('0'), $('#Unit').val('0'), $('#AltQty').val(0),
				$('#AltUnit').val('NA'), $('#OtherRateCurr').val('0'), $('#UnitRate').val('Unit'), $('#DiscPer').val('0'), $('#DiscRs').val('0.00'), $('#Amount').val('0.00'), $('#TolLimit').val(0),
				$('#Remark').val(''), $('#Description').val(''), $('#StoreName').prop('selectedIndex', 0), $('#StockQty').val('0'), $('#AmendmentNo').val(''), $('#AmendmentDate').val(''),
				$('#AmendmentReason').val(''), $('#Color').val(''), $('#Rejper').val('0'), $('#Excessper').val('0'), $('#ProjQty1').val('0'), $('#ProjQty1').val('0');
		}

		$('#SOType').change(function () {
			SOOrder = true;
			var rowCount = $('#divSaleItemGrid tr td').length;
			if (rowCount > 1) {
				$('#SOConfirmationBox').modal('show');
			} else {
				$('.Schedule').fadeOut();
				ClearItemTax();
				if ($('#SOType').val() == "OPEN") {
					$('#Qty,#AltQty').val('0').prop('disabled', true).attr('readonly', 'readonly');
					$('.Schedule').fadeOut();
				}
				else {
					$('#Qty,#AltQty').val('0').prop('disabled', false).removeAttr('readonly');
					$('.Schedule').fadeIn();
				}
			}

			//$('.Schedule').fadeOut();
			//ClearItemTax();
			//if ($(this).val() == "OPEN") {
			//    //$.getJSON({
			//    //    url: "@Url.Action("ResetGridItems")",
			//    //    success: function(result, status, xhr) {
			//    //        if (result == 200) {
			//    //            $('#Qty').val('0').prop('disabled', true).attr('readonly', 'readonly');
			//    //            ClearItem();
			//    //            var NoData = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
			//    //            $('#divSaleItemGrid').html(NoData);
			//    //        }
			//    //    },
			//    //    error: function(result, status, xhr) {
			//    //    }
			//    //});

			//    $('#Qty,#AltQty').val('0').prop('disabled', true).attr('readonly', 'readonly');
			//}
			//if ($(this).val() == "CLOSE") {
			//    $('#Qty,#AltQty').val('0').prop('disabled', false).removeAttr('readonly');
			//}
		});

		$('#OrderType').change(function () {

			SOOrder = false;

			var rowCount = $('#divSaleItemGrid tr td').length;
			if (rowCount > 1) {
				$('#SOConfirmationBox').modal('show');
			} else {

				$('#OrderType').val() == "Domestic" ? $('#CurrencyID').prop('selectedIndex', 0).change() : $('#CurrencyID').prop('selectedIndex', 2).change();
				ClearItemTax();

				// $(this).val() == "Domestic" ? $('#OtherRateCurr').prop('readonly',true) :  $('#Rate').prop('readonly',true);
				if ($('#OrderType').val() == "Domestic") {
					$('#OtherRateCurr').prop('readonly', true);
					$('#OtherRateCurr').prop('disabled', true);
					$('#Rate').prop('readonly', false);
					$('#Rate').prop('disabled', false);
				} else {
					$('#OtherRateCurr').prop('readonly', false);
					$('#OtherRateCurr').prop('disabled', false);
					$('#Rate').prop('readonly', true);
					$('#Rate').prop('disabled', true);
				}

			}
			//$(this).val() == "Domestic" ? $('#CurrencyID').prop('selectedIndex', 0).change() : $('#CurrencyID').prop('selectedIndex', 2).change();

			//// $(this).val() == "Domestic" ? $('#OtherRateCurr').prop('readonly',true) :  $('#Rate').prop('readonly',true);
			//if ($(this).val() == "Domestic") {
			//    $('#OtherRateCurr').prop('readonly', true);
			//    $('#Rate').prop('readonly', false);
			//} else {
			//    $('#OtherRateCurr').prop('readonly', false);
			//    $('#Rate').prop('readonly', true);
			//}

			FillCurrency();
		});
		function GetCurrencyDetail() {

			$.getJSON({
				url: "@Url.Action("GetCurrencyDetail")",
				data: { Currency: $('#CurrencyID :selected').text() },
				async: false,
				success: function (result, status, xhr) {

					if (result != null && result != "null") {
						var objResult = $.parseJSON(result);
						if (objResult != null) {
							if (objResult.StatusCode == 200 && objResult.StatusText == "Success") {

								if (objResult.Result != null) {
									$('#ExRate').val(parseFloat(objResult.Result[0].Rate));
									if (objResult.Result[0].Default == "Y") {
										$('#Rate').val('0.00').prop('disabled', false).removeAttr('readonly');
										$('#OtherRateCurr').val('0').prop('disabled', true).attr('readonly', 'readonly');
									}
									else {
										$('#Rate').val('0.00').prop('disabled', true).attr('readonly', 'readonly');
										$('#OtherRateCurr').val('0').prop('disabled', false).removeAttr('readonly');
										$('#OtherRateCurr').keyup(function () {
											$('#Rate').val($('#OtherRateCurr').val().trim() != "" ? parseFloat($('#OtherRateCurr').val()) * parseFloat($('#ExRate').val()) : 0);
											CalculateRate();
										});
									}
								}
							}
						}
					}
				},
				error: function (result, status, xhr) {
					console.log(result);
				}
			}).done(function () {
				//ClearItemTax();
			});
		}

		$('#CurrencyID').change(function () {
			GetCurrencyDetail();
		});

		async function ClearItemTax() {
			$.ajax({
				url: "@Url.Action("ResetGridItems")",
				type: "GET",
				success: await function (result, status, xhr) {
					if (result == 200) {
						ClearItem();
						var NoData = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
						$('#divSaleItemGrid').html(NoData);
						$('#ItemNetAmount').val('0.00'), $('#TotalTaxAmt').val('0.00'), $('#lblItemNetAmount').text('0.00'), $('#NetTotal').val('0.00'), $('#TotalRoundOff').prop('selectedIndex', 0), $('#TotalDiscountAmt').val('0');
					}
					$('#ItemNetAmount').val('0.00'), $('#TotalTaxAmt').val('0.00'), $('#lblItemNetAmount').text('0.00'), $('#lblTotalNoOfItems').text('0'), $('#NetTotal').val('0.00'),
						$('#TotalRoundOff').prop('selectedIndex', 0), $('#TotalDiscountAmt').val('0'), $('#TotalAmtAftrDiscount').val('0.00');
				}
			}).done(function (data) {
				//$.ajax({
				//    url: '/Tax/ClearTax',
				//    type: "GET",
				//    success: function (data, status, xhr) {
				//        if (data.trim() != "") {
				var NoDataAdded = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
				$('#divTaxGrid').html(NoDataAdded);
				$('#TxPartCode').prop('selectedIndex', 0).prop('disabled', false).removeClass('is-invalid').change(), $('#TxItemCode').prop('selectedIndex', 0).prop('disabled', false).removeClass('is-invalid'),
					$('#TxTaxType').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxAccountCode').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxPercentg').val(0).removeAttr('readonly').removeClass('is-invalid'),
					$('#TxAdInTxable').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxRoundOff').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxRefundable').prop('selectedIndex', 0).removeClass('is-invalid'),
					$('#TxOnExp').val('0.00'), $('#TxRemark').val(''), $('#TxAmount').val("0.00").removeClass('is-invalid');
				//        }
				//    }
				//})
			}).fail(function (data) {
				console.log(data);
			}).always(function (data) {
				console.log(data);
			});
		}

		function addDays(date, days) {
			var NewDate = new Date(date);
			NewDate.setDate(NewDate.getDate() + days);
			return NewDate.toISOString().substring(0, 10);
		}

		$('#Qty').change(function () {

			var ItemCode = parseInt($('#ItemCode').val());
			var UnitQty = parseInt($(this).val());
			var ALtQty = parseInt($('#AltQty').val());
			$.ajax({
				type: "POST",
				data: { "ItemCode": ItemCode, "UnitQty": UnitQty, "ALtQty": ALtQty },
				url: "@Url.Action("GetAltQty")",
				dataType: "json",
				success: function (result, status, error) {
					console.log(result);
					if (result != null) {
						
						if ($('#PartCode').val() == 0 || $('#ItemCode').val() == 0) {
							$.notify('Please select PartCode and ItemName.', "error");
							$('#PartCode').css("border", "1px solid red");
							$('#ItemName').css("border", "1px solid red");
							$('#PartCode').on("change", function () {
								$(this).css("border", "1.5px solid #4CAF50");
							});

							$('#ItemName').on("change", function () {
								$(this).css("border", "1.5px solid #4CAF50");
							});

						}
						else {
							var obj = $.parseJSON(result);
							var altQtyValue = parseFloat(obj.Result[0].AltUnitValue);
							$('#AltQty').val(altQtyValue);
						}
					}
				}
			});
		});

		function ScheduleQty() {
			var Sum = 0;
			$(".Qty").each(function () {
				Sum += parseFloat($(this).text());
			});
			return Sum;
		}

		$('#DQty').on('keyup keypress blur change', function (e) {
			const TQty = parseInt($('#DTQty').val());
			const DQty = parseInt($('#DQty').val());

			const SQty = ScheduleQty();

			const Total = TQty - (DQty + SQty);

			console.log(Total);
			if (Total == 0 && DQty + SQty == TQty) {
				$('.addSchedule').prop('disabled', false).removeAttr('readonly');
			}
			else if (Total >= 0) {
				$('.addSchedule').prop('disabled', false).removeAttr('readonly');
			}
			else if (Total <= 0) {
				$('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
			}
		});

		$('.addSchedule').click(function (e) {
			e.preventDefault();
			const _DDays = parseInt($('#DDays').val().trim());
			const _DDate = new Date($('#DDate').val().trim());
			const date = addDays(_DDate, _DDays);

			const TQty = !$('#DTQty').val() ? 0 : parseInt($('#DTQty').val());
			const CQty = !$('#DQty').val() ? 0 : parseInt($('#DQty').val());

			if (CQty <= 0) {
				return;
			}

			const Sum = ScheduleQty();

			const Total = TQty - (CQty + Sum);

			if (Total == 0) {
				$('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
			}
			else if (Total >= 0) {
				$('.addSchedule').prop('disabled', false).removeAttr('readonly');
			}
			else if (Total <= 0) {
				$('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
			}

			var Data = {
				"DPartCode": $('#SOItemCode').val(),
				"ItemName": $('#SOItemCode option:selected').text(),
				"Days": _DDays,
				"Date": date,
				"Qty": parseInt($('#DQty').val().trim()),
				"AltQty": parseInt($('#DAltQty').val().trim()),
				"Remarks": $('#DRemark').val(),
			}

			$.ajax({
				type: "POST",
				url: '@Url.Action("AddSchedule")',
				data: Data,
				success: function (resp, status, error) {
					if (resp) {
						$('#SOGrid').html(resp);
						$('#DDate').val(date);

						$('#DQty').val(Total <= 0 ? 0 : Total);
						$('#DQty').change();
					}
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		});

		$('.addMultiBuyers').click(function (e) {
			e.preventDefault();

			if ($('#MBillToAccountCode').val() == '') {
				if ($('#MShiptoAccountCode').val() == '') {
					AddErrorCls('MBillToAccountCode');
					return;
				}
			}
			else {
				RemoveErrorCls('MBillToAccountCode');
			}
			if ($('#MShiptoAccountCode').val() == '') {
				if ($('#MBillToAccountCode').val() == '') {
					AddErrorCls('MShiptoAccountCode');
					return;
				}
			}
			else {
				RemoveErrorCls('MShiptoAccountCode');
			}
			var Data = {
				"BillToAccountCode": $('#MBillToAccountCode').val(),
				"BillToAccountName": $('#MBillToAccountCode option:selected').text() == "-Select-" ? "" : $('#MBillToAccountCode option:selected').text(),
				"BuyerAddress": $('#MBuyerAddress').val(),
				"ShiptoAccountCode": $('#MShiptoAccountCode').val(),
				"ShiptoAccountName": $('#MShiptoAccountCode option:selected').text() == "-Select-" ? "" : $('#MShiptoAccountCode option:selected').text(),
				"ShipToAddress": $('#MShipToAddress').val()
			}

			$.ajax({
				type: "POST",
				url: '@Url.Action("AddMultiBuyers")',
				data: Data,
				success: function (resp, status, error) {
					console.log("suceess Multi");
					if (resp) {
						$('#divMultiBuyerGrid').empty();
						$('#divMultiBuyerGrid').html(resp);
					}
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		});
		function ShowHideFields(){
			if ($('#SH').is(':checked') == true) {
				$('.AF').fadeIn();
			}
			else {
				$('.AF :input').val('');
				$('.AF').fadeOut();
			}
		}
		$('#SH').change(function () {
			ShowHideFields();
		});

		$('#DDays').change(function () {

			var newDate = addDays(new Date($('#DDate').val()), parseInt($(this).val()) + 1);
			var newDDate = formatDATEDate(newDate);
			$('#DDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", newDDate);
			$('#DDate').datepicker("option", "minDate", 'now');
		});
		$('#DDate').change(function () {
			var tDate = parseDDate($(this).val());
			var today = new Date();
			var timeDifference = tDate.getTime() - today.getTime();
			var daysDifference = Math.ceil(timeDifference / (1000 * 3600 * 24));
			$('#DDays').val(daysDifference);
		});
		function parseDDate(dateString) {
			var parts = dateString.split('/');
			var day = parseInt(parts[0]);
			var month = parseInt(parts[1]) - 1;
			var year = parseInt(parts[2]);
			return new Date(year, month, day);
		}
		function formatDATEDate(inputDate) {
			var parts = inputDate.split('-');
			var year = parts[0];
			var month = parts[1];
			var day = parts[2];
			return day + '/' + month + '/' + year;
		}

		$('#PN1').change(function () {
			$.ajax({
				type: "POST",
				url: "@Url.Action("GetPartyList")",
				data: { Check: $('#PN1').is(':checked') == true ? 'T' : 'F' },
				dataType: "json",
				success: function (data, status, error) {
					$('#AccountCode').empty();
					$('#AccountCode').append('<option>-Select-</option>');
					$.each(data, function (key, val) {
						$('#AccountCode').append('<option value="' + val.value + '">' + val.text + '</option>');
						$('#Address').val(''), $('#DeliveryAddress').val('');
					});
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		});

		$('#PN1BillTo').change(function () {
			$.ajax({
				type: "POST",
				url: "@Url.Action("GetPartyList")",
				data: { Check: $('#PN1BillTo').is(':checked') == true ? 'T' : 'F' },
				dataType: "json",
				success: function (data, status, error) {
					$('#MBillToAccountCode').empty();
					$('#MBillToAccountCode').append('<option>-Select-</option>');
					$.each(data, function (key, val) {
						$('#MBillToAccountCode').append('<option value="' + val.value + '">' + val.text + '</option>');
						$('#MBuyerAddress').val('');
					});
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		});

		$('#PN1ShipTo').change(function () {
			$.ajax({
				type: "POST",
				url: "@Url.Action("GetPartyList")",
				data: { Check: $('#PN1ShipTo').is(':checked') == true ? 'T' : 'F' },
				dataType: "json",
				success: function (data, status, error) {
					$('#MShiptoAccountCode').empty();
					$('#MShiptoAccountCode').append('<option>-Select-</option>');
					$.each(data, function (key, val) {
						$('#MShiptoAccountCode').append('<option value="' + val.value + '">' + val.text + '</option>');
						$('#MShipToAddress').val('');
					});
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		});

		$('#AccountCode').change(function () {
			ClearTxGrid();
			if ($('#AccountCode').prop('selectedIndex') != 0) {
				$.getJSON({
					url: "@Url.Action("GetAddress")",
					data: { Code: $('#AccountCode').val() },
					success: function (result, status, xhr) {
						$('#Address').val(result.result);
						if ($('#Address').val()) {
							$('#DeliveryAddress').val($('#Address').val());
						}
					}
				});
			}
			else $('#Address').val(''), $('#DeliveryAddress').val('');
		});


		$('#MBillToAccountCode').change(function () {
			if ($('#MBillToAccountCode').prop('selectedIndex') != 0) {
				$.getJSON({
					url: "@Url.Action("GetAddress")",
					data: { Code: $('#MBillToAccountCode').val() },
					success: function (result, status, xhr) {
						$('#MBuyerAddress').val(result.result);
					}
				});
			}
			else $('#MBuyerAddress').val('');
		});

		$('#MShiptoAccountCode').change(function () {
			if ($('#MShiptoAccountCode').prop('selectedIndex') != 0) {
				$.getJSON({
					url: "@Url.Action("GetAddress")",
					data: { Code: $('#MShiptoAccountCode').val() },
					success: function (result, status, xhr) {
						$('#MShipToAddress').val(result.result);
					}
				});
			}
			else $('#MShipToAddress').val('');
		});

		$('#ConsigneeAccountCode').change(function () {
			if ($('#ConsigneeAccountCode').prop('selectedIndex') != 0) {
				$.getJSON({
					url: "@Url.Action("GetAddress")",
					data: { Code: $('#ConsigneeAccountCode').val() },
					success: function (result, status, xhr) {
						$('#ConsigneeAddress').val(result.result);
					}
				});
			}
			else $('#ConsigneeAddress').val('');
		});

		$('#PN2').change(function () {
			$.ajax({
				type: "POST",
				url: "@Url.Action("GetPartyList")",
				data: { Check: $('#PN2').is(':checked') == true ? 'T' : 'F' },
				dataType: "json",
				success: function (data, status, error) {
					$('#ConsigneeAccountCode').empty();
					$('#ConsigneeAccountCode').append('<option>-Select-</option>');
					$.each(data, function (key, val) {
						$('#ConsigneeAccountCode').append('<option value="' + val.value + '">' + val.text + '</option>');
						$('#ConsigneeAddress').val('');
					});
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		});

		$('#IN1').change(function () {
			$('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
			
			$.ajax({
				type: "POST",
				url: "@Url.Action("GetItemPartList")",
				data: { TF: $('#IN1').is(':checked') == true ? 'T' : 'F' },
				dataType: "json",
				async:false,
				success: function (data, status, error) {
					 
					var ObjPartCode = $.parseJSON(data.partCode);
					var ObjItemCode = $.parseJSON(data.itemName);
					
					$('#PartCode').empty();
					$('#PartCode').append('<option>-Select-</option>');
					$.each(ObjPartCode, function (key, val) {
						$('#PartCode').append('<option value="' + val.Text + '">' + val.Value + '</option>');
					});

					$('#ItemCode').empty();
					$('#ItemCode').append('<option>-Select-</option>');
					$.each(ObjItemCode, function (key, val) {
						$('#ItemCode').append('<option value="' + val.Text + '">' + val.Value + '</option>');
					});
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		});

		$('.ItemBtn').click(function () 
		{
			 
			if ($('#PartCode').prop('selectedIndex') == 0)
			{
				AddErrorCls('PartCode');
				$.notify('PartCode Is Required.', "error");
				return;
			}
			else 
			{
				RemoveErrorCls('PartCode');
			}
			if ($('#ItemName').prop('selectedIndex') == 0) 
			{
				AddErrorCls('ItemName');
				$.notify('ItemName Is Required.', "error");
				return;
			}
			else 
			{
				RemoveErrorCls('ItemName');
			}
			if ($('#SOType').val() == "CLOSE") 
			{

				if (isNaN(parseFloat($('#Qty').val())) || parseFloat($('#Qty').val()) == 0 || parseFloat($('#Qty').val()) < 0) 
				{
					AddErrorCls('Qty');
					$.notify('Qty cannot be 0.', "error");
					return;
				} else {
					RemoveErrorCls('Qty');
				}
			}

			if (isNaN(parseFloat($('#Rate').val())) || parseFloat($('#Rate').val()) == 0 || parseFloat($('#Rate').val()) < -1) 
			{
				AddErrorCls('Rate');
				$.notify('Rate cannot be 0.', "error");
				return;
			}
			else 
			{
				RemoveErrorCls('Rate');
			}

			if (isNaN(parseFloat($('#OtherRateCurr').val())) || parseFloat($('#OtherRateCurr').val()) == 0 || parseFloat($('#OtherRateCurr').val()) < -1) 
			{
				AddErrorCls('OtherRateCurr');
				$.notify('OtherRate cannot be 0.', "error");
				return;
			}
			else 
			{
				RemoveErrorCls('OtherRateCurr');
			}

			if (parseInt($('#DiscPer').val()) < 0 || parseInt($('#DiscPer').val()) > 100) 
			{
				AddErrorCls('DiscPer');
				$.notify('DiscPer cannot be 0.', "error");
				return;
			}
			else 
			{
				RemoveErrorCls('DiscPer');
			}

			if ('@Model.Mode' == 'SOA' && @Model.ID > 0)
			{
				if (!$('#AmendmentReason').val()) {
					AddErrorCls('AmendmentReason');
					return;
				}
				else {
					RemoveErrorCls('AmendmentReason');
				}
			}

			if ($('OrderType').val() == "Export") 
			{
				if (parseInt($('#OtherRateCurr').val()) == "" || parseInt($('#OtherRateCurr').val()) == 0 || parseInt(('#OtherRateCurr').val()) < 0) {
					AddErrorCls('OtherRateCurr');
					$.notify('OtherRateCurr cannot be 0.', "error");
					return;
				}
				else {
					RemoveErrorCls('OtherRateCurr');
				}
			}


			// disable button
			$(this).prop("disabled", true);
			// add spinner to button
			$(this).html('Calculating... <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');

			var ItemData = 
			{
				"PartCode": $('#PartCode').val(),
				"PartText": $('#PartCode option:selected').text(),
				"ItemCode": $('#ItemCode').val(),
				"ItemText": $('#ItemCode option:selected').text(),
				"HSNNo": $('#HSNNo').val(),
				"Qty": $('#Qty').val(),
				"Unit": $('#Unit').val(),
				"AltQty": $('#AltQty').val(),
				"AltUnit": $('#AltUnit').val(),
				"Rate": $('#Rate').val(),
				"OtherRateCurr": $('#OtherRateCurr').val(),
				"StoreName": $('#StoreName').val() == '' ? null : JSON.stringify(parseInt($('#StoreName').val())),
				"StockQty": $('#StockQty').val(),
				"UnitRate": $('#UnitRate').val(),
				"DiscPer": $('#DiscPer').val(),
				"DiscRs": $('#DiscRs').val(),
				"Amount": $('#Amount').val(),
				"TolLimit": $('#TolLimit').val(),
				"Description": $('#Description').val(),
				"Remark": $('#Remark').val(),
				"AmendmentNo": $('#AmmNo').val(),
				"AmendmentDate": $('#AmmEffDate').val(),
				"AmendmentReason": $('#AmendmentReason').val(),
				"MRP": $('#MRP').val(),
				"PoNo": $('#PoNo').val(),
				"PoDate": $('#PoDate').val(),
				"Color": $('#Color').val(),
				"Rejper": $('#Rejper').val(),
				"Excessper": $('#Excessper').val(),
				"ProjQty1": $('#ProjQty1').val(),
				"ProjQty2": $('#ProjQty2').val(),
			}
			//alert('before itemgrid');
			 
			console.log(ItemData);
			$.ajax({
				url: '@Url.Action("ItemGrid")',
				type: "POST",
				data: ItemData,
				beforeSend: function (xhr) {
					//xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
					console.log(1);
				},
				success: function (data, status, xhr) {
					 
					console.log(2);
					if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
						$.notify('Duplicate Item Not Allowed.', "info");
						$('.ItemBtn').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
					}
					//else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
					//    $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
					//}
					else {
						if (!DelSeqNo && DelSeqNo != 0) {
							$('#divSaleItemGrid ."' + DelSeqNo + "'").remove();
						}
						$('#divSaleItemGrid').html(data);
						$.notify('Item Added To Grid.', "success");
						ClearItem();
					}

					$('#TotalRoundOff').prop('selectedIndex', 0);
					var INA = parseFloat($('#ItemNetAmount').val());
					var rowCount = $('#divSaleItemGrid tr').length;
					var taxRowCount = $('#divTaxGrid tr').length;
					var sum = 0.00;
					for (var i = 1; i <= rowCount; i++) {

						sum += parseFloat($('#GridAmount-' + i).text() == '.00' || $('#GridAmount-' + i).text() == '' ? 0 : $('#GridAmount-' + i).text());
					}

					$('#ItemNetAmount').val(sum);
					if (rowCount >= 1) {
						$('#lblTotalNoOfItems').text(rowCount);
					} else {
						$('#lblTotalNoOfItems').text(0);
					}
					var txSum = 0.00;
					if ($('#divTaxGrid tr td').length > 1) {

						for (var i = 1; i <= taxRowCount; i++) {
							txSum += parseFloat($('#txGridAmount-' + i).text() == '.00' ? 0 : $('#txGridAmount-' + i).text());
						}
					}
					$('#lblItemNetAmount').text(sum.toFixed(2));
					var txTotal = sum + txSum;
					$('#NetTotal').val(txTotal.toFixed(2));
					$('#TotalDiscountPercentage').val(0);
					$('#TotalAmtAftrDiscount').val(0);
					// $('#PartCode').focus();
				},
				error: function (result, status, xhr) {
					$.notify(result.responseText, "error");
				},
				failure: function (result, status, xhr) {
					alert(response.responseText);
				},
				complete: function () {

					console.log(5);
					if ($('#SOType').val() == 'CLOSE') {
						$('.Schedule').fadeIn();
					} else {
						$('.Schedule').fadeOut();
					}
					$('.ItemBtn').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
				}
			}).done(function () {
				console.log(3);
				GetTaxPartItem();
			}).fail(function () {
				alert("error");;
			}).always(function () {
				console.log(4);
			});
		});

		async function QuotChange(ID) {
			$.getJSON({
				url: "@Url.Action("GetQuotData")",
				data: { Code: $('#' + ID).val() },
				success: function (result, status, xhr) {
					if (result) {
						var obj = JSON.parse(result);
						if (!obj) {
							$('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
						}
						else if (obj.StatusCode == 200 && obj.StatusText == "Success") {
							$('#Unit').val(obj.Result[0].Unit);
							$('#HSNNo').val(obj.Result[0].HSNNo);
							$('#AltUnit').val(obj.Result[0].AltUnit == null ? 'NA' : obj.Result[0].AltUnit);
						}
					}
				},
				error: function (result, status, xhr) {
					$.notify(result.responseText, "error");
				},
			});
		}

		function CalculateRate() {

			var Amount = 0;
			const OC = $('#SOType').val();
			const UnitRate = $('#UnitRate').val();
			const Rate = $('#Rate').val() === "0" || $('#Rate').val() === "" ? 0 : parseFloat($('#Rate').val());
			const DP = $('#DiscPer') === "0" || $('#DiscPer').val() === "" ? 0 : parseFloat($('#DiscPer').val());

			if (UnitRate == "Unit") {
				const Qty = $('#Qty').val() == "0" || $('#Qty').val() == "" ? 0 : parseFloat($('#Qty').val());
				Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
			}
			if (UnitRate == "AltUnit") {
				const Qty = $('#AltQty').val() == "0" || $('#AltQty').val() == "" ? 0 : parseInt($('#AltQty').val());
				Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
			}

			if (DP !== 0) {
				const DA = ((Amount * DP) / 100);
				$('#DiscRs').val(DA);
				Amount = Amount - DA;
			}
			if ($('#OtherRateCurr').val() == ".") {
				$('#Amount').val("0.00");
			} else {
				$('#Amount').val(Amount.toFixed(2));
			}
			// $('#Amount').val(Amount.toFixed(2));

		}

		async function CalculateRateA() {

			var Amount = 0;
			// $('#DiscPer').val(0);
			const OC = $('#SOType').val();
			const UnitRate = $('#UnitRate').val();
			const Rate = $('#Rate').val() == "0" || $('#Rate').val() == "" ? 0 : parseFloat($('#Rate').val());
			const DR = $('#DiscRs') == "0" || $('#DiscRs').val() == "" ? 0 : parseFloat($('#DiscRs').val());

			if (UnitRate == "Unit") {
				const Qty = $('#Qty').val() == "0" || $('#Qty').val() == "" ? 0 : parseFloat($('#Qty').val());
				Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
			}
			if (UnitRate == "AltUnit") {
				const Qty = $('#AltQty').val() == "0" || $('#AltQty').val() == "" ? 0 : parseFloat($('#AltQty').val());
				Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
			}

			if (DR !== 0) {
				Amount = Amount - DR <= 0 ? 0 : Amount - DR;
			}

			$('#Amount').val(Amount.toFixed(2));
		}

		let DelSeqNo = 0;
		let Dat = "";

		async function EditItemRow(SeqNo) {
			 
			var PartCode = $('#PartCode').val();
			$.ajax({
				url: '@Url.Action("EditItemRow")',
				type: "POST",
				data: { PartCode: PartCode, SeqNo: SeqNo },
				success: function (data, status, xhr) {
					 
					if (data == "Duplicate" && (xhr.statusCode == 207 || xhr.responseText == "Duplicate")) {
						$.notify("If Same Tax Exists, Item Cannot Be Edited...!", "warning");
					}
					else {
						
						var obj = $.parseJSON(data);
						// alert('obj'+ JSON.stringify(obj));

						if (obj != null && obj.length == 1) {
							// alert("nusrat111")
							   $('#IN1').prop("checked", true);
							   $('#IN1').trigger("change");
							   // var partCodeListBox = $('#PartCode');
							   //  partCodeListBox.append($('<option>', {
							   //      value: obj[0].PartCode,
							   //      text: obj[0].PartCode // Display text for the option
							   //  }));
							   // $('#IN1').change();
							    
							// $('#PartCode').val(obj[0].PartCode).trigger("change");
							// $('#ItemCode').val(obj[0].ItemCode).trigger("change");
							$('#PartCode').val(obj[0].PartCode).trigger('select2:select');
							$('#ItemCode').val(obj[0].ItemCode).trigger('select2:select');
							$('#HSNNo').val(obj[0].HSNNo);
							$('#Qty').val(obj[0].Qty);
							$('#Unit').val(obj[0].Unit);
							$('#AltQty').val(obj[0].AltQty);
							$('#AltUnit').val(obj[0].AltUnit);
							$('#Rate').val(obj[0].Rate);
							$('#UnitRate').val(obj[0].UnitRate);
							$('#ItemCode').val(obj[0].ItemCode).change();
							$('#DiscPer').val(obj[0].DiscPer);
							$('#DiscRs').val(obj[0].DiscRs);
							$('#Amount').val(obj[0].Amount);
							$('#TolLimit').val(obj[0].TolLimit);
							$('#Description').val(obj[0].Description);
							$('#Remark').val(obj[0].Remark);
							$('#StoreName').val(obj[0].StoreName);
							$('#StockQty').val(obj[0].StockQty);
							$('#AmendmentNo').val(obj[0].AmendmentNo);
							$('#AmendmentDate').val(obj[0].AmendmentDate);
							$('#AmendmentReason').val(obj[0].AmendmentReason);
							$('#MRP').val(obj[0].MRP);
							$('#PoNo').val(obj[0].PoNo);
							$('#PoDate').val(obj[0].PoDate);
							$('#Color').val(obj[0].Color);
							$('#Rejper').val(obj[0].Rejper);
							$('#Excessper').val(obj[0].Excessper);
							$('#ProjQty1').val(obj[0].ProjQty1);
							$('#ProjQty2').val(obj[0].ProjQty2);
							$('#OtherRateCurr').val(obj[0].OtherRateCurr);
							DelSeqNo = SeqNo;
							$('#divSaleItemGrid .' + DelSeqNo).remove();
							if ($('#divSaleItemGrid').children().length == 0) {
								var NoData = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
								$('#divSaleItemGrid').html(NoData);
							}
						}
					}
				},
				error: function (response) {
					$.notify(response.responseText, "error");
				},
				failure: function (response) {
					$.notify(response.responseText, "error");
				}
			});
		}
		$('#MShiptoAccountCode').on('select2:open', function () {
			// Event handler code here
			// This code will execute when the select2 dropdown opens
			$('.select2-search__field').focus();
			// You can perform any additional actions or trigger other events here
		});

		async function DeleteItemRow(SeqNo) {
			$.ajax({
				url: '@Url.Action("DeleteItemRow")',
				type: "POST",
				data: { "SeqNo": SeqNo },
				success: function (data, status, xhr) {
					if (data == "Duplicate" && (xhr.statusCode == 207 || xhr.responseText == "Duplicate")) {
						$.notify("If Same Tax Exists, Item Cannot Be Deleted...!", "warning");
					}
					else {
						$('#divSaleItemGrid').html(data);
						if ($('#divSaleItemGrid').children('tr').length == 0) {
							$('.Schedule').fadeOut();
							var NoData = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
							$('#lblItemNetAmount').text("0.00");
							$('#divSaleItemGrid').html(NoData);
						}
						GetTaxPartItem();
						$('#TotalRoundOff').prop('selectedIndex', 0);
						var INA = parseFloat($('#ItemNetAmount').val());
						var rowCount = $('#divSaleItemGrid tr').length;
						var taxRowCount = $('#divTaxGrid tr').length;
						var sum = 0.00;
						for (var i = 1; i <= rowCount; i++) {

							sum += parseFloat($('#GridAmount-' + i).text() == '.00' ? 0 : $('#GridAmount-' + i).text());
						}
						$('#ItemNetAmount').val(sum);
						var txSum = 0.00;
						if ($('#divTaxGrid tr td').length > 1) {
							for (var i = 1; i <= taxRowCount; i++) {
								txSum += parseFloat($('#txGridAmount-' + i).text() == '.00' ? 0 : $('#txGridAmount-' + i).text());
							}
						}
						$('#lblItemNetAmount').text(sum.toFixed(2));
						var txTotal = sum + txSum;
						$('#NetTotal').val(txTotal.toFixed(2));
						$('#TotalDiscountPercentage').val(0);
						$('#TotalAmtAftrDiscount').val(0);
						$.notify('Item Deleted From Grid.', "info");
					}
				},
				error: function (response, status, xhr) {
					$.notify(response.responseText, "error");
				},
				failure: function (response, status, xhr) {
					$.notify(response.responseText, "error");
				}
			});
		}

		async function DeleteDeliveryRow(SRNo, DPC) {
			$.ajax({
				url: '@Url.Action("DeleteDeliveryRow")',
				type: "POST",
				data: { "SRNo": SRNo, "DPC": DPC },
				success: function (data, status, xhr) {

					$('#SOGrid').html(data);
					if ($('#SOGrid tbody').children().length == 1) {
						var NoData = '<tr class="text-center"><td colspan="6" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
						$('#SOGrid tbody').html(NoData);
					}

					const S = ScheduleQty();
					const T = parseInt($('#DTQty').val());

					T != S ? $('.addSchedule').prop('disabled', false).removeAttr('readonly') : $('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
				},
				error: function (response, status, xhr) {
					$.notify(response.responseText, "error");
				},
				failure: function (response, status, xhr) {
					$.notify(response.responseText, "error");
				}
			});
		}

		async function DeleteBillToShipToRow(SeqNo) {
			$.ajax({
				url: '@Url.Action("DeleteBillToShipToRow")',
				type: "POST",
				data: { "SeqNo": SeqNo },
				success: function (data, status, xhr) {

					$('#divMultiBuyerGrid').html(data);
					if ($('#divMultiBuyerGrid tbody').children().length < 1) {
						var NoData = '<tr class="text-center"><td colspan="6" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
						$('#divMultiBuyerGrid tbody').html(NoData);
					}
				},
				error: function (response, status, xhr) {
					$.notify(response.responseText, "error");
				},
				failure: function (response, status, xhr) {
					$.notify(response.responseText, "error");
				}
			});
		}

		async function GetTaxPartItem() {
			 
			$.ajax({
				type: "GET",
				//url: "@Url.Action("GetTaxPartItem")",
				//processData: false,
				//dataType: "json",
				url: '@Url.Action("GetTaxPartItem", "Tax")',
				data: { SessionName: 'ItemList' },
				dataType: "json",
				success: function (data, status, error) {
					
					$('#TxPartCode').empty();
					$('#TxPartCode').append('<option>-Select-</option>');
					$.each(data.partCode, function (key, val) {
						$('#TxPartCode').append('<option value="' + val.value + '">' + val.text + '</option>');
					});

					$("[id='TxItemCode']").empty();
					$("[id='TxItemCode']").append('<option>-Select-</option>');
					$.each(data.itemCode, function (key, val) {
						$("[id='TxItemCode']").append('<option value="' + val.value + '">' + val.text + '</option>');
					});

					$("[id='SOItemCode']*").empty();
					$("[id='SOItemCode']*").append('<option>-Select-</option>');
					$.each(data.itemCode, function (key, val) {
						$("[id='SOItemCode']*").append('<option value="' + val.value + '">' + val.text + '</option>');
					});
				},
				error: function (req, status, error) {
					alert(error);
				}
			});
		}

		$('#Rate').keyup(function () {
			$('#OtherRateCurr').val($(this).val());
		});

		$('.Schedule').click(function () {

			$('.modal-header').addClass('bg-graident bg-warning');
			$('.modal-title').text('DELIVERY SCHEDULE');
			$('#DTQty').val();
			//$('#DDate').val(new Date().toISOString().substring(0, 10));
			$('#DDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
			$('#PopupModel').modal("show");
		});

		function RefreshSchedule(ID) {
			if (!ID) $('#SOItemCode').prop('selectedIndex', 0).change();
			else {
				_PCode = parseInt($('#' + ID).val());
				$.ajax({
					type: "POST",
					url: "@Url.Action("RefreshSchedule")",
					data: { PCode: _PCode, Typ: "SchVal" },
					success: function (data, status, error) {
						$('#DTQty').val(data.schVal.Qty);
						$('#DQty').val();
						$('#DAltQty').val(data.schVal.AltQty);
						$('#DRemark').val(data.schVal.Remark);
					},
					error: function (req, status, error) {
						alert(error);
					}
				}).done(function () {
					$.ajax({
						type: "POST",
						url: "@Url.Action("RefreshSchedule")",
						data: { PCode: _PCode },
						success: function (data, status, error) {
							$('#SOGrid').html(data);
						},
						error: function (req, status, error) {
							alert(error);
						}
					});
				});
			}
		}

		function new1() {
			sessionStorage.setItem();
		}

	</script>
	<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
	<script src="https://cdn.jsdelivr.net/gh/linways/table-to-excel@v1.0.4/dist/tableToExcel.js"></script>


	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.2/xlsx.full.min.js"></script>
	@*<script src="~/Scripts/table2excel.js"></script>*@
	<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>


}