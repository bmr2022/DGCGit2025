@model eTactWeb.DOM.Models.SaleOrderModel

@{
    ViewData["Title"] = "Sale Order Amendment Form";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}

<div class="card bg-gradient mb-3 border-light shadow-lg">
    <partial name="_SADelivery" />
    <form asp-action="SaveForm" autocomplete="off" class="form-horizontal">
        <input type="hidden" asp-for="ExRate" />
        <input type="hidden" asp-for="Mode" />
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                <strong>@ViewData["Title"]</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    <a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">
                        <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                        Dashboard
                    </a>
                </span>
            </h5>
        </div>
        <div class="card-body bg-light pt-0">
            <div asp-validation-summary="All" class="text-danger pt-1"></div>
            <div class="accordion shadow-lg">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_RParameter">
                        <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_RParameter" aria-expanded="true" aria-controls="B_RParameter">
                            <i class="fa-brands fa-wpforms fa-lg fa-fw pr35"></i>
                            Required Parameter
                        </button>
                    </h2>
                    <div id="B_RParameter" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_RParameter">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3">
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryID" class="form-label">Entry ID</label>
                                    <input asp-for="EntryID" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="YearCode" class="form-label">Year</label>
                                    <input asp-for="YearCode" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryDate" class="form-label">Entry Date</label>
                                    <input asp-for="EntryDate" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryTime" class="form-label">Time</label>
                                    <input asp-for="EntryTime" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Branch" class="form-label">Branch</label>
                                    <select class="form-select" asp-for="Branch" asp-items="@(new SelectList(Model.BranchList,"Value","Text"))" readonly disabled></select>
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="AccountCode" class="form-label">Party Name</label>
                                    <div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
                                        <input asp-for="PN1" class="form-check-input" type="checkbox" role="switch" readonly disabled />Show All
                                    </div>
                                    <select class="form-select" asp-for="AccountCode" asp-items="@(new SelectList(Model.AccountList,"Value","Text"))" readonly disabled>
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CustOrderNo" class="form-label">Cust Order No</label>
                                    <input asp-for="CustOrderNo" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SONo" class="form-label">SO No</label>
                                    <input asp-for="SONo" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SOFor" class="form-label">SO For</label>
                                    <select class="form-select" asp-for="SOFor" asp-items="@(new SelectList(Model.SOForList,"Value","Text"))" readonly disabled></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SOType" class="form-label">SO Type</label>
                                    <select class="form-select" asp-for="SOType" asp-items="@(new SelectList(Model.SOTypeList,"Value","Text"))" readonly disabled></select>
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="Address" class="form-label">Address</label>
                                    <input asp-for="Address" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="DeliveryAddress" class="form-label">Delivery Address</label>
                                    <input asp-for="DeliveryAddress" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CurrencyID" class="form-label">Currency</label>
                                    <select class="form-select" asp-for="CurrencyID" asp-items="@(new SelectList(Model.CurrencyList,"Value","Text"))" readonly disabled></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="OrderType" class="form-label">Order Type</label>
                                    <select class="form-select" asp-for="OrderType" asp-items="Model.OrderTypeList" readonly disabled></select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SODate" class="form-label">SO Date</label>
                                    <input asp-for="SODate" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="WEF" class="form-label">WEF</label>
                                    <input asp-for="WEF" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SOCloseDate" class="form-label">SO Close Date</label>
                                    <input asp-for="SOCloseDate" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="QuotNo" class="form-label">Quot No</label>
                                    <select class="form-select" asp-for="QuotNo" asp-items="@(new SelectList(Model.QuotList,"Value","Text"))" onchange="QuotChange(this.id);" readonly disabled>
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="QuotYear" class="form-label">Quotation Year</label>
                                    <select class="form-select" asp-for="QuotYear" asp-items="@(new SelectList(Model.QuotYearList,"Value","Text"))" readonly disabled>
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label class="form-label">Quote Date</label>
                                    <input asp-for="QDate" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AmmNo" class="form-label">Amm No</label>
                                    <input asp-for="AmmNo" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AmmEffDate" class="form-label">Amm Eff Date</label>
                                    <input asp-for="AmmEffDate" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AmmEffDate" class="form-label">Amendment Date</label>
                                    <input asp-for="AmmEffDate" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SOConfirmDate" class="form-label">SO Confirm Date</label>
                                    <input asp-for="SOConfirmDate" class="form-control" readonly disabled />
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="ConsigneeAccountCode" class="form-label">Consignee</label>
                                    <div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
                                        <input asp-for="PN2" class="form-check-input" type="checkbox" role="switch" readonly disabled />Show All
                                    </div>
                                    <select class="form-select" asp-for="ConsigneeAccountCode" data-val="false" asp-items="@(new SelectList(Model.AccountList,"Value","Text"))" readonly disabled>
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="ConsigneeAddress" class="form-label">Consignee Address</label>
                                    <input asp-for="ConsigneeAddress" class="form-control" readonly disabled />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_SAGrid">
                        <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Item Detail Grid</strong>
                        </button>
                    </h2>
                    <div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                        <div class="accordion-body">
        @*                     <div class="row g-2 gx-3">
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">

         *@                           
                                <div class="row g-2 gx-3" id="_ItemGrid">
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="PartCode" class="form-label">Part Code</label>
                                    <select class="form-select" asp-for="PartCode" asp-items="@(new SelectList(Model.PartCodeList,"Text","Value"))" onchange="PartCodeChange(this.id);">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="ItemCode" class="form-label">Item Name</label>
                                    <div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
                                        <input asp-for="IN1" class="form-check-input" type="checkbox" role="switch" />Show All
                                    </div>
                                    <select class="form-select" asp-for="ItemCode" asp-items="@(new SelectList(Model.ItemNameList,"Text","Value"))" onchange="ItemNameChange(this.id);">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="HSNNo" class="form-label">HSN No</label>
                                    <input asp-for="HSNNo" class="form-control" value="0" />
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="Qty" class="form-label">Qty</label>
                                    <input asp-for="Qty" class="form-control" min=0 value="0" onkeyup="CalculateRate();" data-val="false" />
                                </div>
                             @*    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">

                                    <label asp-for="Unit" class="form-label">Unit</label>
                                    <input asp-for="Unit" class="form-control" readonly />
                                </div>
                              @*   <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">

                                    <label asp-for="AltQty" class="form-label">Alt Qty</label>
                                    <input asp-for="AltQty" class="form-control" onkeyup="CalculateRate();" />
                                </div>
                               @*  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">

                                    <label asp-for="AltUnit" class="form-label">Alt Unit</label>
                                    <input asp-for="AltUnit" class="form-control" value="NA" readonly="readonly" aria-readonly="readonly" />
                                </div>
                            @*     <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">

                                    <label asp-for="Rate" class="form-label">Rate</label>
                                    <input asp-for="Rate" class="form-control" onkeyup="CalculateRate();" />
                                </div>
                                @* <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                <div class="col-xl-4 col-lg-3 col-md-4 col-sm-6 col-xs-12">

                                    <label asp-for="OtherRateCurr" class="form-label">Rate In Oth Curr.</label>
                                    <input asp-for="OtherRateCurr" class="form-control" readonly disabled />
                                </div>
                              @*   <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                <div class="col-xl-4 col-lg-3 col-md-4 col-sm-6 col-xs-12">

                                    <label asp-for="UnitRate" class="form-label">Rate/Unit</label>
                                    <select class="form-select" asp-for="UnitRate" asp-items="Model.UnitRateList" onchange="CalculateRate();"></select>
                                </div>
                              @*   <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                <div class="col-xl-4 col-lg-3 col-md-4 col-sm-6 col-xs-12">

                                    <label asp-for="DiscPer" class="form-label">Disc %</label>
                                    <input asp-for="DiscPer" class="form-control" value="0" min="0" max="100" onchange="CalculateRate();" />
                                </div>
                                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="DiscRs" class="form-label">Disc Rs.</label>
                                    <input asp-for="DiscRs" class="form-control" onkeyup="CalculateRateA();" />
                                </div>
                                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Amount" class="form-label">Amount</label>
                                    <input asp-for="Amount" class="form-control" value="0.00" readonly disabled />
                                </div>
                                <div class="col-xl-3 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="TolLimit" class="form-label">Tol Limit</label>
                                    <input asp-for="TolLimit" class="form-control" />
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="Remark" class="form-label">Remark</label>
                                    <input asp-for="Remark" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Description" class="form-label">Description</label>
                                    <input asp-for="Description" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AmendmentNo" class="form-label">Amend No</label>
                                    <input asp-for="AmendmentNo" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="AmendmentDate" class="form-label">Amend Date</label>
                                    <input asp-for="AmendmentDate" class="form-control" />
                                </div>
                                <div class="col-xl-4 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="AmendmentReason" class="form-label">Amend Reason</label>
                                    <input asp-for="AmendmentReason" class="form-control" />
                                </div>
                                <div class=" col-4 col-auto">
                                    <div class="row justify-content-around">
                                        <div class="col-auto">
                                            <button type="button" class="ItemBtn btn btn-sm btn-outline-danger mt-3">
                                                <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                            </button>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch d-flex justify-content-center mt-2">
                                                <input asp-for="SH" class="form-check-input" type="checkbox" role="switch" />
                                            </div>
                                            <label class="form-label">Show/Hide Additional Fields</label>
                                        </div>
                                        <div class="col-auto">
                                            <button type="button" class="Schedule btn btn-sm btn-outline-success mt-3">
                                                <i class="fa-solid fa-calendar-clock fa-fw fa-lg"></i> SECHDULE
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="StoreName" class="form-label">Store Name</label>
                                    <select class="form-select" asp-for="StoreName" asp-items="@(new SelectList(Model.StoreList,"Value","Text"))">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="StockQty" class="form-label">Stock Qty</label>
                                    <input asp-for="StockQty" class="form-control" readonly disabled />
                                </div>
                                <div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Color" class="form-label">Color</label>
                                    <input asp-for="Color" class="form-control" />
                                </div>
                                <div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Rejper" class="form-label">Rejper</label>
                                    <input asp-for="Rejper" class="form-control" />
                                </div>
                                <div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Excessper" class="form-label">Excessper</label>
                                    <input asp-for="Excessper" class="form-control" />
                                </div>
                                <div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ProjQty1" class="form-label">Proj Qty1</label>
                                    <input asp-for="ProjQty1" class="form-control" />
                                </div>
                                <div class="AF col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ProjQty2" class="form-label">Proj Qty2</label>
                                    <input asp-for="ProjQty2" class="form-control" />
                                </div>
                            </div>
                            <div class="progress my-2 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="card">
                                <div class="card-body overflow-auto pb-0">
                                    <table class="table table-hover table-bordered table-striped">
                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                            <tr>
                                                <th>Action</th>
                                                <th>Seq No</th>
                                                <th>Part Code</th>
                                                <th>Item Name</th>
                                                <th>HSN No</th>
                                                <th>Qty</th>
                                                <th>Unit</th>
                                                <th>Alt Qty</th>
                                                <th>Alt Unit</th>
                                                <th>Rate</th>
                                                <th>Rate/Unit</th>
                                                <th>Disc%</th>
                                                <th>Disc Rs</th>
                                                <th>Amount</th>
                                                <th>Tol Limit</th>
                                                <th>Description</th>
                                                <th>Remark</th>
                                                <th>Amendment No</th>
                                                <th>Amendment Date</th>
                                                <th>Amendment Reason</th>
                                                <th>Color</th>
                                                <th>Rejper</th>
                                                <th>Excessper</th>
                                                <th>Proj Qty1</th>
                                                <th>Proj Qty2</th>
                                            </tr>
                                        </thead>
                                        <tbody id="divSaleItemGrid">
                                            <partial name="_SOAmmItemGrid" />
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="progress my-3 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="row g-2 gx-3">
                                <div class="col-12 text-center">
                                    <strong>BASIC TOTAL : <i class="fa-solid fa-indian-rupee-sign fa-fw fa-1x"></i><span id="lblItemNetAmount"></span></strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_TaxDetail">
                        <button class="accordion-button collapsed text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_TaxDetail" aria-expanded="true" aria-controls="B_TaxDetail">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Tax Detail</strong>
                        </button>
                    </h2>
                    <div id="B_TaxDetail" class="accordion-collapse collapse pnl1 bg-gradient" aria-labelledby="H_TaxDetail">
                        @await Html.PartialAsync("_TaxDetail")
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_SODetail">
                        <button class="accordion-button text-light pnl4BG bg-gradient collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#B_SODetail" aria-expanded="false" aria-controls="B_SODetail">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-hourglass-clock fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
                        </button>
                    </h2>
                    <div id="B_SODetail" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SODetail">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3">
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="FreightPaidBy" class="form-label">Freight Paid By</label>
                                    <select class="form-select" asp-for="FreightPaidBy" asp-items="Model.FreightByList">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PackingChgApplicable" class="form-label">Packing Chg Applicable</label>
                                    <select class="form-select" asp-for="PackingChgApplicable" asp-items="Model.YesNo">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="TransportMode" class="form-label">Mode Transport</label>
                                    <select class="form-select" asp-for="TransportMode" asp-items="Model.TransportModeList">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="DeliverySch" class="form-label">Delivery Sch</label>
                                    <input asp-for="DeliverySch" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="DeliveryTerms" class="form-label">Delivery Terms</label>
                                    <input asp-for="DeliveryTerms" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PreparedBy" class="form-label">Prepared By</label>
                                    <select class="form-select" asp-for="PreparedBy" asp-items="@(new SelectList(Model.PreparedByList,"Value","Text"))">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="PortOfDischarge" class="form-label">Port Of Discharge</label>
                                    <input asp-for="PortOfDischarge" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ResponsibleSalesPersonID" class="form-label">Responsible Sales Person</label>
                                    <select class="form-select" asp-for="ResponsibleSalesPersonID" asp-items="@(new SelectList(Model.ResponsibleSalesPersonList,"Value","Text"))">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CustContactPerson" class="form-label">Cust Contact Person</label>
                                    <input asp-for="CustContactPerson" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SaleDocType" class="form-label">Sale Doc Type</label>
                                    <select class="form-select" asp-for="SaleDocType" asp-items="@(new SelectList(Model.SaleDocTypeList,"Value","Text"))">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="OtherDetail" class="form-label">Other Detail</label>
                                    <input asp-for="OtherDetail" class="form-control" />
                                </div>

                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Port2Loading" class="form-label">Port To Loading</label>
                                    <input asp-for="Port2Loading" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="InsuApplicable" class="form-label">Insurance Applicable</label>
                                    <input asp-for="InsuApplicable" class="form-control" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="SODeliveryDate" class="form-label">SO Delivery Date</label>
                                    <input asp-for="SODeliveryDate" class="form-control" required />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="Remark" class="form-label">Remark</label>
                                    <input asp-for="Remark" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer p-3">
            <partial name="_FormsButton" model="Model" />
        </div>
    </form>
</div>


@section Scripts
    {
    <script>
        $(function() {
            if ('@Model.Mode' != '' && parseInt('@Model.ID') != 0) {
                GetTaxPartItem();
                $('#lblItemNetAmount').text($('#ItemNetAmount').val());
                if ($('#SOType').val() == "OPEN") {
                    $('#Qty').val('0').prop('disabled', true).attr('readonly', 'readonly');
                }
            }
            else {
                window.setInterval(function() {
                    Dat = new Date();
                    let am_pm = (Dat.getHours() >= 12) ? "PM" : "AM";
                    let hours = Dat.getHours().toString().length == 1 ? '0' + Dat.getHours() : Dat.getHours();
                    let minutes = Dat.getMinutes().toString().length == 1 ? '0' + Dat.getMinutes() : Dat.getMinutes();
                    let seconds = Dat.getSeconds().toString().length == 1 ? '0' + Dat.getSeconds() : Dat.getSeconds();
                    var time = hours + ":" + minutes + ":" + seconds + " - " + am_pm;
                    $('#EntryTime').val(time);
                }, 1000);
            }
        });

        $(document).ready(function() {
            $("#AmmDate").datepicker({ dateFormat: 'dd/mm/yy' });
            $("#QDate").datepicker({ dateFormat: 'dd/mm/yy' });
            $("#SODate").datepicker({ dateFormat: 'dd/mm/yy' });
            $("#WEF").datepicker({ dateFormat: 'dd/mm/yy' });
            $("#SOConfirmDate").datepicker({ dateFormat: 'dd/mm/yy' });
            $("#SODeliveryDate").datepicker({ dateFormat: 'dd/mm/yy' });

            $("#SOCloseDate").datepicker({
                dateFormat: 'dd/mm/yy',
            });

            $('.AF').fadeOut();
            $('.Schedule').fadeOut();
        });

        $('form').submit(function(event) {
            //event.preventDefault(); // Prevent the form from submitting via the browser
            var form = $(this);
            var url = form.attr('action'); //get submit url [replace url here if desired]
            $("form :input").prop("disabled", false);
        });

        $("#SODate").on('keydown', function(e) {
            e.preventDefault();
            return false;
        });

        function PartCodeChange(ID) {
            $.when(SetPartCodeItem(ID)).done(function() { GetItemPartCode(ID) });
        }

        function ItemNameChange(ID) {
            SetPartCodeItem(ID);
            GetItemPartCode(ID);
        }

        function ClearItem() {
            $('#PartCode').prop('selectedIndex', 0).removeClass('is-invalid').change(), $('#HSNNo').val('0'), $('#Qty').val('0'), $('#Rate').val('0'), $('#Unit').val('0'), $('#AltQty').val(0),
                $('#AltUnit').val('NA'), $('#OtherRateCurr').val('0'), $('#UnitRate').val('Unit'), $('#DiscPer').val('0'), $('#DiscRs').val('0.00'), $('#Amount').val('0.00'), $('#TolLimit').val(0),
                $('#Remark').val(''), $('#Description').val(''), $('#StoreName').prop('selectedIndex', 0), $('#StockQty').val('0'), $('#AmendmentNo').val(''), $('#AmendmentDate').val(''),
                $('#AmendmentReason').val(''), $('#Color').val(''), $('#Rejper').val('0'), $('#Excessper').val('0'), $('#ProjQty1').val('0'), $('#ProjQty1').val('0');
        }

        //$('#SOType').change(function() {
        //    $('.Schedule').fadeOut();
        //    ClearItemTax();
        //    if ($(this).val() == "OPEN") {
        //        $('#Qty').val('0').prop('disabled', true).attr('readonly', 'readonly');
        //    }
        //    if ($(this).val() == "CLOSE") {
        //        $('#Qty').val('0').prop('disabled', false).removeAttr('readonly');
        //    }
        //});

        //$('#CurrencyID').change(function() {
        //    $.getJSON({
        //        url: "/SaleOrder/GetCurrencyDetail",
        //        data: { Currency: $('#CurrencyID :selected').text() },
        //        success: function(result, status, xhr) {
        //            if (result != null && result != "null") {
        //                var objResult = $.parseJSON(result);
        //                if (objResult != null) {
        //                    if (objResult.StatusCode == 200 && objResult.StatusText == "Success") {
        //                        if (objResult.Result != null) {
        //                            $('#ExRate').val(parseFloat(objResult.Result[0].Rate));
        //                            if (objResult.Result[0].Default == "Y") {
        //                                $('#Rate').val('0.00').prop('disabled', false).removeAttr('readonly');
        //                                $('#OtherRateCurr').val('0').prop('disabled', true).attr('readonly', 'readonly');
        //                            }
        //                            else {
        //                                $('#Rate').val('0.00').prop('disabled', true).attr('readonly', 'readonly');
        //                                $('#OtherRateCurr').val('0').prop('disabled', false).removeAttr('readonly');
        //                                $('#OtherRateCurr').keyup(function() {
        //                                    $('#Rate').val($('#OtherRateCurr').val().trim() != "" ? parseFloat($('#OtherRateCurr').val()) * parseFloat($('#ExRate').val()) : 0);
        //                                    CalculateRate();
        //                                });
        //                            }
        //                        }
        //                    }
        //                }
        //            }
        //        },
        //        error: function(result, status, xhr) {
        //            console.log(result);
        //        }
        //    }).done(function() {
        //        ClearItemTax();
        //    });
        //});

        async function ClearItemTax() {
            $.ajax({
                url: "/SaleOrder/ResetGridItems",
                type: "GET",
                success: await function(result, status, xhr) {
                    if (result == 200) {
                        ClearItem();
                        var NoData = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
                        $('#divSaleItemGrid').html(NoData);
                        $('#ItemNetAmount').val('0.00'), $('#TotalTaxAmt').val('0.00'), $('#lblItemNetAmount').text('0.00'), $('#NetTotal').val('0.00'), $('#TotalRoundOff').prop('selectedIndex', 0), $('#TotalDiscountAmt').val('0');
                    }
                    $('#ItemNetAmount').val('0.00'), $('#TotalTaxAmt').val('0.00'), $('#lblItemNetAmount').text('0.00'), $('#NetTotal').val('0.00'),
                        $('#TotalRoundOff').prop('selectedIndex', 0), $('#TotalDiscountAmt').val('0'), $('#TotalAmtAftrDiscount').val('0.00');
                }
            }).done(function(data) {
                $.ajax({
                    url: '/Tax/ClearTax',
                    type: "GET",
                    success: function(data, status, xhr) {
                        if (data.trim() != "") {
                            $('#divTaxGrid').html(data);
                            $('#TxPartCode').prop('selectedIndex', 0).prop('disabled', false).removeClass('is-invalid').change(), $('#TxItemCode').prop('selectedIndex', 0).prop('disabled', false).removeClass('is-invalid'),
                                $('#TxTaxType').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxAccountCode').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxPercentg').val(0).removeAttr('readonly').removeClass('is-invalid'),
                                $('#TxAdInTxable').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxRoundOff').prop('selectedIndex', 0).removeClass('is-invalid'), $('#TxRefundable').prop('selectedIndex', 0).removeClass('is-invalid'),
                                $('#TxOnExp').val('0.00'), $('#TxRemark').val(''), $('#TxAmount').val("0.00").removeClass('is-invalid');
                        }
                    }
                })
            }).fail(function(data) {
                console.log(data);
            }).always(function(data) {
                console.log(data);
            });
        }

        function addDays(date, days) {
            var NewDate = new Date(date);
            NewDate.setDate(NewDate.getDate() + days);
            return NewDate.toISOString().substring(0, 10);
        }

        function ScheduleQty() {
            var Sum = 0;
            $(".Qty").each(function() {
                Sum += parseFloat($(this).text());
            });
            return Sum;
        }

        $('#DQty').on('keyup keypress blur change', function(e) {
            const TQty = parseInt($('#DTQty').val());
            const DQty = parseInt($('#DQty').val());

            const SQty = ScheduleQty();

            const Total = TQty - (DQty + SQty);

            if (Total == 0 && DQty + SQty == TQty) {
                $('.addSchedule').prop('disabled', false).removeAttr('readonly');
            }
            else if (Total >= 0) {
                $('.addSchedule').prop('disabled', false).removeAttr('readonly');
            }
            else if (Total <= 0) {
                $('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
            }
        });

        $('.addSchedule').click(function(e) {
            e.preventDefault();
            const _DDays = parseInt($('#DDays').val().trim());
            const _DDate = new Date($('#DDate').val().trim());
            const date = addDays(_DDate, _DDays);

            const TQty = !$('#DTQty').val() ? 0 : parseInt($('#DTQty').val());
            const CQty = !$('#DQty').val() ? 0 : parseInt($('#DQty').val());

            if (CQty <= 0) {
                return;
            }

            const Sum = ScheduleQty();

            const Total = TQty - (CQty + Sum);

            if (Total == 0) {
                $('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
            }
            else if (Total >= 0) {
                $('.addSchedule').prop('disabled', false).removeAttr('readonly');
            }
            else if (Total <= 0) {
                $('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
            }

            var Data = {
                "DPartCode": $('#SOItemCode').val(),
                "Days": _DDays,
                "Date": date,
                "Qty": parseInt($('#DQty').val().trim()),
                "AltQty": parseInt($('#DAltQty').val().trim()),
                "Remarks": $('#DRemark').val(),
            }

            $.ajax({
                type: "POST",
                url: '/SaleOrder/AddSchedule',
                data: Data,
                success: function(resp, status, error) {
                    if (resp) {
                        $('#SOGrid').html(resp);
                        $('#DDate').val(date);

                        $('#DQty').val(Total <= 0 ? 0 : Total);
                        $('#DQty').change();
                    }
                },
                error: function(req, status, error) {
                    alert(error);
                }
            });
        });

        $('#SH').change(function() {
            if ($('#SH').is(':checked') == true) {
                $('.AF').fadeIn();
            }
            else {
                $('.AF :input').val('');
                $('.AF').fadeOut();
            }
        });

        //$('#PN1').change(function() {
        //    $.ajax({
        //        type: "POST",
        //        url: "/SaleOrder/GetPartyList",
        //        data: { Check: $('#PN1').is(':checked') == true ? 'T' : 'F' },
        //        dataType: "json",
        //        success: function(data, status, error) {
        //            $('#AccountCode').empty();
        //            $('#AccountCode').append('<option>-Select-</option>');
        //            $.each(data, function(key, val) {
        //                $('#AccountCode').append('<option value="' + val.value + '">' + val.text + '</option>');
        //                $('#Address').val(''), $('#DeliveryAddress').val('');
        //            });
        //        },
        //        error: function(req, status, error) {
        //            alert(error);
        //        }
        //    });
        //});

        //$('#AccountCode').change(function() {
        //    if ($('#AccountCode').prop('selectedIndex') != 0) {
        //        $.getJSON({
        //            url: "/SaleOrder/GetAddress",
        //            data: { Code: $('#AccountCode').val() },
        //            success: function(result, status, xhr) {
        //                $('#Address').val(result.result);
        //                if ($('#Address').val()) {
        //                    $('#DeliveryAddress').val($('#Address').val());
        //                }
        //            }
        //        });
        //    }
        //    else $('#Address').val(''), $('#DeliveryAddress').val('');
        //});

        //$('#ConsigneeAccountCode').change(function() {
        //    if ($('#ConsigneeAccountCode').prop('selectedIndex') != 0) {
        //        $.getJSON({
        //            url: "@Url.Action("GetAddress")",
        //            data: { Code: $('#ConsigneeAccountCode').val() },
        //            success: function(result, status, xhr) {
        //                $('#ConsigneeAddress').val(result.result);
        //            }
        //        });
        //    }
        //    else $('#ConsigneeAddress').val('');
        //});

        //$('#PN2').change(function() {
        //    $.ajax({
        //        type: "POST",
        //        url: "/SaleOrder/GetPartyList",
        //        data: { Check: $('#PN2').is(':checked') == true ? 'T' : 'F' },
        //        dataType: "json",
        //        success: function(data, status, error) {
        //            $('#ConsigneeAccountCode').empty();
        //            $('#ConsigneeAccountCode').append('<option>-Select-</option>');
        //            $.each(data, function(key, val) {
        //                $('#ConsigneeAccountCode').append('<option value="' + val.value + '">' + val.text + '</option>');
        //                $('#ConsigneeAddress').val('');
        //            });
        //        },
        //        error: function(req, status, error) {
        //            alert(error);
        //        }
        //    });
        //});

        $('#IN1').change(function() {
            $('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
            $.ajax({
                type: "POST",
                url: "/SaleOrder/GetItemPartList",
                data: { TF: $('#IN1').is(':checked') == true ? 'T' : 'F' },
                dataType: "json",
                success: function(data, status, error) {

                    var ObjPartCode = $.parseJSON(data.partCode);
                    var ObjItemCode = $.parseJSON(data.itemName);

                    $('#PartCode').empty();
                    $('#PartCode').append('<option>-Select-</option>');
                    $.each(ObjPartCode, function(key, val) {
                        $('#PartCode').append('<option value="' + val.Text + '">' + val.Value + '</option>');
                    });

                    $('#ItemCode').empty();
                    $('#ItemCode').append('<option>-Select-</option>');
                    $.each(ObjItemCode, function(key, val) {
                        $('#ItemCode').append('<option value="' + val.Text + '">' + val.Value + '</option>');
                    });
                },
                error: function(req, status, error) {
                    alert(error);
                }
            });
        });

        $('.ItemBtn').click(function() {
            if ($('#PartCode').prop('selectedIndex') == 0) {
                AddErrorCls('PartCode');
                return;
            }
            else {
                RemoveErrorCls('PartCode');
            }

            if ($('#SOType').val() == "CLOSE" && ($('#Qty').val() == "" || $('#Qty').val() == "0")) {
                AddErrorCls('Qty');
                return;
            }
            else {
                RemoveErrorCls('Qty');
            }

            if ($('#Rate').val() == "" || $('#Rate').val() == "0") {
                AddErrorCls('Rate');
                return;
            }
            else {
                RemoveErrorCls('Rate');
            }

            if (parseInt($('#DiscPer').val()) < 0 || parseInt($('#DiscPer').val()) > 100) {
                AddErrorCls('DiscPer');
                return;
            }
            else {
                RemoveErrorCls('DiscPer');
            }

            $(this).prop("disabled", true);
            $(this).html('Calculating... <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');

            var ItemData = {
                "PartCode": $('#PartCode').val(),
                "PartText": $('#PartCode option:selected').text(),
                "ItemCode": $('#ItemCode').val(),
                "ItemText": $('#ItemCode option:selected').text(),
                "HSNNo": $('#HSNNo').val(),
                "Qty": $('#Qty').val(),
                "Unit": $('#Unit').val(),
                "AltQty": $('#AltQty').val(),
                "AltUnit": $('#AltUnit').val(),
                "Rate": $('#Rate').val(),
                "UnitRate": $('#UnitRate').val(),
                "DiscPer": $('#DiscPer').val(),
                "DiscRs": $('#DiscRs').val(),
                "Amount": $('#Amount').val(),
                "TolLimit": $('#TolLimit').val(),
                "Description": $('#Description').val(),
                "Remark": $('#Remark').val(),
                "AmendmentNo": $('#AmendmentNo').val(),
                "AmendmentDate": $('#AmendmentDate').val(),
                "AmendmentReason": $('#AmendmentReason').val(),
                "MRP": $('#MRP').val(),
                "PoNo": $('#PoNo').val(),
                "PoDate": $('#PoDate').val(),
                "Color": $('#Color').val(),
                "Rejper": $('#Rejper').val(),
                "Excessper": $('#Excessper').val(),
                "ProjQty1": $('#ProjQty1').val(),
                "ProjQty2": $('#ProjQty2').val(),
            }

            $.ajax({
                url: '/SaleOrder/ItemGrid',
                type: "POST",
                data: ItemData,
                beforeSend: function(xhr) {
                    //xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
                    console.log(1);
                },
                success: function(data, status, xhr) {
                    console.log(2);
                    if (data.trim() == "") {
                        $.notify('Duplicate Item Not Allowed.', "info");
                        $('.ItemBtn').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                    }
                    else {
                        if (!DelSeqNo && DelSeqNo != 0) {
                            $('#divSaleItemGrid ."' + DelSeqNo + "'").remove();
                        }
                        $('#divSaleItemGrid').html(data);
                        $.notify('Item Added To Grid.', "success");
                        ClearItem();
                    }
                    $('#TotalRoundOff').prop('selectedIndex', 0);
                    var INA = parseFloat($('#ItemNetAmount').val());
                    $('#lblItemNetAmount').text(INA.toFixed(2));
                    $('#NetTotal').val(INA.toFixed(2));
                },
                error: function(result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function(result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                complete: function() {
                    console.log(5);
                    $('.Schedule').fadeIn();
                    $('.ItemBtn').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                }
            }).done(function() {
                console.log(3);
                GetTaxPartItem();
            }).fail(function() {
                $.notify("error");
            }).always(function() {
                console.log(4);
            });
        });

        async function SetPartCodeItem(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).val();
                var t = $('#' + ID + ' option:selected').text();

                if (ID == "PartCode") {
                    v == "" ? $('#ItemCode').val("") : $('#ItemCode').val(v);
                }

                if (ID == "ItemCode") {
                    v == "" ? $('#PartCode').val("") : $('#PartCode').val(v);
                }
            }
        }

        async function GetItemPartCode(ID) {
            $.getJSON({
                url: "/SaleOrder/GetItemPartCode",
                data: { Code: $('#' + ID).val() },
                success: function(result, status, xhr) {
                    if (result) {
                        var obj = JSON.parse(result);
                        if (!obj) {
                            $('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
                        }
                        else if (obj.StatusCode == 200 && obj.StatusText == "Success") {
                            $('#Unit').val(obj.Result[0].Unit);
                            $('#HSNNo').val(obj.Result[0].HSNNo);
                            $('#AltUnit').val(obj.Result[0].AltUnit == null ? 'NA' : obj.Result[0].AltUnit);
                            !$('#AltUnit').val() ? $('#UnitRate').prop('disabled', true) : $('#UnitRate').prop('disabled', false);
                        }
                    }
                },
                error: function(result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
            });
        }

        async function QuotChange(ID) {
            $.getJSON({
                url: "/SaleOrder/GetQuotData",
                data: { Code: $('#' + ID).val() },
                success: function(result, status, xhr) {
                    if (result) {
                        var obj = JSON.parse(result);
                        if (!obj) {
                            $('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
                        }
                        else if (obj.StatusCode == 200 && obj.StatusText == "Success") {
                            $('#Unit').val(obj.Result[0].Unit);
                            $('#HSNNo').val(obj.Result[0].HSNNo);
                            $('#AltUnit').val(obj.Result[0].AltUnit == null ? 'NA' : obj.Result[0].AltUnit);
                        }
                    }
                },
                error: function(result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
            });
        }

        async function CalculateRate() {
            var Amount = 0;
            const OC = $('#SOType').val();
            const UnitRate = $('#UnitRate').val();
            const Rate = $('#Rate').val() == "0" || $('#Rate').val() == "" ? 0 : parseInt($('#Rate').val());
            const DP = $('#DiscPer') == "0" || $('#DiscPer').val() == "" ? 0 : parseInt($('#DiscPer').val());

            if (UnitRate == "Unit") {
                const Qty = $('#Qty').val() == "0" || $('#Qty').val() == "" ? 0 : parseInt($('#Qty').val());
                Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
            }
            if (UnitRate == "AltUnit") {
                const Qty = $('#AltQty').val() == "0" || $('#AltQty').val() == "" ? 0 : parseInt($('#AltQty').val());
                Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
            }

            if (DP !== 0) {
                const DA = ((Amount * DP) / 100);
                $('#DiscRs').val(DA);
                Amount = Amount - DA;
            }

            $('#Amount').val(Amount.toFixed(2));
        }

        async function CalculateRateA() {
            var Amount = 0;
            $('#DiscPer').val(0);
            const OC = $('#SOType').val();
            const UnitRate = $('#UnitRate').val();
            const Rate = $('#Rate').val() == "0" || $('#Rate').val() == "" ? 0 : parseInt($('#Rate').val());
            const DR = $('#DiscRs') == "0" || $('#DiscRs').val() == "" ? 0 : parseInt($('#DiscRs').val());

            if (UnitRate == "Unit") {
                const Qty = $('#Qty').val() == "0" || $('#Qty').val() == "" ? 0 : parseInt($('#Qty').val());
                Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
            }
            if (UnitRate == "AltUnit") {
                const Qty = $('#AltQty').val() == "0" || $('#AltQty').val() == "" ? 0 : parseInt($('#AltQty').val());
                Amount = OC == 'CLOSE' ? Qty * Rate : Amount;
            }

            if (DR !== 0) {
                Amount = Amount - DR <= 0 ? 0 : Amount - DR;
            }

            $('#Amount').val(Amount.toFixed(2));
        }

        let DelSeqNo = 0;
        let Dat = "";

        async function EditItemRow(SeqNo) {
            var PartCode = $('#PartCode').val();
            $.ajax({
                url: '/SaleOrder/EditItemRow',
                type: "POST",
                data: { PartCode: PartCode, SeqNo: SeqNo },
                success: await function(data) {
                    var obj = $.parseJSON(data);
                    if (obj != null && obj.length == 1) {
                        $('#PartCode').val(obj[0].PartCode);
                        $('#HSNNo').val(obj[0].HSNNo);
                        $('#Qty').val(obj[0].Qty);
                        $('#Unit').val(obj[0].Unit);
                        $('#AltQty').val(obj[0].AltQty);
                        $('#AltUnit').val(obj[0].AltUnit);
                        $('#Rate').val(obj[0].Rate);
                        $('#UnitRate').val(obj[0].UnitRate);
                        $('#ItemCode').val(obj[0].ItemCode).change();
                        $('#DiscPer').val(obj[0].DiscPer);
                        $('#DiscRs').val(obj[0].DiscRs);
                        $('#Amount').val(obj[0].Amount);
                        $('#TolLimit').val(obj[0].TolLimit);
                        $('#Description').val(obj[0].Description);
                        $('#Remark').val(obj[0].Remark);
                        $('#StoreName').val(obj[0].StoreName);
                        $('#StockQty').val(obj[0].StockQty);
                        $('#AmendmentNo').val(obj[0].AmendmentNo);
                        $('#AmendmentDate').val(obj[0].AmendmentDate);
                        $('#AmendmentReason').val(obj[0].AmendmentReason);
                        $('#MRP').val(obj[0].MRP);
                        $('#PoNo').val(obj[0].PoNo);
                        $('#PoDate').val(obj[0].PoDate);
                        $('#Color').val(obj[0].Color);
                        $('#Rejper').val(obj[0].Rejper);
                        $('#Excessper').val(obj[0].Excessper);
                        $('#ProjQty1').val(obj[0].ProjQty1);
                        $('#ProjQty2').val(obj[0].ProjQty2);
                        DelSeqNo = SeqNo;
                        $('#divSaleItemGrid .' + DelSeqNo).remove();
                        if ($('#divSaleItemGrid').children().length == 0) {
                            var NoData = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
                            $('#divSaleItemGrid').html(NoData);
                        }
                    }
                },
                error: function(response) {
                    $.notify(response.responseText, "error");
                },
                failure: function(response) {
                    $.notify(response.responseText, "error");
                }
            });
        }

        async function DeleteItemRow(SeqNo) {
            $.ajax({
                url: '/SaleOrder/DeleteItemRow',
                type: "POST",
                data: { "SeqNo": SeqNo },
                success: await function(data, status, xhr) {
                    $('#divSaleItemGrid').html(data);
                    if ($('#divSaleItemGrid').children('tr').length == 0) {
                        $('.Schedule').fadeOut();
                        var NoData = '<tr class="text-center"><td colspan="28" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
                        $('#lblItemNetAmount').text("0.00");
                        $('#divSaleItemGrid').html(NoData);
                    }
                    GetTaxPartItem();
                    $('#lblItemNetAmount').text($('#ItemNetAmount').val());
                    $('#TotalRoundOff').prop('selectedIndex', 0);
                    $.notify('Item Deleted From Grid.', "info");
                },
                error: function(response, status, xhr) {
                    alert(response.responseText);
                },
                failure: function(response, status, xhr) {
                    alert(response.responseText);
                }
            });
        }

        async function DeleteDeliveryRow(SRNo, DPC) {
            $.ajax({
                url: '/SaleOrder/DeleteDeliveryRow',
                type: "POST",
                data: { "SRNo": SRNo, "DPC": DPC },
                success: await function(data, status, xhr) {
                    $('#SOGrid').html(data);
                    if ($('#SOGrid tbody').children().length == 1) {
                        var NoData = '<tr class="text-center"><td colspan="6" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
                        $('#SOGrid tbody').html(NoData);
                    }

                    const S = ScheduleQty();
                    const T = parseInt($('#DTQty').val());

                    T != S ? $('.addSchedule').prop('disabled', false).removeAttr('readonly') : $('.addSchedule').prop('disabled', true).attr('readonly', 'readonly');
                },
                error: function(response, status, xhr) {
                    $.notify(response.responseText, "error");
                },
                failure: function(response, status, xhr) {
                    $.notify(response.responseText, "error");
                }
            });
        }

        async function GetTaxPartItem() {
            $.ajax({
                type: "GET",
                url: "/SaleOrder/GetTaxPartItem",
                processData: false,
                dataType: "json",
                success: await function(data, status, error) {
                    $('#TxPartCode').empty();
                    $('#TxPartCode').append('<option>-Select-</option>');
                    $.each(data.partCode, function(key, val) {
                        $('#TxPartCode').append('<option value="' + val.value + '">' + val.text + '</option>');
                    });

                    $("[id='TxItemCode']").empty();
                    $("[id='TxItemCode']").append('<option>-Select-</option>');
                    $.each(data.itemCode, function(key, val) {
                        $("[id='TxItemCode']").append('<option value="' + val.value + '">' + val.text + '</option>');
                    });

                    $("[id='SOItemCode']*").empty();
                    $("[id='SOItemCode']*").append('<option>-Select-</option>');
                    $.each(data.itemCode, function(key, val) {
                        $("[id='SOItemCode']*").append('<option value="' + val.value + '">' + val.text + '</option>');
                    });
                },
                error: function(req, status, error) {
                    $.notify(req.responseText, "error");
                }
            });
        }

        $('#Rate').keyup(function() {
            $('#OtherRateCurr').val($(this).val());
        });

        $('.Schedule').click(function() {
            $('.modal-header').addClass('bg-graident bg-warning');
            $('.modal-title').text('DELIVERY SCHEDULE');
            $('#DTQty').val();
            $('#DDate').val(new Date().toISOString().substring(0, 10));
            $('#PopupModel').modal("show");
        });

        function RefreshSchedule(ID) {
            if (!ID) $('#SOItemCode').prop('selectedIndex', 0).change();
            else {
                _PCode = parseInt($('#' + ID).val());
                $.ajax({
                    type: "POST",
                    url: "/SaleOrder/RefreshSchedule",
                    data: { PCode: _PCode, Typ: "SchVal" },
                    success: function(data, status, error) {
                        $('#DTQty').val(data.schVal.Qty);
                        $('#DQty').val();
                        $('#DAltQty').val(data.schVal.AltQty);
                        $('#DRemark').val(data.schVal.Remark);
                    },
                    error: function(req, status, error) {
                        alert(error);
                    }
                }).done(function() {
                    $.ajax({
                        type: "POST",
                        url: "/SaleOrder/RefreshSchedule",
                        data: { PCode: _PCode },
                        success: function(data, status, error) {
                            $('#SOGrid').html(data);
                        },
                        error: function(req, status, error) {
                            alert(error);
                        }
                    });
                });
            }
        }

        function new1() {
            sessionStorage.setItem();
        }

    </script>
}