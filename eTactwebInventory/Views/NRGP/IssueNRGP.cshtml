@model eTactWeb.DOM.Models.IssueNRGPModel
@{
    ViewData["Title"] = "Issue NonRetuanable Challan";

    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<style>

    .disabled-link {
        pointer-events: none; /* Prevents clicking */
        color: gray; /* Optional: Make it look disabled */
        text-decoration: none; /* Optional: Remove underline */
        cursor: default; /* Optional: Show normal cursor */
        opacity: 0.6; /* Optional: Make it look faded */
    }
    .select2-container--default .select2-selection--single {
        background-color: #e0f2f1;
        border: 1.5px solid #0a0a0a !important;
        border-radius: 4px;
    }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            /* border-bottom: 1.5px solid #000 !important; */
            border-bottom: none !important;
        }

    .select2-container--default .select2-results > .select2-results__options {
        background-color: #e0f2f1; /* Dropdown background color */
        color: #000;
</style>

<div class="card bg-gradient mb-3 border-light shadow-lg">
    <form asp-action="IssueNRGP" autocomplete="off" class="form-horizontal">
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                <strong>Issue Challan - @Model.YearCode</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    @if (Model.Mode == "U" || Model.Mode == "V")
                    {
                        <a type="button" class="btn btn-sm btn-outline-light bg-gradient me-2" asp-action="PrintReport" asp-controller="NRGP" asp-route-EntryId="@Model.EntryId" asp-route-YearCode="@Model.YearCode">
                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                            PRINT
                        </a>
                        <a type="button" class="btn btn-sm btn-outline-light bg-gradient me-2" asp-action="PrintReport" asp-controller="NRGP" asp-route-EntryId="@Model.EntryId" asp-route-YearCode="@Model.YearCode">
                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                            Generate E-Way Bill
                        </a>
                    }
                    <a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient DashBoard">
                        <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                        Dashboard
                    </a>
                    <div class="row justify-content-between g-2">
                        <div class="col-auto">
                            <input asp-for="FromDateBack" type="hidden" value="@Model.FromDateBack" />
                            <input asp-for="ToDateBack" type="hidden" value="@Model.ToDateBack" />
                            <input asp-for="PartCodeBack" type="hidden" value="@Model.PartCodeBack" />
                            <input asp-for="ItemNameBack" type="hidden" value="@Model.ItemNameBack" />
                            <input asp-for="VendorNameBack" type="hidden" value="@Model.VendorNameBack" />
                            <input asp-for="RGPNRGPBack" type="hidden" value="@Model.RGPNRGPBack" />
                            <input asp-for="ChallanNoBack" type="hidden" value="@Model.ChallanNoBack" />
                            <input asp-for="ChallanTypeBack" type="hidden" value="@Model.ChallanTypeBack" />
                            <input asp-for="DashboardTypeBack" type="hidden" value="@Model.DashboardTypeBack" />
                            @*<a href="#" class="btn offer-listbtn hvr-sweep-to-right btn-sm btn-secondary" onclick="back();">*@
                            <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                BACK
                            </a>
                        </div>
                        @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                        {
                            <div class="col-auto">
                                @*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
                                <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                    @* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
                                    <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                    REFRESH
                                </a>
                            </div>
                            @if (Model.Mode == "U")
                            {
                                @*Model.Mode = "U";*@
                                <div class="col-auto">
                                    @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                    <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="UpdateButton">
                                        <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                        UPDATE
                                    </button>
                                </div>
                            }

                            else
                            {
                                <div class="col-auto">
                                    @*   <button type="submit" class="btn btn-sm btn-outline-primary">*@
                                    <button type="submit" class="btn btn-primary btn-sm submitBTN" id="submitBTN">
                                        <i class="fa-solid fa-chevron-circle-right"></i>
                                        SUBMIT
                                    </button>
                                </div>
                            }
                        }
                    </div>
                    @*<partial name="_FormsButton" />*@
                </span>
            </h5>
        </div>
        <div class="card-body bg-light pt-0">
          
            <div class="accordion shadow-lg">
                <div class="accordion-item" id="GI_Grid">
                    <h2 class="accordion-header" id="H_RParameter">
                        <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_RParameter" aria-expanded="true" aria-controls="B_RParameter">
                            <i class="fa-brands fa-wpforms fa-lg fa-fw pr35"></i>
                            Required Parameter
                        </button>
                    </h2>
                    <div id="B_RParameter" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_RParameter">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3">
                                <div class="col-xl-1 col-lg-1 col-md-1 col-sm-6 col-xs-12">

                                    @* <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">*@
                                    <input type="hidden" asp-for="FinFromDate" value="@Model.FinFromDate" />
                                    <input type="hidden" asp-for="FinToDate" value="@Model.FinToDate" />
                                    <input type="hidden" asp-for="Mode" value="@Model.Mode" />
                                    <input type="hidden" asp-for="SEQNo" id="hiddenSeqNo" />
                                    <label asp-for="EntryId" class="form-label">Entry Id</label>
                                    <input asp-for="EntryId" class="form-control" value="@Model.EntryId" readonly />
                                </div>
                                @*<div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">*@
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="YearCode" class="form-label">Year Code</label>
                                    <input asp-for="YearCode" class="form-control" value="@Model.YearCode" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryDate" class="form-label">Entry Date</label>
                                    <input asp-for="EntryDate" class="form-control" readonly value="@Model.EntryDate" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryTime" class="form-label">Entry Time</label>
                                    <input asp-for="EntryTime" class="form-control" readonly value="@Model.EntryTime" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CC" class="form-label">Branch</label>
                                    <input asp-for="CC" class="form-control" value="@Model.CC" readonly />
                                </div>
                                @if (Model.Mode == "U" || Model.Mode == "V")
                                {
                                    <input type="hidden" value="@Model.RGPNRGP" id="hiddenRGPNRGP" />
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="RGPNRGP" class="form-label" style="color: red;">RGP/NRGP</label>
                                        <select class="form-select" asp-for="RGPNRGP">
                                            <option value="">-Select-</option>
                                            <option value="RGP">RGP</option>
                                            <option value="NRGP">NRGP</option>
                                        </select>
                                    </div>
                                }
                                else
                                {
                                    <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                        <label asp-for="RGPNRGP" class="form-label" style="color: red;">RGP/NRGP</label>
                                        <select class="form-select" asp-for="RGPNRGP">
                                            <option value="">-Select-</option>
                                            <option value="RGP">RGP</option>
                                            <option value="NRGP" selected>NRGP</option>
                                        </select>
                                    </div>
                                }
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">

                                    @* <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">*@


                                    @* <select class="form-select" asp-for="ChallanType" asp-items="@(new SelectList(Model.ChallanTypeList," Value","Text"))">
                                        <option value="">-Select-</option>
                                    </select> *@

                                    @* </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12"> *@
                                    @* <input type="hidden" value="@Model.ChallanType" id="hiddenChallanType" /> *@
                                    <label asp-for="ChallanType" class="form-label" style="color: red;">Challan Type</label>
                                    <select class="form-select" asp-for="ChallanType">
                                        @* <select class="form-select" asp-for="ChallanType" asp-items="@(new SelectList(Model.ChallanTypeList, "Value", "Text"))">   *@
                                        @* <select class="form-select" asp-for="ChallanType" > *@
                                        <option value="">-Select-</option>
                                    </select>

                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ChallanNo" class="form-label" style="color: red;">Challan No</label>
                                    <input type="hidden" value="@Model.ChallanNo" id="hiddenChallanNo" />
                                    <input asp-for="ChallanNo" class="form-control" readonly value="@Model.ChallanNo" style="background-color: lightblue !important;" />
                                </div>
                                <div class="col-xl-1  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="ChallanDate" class="form-label" style="color: red;">Challan Date</label>
                                    <input asp-for="ChallanDate" class="form-control" readonly value="@Model.ChallanDate" />
                                </div>
                                <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="AccountCode" class="form-label" style="color: red;">Vendor Name</label>
                                    @if (Model.Mode == "U" || Model.Mode == "V")
                                    {
                                        <input type="hidden" value="@Model.AccountCode" id="hiddenAccountCode" />
                                    }
                                    <div class="form-check form-switch mx-3 w-auto position-absolute d-inline">
                                        <input asp-for="AC1" class="form-check-input" type="checkbox" role="switch" />Show All
                                    </div>
                                    <select class="form-select" asp-for="AccountCode">
                                        <option value="">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="RemovalTime" class="form-label">Time</label>
                                    <input asp-for="RemovalTime" class="form-control" readonly value="@Model.EntryTime" />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="GSTType" class="form-label">Gst Type</label>
                                    <input asp-for="GSTType " class="form-control" readonly />
                                </div>

                                <div class="col-xl-3  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="DeliveryAddress" class="form-label">Delivery Address</label>
                                    @if (Model.Mode == "U" || Model.Mode == "V")
                                    {
                                        <input type="hidden" value="@Model.DeliveryAddress" id="hiddenDA" />
                                    }
                                    <input asp-for="DeliveryAddress" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="VehicleNo" class="form-label">Vehicle No</label>
                                    <input asp-for="VehicleNo" class="form-control" />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="Transporter" class="form-label">Transpoter</label>
                                    <input asp-for="Transporter" class="form-control" />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="Distance" class="form-label">Distance</label>
                                    <input asp-for="Distance" class="form-control" />
                                </div>

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <div class="form-check form-switch d-flex justify-content-center mt-2">
                                        <input asp-for="SH" class="form-check-input" type="checkbox" role="switch" />
                                    </div>
                                    <label class="form-label d-flex justify-content-center">Show/Hide Additional Fields</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="H_SAGrid">
                            <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
                                <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Issue Challan Grid</strong>
                            </button>
                        </h2>

                        <div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                            <div class="accordion-body">
                                <div class="row g-2 gx-3" id="_ItemGrid">
                                </div>
                                <div class="progress my-2 mb-3" style="height: 4px;">
                                    <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="card">
                                    <div class="card-body overflow-auto pb-0">
                                        <table class="table table-hover table-bordered table-striped" id="TableGrid">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap" id="GridLabels">
                                                <tr>
                                                    <th>Store</th>
                                                    <th>Part Code</th>
                                                    <th style="align-items:left;">Item Name<label style="float:right;">  <input asp-for="IC1" class="form-check-input me-1 mt-2" type="checkbox" role="switch" />Show All</label></th>
                                                    <th>HSN No</th>
                                                    <th>Batch NO</th>
                                                    <th>Unique Batch No</th>
                                                    <th>Qty</th>
                                                    <th>Total Stock</th>
                                                    <th>Total Batch Stock</th>
                                                    <th>Process</th>
                                                    <th>Unit</th>
                                                    <th>Rate</th>
                                                    <th>Amount</th>
                                                    <th>Remark</th>
                                                    <th>Purpose</th>
                                                    <th>PurchasePrice</th>
                                                    <th>Alt Qty</th>
                                                    <th>Alt Unit</th>
                                                </tr>
                                            </thead>
                                            <tbody id="GridControls">
                                                <tr>
                                                    <td>
                                                        <select class="form-select" asp-for="Storeid" style="width:100px;" onchange="FillCurrentBatchINStore(); GetTotalStockQty();">
                                                            <option value="" disabled selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <select class="form-select" asp-for="PartCode" style="width:160px;">
                                                            <option value="0">-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <select class="form-select" asp-for="ItemCode" style="width:250px;">
                                                            <option value="0">-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td><input asp-for="HSNNo" style="width:70px !important" readonly /></td>

                                                    <td>
                                                        <select class="form-select" asp-for="BatchNo" style="width:100px;">
                                                            <option value="0" disabled selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <select class="form-select" asp-for="uniquebatchno">
                                                            <option value="0" disabled selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td><input asp-for="Qty" class="form-control" style="width:80px;" value="0" /></td>
                                                    <td><input asp-for="TotalStock" style="width:70px !important" readonly /></td>
                                                    <td><input asp-for="BatchStock" style="width:70px !important" readonly /></td>
                                                    <td>
                                                        <select class="form-select" asp-for="ProcessId" style="width:70px;">
                                                            <option value="0" selected>-Select-</option>
                                                        </select>
                                                    </td>
                                                    <td><input asp-for="unit" style="width:70px !important" readonly /></td>
                                                    <td><input asp-for="Rate" style="width:70px!important" class="form-control" value="0" /></td>
                                                    <td><input asp-for="Amount" style="width:70px !important" readonly /></td>
                                                    <td><input asp-for="RemarkDetail" /></td>
                                                    <td><input asp-for="Purpose" /></td>
                                                    <td><input asp-for="PurchasePrice" style="width:70px !important" readonly /></td>

                                                    <td><input asp-for="AltQty" style="width:70px !important" /></td>
                                                    <td><input asp-for="AltUnit" style="width:70px !important" readonly /></td>

                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="progress my-3 mb-3" style="height: 4px;">
                                    <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>

                                <div class="row g-2 gx-3">
                                    <div class="AF col-sm-auto">
                                        <label asp-for="PONO" class="form-label">PO Number</label>
                                        <select class="form-select" asp-for="PONO">
                                            <option value="">-Select-</option>
                                        </select>
                                        <input type="hidden" asp-for="Stockable" />
                                        <input type="hidden" id="hiddenItemStockable" />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="POYearCode" class="form-label">PO Year</label>
                                        <select class="form-select" asp-for="POYearCode">
                                            <option value="0">-Select-</option>
                                        </select>
                                    </div>
                                    <div class="AF col-sm-auto col-xl-1 col-md-2 col-sm-3 col-xs-12">
                                        <label asp-for="PODate" class="form-label">PO Date</label>
                                        <input asp-for="PODate" class="form-control" readonly />
                                    </div>
                                    <div class="AF col-sm-auto">
                                        <label asp-for="POAmendementNo" class="form-label">PO Amendment</label>
                                        <input asp-for="POAmendementNo" class="form-control" />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="discper" class="form-label">Discount %</label>
                                        <input asp-for="discper" class="form-control" onchange="TotalhiddenAmount();" oninput="handleInput(this);" />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="disamt" class="form-label">Discount Amount</label>
                                        <input asp-for="disamt" class="form-control" oninput="handleInput(this);" />
                                    </div>
                                    <div class="AF col-sm-auto">
                                        <label asp-for="AgainstChallanEntryId" class="form-label">Against Challan EntryId</label>
                                        <select class="form-select" asp-for="AgainstChallanEntryId">
                                            <option value="">-Select-</option>
                                        </select>
                                    </div>
                                    <div class="AF col-sm-auto">
                                        <label asp-for="AgainstChallanNo" class="form-label">Against Challan No</label>
                                        <select class="form-select" asp-for="AgainstChallanNo" onchange="FillAgainstChallanYC();">
                                            <option value="0">-Select-</option>
                                        </select>
                                    </div>
                                    <div class="AF col-sm-auto">
                                        <label asp-for="AgainstChallanYearCode" class="form-label">Against Challan Year</label>
                                        <select class="form-select col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12" asp-for="AgainstChallanYearCode" onchange="FillAgainstChallanEntryId();">
                                            <option value="0">-Select-</option>
                                        </select>
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="AgainstChallanType" class="form-label">Ag ChallanType</label>
                                        <select class="form-select col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12" asp-for="AgainstChallanType">
                                            <option value="0">-Select-</option>
                                        </select>
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="Closed" class="form-label">Closed</label>
                                        <input asp-for="Closed" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="ItemColor" class="form-label">Item Color</label>
                                        <input asp-for="ItemColor" class="form-control" />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="ItemSize" class="form-label">Item Size</label>
                                        <input asp-for="ItemSize" class="form-control" />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="ItemModel" class="form-label">Item Model</label>
                                        <input asp-for="ItemModel" class="form-control" />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="PendQty" class="form-label">PendQty</label>
                                        <input asp-for="PendQty" class="form-control" readonly />
                                    </div>
                                    <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12 AF col-sm-auto">
                                        <label asp-for="PendAltQty" class="form-label">Pend AltQty</label>
                                        <input asp-for="PendAltQty" class="form-control" readonly />
                                    </div>
                                </div>
                                <div class="d-flex">
                                    <div class="col-md-10">
                                        <button type="button" class="GridButton btn btn-sm btn-outline-danger mt-1 mb-1">
                                            <i class="fa-duotone fa-angle-double-down fa-fw fa-lg"></i> ADD TO GRID
                                        </button>
                                    </div>
                                    <div class="col-md-2 mt-1 mb-1">
                                        <input type="text" class="form-control" id="search-box" placeholder="Search..." style="background-color:#FFFACD;">
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-body overflow-auto pb-0">
                                        <table class="table table-hover table-bordered table-striped IssueNRGPTb">
                                            <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                                <tr>
                                                    <th>Action</th>
                                                    <th>SR#</th>
                                                    <th data-columnno="1" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Part Code</th>
                                                    <th data-columnno="2" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Item Name</th>
                                                    <th data-columnno="3" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>HSN No</th>
                                                    <th data-columnno="4" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Store</th>
                                                    <th data-columnno="5" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Batch NO</th>
                                                    <th data-columnno="6" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Unique Batch No</th>
                                                    <th data-columnno="7" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Total Stock</th>
                                                    <th data-columnno="8" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Total Batch Stock</th>
                                                    <th data-columnno="9" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Process</th>
                                                    <th data-columnno="10" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Qty</th>
                                                    <th data-columnno="11" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Unit</th>
                                                    <th data-columnno="12" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Rate</th>
                                                    <th data-columnno="13" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Amount</th>
                                                    <th data-columnno="14" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PurchasePrice</th>
                                                    <th data-columnno="15" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Alt Qty</th>
                                                    <th data-columnno="16" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Alt Unit</th>
                                                    <th data-columnno="17" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Remark</th>
                                                    <th data-columnno="18" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Purpose</th>
                                                    <th data-columnno="19" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO No</th>
                                                    <th data-columnno="20" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO Year</th>
                                                    <th data-columnno="21" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO Date</th>
                                                    <th data-columnno="22" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO Amendment</th>
                                                    <th data-columnno="23" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Discount%</th>
                                                    <th data-columnno="24" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Dis Amt</th>
                                                    <th data-columnno="25" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Amount</th>
                                                    <th data-columnno="26" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Against ChallanEntryId</th>
                                                    <th data-columnno="27" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Against ChallanNo</th>
                                                    <th data-columnno="28" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Against ChallanYear</th>
                                                    <th data-columnno="29" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Against ChallanType</th>
                                                    <th data-columnno="30" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Closed</th>
                                                    <th data-columnno="31" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Item Color</th>
                                                    <th data-columnno="32" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Item Size</th>
                                                    <th data-columnno="33" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Item Model</th>
                                                    <th data-columnno="34" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PendQty</th>
                                                    <th data-columnno="35" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Pend AltQty</th>
                                                </tr>
                                            </thead>
                                            <tbody id="divIssueNRGPGrid">
                                                <partial name="_IssueNRGPGrid" />
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-2 gx-3">
                                <div class="col-12 text-center">
                                    <strong>BASIC TOTAL : <i class="fa-solid fa-indian-rupee-sign"></i><span id="lblItemNetAmount"></span></strong>
                                    <strong>, TOTAL NO OF ITEMS : <span id="lblItemCount"></span></strong>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_TaxDetail">
                        <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_TaxDetail" aria-expanded="true" aria-controls="B_TaxDetail">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Tax Detail</strong>
                        </button>
                    </h2>
                    <div id="B_TaxDetail" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_TaxDetail">
                        <div class="accordion-body">
                            <div class="progress my-3 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>

                            <partial name="_TaxNRGPDetail" />

                            <div class="progress my-3 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>

                            <div class="row g-2 gx-3 justify-content-around">
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="TotalRoundOff" class="form-label">RoundOff</label>
                                    <select class="form-select" asp-for="TotalRoundOff" asp-items="Model.YesNo">
                                        <option value="0">-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="TotalDiscountPercentage" class="form-label">Discount %</label>
                                    <input asp-for="TotalDiscountPercentage" class="form-control" value="0" min="0" max="100" />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="TotalAmtAftrDiscount" class="form-label">Amt Aftr Discount</label>
                                    <input asp-for="TotalAmtAftrDiscount" class="form-control" value="0.00" readonly disabled />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="NetTotal" class="form-label">Net Total</label>
                                    <input asp-for="NetTotal" class="form-control" readonly />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="OtherGrid">
                        <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#OtherGridDetail" aria-expanded="true" aria-controls="OtherGridDetail">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
                        </button>
                    </h2>
                    <div id="OtherGridDetail" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="OtherGrid">
                        <div class="accordion-body">
                            <div class="progress my-2 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="row g-2 gx-3" id="_ItemGrid">
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="VendorStateCode" class="form-label">Vendor State Code</label>
                                    <input asp-for="VendorStateCode " class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="Uid" class="form-label">UID</label>
                                    <input asp-for="Uid" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="ActualEnteredEmpByName" class="form-label">Actual Entered By</label>
                                    <input asp-for="ActualEnteredEmpByName" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="ActualEntryDate" class="form-label">Actual Entered Date</label>
                                    <input asp-for="ActualEntryDate " class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="UpdatedByEmpName" class="form-label">Updated By</label>
                                    <input asp-for="UpdatedByEmpName" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="UpdatedDate" class="form-label">UpdatedBy Date</label>
                                    <input asp-for="UpdatedDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="MachineName" class="form-label">Machine Name</label>
                                    <input asp-for="MachineName" class="form-control" value="@Environment.MachineName" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="PurchaseBillNo" class="form-label">Purchase Bill No</label>
                                    <input asp-for="PurchaseBillNo" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="PurchaseBillDate" class="form-label">Purchase Bill Date</label>
                                    <input asp-for="PurchaseBillDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="PurchaseBillYearCode" class="form-label">Purchase Bill YearCode</label>
                                    <input asp-for="PurchaseBillYearCode" class="form-control" readonly />
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="card-footer card-headerBG text-light bg-gradient">
                <div class="row justify-content-between g-2">
                    <h5>
                        <strong>Issue NonReturnable Challan - @Model.YearCode</strong>
                        <span class="d-flex float-end" style="margin-top:-2px;">
                            @if (Model.Mode == "U" || Model.Mode == "V")
                            {
                                <a type="button" class="btn btn-sm btn-outline-light bg-gradient me-2" asp-action="PrintReport" asp-controller="NRGP" asp-route-EntryId="@Model.EntryId" asp-route-YearCode="@Model.YearCode">
                                    <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                    PRINT
                                </a>
                                <a type="button" class="btn btn-sm btn-outline-light bg-gradient me-2" asp-action="PrintReport" asp-controller="NRGP" asp-route-EntryId="@Model.EntryId" asp-route-YearCode="@Model.YearCode">
                                    <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                    PRINT E-Way Bill
                                </a>
                            }
                            <a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient DashBoard">
                                <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                                Dashboard
                            </a>
                            <partial name="_FormsButton" />
                        </span>
                    </h5>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        $('#submitBTN').click(function (e) {
            e.preventDefault();

            if (!ValidateSubmit()) return;
            var CheckTaxFileds = false;
            var TaxRow = $('#divTaxGrid tr').length;
            if ($('#divTaxGrid tr td').length > 1) {
                for (var i = 1; i <= TaxRow; i++) {
                    if ($('#txGridType-' + i).text() == '' || $('#txGridName-' + i).text() == '') {
                        CheckTaxFileds = true;
                        break;
                    }
                }
            }
            //ValidateSubmit();
            if ($('#divIssueNRGPGrid tr td').length <= 1) {
                $.notify('IssueNRGP Grid Should Have Atleast 1 Item...!', "error");
            }
            else if (CheckTaxFileds) {
                $.notify('Please Fill Tax Fields Property!', "error");
            }
            else {
                $("form").submit();
            }
        });

        $('#UpdateButton').click(function (e) {
            e.preventDefault();
            if (!ValidateSubmit()) return;
            var CheckTaxFileds = false;
            var TaxRow = $('#divTaxGrid tr').length;
            for (var i = 1; i <= TaxRow; i++) {
                if ($('#txGridType-' + i).text() == '' || $('#txGridName-' + i).text() == '') {
                    CheckTaxFileds = true;
                    break;
                }
            }


            if ($('#divIssueNRGPGrid tr td').length <= 1) {
                $.notify('IssueNRGP Grid Should Have Atleast 1 Item...!', "error");
            }
            //else if (CheckTaxFileds) {
            //    $.notify('Please Fill Tax Fields Property!', "error");
            //}
            else {

                $('#Mode').val("U");
                $("form").submit();
            }

        });

        function ValidateSubmit() {

            if ($('#AccountCode').val() == '' || $('#AccountCode').val() == null) {
                $.notify('Please Select Vendor Name...!', "error");
                return false;
            }

            if ($('#ChallanType').val() == '0' || $('#ChallanType').val() == null) {
                $.notify('Please Select Challan Type...!', "error");
                return false;
            }

            if ($('#RGPNRGP').val() == '' || $('#RGPNRGP').val() == null) {
                $.notify('Please Select RGP/NRGP...!', "error");
                return false;
            }

            if ($('#RemovalTime').val() == '' || $('#RemovalTime').val() == null) {
                $.notify('Please Select Removal Time...!', "error");
                return false;
            }

            if ($('#VehicleNo').val() != '') {
                var inputValue = $('#VehicleNo').val();
                if (inputValue.length > 10) {
                    $('#VehicleNo').val(inputValue.substring(0, 10));
                } else if (inputValue.length < 10) {
                    $.notify("Please enter at least 10 characters in Vehicle No", "error");
                    return false;
                }
            }

            return true;
        }


        function GetFormRights() {
            $.ajax({
                url: "@Url.Action("GetFormRights")",
                type: "POST",
                success: function (data) {
                    if (data != null) {
                        var obj = $.parseJSON(data);
                        console.log(obj);
                        var optAll = obj.Result.Table[0].OptAll;
                        var optSave = obj.Result.Table[0].OptSave;
                        var optUpdate = obj.Result.Table[0].OptUpdate;
                        var optDelete = obj.Result.Table[0].OptDelete;
                        var optView = obj.Result.Table[0].OptView;
                        if (!optAll) {
                            if (!optSave) {
                                $("#submitBTN").prop("disabled", true);
                            }
                            if (!(optUpdate || optDelete || optView)) {
                                $(".DashBoard")
                                    .addClass("disabled-link")
                                    .on("click", function (e) {
                                        e.preventDefault(); // Prevents clicking the link
                                    });
                            }
                        }
                    }
                },
                error: function (errMsg) {
                    $.notify(errMsg, { position: "top center", className: "error" });
                }
            });
        }

        async function ApplyIssueNRGPTax2All() {
            var TxPageName = $('title').text();
            var TxPageData;
            if (TxPageName.indexOf('Issue NonRetuanable') == 0) {
                TxPageData = 'IssueNRGP';
            }

            if ($('#TxType').val() == "TAX") {
                if (ValidateTaxDetail() == 1) return;
                var TaxData = {
                    "TxType": $('#TxType').val(),
                    "TxItemCode": $('#TxItemCode').val(),
                    "TxItemName": $('#TxItemCode option:selected').text(),
                    "TxPartCode": $('#TxPartCode').val(),
                    "TxPartName": $('#TxPartCode option:selected').text(),
                    "TxTaxType": $('#TxTaxType').val(),
                    "TxTaxTypeName": $('#TxTaxType option:selected').text(),
                    "TxAccountCode": $('#TxAccountCode').val(),
                    "TxAccountName": $('#TxAccountCode option:selected').text(),
                    "TxPercentg": parseFloat($('#TxPercentg').val().trim()),
                    "TxAdInTxable": $('#TxAdInTxable').val(),
                    "TxRoundOff": $('#TxRoundOff').val(),
                    "TxAmount": parseFloat($('#TxAmount').val().trim()),
                    "TxRefundable": $('#TxRefundable').val(),
                    "TxOnExp": parseInt($('#TxOnExp').val().trim()),
                    "TxRemark": $('#TxRemark').val(),
                    "TxPageName": TxPageData
                }

                $.ajax({
                    url: "@Url.Action("ApplyIssueNRGPTax2All", "Tax")",
                    type: "POST",
                    data: { TxModel: TaxData },
                    success: function (data, status, xhr) {

                        if (data.trim() != "") {
                            $('#divTaxGrid').html(data);
                            var taxRowCount = $('#divTaxGrid tr').length;
                            var txSum = 0;
                            if ($('#divTaxGrid tr td').length > 1) {
                                for (var i = 1; i <= taxRowCount; i++) {
                                    txSum += parseInt($('#txGridAmount-' + i).text() == '.00' ? 0 : $('#txGridAmount-' + i).text());

                                }
                            }
                            //$('#TotalTaxAmt').val(txSum);
                            //var INA = parseFloat($('#ItemNetAmount').val());
                            //var TTA = parseFloat($('#TotalTaxAmt').val());
                            //var NT = INA + TTA;
                            //$('#NetTotal').val(NT.toFixed(2));
                            TotalNetAmount();
                        }
                        if ($('title').text().indexOf('Job Work') == 0) {
                            GetAmtAfterDiscount();
                        }
                    },
                    error: function (error, status, xhr) {
                        if (error.status == 400) {
                            $.notify(status + " : " + error.status + " : Cannot Add Duplicate Tax, if Same Tax Exists...!", { position: "top center", className: "error" });
                        }
                        else {
                            $.notify(error, { position: "top center", className: "error" });
                        }
                    }
                });
            }
        }

        $('#TxType').change(function () {
            if ($('#TxType').val() == 'EXPENSES') {
                $('#TxAmount').prop("readonly", false);
            } else {
                $('#TxAmount').prop("readonly", true);
            }
        });


        function AddIssueTaxDtail() {

            var TxPageName = $('title').text();
            var TxPageData;
            if (TxPageName.indexOf('Issue NonRetuanable') == 0) {
                TxPageData = 'IssueNRGP';
            }

            var TaxData = {
                "TxType": $('#TxType').val(),
                "TxItemCode": $('#TxItemCode').val(),
                "TxItemName": $('#TxItemCode option:selected').text(),
                "TxPartCode": $('#TxPartCode').val(),
                "TxPartName": $('#TxPartCode option:selected').text(),
                "TxTaxType": $('#TxTaxType').val(),
                "TxTaxTypeName": $('#TxTaxType option:selected').text(),
                "TxAccountCode": $('#TxAccountCode').val(),
                "TxAccountName": $('#TxAccountCode option:selected').text(),
                "TxPercentg": parseFloat($('#TxPercentg').val().trim()),
                "TxAdInTxable": $('#TxAdInTxable').val(),
                "TxRoundOff": $('#TxRoundOff').val(),
                "TxAmount": parseFloat($('#TxAmount').val().trim()),
                "TxRefundable": $('#TxRefundable').val(),
                "TxOnExp": parseInt($('#TxOnExp').val().trim()),
                "TxRemark": $('#TxRemark').val(),
                "TxPageName": TxPageData
            }

            $.ajax({
                type: "POST",
                url: '/Tax/AddNRGPTaxDetail',
                data: TaxData,
                success: function (resp, status, error) {

                    if (resp.trim() == "") {
                        $.notify('Adding Duplicate Tax Is Not Allowed...!', "info");
                    }
                    else {

                        $('#divTaxGrid').html(resp);
                        var taxRowCount = $('#divTaxGrid tr').length;
                        var txSum = 0;
                        if ($('#divTaxGrid tr td').length > 1) {
                            for (var i = 1; i <= taxRowCount; i++) {
                                txSum += parseInt($('#txGridAmount-' + i).text() == '.00' ? 0 : $('#txGridAmount-' + i).text());
                            }
                        }

                        $('#TotalTaxAmt').val(txSum);
                        var INA = parseFloat($('#ItemNetAmount').val());
                        var TTA = parseFloat($('#TotalTaxAmt').val());
                        var NT = INA + TTA;
                        $('#NetTotal').val(NT.toFixed(2));
                        $('#TxType').prop('selectedIndex', 0).change();

                    }

                    ClearTax();
                    /*}*/
                },
                error: function (error, status, xhr) {
                    if (error.status == 400) {
                        $.notify(status + " : " + error.status + " : Cannot Add Expenses with Add In Taxable='Y', if Tax Exists.", { position: "top center", className: "error" });
                    }
                    else if (error.status == 501) {
                        $.notify(status + " : " + error.status + " : " + error.responseText, { position: "top center", className: "error" });
                    }
                    else {
                        $.notify(error, { position: "top center", className: "error" });
                    }
                }
            });

        }
        function ClearTaxGrid() {
            var SN = $('title').text();
            //SN = SN.indexOf('Sale Order') === 0 ? 'ItemList' : 'PurchaseOrder';

            var TxPageData;
            if (SN.indexOf('Issue NonRetuanable') == 0) {
                SN = 'IssueNRGP';
            }

            ClearTax();
            $.ajax({
                url: '/Tax/ClearTax',
                type: "GET",
                data: { 'SN': SN },
                datatype: "json",
                success: function (data, status, xhr) {

                    if (data.trim() != "") {
                        $('#divTaxGrid').html(data);
                        //var INA = parseFloat($('#ItemNetAmount').val());
                        //var TTA = parseFloat($('#TotalTaxAmt').val());
                        //TTA = TTA = "NAN" ? 0.00 : TTA;
                        //var NT = INA + TTA;
                        //$('#NetTotal').val(NT.toFixed(2));
                        TotalNetAmount();

                    }
                    if ($('title').text().indexOf('Job Work') == 0) {

                        GetAmtAfterDiscount();
                    }

                }
            }).done(function (data) {
                console.log(data);
            }).fail(function (data) {
                console.log(data);
            }).always(function (data) {
                console.log(data);
            });
        }

        function copyToClipboardForDropdown(element) {
            var $temp = $("<input>");
            $("body").append($temp);
            $temp.val($(element).find(":selected").text()).select();
            document.execCommand("copy");
            $temp.remove();
        }

        $(document).ready(function () {
            GetFormRights();
            $('#ItemCode').select2();
            $('#PartCode').select2();
            $('#AccountCode').select2();
            FillVendorList();
            $('.AF').fadeOut();


            // var finFromDate = $('#FinFromDate').val();
            // var finToDate = $('#FinToDate').val();
            // var dateParts1 = finFromDate.split("/");
            var monthNames = {
                "Jan": "01",
                "Feb": "02",
                "Mar": "03",
                "Apr": "04",
                "May": "05",
                "Jun": "06",
                "Jul": "07",
                "Aug": "08",
                "Sep": "09",
                "Oct": "10",
                "Nov": "11",
                "Dec": "12"
            };


            // var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
            // var dateParts2 = finToDate.split("/");

            // var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];


            // $('#EntryDate,#ChallanDate').datepicker("option", "minDate", formattedDate1);
            // $('#EntryDate,#ChallanDate').datepicker("option", "maxDate", formattedDate2);

            if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {

                //$('#cardEditHide').hide();
                $('#AC1').prop("checked", true);
                //$('#AC1').trigger("change");
                //fillAccount();
                SetminQty();

                var selectElement = $("#AccountCode");
                var desiredValue = parseInt($('#hiddenAccountCode').val());
                $("#AccountCode").find("option[value='" + desiredValue + "']").prop("selected", true).trigger("change");
                //$('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#EntryDate').val().split(" ")[0]));
                //$('#ActualEntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat($('#ActualEntryDate').val().split(" ")[0]));
                $('#RGPNRGP').val($('#hiddenRGPNRGP').val());
                var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ")[0]);
                 var ChallanDt = parseDateToFormat($('#ChallanDate').val().split(" ")[0]);
                $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", EntryDate);
                 $('#ChallanDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", ChallanDt);
                $('#ChallanNo').val($('#hiddenChallanNo').val());
                var rowCount = $('#divIssueNRGPGrid tr').length;
                for (var i = 1; i <= rowCount; i++) {
                    var itemCodee = parseInt($('#GridIC-' + i).val());
                    var batchNoo = $('#GridBatchNo-' + i).text();
                    var uniquebatchnoo = $('#GridUniqueBatchNo-' + i).text();
                    var Seqno = $('#SeqNo-' + i).val();
                    itemBatchArray.push({
                        "SeqNo": parseInt(Seqno),
                        "itemcode": itemCodee,
                        "batchno": batchNoo,
                        "uniquebatchno": uniquebatchnoo
                    });
                }

                fillAccount();

            }
            else
            {

               // FillEntryandChallanNo("NRGP");


                GetServerDate();
               // alert("after GetServerDate");

                // var finFromDate = $('#FinFromDate').val();
                // var finToDate = $('#FinToDate').val();

                // var dateParts1 = finFromDate.split("/");
                // var monthNames = {
                //     "Jan": "01",
                //     "Feb": "02",
                //     "Mar": "03",
                //     "Apr": "04",
                //     "May": "05",
                //     "Jun": "06",
                //     "Jul": "07",
                //     "Aug": "08",
                //     "Sep": "09",
                //     "Oct": "10",
                //     "Nov": "11",
                //     "Dec": "12"
                // };

                // var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
                // var dateParts2 = finToDate.split("/");

                // var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];


                // $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                // $('#ChallanDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                // $('#ChallanDate').datepicker("option", "maxDate", 'now');

            }


            //FillChallanType();

            FillCurrentBatchINStore();
            //alert("after FillCurrentBatchINStore");

            GetTxPartItem();
                  //           alert("after GetTxPartItem");
            FillLoadItems();
           // alert("after FillLoadItems");
            //GetFormRights();
            BasicTotal();
             //alert("after BasicTotal");
           var CurrentTime = new Date();
            var Hours = CurrentTime.getHours();
            var Mins = CurrentTime.getMinutes();
            var Seconds = CurrentTime.getSeconds();
            var FormattedTime = Hours + ':' + Mins + ':' + Seconds;
            $('#EntryTime').val(FormattedTime);
            $('#RemovalTime').val(FormattedTime);


            //$('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
            //$('#ActualEntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

            //$('#EntryDate').datepicker("option", "minDate", formattedDate1);
            //$('#EntryDate').datepicker("option", "maxDate", formattedDate2);

            $('#ChallanType').rules("remove", "required");
            $('#RemovalTime').rules("remove", "required");
            $('#Rate').rules("remove", "required");
            $('#Amount').rules("remove", "required");
            //$('#GSTType').rules("remove", "required");
            //$('#DeliveryAddress').rules("remove", "required");
            $('#Storeid').rules("remove", "required");
            $('#BatchNo').rules("remove", "required");
            $('#ProcessId').rules("remove", "required");
            $('#unit').rules("remove", "required");
            $('#AltUnit').rules("remove", "required");
            $('#Remark').rules("remove", "required");
            $('#TxRemark').rules("remove", "required");
            $('#VendorStateCode').rules("remove", "required");
            $('#UpdatedByEmpName').rules("remove", "required");
            $('#UpdatedDate').rules("remove", "required");
            $('#PurchaseBillNo').rules("remove", "required");
            $('#PurchaseBillDate').rules("remove", "required");
            $('#ActualEnteredEmpByName').rules("remove", "required");
            $('#uniquebatchno').rules("remove", "required");
            $('#VehicleNo').rules("remove", "required");
            $('#Transporter').rules("remove", "required");
            $('#GSTType').rules("remove", "required");
            $('#PartCode').rules("remove", "required");
            $('#RemarkDetail').rules("remove", "required");
            $('#Purpose').rules("remove", "required");
            $('#PONO').rules("remove", "required");
            $('#POYearCode').rules("remove", "required");
            $('#POAmendementNo').rules("remove", "required");
            $('#AgainstChallanEntryId').rules("remove", "required");
            $('#AgainstChallanNo').rules("remove", "required");
            $('#Closed').rules("remove", "required");
            $('#ItemColor').rules("remove", "required");
            $('#ItemModel').rules("remove", "required");
            $('#ItemSize').rules("remove", "required");
            $('#AgainstChallanYearCode').rules("remove", "required");
            $('#AgainstChallanType').rules("remove", "required");
            $('#PODate').rules("remove", "required");
            //  GetDefaultBranch();

            GetAllowBackDate();
            //  alert("after GetAllowBackDate");
            FillProcessList();
            // alert("after FillProcessList");
            FillStoreList();
          //        alert("after FillStoreList");
            $('#BatchNo').css('background-color', 'rgb(248 255 178)');

            $('#ChallanDate').css('color', 'rgb(248 255 178)');
            $('#EntryDate').css('color', 'rgb(248 255 178)');
            //var now = new Date();
            //$('#Processdays').val(30);
            //$('#YearCode').val(new Date().getFullYear());
            // $('#timeofremoval').val(now.getHours() + ":" + now.getMinutes() + ":" + now.getSeconds());
            //var today = new (Date);
            //$('#ChallanDate,#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
            //$("#ChallanDate").datepicker("option", "maxDate", formatDate(today));
        });


        document.addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
            }
        });

        function GetItemRate() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetItemRate")",
                data: { ItemCode: $('#ItemCode').val(), TillDate: $('#ChallanDate').val(), YearCode: $('#YearCode').val(), BatchNo: $('#BatchNo').val(), UniqueBatchNo: $('#uniquebatchno').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    debugger
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.Result[0] == undefined) {
                            $('#Rate').prop("readonly", false);
                        }
                        else {
                            $('#Rate').val(obj.Result[0].Rate);

                            if (parseInt(obj.Result[0].Rate) == 0) {
                                $('#Rate').prop("readonly", false);
                            }
                        }

                    }
                }
            });
        }

        function FillVendorList() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetVendorList")",
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#AccountCode').empty();
                        $('#AccountCode').append('<option value="0">-Select-</option>');
                        $.each(obj.Result, function (key, val) {
                            $('#AccountCode').append('<option value="' + val.Account_Code + '">' + val.Account_Name + '</option>');
                        });

                        if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                            $('#AccountCode').val($('#hiddenAccountCode').val());
                        }
                    }
                }
            });
        }

        function FillProcessList() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetProcessList")",
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#ProcessId').empty();
                        $('#ProcessId').append('<option value="0">-Select-</option>');
                        $.each(obj.Result, function (key, val) {
                            $('#ProcessId').append('<option value="' + val.EntryID + '">' + val.StageDescription + '</option>');
                        });
                    }
                }
            });
        }

        function FillStoreList() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetStoreList")",
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#Storeid').empty();
                        $('#Storeid').append('<option value="0">-Select-</option>');
                        $.each(obj.Result, function (key, val) {
                            $('#Storeid').append('<option value="' + val.entryid + '">' + val.store_name + '</option>');
                        });
                    }
                }
            });
        }

        function GetServerDate() {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetServerDate", "SaleOrder")",
                async: false,
                success: function (result, status, error) {
                    $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);
                    $('#ActualEntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", result);
                }
            });
        }

        var currentSearchColumn = null;

        $("#search-box").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#divIssueNRGPGrid tr").filter(function () {
                if (currentSearchColumn !== null) {
                    var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
                    $(this).toggle(columnText.indexOf(value) > -1);
                } else {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                }
            });
        });


        $(document).on("click", "th[data-columnno]", function () {

            currentSearchColumn = $(this).data('columnno');
            $("#search-box").val('').trigger('keyup');
        });

        $(document).on("click", ".sortCol", function () {
            var $column = $(this).parent().closest("th");
            var colno = $(this).data('columnno');
            var currentOrder = $(this).data('sortorder');

            $('.sortCol').css('color', 'white');

            if (currentOrder === 'asc') {
                sortTable(colno, false);
                $(this).data('sortorder', 'desc');
                $(this).css('color', 'yellow');
                //$(this).css('font-size', 'larger');
                $(this).find('i:first').removeClass('fa-arrow-up');
                $(this).find('i:first').addClass('fa-arrow-down');
            } else {
                sortTable(colno, true);
                $(this).data('sortorder', 'asc');
                $(this).css('color', 'yellow');
                // $(this).css('font-size', 'larger');
                $(this).find('i:first').removeClass('fa-arrow-down');
                $(this).find('i:first').addClass('fa-arrow-up');
            }
        });

        function sortTable(columnIndex, ascending) {

            var table = $('.IssueNRGPTb');
            var rows = table.find('#divIssueNRGPGrid > tr').toArray();

            rows.sort(function (a, b) {
                var aValue = $(a).find('td').eq(columnIndex).text().trim();
                var bValue = $(b).find('td').eq(columnIndex).text().trim();

                var aIntValue = 0;
                var bIntValue = 0;
                if (/^\d+$/.test(aValue) && /^\d+$/.test(bValue)) {
                    aIntValue = parseInt(aValue, 10);
                    bIntValue = parseInt(bValue, 10);
                }

                if (aIntValue > 0) {
                    if (ascending) {
                        return aValue - bValue;
                    } else {
                        return bValue - aValue;
                    }
                } else {
                    if (ascending) {
                        return aValue.localeCompare(bValue);
                    } else {
                        return bValue.localeCompare(aValue);
                    }
                }
            });

            $.each(rows, function (index, row) {
                table.children('#divIssueNRGPGrid').append(row);
            });
        }

        $('.Display').click(function () {
            showAllControls();
        });

        $('#VehicleNo').on('input', function () {
            var inputValue = $(this).val();
            //var regex = /^[a-zA-Z0-9]{10}$/;
            if (inputValue.length > 10) {
                $(this).val(inputValue.substring(0, 10));
            }
        });


        $('#VehicleNo').on('change', function () {
            var inputValue = $(this).val();
            //var regex = /^[a-zA-Z0-9]{10}$/;
            if (inputValue.length < 10) {
                $.notify("Please enter at least 10 characters in Vehicle No", "error");
            }
        });


        //$("#Qty").on("keydown", function (event) {
        //
        //    if ((event.key === '.' && $(this).val().indexOf('.') === -1) || (event.key < '0' || event.key > '9')) {
        //        event.preventDefault();
        //    }
        //});

        //$("#Qty").on("keypress", function (e) {
        //
        //    var key = e.which;
        //    if ((key < 48 || key > 57) && key !== 8 && key !== 9 && key !== 13 && key !== 46) {
        //        e.preventDefault();
        //    }

        //    if (key === 46 && $(this).val().indexOf('.') !== -1) {
        //        e.preventDefault();
        //    }
        //});


        function TotalNetAmount() {

            var rowCount = $('#divIssueNRGPGrid tr').length;
            var taxRowCount = $('#divTaxGrid tr').length;
            var sum = 0.00;
            for (var i = 1; i <= rowCount; i++) {

                sum += parseFloat($('#GridAmount-' + i).text() == '.00' ? 0 : $('#GridAmount-' + i).text());
            }

            var txSum = 0.00;
            if ($('#divTaxGrid tr td').length > 1) {
                for (var i = 1; i <= taxRowCount; i++) {
                    txSum += parseFloat($('#txGridAmount-' + i).text() == '.00' ? 0 : $('#txGridAmount-' + i).text());
                }
            }
            var txTotal = sum + txSum;
            $('#NetTotal').val(txTotal.toFixed(2));
            $('#TotalDiscountPercentage').val(0);
            $('#TotalAmtAftrDiscount').val(0);
            $('#ItemNetAmount').val(sum);
        }

        //$('#TotalRoundOff').change(function(){
        //
        //    var RoundOff = $('#TotalRoundOff').val();
        //    var NetTotal = $('#NetTotal').val();
        //    if(RoundOff == 'Y'){
        //        $('#NetTotal').val(Math.round(parseFloat(NetTotal)));
        //    }
        //    else{
        //        $('#NetTotal').val(NetTotal);
        //    }
        //});

        $("#Qty").on("input", function (e) {
            var inputValue = $(this).val();

            inputValue = inputValue.replace(/[^0-9.]/g, '');

            var dotCount = inputValue.split('.').length - 1;
            if (dotCount > 1) {
                inputValue = inputValue.slice(0, -1);
            }
            $(this).val(inputValue);
        });

        $("#Rate").on("input", function (e) {
            var inputValue = $(this).val();

            inputValue = inputValue.replace(/[^0-9.]/g, '');

            var dotCount = inputValue.split('.').length - 1;
            if (dotCount > 1) {
                inputValue = inputValue.slice(0, -1);
            }
            $(this).val(inputValue);
        });


        //$("#Rate").on("keypress", function (e) {
        //    var key = e.which;

        //    if ((key < 48 || key > 57) && key !== 8 && key !== 9 && key !== 13) {
        //        e.preventDefault();
        //    }
        //});

        //$("#Rate").on("keydown", function (event) {
        //    if (event.key.toLowerCase() === 'e' || event.key === '-') {
        //        event.preventDefault();
        //    }
        //});



        function FillCurrentBatchINStore() {
            var ItemCode = $('#ItemCode').val();
            var YearCode = $('#YearCode').val();
            var StoreName = $('#Storeid').find(':selected').text();
            var batchno = "";
            if ($('#BatchNo').prop('selectedIndex') != 0) {
                batchno = $('#BatchNo').val();
            }
            $.ajax({
                type: "GET",
                data: { "ItemCode": ItemCode, "YearCode": YearCode, "StoreName": StoreName, "batchno": batchno },
                url: "@Url.Action("FillCurrentBatchINStore")",
                dataType: "json",
                success: function (result, status, error) {
                    $('#Qty').val(0);
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#BatchNo').empty();
                            $('#BatchNo').append('<option value="0" disabled selected>-Select-</option>');
                            //$('#uniquebatchno').empty();
                            //$('#uniquebatchno').append('<option value="" disabled selected>-Select-</option>');

                            var seenValues = {};
                            $.each(obj.Result, function (index, val) {
                                if (!seenValues[val.batchno]) {
                                    seenValues[val.batchno] = true;
                                    $('#BatchNo').append('<option value="' + val.batchno + '">' + val.batchno + '</option>');
                                }
                                // $('#uniquebatchno').append('<option value="' + val.UniqueBatchNo + '">' + val.UniqueBatchNo + '</option>');
                            });
                            GetBatchInventory();

                            var selectListLength = $('#BatchNo option').length - 1;
                            // var selectList
                            var itemArrayLength = itemBatchArray.length;
                            if (itemArrayLength > 0) {
                                var itemsWithCode16 = itemBatchArray.filter(function (item) {
                                    return item.itemcode === parseInt(ItemCode);
                                });
                                var selectList = $('#BatchNo');
                                selectList.find('option').each(function () {
                                    var optionValue = $(this).val();
                                    var existsInItemsWithCode16 = itemsWithCode16.some(function (item) {
                                        return item.batchno === optionValue;
                                    });

                                    if (existsInItemsWithCode16) {
                                        $(this).remove();
                                    }
                                });
                                //}
                                //if (itemBatchArray.length > 0) {
                                //    $('#BatchNo option[value="' + itemBatchArray[0].batchno + '"]').remove();
                                //    $('#uniquebatchno option[value="' + itemBatchArray[0].uniquebatchno + '"]').remove();
                                //}
                            }
                        } else {
                            $('#BatchNo').empty();
                            $('#BatchNo').append('<option value="0" disabled selected>-Select-</option>');
                            $('#uniquebatchno').empty();
                            $('#uniquebatchno').append('<option value="0" disabled selected>-Select-</option>');
                        }

                    }
                }
            });
        }

        $('#BatchNo').change(function () {
            $('#Qty').val(0);
        });


        var MinQtyVal = 0;
        var LowestStock = "";
        function SetminQty() {

            var TotalStock = parseFloat($('#TotalStock').val());
            var LotStock = parseFloat($('#BatchStock').val());
            var MinValue = 0;
            MinValue = Math.min(TotalStock, LotStock);
            MinQtyVal = MinValue ;

            if (TotalStock > LotStock) {
                LowestStock = "LotStock";
            } else {
                LowestStock = "TotalStock";
            }

            if (parseFloat($('#Qty').val()) > MinQtyVal) {
                AddErrorCls('Qty');
                Err = 1;
                if (LowestStock == "LotStock") {
                    $.notify("Can not add Qty more then Lot Stock", "error");
                } else {
                    $.notify("Can not add Qty more then Total Stock", "error");
                }
            }
            else {
                RemoveErrorCls('Qty');
            }
        }

        function GetAllItems() {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetAllItems")",
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {

                        } else {

                        }

                    }
                }
            });
        }

        $('#RGPNRGP').change(function () {
            FillChallanType();
            FillEntryandChallanNo($('#RGPNRGP').val());
        });

        function FillChallanType() {
            var RGPNRGP = $('#RGPNRGP').val();
            $.ajax({
                type: "GET",
                url: "@Url.Action("FillChallanType")",
                data: { "RGPNRGP": RGPNRGP },
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {

                            $('#ChallanType').empty();
                            // $('#ChallanType').append('<option value="">-Select-</option>');
                            $(obj.Result).each(function (index, val)
                            {
                                $('#ChallanType').append('<option value="' + val.ChallanType + '">' + val.ChallanType + '</option>');
                            });
                        } else {

                        }
                        if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                            //  $('ChallanType').val($('#hiddenChallanType').val().trim());
                            var ChallanVal = $('#hiddenChallanType').val().trim();
                            //$('#ChallanType').val(ChallanVal);
                        }
                    }
                }
            });
        }

        function StockableItems(ItemCode) {
            //var ItemCode = $('#ItemCode').val();
            $.ajax({
                type: "GET",
                url: "@Url.Action("StockableItems")",
                data: { "ItemCode": ItemCode },
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#hiddenItemStockable').val(obj.Result[0].Stockable);
                        } else {

                        }
                    }
                }
            });
        }

        function FillEntryandChallanNo(RGPNRGP) {
              var yearCode = @Model.YearCode;
               var RGPNRGP =   RGPNRGP;
              //var yearCode = @Model.YearCode;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FillEntryandChallanNo")",
                // data: { "YearCode": $('#YearCode').val(), "RGPNRGP": $('#RGPNRGP').val() },
                data: { "YearCode": yearCode, "RGPNRGP": RGPNRGP },
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        var modeValue = $('#Mode').val(); // Get the value of Mode
                        var entryId = obj.Result[0].EntryId;

                        // Show EntryId in an alert box
                       /*  alert("EntryId: " + entryId); */

                        // if ($('#Mode').val() != "U" && $('#Mode').val() != "V") {
                      /* alert("condition in or up"+ ($('#Mode').val() != "U" && $('#Mode').val() != "V")); */
                        if ($('#Mode').val() == undefined || ($('#Mode').val() != "U" && $('#Mode').val() != "V"))
                        {

                            $('#EntryId').val(obj.Result[0].EntryId);
                        }
                         $('#EntryId').val(obj.Result[0].EntryId);
                        $('#ChallanNo').val(obj.Result[0].ChallanNo);
                    }
                }
            });
        }

        function CheckItems() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("CheckItems")",
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        var ItemName = $('#ItemCode').val();
                        var PartCode = $('#PartCode').val();
                        $('#PartCode').data('ServeAsstes', 'Items');
                        for (var i = 0; i < obj.Result.length; i++) {
                            if (PartCode == obj.Result[i].Item_Code) {
                                $('#PartCode').data('ServeAsstes', 'NotItems');
                            }
                        }
                    }
                }
            });
        }

        var QtyVal = 0;
        var AltQtyVal = 0;

        function GetPrevQty() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetPrevQty")",
                data: { "EntryId": $('#EntryId').val(), "YearCode": $('#YearCode').val(), "ItemCode": $('#ItemCode').val(), "uniqueBatchno": $('#uniquebatchno').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        QtyVal = obj.Result[0].qty;
                        AltQtyVal = obj.Result[0].AltQty;
                    }
                }
            });
        }


        function GetBatchInventory() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetBatchInventory")",
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        //$('#EntryId').val(obj.Result[0].EntryId);
                        if (obj.Result[0].FIFOBasedBatchInventory == 'Y') {
                            $("#BatchNo option:not(:eq(1))").prop("disabled", true);
                            $('#BatchNo').css('background-color', 'rgb(248 255 178)');
                        }
                    }
                }
            });
        }

        function GetAllowBackDate() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetAllowBackDate")",
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.Result[0].AllowBackDateIssueChallan == 'Y') {
                            $("#EntryDate").prop("disabled", false);
                            $("#ChallanDate").prop("disabled", false);
                            $("#EntryDate").prop("readonly", false).css("color", "black");
                            $("#ChallanDate").prop("readonly", false).css("color", "black");;
                            $('#ChallanDate').css('background-color', 'rgb(248 255 178)');
                            $('#EntryDate').css('background-color', 'rgb(248 255 178)');

                        }
                    }
                }
            });
        }


        function GetDefaultBranch() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetDefaultBranch")",
                dataType: "json",
                success: function (result, status, error) {
                    const selectElement = document.getElementById("CC"); // replace "mySelect" with the ID of your select element
                    const desiredValue = result; // replace with the value of the option you want to select

                    for (let i = 0; i < selectElement.options.length; i++) {
                        if (selectElement.options[i].value === desiredValue) {
                            selectElement.selectedIndex = i;
                            selectElement.options[i].selected = true;
                            break;
                        }
                    }
                }
            });
        }

        function showAllControls() {
            $('#TableGrid>thead>tr').append("<th>PONO</th><th>PO Year</th><th>PO Date</th><th>Sch No</th><th>Sch Date</th><th>Sch Year</th><th>PO Amend No</th><th>Against Adavice No</th><th>Against Adavice Year</th><th>Against Adavice Date</th><th>Item Color</th><th>Item Size</th>");
            $('#PONO,#POYear,#PODate,#SchNo,#SchYear,#SchDate,#POAmendementNo,#AgainstAdaviceNo,#AgainstAdaviceYear,#AgainstAdaviceDate,#ItemColor,#ItemSize').css('display', 'block');
        }
        function formatJSONDate(jsonDate) {
            var newDate = new Date(jsonDate);
            var day = newDate.getDate();
            var month = newDate.getUTCMonth() + 1;
            var year = newDate.getFullYear();
            finaldate = day + "-" + ("0" + (month)) + "-" + year
            return finaldate;
        }

        function EmptyGridFields() {
            $('select[name^="StoreId"]').val('');
            $('select[name^="BatchNo"]').val('');
            $('select[name^="UniqueBatchNo"]').val('');
            $('#StockQty').val('');
            $('#BatchStockQty').val('');
            $('#IssQty').val('');
            $('#Rate').val('');
            $('#Amount').val('');
            $('select[name^="ProcessId"]').val('');
        }

        $('#SH').change(function () {

            if ($('#SH').is(':checked') == true) {
                $('.AF').fadeIn();
                GetPONOByAccount();
            }
            else {
                $('.AF :input').val('');
                $('.AF').fadeOut();
            }
        });

        $('#PONO').change(function () {

            copyToClipboardForDropdown('#PONO');
            $('#ItemName').find("[data-part-code='" + $(this).val() + "']").attr('selected', 'selected');

            //$('#POYear').find("[data-pono='" + $(this).val() + "']").css('display', 'block');
            $('#POYear').find("[data-pono='" + $(this).val() + "']");
            $('#POYearCode').append('<option value="' + $('#PONO').find(':selected').data('po-year') + '" selected>' + $('#PONO').find(':selected').data('po-year') + '</option>');
            $('#PODate').val($('#PONO').find(':selected').data('po-date').split("T")[0]);
            //$('#POYear').empty();
            //$('#POYear').append('<option disbaled selected>-Select-</option>');
            //var poYear=$('#PONO').find(":selected").data('po-year');
            //var poDate=$('#PONO').find(":selected").data('po-date');
            //$('#POYear').append('<option value="' + poYear +
            //                     '" data-po-date="' + poDate + '">' + poYear + '</option>');

        });

        function GetPONOByAccount() {

            $('#PONO,#POYear,#PODate,#SchNo,#SchYear,#AgainstAdaviceNo,#AgainstAdaviceYear,#ItemColor,#ItemSize').empty();
            $.ajax({
                url: "@Url.Action("GetPONOByAccount")",
                data: { AccountCode: $('#AccountCode').val(), PONO: $('#PONO').val(), POYear: $('#POYear').val(), ItemCode: parseInt($('#ItemCode').val()), ChallanDate: $('#ChallanDate').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#PONO,#POYearCode').empty();
                            $('#PONO,#POYearCode').append('<option disabled selected>-Select-</option>');

                            $.each(obj.Result, function (index, val) {
                                if ($("#PONO option[value='" + val.PONO + "']").length == 0) {
                                    $('#PONO').append('<option value="' + val.PONO + '" data-po-year ="' + val.YearCode + '" data-po-date="' + val.PODate + '">' + val.PONO + '</option>');
                                }

                                //$('#POYearCode').append('<option value="' + val.YearCode +
                                //    '" data-pono= "' + val.PONO +
                                //    '" data-po-date="' + val.PODate + '">' + val.YearCode + '</option>');
                            });
                        }
                    }
                }
            });
        }

        function TotalhiddenAmount() {
            var Amount = 0;
            // $('#Amount').val(Amount);
            var TotalAmt = parseFloat($('#Amount').val());
            var DisPr = parseFloat($('#discper').val());
            if (DisPr == 0) {
                $('#Amount').val(parseFloat($('#Qty').val()) * parseFloat($('#Rate').val()));
                $('#disamt').val(0.00);
            } else {
                var DisAmount = TotalAmt * DisPr / 100;
                $('#disamt').val(DisAmount.toFixed(2));
                var Netamont = TotalAmt - DisAmount;
                $('#Amount').val(Netamont.toFixed(2));
            }
        }

        function FillAgainstChallanNo() {
            $.ajax({
                url: "@Url.Action("FillAgainstChallanNo")",
                data: { "AccountCode": $('#AccountCode').val(), "ItemCode": $('#ItemCode').val(), "YearCode": $('#YearCode').val(), "ChallanDate": $('#ChallanDate').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#AgainstChallanNo').empty();
                            $('#AgainstChallanNo').append('<option disabled selected>-Select-</option>');

                            $.each(obj.Result, function (index, val) {
                                $('#AgainstChallanNo').append('<option value="' + val.ChallanNo +
                                    '">' + val.ChallanNo + '</option>');
                            });
                        }
                        else {
                            $('#AgainstChallanNo').empty();
                            $('#AgainstChallanNo').append('<option disabled selected>-Select-</option>');
                        }
                    }
                },
                error: function (req, status, error) {
                    console.log(error);
                }
            });
        }

        function FillAgainstChallanYC() {
            $.ajax({
                url: "@Url.Action("FillAgainstChallanYC")",
                data: { "AccountCode": $('#AccountCode').val(), "ItemCode": $('#ItemCode').val(), "YearCode": $('#YearCode').val(), "ChallanDate": $('#ChallanDate').val(), "AgainstChallanNo": $('#AgainstChallanNo').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#AgainstChallanYearCode').empty();
                            $('#AgainstChallanYearCode').append('<option disabled selected>-Select-</option>');

                            $.each(obj.Result, function (index, val) {
                                $('#AgainstChallanYearCode').append('<option value="' + val.YearCode + '">' + val.YearCode + '</option>');
                            });
                        }
                        else {
                            $('#AgainstChallanYearCode').empty();
                            $('#AgainstChallanYearCode').append('<option disabled selected>-Select-</option>');
                        }
                    }

                },
                error: function (req, status, error) {
                    console.log(error);
                }
            });
        }

        function FillAgainstChallanEntryId() {
            $.ajax({
                url: "@Url.Action("FillAgainstChallanEntryId")",
                data: { "AccountCode": $('#AccountCode').val(), "ItemCode": $('#ItemCode').val(), "ChallanDate": $('#ChallanDate').val(), "AgainstChallanNo": $('#AgainstChallanNo').val(), "AgainstChallanYC": $('#AgainstChallanYearCode').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#AgainstChallanEntryId').empty();
                            $('#AgainstChallanEntryId').append('<option disabled selected>-Select-</option>');
                            $('#AgainstChallanType').empty();
                            $('#AgainstChallanType').append('<option disabled selected>-Select-</option>');

                            $.each(obj.Result, function (index, val) {
                                $('#AgainstChallanEntryId').append('<option value="' + val.EntryId + '">' + val.EntryId + '</option>');
                                $('#AgainstChallanType').append('<option value="' + val.ChallanType + '">' + val.ChallanType + '</option>');
                            });
                        }
                        else {
                            $('#AgainstChallanEntryId').empty();
                            $('#AgainstChallanEntryId').append('<option disabled selected>-Select-</option>');
                            $('#AgainstChallanType').empty();
                            $('#AgainstChallanType').append('<option disabled selected>-Select-</option>');
                        }
                    }

                },
                error: function (req, status, error) {
                    console.log(error);
                }
            });
        }

        function formatInvDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [day, month, year].join('/');
        }
        $('#AgainstAdaviceNo').change(function () {
            $('#AgainstAdaviceYear').find("[data-adviseno='" + $(this).val() + "']").css('display', 'block');
        });
        $('#AgainstAdaviceYear').change(function () {
            $('#AgainstAdaviceDate').val($(this).find(':selected').data('advisedate'));
        });
        function formatPODate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [day, month, year].join('/');
        }

        $('#POYearCode').change(function () {

            //$("#PODate").val($(this).find(":selected").data('po-date'));

            var poDate = formatPODate($('#PONO').find(":selected").data('po-date'));
            $('#PODate').val(poDate);
            //$('#PODate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate",$('#PONO').find(":selected").data('po-date'));
            $.ajax({
                url: "@Url.Action("GetPONOByAccount")",
                data: { AccountCode: $('#AccountCode').val(), PONO: $('#PONO').val(), POYear: $('#POYear').val(), ItemCode: parseInt($('#ItemCode').val()), ChallanDate: $('#ChallanDate').val() },
                dataType: "json",
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#SchNo,#SchYear').empty();
                            $('#SchNo').append('<option disabled selected>-Select-</option>');
                            $('#SchYear').append('<option selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                if ($("#SchNo option[value='" + val.ScheduleNo + "']").length == 0) {
                                    $('#SchNo').append('<option value="' + val.ScheduleNo + '">' + val.ScheduleNo + '</option>');
                                }
                                $('#SchYear').append('<option value="' + val.yearcode +
                                    '" data-sch-date="' + val.ScheduleDate + '">' + val.yearcode + '</option>');
                            });
                        }
                    }
                }
            });
        });
        $('#SchNo').change(function () {
            copyToClipboardForDropdown('#SchNo');
        });
        $('#SchYear').change(function () {
            //$("#SchDate").val($(this).find(":selected").data('sch-date'));
            var schDate = formatPODate($('#SchYear').find(":selected").data('sch-date'));
            $('#SchDate').val(schDate);
            //$('#SchDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", $(this).find(":selected").data('sch-date'));
        });
        $('#Qty').keyup(function () {
            var qty = parseFloat($(this).val());
            var rate = parseFloat($('#Rate').val());
            if (rate < 0) {
                $.notify("Rate cannot be less than 0", "error");
                $('#Rate').val(0);
            }
            if (qty < 0) {
                $.notify("Qty cannot be less than 0", "error");
                $('#IssQty').val(0);
            }
            if ($('#Rate').val() == '') {
                rate = 0;
            }
            if ($('#IssQty').val() == '') {
                qty = 0;
            }
            $('#Amount').val(parseFloat(qty * rate));
            SetminQty();
            SetAltQty();
            TotalhiddenAmount();
        });
        $('#Rate').keyup(function () {
            var qty = parseFloat($('#Qty').val());
            var rate = parseFloat($(this).val());
            if ($('#Rate').val() == '') {
                rate = 0;
            }
            if (rate < 0) {
                $.notify("Rate cannot be less than 0", "error");
                $('#Rate').val(0);
            }
            if (qty < 0) {
                $.notify("Qty cannot be less than 0", "error");
                $('#IssQty').val(0);
            }
            if ($('#IssQty').val() == '') {
                qty = 0;
            }
            $('#Amount').val(parseFloat(qty * rate));
            TotalhiddenAmount();
        });

        $("#AC1").change(function () {
            fillAccount();
        });

        function fillAccount() {
            $.ajax({
                type: "POST",
                url: "@Url.Action("GetAccountList")",
                data: { Check: $('#AC1').is(':checked') == true ? 'T' : 'F' },
                async: false,
                dataType: "json",
                success: function (data, status, error) {

                    $('#AccountCode').empty();
                    $('#AccountCode').append('<option disabled selected> -Select - </option>');
                    $.each(data, function (key, val) {
                        $('#AccountCode').append('<option value = "' + val.value + '"> ' + val.text + ' </option>');
                        $('#Address').val(''), $('#DeliveryAddress').val('');
                    });
                    if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                        $('#AccountCode').val($('#hiddenAccountCode').val());
                        $('#DeliveryAddress').val($('#hiddenDA').val());
                    }
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        }

        $('#AccountCode').change(function () {
            copyToClipboardForDropdown(this);

            if($('#Mode').val()=="U" || $('#Mode').val()=="V"){

            }else{
            ClearTaxGrid();
            }
            if ($('#ChangeEventTriggered').val() != "Y") {

                //$.ajax({
                //    type: "POST",
                //    url: "@Url.Action("ClearTaxGrid")",
                //    data: { AccountCode: $('#AccountCode').val() },
                //    dataType: "json",
                //    success: function (result, status, error) {
                //        $('#divTaxGrid').empty();
                //    },
                //    error: function (req, status, error) {
                //        alert(error);
                //    }
                //})
                GetPONOByAccount();
                FillAgainstChallanNo();
                var dataParams = {
                    "AccountCode": $('#AccountCode').val()
                }
                if ($('#AccountCode').prop('selectedIndex') != 0) {
                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("GetAddressDetails")",
                        data: dataParams,
                        dataType: "json",
                        success: function (result, status, error) {
                            if (result != null) {
                                var obj = $.parseJSON(result);
                                if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                                    $.each(obj.Result, function (index, val) {
                                        $('#DeliveryAddress').val(val.Address);
                                        $('#VendorStateCode').val(val.statecode);
                                        $('#GSTType').val(val.GSTPartyTypes);
                                    });
                                }
                            }
                        },
                        error: function (req, status, error) {
                            alert(error);
                        }
                    });
                }
                else $('#DeliveryAdd').val('');
            }

            $('#ChangeEventTriggered').val("N");

        });


        $('#StoreId').change(function () {
            $('#BatchNo,#UniqueBatchNo').empty();
            $('#StockQty,#BatchStockQty').val('');
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetBatchNumber")',
                data: { StoreId: $('#StoreId').val(), StoreName: $('#StoreId').find(':selected').text(), ItemCode: $('#ItemCode').val(), TransDate: $('#ChallanDate').val(), YearCode: $('#YearCode').val(), BatchNo: $('#BatchNo').val() },
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#BatchNo,#UniqueBatchNo').empty();
                            $('#BatchNo').append('<option value="0" disabled selected>-Select-</option>');
                            $('#UniqueBatchNo').append('<option value="0" selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                if ($("#BatchNo option[value='" + val.batchno + "']").length == 0) {
                                    $('#BatchNo').append('<option value="' + val.batchno + '" data-uniquebatchno="' + val.UniqueBatchNo + '">' + val.batchno + '</option>');
                                }
                            });
                        }
                    }
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
            GetBatchStock();
        });
        $('#UniqueBatchNo').change(function () {
            //$("#StockQty").val($(this).find(":selected").data('stock'));
            GetBatchStock();
            GetTotalStockQty();

        });
        //$('#ItemCode').change(function () {

        //});
        //$('#PartCode').change(function () {
        //    EmptyGridFields();
        //});
        var BatchStock = 0;
        function GetBatchStock() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetBatchStockQty")",
                data: { ItemCode: $('#ItemCode').val(), StoreId: $('#Storeid').val(), TillDate: $('#ChallanDate').val(), BatchNo: $('#BatchNo').val(), UniqueBatchNo: $('#uniquebatchno').val() },
                dataType: "json",
                async: false,
                success: function (result, status, error) {
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        $('#BatchStock').val($.parseJSON(result).Result[0].STOCK);
                        BatchStock = $.parseJSON(result).Result[0].STOCK;
                    }
                    // SetminQty();
                }
            });
        }

        function checkPartCodeMusthaveAtLeastOneTax() {

            var errorPartCode = [];
            $('.divNRGPItemListPC').each(function (i, data) {
                var partcode = $(data).text();
                var taxes = $("td[data-txPartCode='" + partcode + "']");
                if (!taxes || taxes.length == 0) {
                    errorPartCode.push(partcode)
                }
            });
            if (errorPartCode.length > 0) {
                $.notify("No tax available for " + errorPartCode.join(", ") + " part code(s).", "error");
            }
            return errorPartCode.length == 0;
        }

        function GetTotalStockQty() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("GetStoreTotalStock")",
                data: { ItemCode: $('#ItemCode').val(), StoreId: $('#Storeid').val(), TillDate: $('#ChallanDate').val() },
                dataType: "json",
                success: function (result, status, error) {
                    if (result && result.length > 0) {
                 /*         alert(JSON.stringify(result)); */
                    /* if (result != null) { */
                        /* var obj = $.parseJSON(result); */
                        $('#TotalStock').val($.parseJSON(result).Result[0].STOCK);
                     /*     $('#TotalStock').val(result[0].STOCK); */
                    }
                    // SetminQty();
                }
            });
        }

        $('#BatchNo').change(function () {

            $.ajax({
                type: "POST",
                /* url: '@Url.Action("GetBatchNumber")', */
                url: '@Url.Action("FillStockBatchNo", "InterStoreTransfer")',
                data: { StoreId: $('#Storeid').val(), StoreName: $('#Storeid').find(':selected').text(), ItemCode: $('#ItemCode').val(), TransDate: $('#ChallanDate').val(), YearCode: $('#YearCode').val(), BatchNo: $('#BatchNo').val() },
                dataType: "json",
                success: function (result, status, error) {
                     
                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#uniquebatchno').empty();
                            $('#uniquebatchno').append('<option value="0" selected>-Select-</option>');
                            $.each(obj.Result, function (index, val) {
                                if ($("#uniquebatchno option[value='" + val.UniqueBatchNo + "']").length == 0) {
                                    $('#uniquebatchno').append('<option value="' + val.UniqueBatchNo + '" data-stock="' + val.stock + '" selected>' + val.UniqueBatchNo + '</option>');
                                }
                            });
                        }
                    }
                    GetBatchStock();
                    GetItemRate();
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        });

        var itemBatchArray = [];

        $('.GridButton').click(function (e) {
            e.preventDefault();

            var seqnoarray = [];
            $('#divIssueNRGPGrid tr').each(function (index, element) {
                var currentRow = $(element);
                var seqnoText = currentRow.find('th').data('seqno') == undefined ? 0 : currentRow.find('th').data('seqno');
                if (seqnoText != 0) {
                    seqnoarray.push(parseInt(seqnoText));
                }
            });
            var highestValue = 0;
            if (seqnoarray.length == 0) {
                highestValue = 0;
            }
            else {
                highestValue = Math.max(...seqnoarray);
            }

            if (!ValidateIN_Grid()) return;
            EditEachItem = false;
            var StoreName, ProcessName;
            if ($('#Storeid').find(':selected').text() == '-Select-') {
                StoreName = 'NA';
            } else {
                StoreName = $('#Storeid').find(':selected').text();
            }
            if ($('#ProcessId').find(':selected').text() == '-Select-') {
                ProcessName = 'NA';
            } else {
                ProcessName = $('#ProcessId').find(':selected').text();
            }
            var itemCodee = parseInt($('#ItemCode').val());
            var batchNoo = $('#BatchNo').val();
            var uniquebatchnoo = $('#uniquebatchno').val();

            var ItemData = {
                "ItemCode": parseInt($('#ItemCode').val()),
                "PartCode": $('#PartCode').find(':selected').text(),
                "ItemName": $('#ItemCode').find(':selected').text(),
                "HSNNo": $('#HSNNo').val(),
                "Qty": $('#Qty').val(),
                "unit": $('#unit').val(),
                "Rate": $('#Rate').val(),
                "Amount": $('#Amount').val(),
                "PurchasePrice": $('#PurchasePrice').val(),
                "ProcessId": $('#ProcessId').val(),
                "ProcessName": ProcessName,
                "Storeid": $('#Storeid').val(),
                "StoreName": StoreName,
                "BatchNo": $('#BatchNo').val(),
                "uniquebatchno": $('#uniquebatchno').val(),
                "TotalStock": parseInt($('#TotalStock').val()),
                "BatchStock": $('#BatchStock').val(),
                "AltQty": $('#AltQty').val(),
                "AltUnit": $('#AltUnit').val(),
                "discper": $('#discper').val(),
                "disamt": $('#disamt').val() == "NaN" ? 0 :$('#disamt').val() ,
                "ToLimit": $('#ToLimit').val(),
                "Remark": $('#Remark').val(),
                "PONO": $('#PONO').val(),
                "POYearCode": $('#POYearCode').val(),
                "PODate": $('#PODate').val(),
                "POAmendementNo": $('#POAmendementNo').val(),
                "AgainstChallanEntryId": $('#AgainstChallanEntryId').val(),
                "AgainstChallanNo": $('#AgainstChallanNo').val(),
                "AgainstChallanYearCode": $('#AgainstChallanYearCode').val(),
                "BatchWise": $('#BatchWise').val(),
                "Stockable": $('#Stockable').val(),
                "ItemSize": $('#ItemSize').val(),
                "ItemColor": $('#ItemColor').val(),
                "ItemModel": $('#ItemModel').val(),
                "Closed": $('#Closed').val(),
                "PendQty": $('#PendQty').val(),
                "PendAltQty": $('#PendAltQty').val(),
                "RemarkDetail": $('#RemarkDetail').val(),
                "Purpose": $('#Purpose').val(),
                "Mode": $('#Mode').val(),
                "SEQNo": parseInt($('#hiddenSeqNo').val()) == 0 ? (highestValue + 1) : parseInt($('#hiddenSeqNo').val())
            }

            $.ajax({
                url: "@Url.Action("AddIssueNRGPDetail")",
                type: "POST",
                data: ItemData,
                beforeSend: function (xhr) {

                },
                success: function (data, status, xhr) {

                    $('#RoundOff').prop('selectedIndex', 0);
                    if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                        $.notify('Duplicate Item Not Allowed.', "info");
                        $('.ItemBtn').html('<span role="status"><i class="fa-duotone fa-angle-double-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                    }
                    else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
                        $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
                    }
                    else {
                        $('#divIssueNRGPGrid').html(data);
                        $.notify('Item Added To Grid', "success");
                        //GetAmtAfterDiscount();
                        ClearGrid();
                         $('.AF :input').val('');
                         $('.AF').fadeOut();


                        var rowCount = $('#divIssueNRGPGrid tr').length;
                        var Seqno = $('#SeqNo-' + rowCount).val();
                        itemBatchArray.push({
                            "SeqNo": parseInt(Seqno),
                            "itemcode": itemCodee,
                            "batchno": batchNoo,
                            "uniquebatchno": uniquebatchnoo
                        });
                        //for (var i = 1; i <= rowCount + 1; i++) {
                        //    $('#editButton-' + i).prop("disabled", false);
                        //}
                        // ClearItem();
                        $('#PartCode').focus();

                        TotalNetAmount();

                    }

                    BasicTotal();

                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                },
                failure: function (result, status, xhr) {
                    alert(response.responseText);
                },
                complete: function () {
                    $('#NetTotall').val(0);
                    $('#DiscountPercentage').val(0);
                    $('#AmtAftrDiscount').val(0);
                    //$('.ItemBtn').html('<span role="status"><i class="fa-duotone fa-angle-double-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                }
            }).done(function () {
                console.log(3);
                GetTxPartItem();
            }).fail(function () {
                alert("error");;
            }).always(function () {
                console.log(4);
            });
        });

        function BasicTotal() {
            var columnCount = $('#divIssueNRGPGrid tr td').length;
            //var taxRowCount = $('#divTaxGrid tr').length;
            var sum = 0;
            var rowCount = $('#divIssueNRGPGrid tr').length;
            //noofitems
            if (columnCount > 1)
                $('#lblItemCount').text(rowCount);
            else
                $('#lblItemCount').text(0);

            for (var i = 1; i <= rowCount; i++) {

                sum += parseFloat($('#GridAmount-' + i).text() == '.00' ? 0 : $('#GridAmount-' + i).text());
            }

            $('#lblItemNetAmount').text(sum.toFixed(2));
        }


        $('#DiscountPercentage').change(function () {

            const DP = $('#DiscountPercentage') == "0" || $('#DiscountPercentage').val() == "" ? 0 : parseFloat($('#DiscountPercentage').val());
            var Amount = $('#NetTotall').val() == "0" || $('#NetTotall').val() == "" ? 0 : parseFloat($('#NetTotall').val());

            if (DP !== 0) {
                var AmtAfterDis = $('#AmtAftrDiscount').val();
                const DA = ((Amount * DP) / 100);
                Amount = Amount - DA;
                $('#AmtAftrDiscount').val((AmtAfterDis - DA).toFixed(2));
            }
            else {
                Amount = parseFloat($('#NetTotall').val());
                $('#AmtAftrDiscount').val('0.00'), $('#DiscountPercentage').val('0');
            }

            $('#NetTotall').val(Amount.toFixed(2));
        });

        function ClearGrid() {
            $('#PartCode,#ItemCode').prop('selectedIndex', 0).trigger("change");
            $('#BatchNo,#uniquebatchno,#ProcessId').prop('selectedIndex', 0);
            $('#BatchNo,#uniquebatchno').empty();
            $('#BatchNo,#uniquebatchno').append('<option value="0">-Select-</option>');
            $('#PONO,#POYearCode,#PODate,#AgainstAdaviceNo,#AgainstAdaviceYear,#ItemColor,#ItemSize,#ItemModel').prop('selectedIndex', 0);
            $('#HSNNo,#TotalStock,#BatchStock,#Qty,#Rate,#Amount,#PurchasePrice,#AltQty,#PendQty,#PendAltQty,#discper,#disamt').val(0);
            $('#unit,#Remark,#AltUnit,#AgainstAdaviceDate,#POAmendementNo,#Closed').val('');
        }

        //$('#IssQty').change(function () {
        //    var Qty = parseInt($('#IssQty').val());
        //    var rate = parseInt($('#Rate').val());
        //    $('#Amount').val(Qty * rate);
        //});
        //$('#Rate').change(function () {
        //    var Qty = parseInt($('#IssQty').val());
        //    var rate = parseInt($('#Rate').val());
        //    $('#Amount').val(Qty * rate);
        //});

        $('#Amount').change(function () {
            var stockQty = parseInt($('#StockQty').val());
            var batchStock = parseInt($('#BatchStockQty').val());
            var qty = parseInt($('#IssQty').val());
            if (qty > stockQty) {
                $.notify("Qty cannot be greater than Stock Qty", "error");
                $('#IssQty').val(0);
            }
            if (qty > batchStock) {
                $.notify("Qty cannot be greater than Batch Stock Qty", "error");
                $('#IssQty').val(0);
            }
        });

        $('#RoundOff').change(function () {

            $('#DiscountPercentage').val('');
            GetAmtAfterDiscount();

        });

        $('#NetTotall').change(function () {
            if ($(this).val() == "Y") {
                let Amt = $('#NetTotall').val().trim() == "" ? 0 : parseFloat($('#NetTotall').val().trim());
                Amt = Math.round(Amt);
                $('#NetTotall').val(Amt.toFixed(2));
            }
            else {
                //var INA = parseFloat($('#ItemNetAmount').val());
                //var TTA = parseFloat($('#TotalTaxAmt').val());
                //TTA = TTA == "NAN" ? 0.00 : TTA;
                //var NT = INA + TTA;
                var NetTotall = $('#NetTotall').val();
                $('#NetTotall').val(netTotal.toFixed(2));
            }
        });

        function GetAmtAfterDiscount() {
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetAmtAfterDiscount")',
                dataType: "json",
                success: function (result, status, error) {

                    $('#AmtAftrDiscount').val(parseInt(result).toFixed(2));
                },
                error: function (req, status, error) {
                    alert(error);
                },
                complete: function () {
                    //console.log(5);
                    //$('.Schedule').fadeIn();
                    //$('#NetTotall').val(0);
                    //$('.ItemBtn').html('<span role="status"><i class="fa-duotone fa-angle-double-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                }
            }).done(function () {
                GetSumofTaxGrid();
            });

        }
        function GetSumofTaxGrid() {
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetSumofTaxGrid")',
                dataType: "json",
                success: function (result, status, error) {

                    var amtAftrDis = parseInt($('#AmtAftrDiscount').val());
                    var netTotal = amtAftrDis + parseInt(result);
                    $('#NetTotall').val(netTotal.toFixed(2));
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        }

        function ValidateIN_Grid() {

            var Err = 0;

            CheckItems();
            SetminQty();

            if (parseInt($('#PartCode').val()) == 0 || $('#PartCode').val() == '') {
                AddErrorCls('PartCode');
                Err = 1;
            }
            else {
                RemoveErrorCls('PartCode');
            }
            if (parseInt($('#ItemCode').val()) == 0 || $('#ItemCode').val() == '') {
                AddErrorCls('ItemCode');
                Err = 1;
            }
            else {
                RemoveErrorCls('ItemCode');
            }


            if ($('#PartCode').data('ServeAsstes') != 'NotItems' && $('#hiddenItemStockable').val() == 'Y') {
                if (parseInt($('#BatchNo').val()) == 0 || $('#BatchNo').val() == '' || $('#BatchNo').val() == null) {
                    AddErrorCls('BatchNo');
                    Err = 1;
                }
                else {
                    RemoveErrorCls('BatchNo');
                }
                if (parseInt($('#uniquebatchno').val()) == 0 || $('#uniquebatchno').val() == '' || $('#uniquebatchno').val() == null) {
                    AddErrorCls('uniquebatchno');
                    Err = 1;
                }
                else {
                    RemoveErrorCls('uniquebatchno');
                }

                //if (parseInt($('#Qty').val()) == 0 || $('#Qty').val() == '' || parseFloat($('#Qty').val()) > parseFloat($('#BatchStock').val())) {
                //    AddErrorCls('Qty');
                //    Err = 1;
                //}
                //else {
                //    RemoveErrorCls('Qty');
                //}

                if (parseInt($('#Qty').val()) == 0 || $('#Qty').val() == '' || parseFloat($('#Qty').val()) > MinQtyVal) {
                    AddErrorCls('Qty');
                    Err = 1;
                    if (LowestStock == "LotStock") {
                        $.notify("Can not add Qty more then Lot Stock", "error");
                    } else {
                        $.notify("Can not add Qty more then Total Stock", "error");
                    }
                }
                else {
                    RemoveErrorCls('Qty');
                }

            }

            //if (parseInt($('#Rate').val()) == 0 || $('#Rate').val() == '') {
            //    AddErrorCls('Rate');
            //    Err = 1;
            //}
            //else {
            //    RemoveErrorCls('Rate');
            //}

            if ($('#RGPNRGP').val() == '') {
                AddErrorCls('RGPNRGP');
                Err = 1;
            }
            else {
                RemoveErrorCls('RGPNRGP');
            }

            if ($('#Storeid').val() == null || parseInt($('#Storeid').val()) == 0) {
                AddErrorCls('Storeid');
                Err = 1;
            }
            else {
                RemoveErrorCls('Storeid');
            }
            //SetminQty();

            Err == 1 ? ShowErrorFld('H_SAGrid') : HideErrorFld('H_SAGrid');
            if (Err == 1) return false;

            return true;
        }

        async function GetTxPartItem() {
            $.ajax({
                type: "GET",
                url: '@Url.Action("GetTaxPartItem", "Tax")',
                data: { SessionName: "IssueNRGP", Mode: $('#Mode').val() },
                dataType: "json",
                success: await function (data, status, error) {

                    $('#TxPartCode').empty();
                    $('#TxPartCode').append('<option>-Select-</option>');
                    var PartCode = 0;
                    var arrayPartCode = [];
                    $.each(data.partCode, function (key, val) {
                        if (arrayPartCode.includes(val.text)) {
                            //do nothing
                        }
                        else {
                            $('#TxPartCode').append('<option value="' + val.value + '">' + val.text + '</option>');
                            arrayPartCode.push(val.text);
                        }
                    });
                    $("[id='TxItemCode']").empty();
                    $("[id='TxItemCode']").append('<option>-Select-</option>');
                    var ItemText = 0;
                    var arrayitemCode = [];
                    $.each(data.itemCode, function (key, val) {
                        if (arrayitemCode.includes(val.text)) {
                            //do nothing
                        }
                        else {
                            $("[id='TxItemCode']").append('<option value="' + val.value + '">' + val.text + '</option>');
                            arrayitemCode.push(val.text);
                        }


                    });

                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        }


        function formatDate(d) {
            var newDate = new Date(d);
            var day = newDate.getDate();
            var month = newDate.getUTCMonth();
            var year = newDate.getFullYear();
            finaldate = new Date(year, month, day);
            return finaldate;
        }

        var ItemNameSort = [];

        $('#IC1').change(function () {
            $('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');

            if (!$(this).is(":checked")) {
                $('select[name^="BomStatus"]').val('');
            }
            $.ajax({
                type: "POST",
                url: '@Url.Action("GetAllItems")',
                data: { TF: $('#IC1').is(':checked') == true ? 'T' : 'F' },
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ItemCode,#PartCode').empty();
                            $('#PartCode').append('<option disabled selected>-Select-</option>');
                            $('#ItemCode').append('<option selected>-Select-</option>');

                            ItemNameSort = [];

                            $.each(obj.Result, function (index, val) {
                                if ($("#PartCode option[value='" + val.PartCode + "']").length == 0) {
                                    $('#PartCode').append('<option value="' + val.Item_Code + '">' + val.PartCode + '</option>');
                                }

                                //$('#ItemCode').append('<option value="' + val.Item_Code +
                                //    '">' + val.ItemName + '</option>');
                                ItemNameSort.push({
                                    ItemCode: val.Item_Code,
                                    ItemName: val.ItemName
                                });
                            });
                        } else {
                            $('#ItemCode,#PartCode').empty();
                        }
                        FillAllItemName();
                    }
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        });



        function FillAllItemName() {
            ItemNameSort.sort(function (a, b) {
                var nameA = a.ItemName.toUpperCase();
                var nameB = b.ItemName.toUpperCase();

                if (nameA < nameB) {
                    return -1;
                }
                if (nameA > nameB) {
                    return 1;
                }
                return 0;
            });

            $('#ItemCode').empty();

            // Add a default option
            $('#ItemCode').append($('<option>', {
                value: '0',
                text: '-Select-'
            }));

            // Append sorted options to the combo box
            $.each(ItemNameSort, function (index, item) {
                $('#ItemCode').append($('<option>', {
                    value: item.ItemCode,
                    text: item.ItemName
                }));
            });
        }

        function FillLoadItems() {
            $('#Unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');


            $.ajax({
                type: "POST",
                url: '@Url.Action("FillItemName")',
                dataType: "json",
                success: function (result, status, error) {

                    if (result != null) {
                        var obj = $.parseJSON(result);
                        if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                            $('#ItemCode,#PartCode').empty();
                            $('#PartCode').append('<option disabled selected>-Select-</option>');
                            $('#ItemCode').append('<option selected>-Select-</option>');


                            $.each(obj.Result, function (index, val) {
                                if ($("#PartCode option[value='" + val.PartCode + "']").length == 0) {
                                    $('#PartCode').append('<option value="' + val.Item_Code + '">' + val.PartCode + '</option>');
                                }

                                //$('#ItemCode').append('<option value="' + val.Item_Code +
                                //    '">' + val.ItemName + '</option>');
                                ItemNameSort.push({
                                    ItemCode: val.Item_Code,
                                    ItemName: val.ItemName
                                });
                            });
                        }
                        else {
                            $('#PartCode,#ItemCode').empty();
                        }
                        FillAllItemName();
                    }
                },
                error: function (req, status, error) { alert(error); }

            });
        }

        $('#JobWorkNewRework').change(function () {
            $.ajax({
                type: "POST",
                url: "@Url.Action("ClearJobWorkGrid")",
                data: { AccountCode: $('#AccountCode').val() },
                dataType: "json",
                success: function (data, status, error) {
                    $('#divJobWorkGrid').empty();
                    //$('#divTaxGrid').empty();
                    console.log("Job Grid cleared");
                },
                error: function (req, status, error) {
                    alert(error);
                }
            });
        });

        $(document).on('select2:select', '#ItemCode,#PartCode', function (e) {
            var cntId = e.target.id;

            if (cntId == 'ItemCode') {
                ItemNameChange(cntId);
            }
            else {
                PartCodeChange(cntId);
            }
            FillAgainstChallanNo();
            FillCurrentBatchINStore();
            GetTotalStockQty();
        });

        function PartCodeChange(ID) {
            $.when(SetPartCodeItemName(ID)).done(function () {
                GetItemPartCode(ID)
            });
            copyToClipboardForDropdown('#PartCode');
            EmptyGridFields();
            //$('#Storeid').val("");
            StockableItems(parseInt($('#PartCode').val()));
            CheckItems();
        }


        function ItemNameChange(ID) {
            SetPartCodeItemName(ID);
            GetItemPartCode(ID);
            copyToClipboardForDropdown('#ItemCode');
            EmptyGridFields();
            //$('#Storeid').val("");
            StockableItems(parseInt($('#ItemCode').val()));
            CheckItems();
        }

        function SetPartCodeItemName(ID) {
            if (!ID) return;
            else {
                var v = $('#' + ID).select2('val');
                if (ID == "PartCode") {
                    $("#ItemCode").val(v).trigger("change");
                }

                if (ID == "ItemCode") {
                    $("#PartCode").val(v).trigger("change");
                }
            }
        }

        async function GetItemPartCode(ID) {
            $.getJSON({
                url: '@Url.Action("GetItemPartCode", "SaleOrder")',
                data: { Code: $('#' + ID).val() },
                success: function (result, status, xhr) {

                    if (result) {
                        var obj = JSON.parse(result);
                        if (!obj) {
                            $('#unit').val('0'), $('#HSNNo').val('0'), $('#AltUnit').val('NA');
                        }
                        else if (obj.StatusCode == 200 && obj.StatusText == "Success") {
                            $('#unit').val(obj.Result[0].Unit);
                            $('#HSNNo').val(obj.Result[0].HSNNo);
                            $('#AltUnit').val(obj.Result[0].AltUnit == null ? 'NA' : obj.Result[0].AltUnit);
                            !$('#AltUnit').val() ? $('#UnitRate').prop('disabled', true) : $('#UnitRate').prop('disabled', false);
                        }
                        SetAltQty();
                    }
                },
                error: function (result, status, xhr) {
                    $.notify(result.responseText, "error");
                }
            });
        }

        function SetAltQty() {
            var unit = $('#unit').val();
            var Altunit = $('#AltUnit').val();

            if (unit == Altunit) {
                $('#AltQty').prop("readonly", true);
                $('#AltQty').val($('#Qty').val());
            }
        }

        function DeleteItemRow(SeqNo) {

            var IC = $('#GridIC-' + SeqNo).val();
            var BatchNo = $('#GridBatchNo-' + SeqNo).text();

            var allowDeletion = true;
            if (!EditDeleteBatchValidation) {
                for (var j = 0; j < itemBatchArray.length; j++) {
                    if (itemBatchArray[j].SeqNo > SeqNo && itemBatchArray[j].itemCodee == IC) {
                        $.notify('Cannot delete this row before deleting other BatchNo of this Item.', "error");
                        allowDeletion = false;
                        break;
                    }
                }
            }

            if (allowDeletion) {
                $.ajax({
                    url: '@Url.Action("DeleteItemRow")',
                    type: "POST",
                    data: { "SeqNo": SeqNo, "Mode": $('#Mode').val() },
                    async: false,
                    success: function (data, status, xhr) {
                        console.log(data);
                        if (EditItemFlag) {
                            ClearGrid();
                        }
                        if (data === "Duplicate") {
                            $.notify('Cannot delete item that exists in Tax Grid!!!', "error");
                        } else {
                            $('#divIssueNRGPGrid').html(data);
                            $.notify("Item Deleted from Grid", "info");

                            var itemArrayLength = itemBatchArray.length;

                            for (var i = 0; i < itemArrayLength; i++) {
                                if (itemBatchArray[i].itemCodee == IC && itemBatchArray[i].batchno == BatchNo) {
                                    itemBatchArray.splice(i, 1);
                                }
                            }
                            TotalNetAmount();
                            //$('#BatchNo').append('<option>' + itemBatchArray[0].batchno + '</option>');
                            BasicTotal();
                        }
                    },
                    error: function (response, status, xhr) {

                        $.notify("Cannot delete item that exists in Tax Grid!!!", "error");
                    },
                    failure: function (response, status, xhr) {
                        alert(response.responseText);
                        $.notify(response.responseText, "error");
                    }
                });
            }
            EditDeleteBatchValidation = false;
        }
        var EditItemFlag = true;
        var EditEachItem = false;
        var EditDeleteBatchValidation = false;
        function EditItemRow(SeqNo) {

            var RowCount = $('#divIssueNRGPGrid tr').length;
            if (EditEachItem) {
                $.notify('Cannot Edit item while AddtoGrid  Existing Item!!!', "error");
                $('#editButton-' + RowCount).prop("disabled", true);
            }
            else {
                var TaxRowCount = $('#divTaxGrid tr td').length;
                if (TaxRowCount > 1) {
                    $.notify('Cannot delete item that exists in Tax Grid!!!', "error");
                } else {
                    //if (!ValidateIN_Grid()) return;
                    $.ajax({
                        url: '/NRGP/EditItemRow',
                        type: "POST",
                        data: { SeqNo: SeqNo },
                        success: function (data) {

                            EditDeleteBatchValidation = true;
                            var obj = $.parseJSON(data);
                            StockableItems(obj[0].ItemCode);
                            EditEachItem = true;

                            if (obj[0].PONO != "") {
                                if(obj[0].PONO !=null){
                                $('#SH').prop("checked", true);
                                $('.AF').fadeIn();
                                GetPONOByAccount();
                                }
                            }
                            if (obj != null && obj.length == 1) {

                                var PODate = obj[0].PODate == null ? "" : obj[0].PODate.split(" ")[0];
                                $('#PartCode').val(obj[0].ItemCode).trigger("change");
                                $('#ItemCode').val(obj[0].ItemCode).trigger("change");
                                $('#ItemName').val(obj[0].ItemName);
                                $('#HSNNo').val(obj[0].HSNNo);
                                $('#Storeid').val(obj[0].Storeid);
                                $('#StoreName').val(obj[0].StoreName);
                                //  if ($('#Mode').val() == "U" || $('#Mode').val() == "V") {
                                if (obj[0].BatchNo != '0' && obj[0].BatchNo != null && obj[0].BatchNo != 0) {
                                    $('#BatchNo').append('<option value="' + obj[0].BatchNo + '" selected>' + obj[0].BatchNo + '</option>');
                                    $('#uniquebatchno').append('<option value="' + obj[0].uniquebatchno + '" selected>' + obj[0].uniquebatchno + '</option>');
                                }
                                //} else {
                                //    $('#BatchNo').val(obj[0].BatchNo);
                                //    $('#uniquebatchno').val(obj[0].uniquebatchno);
                                //}
                                $('#Qty').val(obj[0].Qty);
                                $('#TotalStock').val(obj[0].TotalStock);
                                $('#hiddenSeqNo').val(obj[0].SEQNo);
                                $('#ProcessId').val(obj[0].ProcessId);
                                $('#unit').val(obj[0].unit);
                                $('#Rate').val(obj[0].Rate);
                                $('#Amount').val(obj[0].Amount);
                                $('#PurchasePrice').val(obj[0].PurchasePrice);
                                $('#AltQty').val(obj[0].AltQty);
                                $('#AltUnit').val(obj[0].AltUnit);
                                $('#RemarkDetail').val(obj[0].RemarkDetail);
                                $('#Purpose').val(obj[0].Purpose);
                                $('#PONO').val(obj[0].PONO);
                                //$('#POYearCode').val(obj[0].POYearCode);
                                if (obj[0].POYearCode != 0) {
                                    $('#POYearCode').append('<option value="' + $('#PONO').find(':selected').data('po-year') + '" selected>' + $('#PONO').find(':selected').data('po-year') + '</option>');
                                }
                                $('#PODate').val(PODate);
                                $('#POAmendementNo').val(obj[0].POAmendementNo);
                                $('#discper').val(obj[0].discper);
                                $('#disamt').val(obj[0].disamt);
                                $('#Amount').val(obj[0].Amount);
                                $('#AgainstChallanEntryId').val(obj[0].AgainstChallanEntryId);
                                $('#AgainstChallanNo').val(obj[0].AgainstChallanNo);
                                $('#AgainstChallanYearCode').val(obj[0].AgainstChallanYearCode);
                                $('#AgainstChallanType').val(obj[0].AgainstChallanType);
                                $('#Closed').val(obj[0].Closed);
                                $('#ItemColor').val(obj[0].ItemColor);
                                $('#ItemSize').val(obj[0].ItemSize);
                                $('#ItemModel').val(obj[0].ItemModel);
                                $('#PendQty').val(obj[0].PendQty);
                                $('#PendAltQty').val(obj[0].PendAltQty);

                                //$('#Remark').val(obj[0].RecScrapItemName);

                                    GetBatchStock();
                                    GetTotalStockQty();
                                GetPrevQty();
                                $('#BatchStock').val(QtyVal + BatchStock);
                                //SetminQty();
                                var rowCount = $('#divIssueNRGPGrid tr').length;
                                for (var i = 1; i <= rowCount + 1; i++) {
                                    $('#editButton-' + i).css("pointer-events", "none");
                                    $('#editButton-' + i).css("cursor", "not-allowed");
                                }
                                EditItemFlag = false;
                                //DeleteIssueTaxRow(SeqNo);
                                DeleteItemRow(SeqNo);
                            }
                        },
                        error: function (response) {
                            $.notify(response.responseText, "error");
                        },
                        failure: function (response) {
                            $.notify(response.responseText, "error");
                        }
                    });
                }

            }
        }
        function handleInput(inputElement) {
            var inputValue = $(inputElement).val();

            inputValue = inputValue.replace(/[^0-9.]/g, '');

            var dotCount = inputValue.split('.').length - 1;
            if (dotCount > 1) {
                inputValue = inputValue.slice(0, -1);
            }

            $(inputElement).val(inputValue);
        }

        function RecScrapPartChange(ID) {
            $.when(SetRecScrapPartCodeItemName(ID));
        }

        function RecScrapItemChange(ID) {
            SetRecScrapPartCodeItemName(ID);
        }
        function RecPartChange(ID) {
            $.when(SetRecPartCodeItemName(ID));
        }

        function RecItemChange(ID) {
            SetRecPartCodeItemName(ID);
        }

        function DeleteTaxRow(SeqNo) {
            $.ajax({
                url: '/Tax/DeleteIssueTaxRow',
                type: "POST",
                data: { "SeqNo": SeqNo, 'SN': 'IssueNRGP' },
                success: function (data, status, xhr) {
                    $('#divTaxGrid').html(data);
                    var INA = parseFloat($('#NetAmount').val());
                    var TTA = parseFloat($('#TotalTaxAmt').val());
                    var NT = INA + TTA;
                    $('#NetTotal').val(NT.toFixed(2));

                    if ($('#divTaxGrid').children().length == 0) {
                        var NoData = '<tr class="text-center"><td colspan="14" class="text-black-50"><strong>NO DATA ADDED</strong></td></tr>';
                        $('#divTaxGrid').html(NoData);
                        $('#NetTotal').val(INA.toFixed(2));
                    }

                    $.notify('Item Deleted From Grid.', "info");
                    if ($('title').text().indexOf('Job Work') == 0) {
                        GetAmtAfterDiscount();
                    }
                },
                error: function (error, status, xhr) {
                    $.notify(status + " : " + error.status + " : Cannot Delete Expenses, if Tax Exists.", { position: "top center", className: "error" });
                },
                failure: function (error, status, xhr) {
                    $.notify(error, { position: "top center", className: "error" });
                }
            });
        }

        function PressBack() {

            sessionStorage.setItem('FromDateBack', $('#FromDateBack').val());
            sessionStorage.setItem('ToDateBack', $('#ToDateBack').val());
            sessionStorage.setItem('PartCodeBack', $('#PartCodeBack').val());
            sessionStorage.setItem('ItemNameBack', $('#ItemNameBack').val());
            sessionStorage.setItem('VendorNameBack', $('#VendorNameBack').val());
            sessionStorage.setItem('RGPNRGPBack', $('#RGPNRGPBack').val());
            sessionStorage.setItem('ChallanNoBack', $('#ChallanNoBack').val());
            sessionStorage.setItem('ChallanTypeBack', $('#ChallanTypeBack').val());
            sessionStorage.setItem('DashboardTypeBack', $('#DashboardTypeBack').val());

            window.history.back();
        }

    </script>

}