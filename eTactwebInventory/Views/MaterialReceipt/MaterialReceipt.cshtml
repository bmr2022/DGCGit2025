@model eTactWeb.DOM.Models.MaterialReceiptModel


@{
    ViewData["Title"] = "Material Receipt Note";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<style>
    .disabled-link {
        pointer-events: none; /* Prevents clicking */
        color: gray; /* Optional: Make it look disabled */
        text-decoration: none; /* Optional: Remove underline */
        cursor: default; /* Optional: Show normal cursor */
        opacity: 0.6; /* Optional: Make it look faded */
    }
</style>
<div class="card bg-gradient mb-3 border-light shadow-lg">

    <form asp-action="MaterialReceipt" autocomplete="off" class="form-horizontal">
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                <strong>Material Receipt</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    @*<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">*@
                    <div class="col-auto">
                        @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                        <a type="button" class="btn btn-sm btn-outline-light bg-gradient" asp-action="MRNTag" asp-controller="MaterialReceipt" asp-route-EntryId="@Model.EntryID" asp-route-YearCode="@Model.YearCode" asp-route-MrnNo="@Model.MRNNo">
                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                            MRN Tag
                        </a>

                    </div>
                     <div class="col-auto">
                        @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                        <a type="button" class="btn btn-sm btn-outline-light bg-gradient" asp-action="PrintReport" asp-controller="MaterialReceipt" asp-route-EntryId="@Model.EntryID" asp-route-YearCode="@Model.YearCode" asp-route-MrnNo="@Model.MRNNo">
                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                            PRINT
                        </a>

                    </div>

                    <div class="col-auto">
                        @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                        <a type="button" class="btn btn-sm btn-outline-light bg-gradient" asp-action="PrintReportShortExcess" asp-controller="MaterialReceipt" asp-route-EntryId="@Model.EntryID" asp-route-YearCode="@Model.YearCode" asp-route-MrnNo="@Model.MRNNo" asp-route-AccountCode="@Model.AccountID">
                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                            Short & Excess
                        </a>

                    </div>

                    <a asp-action="MRNDashboard" asp-route-ID="0" class="btn btn-secondary btn-sm DashBoard">
                        <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                        Dashboard
                    </a>
                    @* <partial name="_FormsButton" />*@
                    <div class="row justify-content-between g-2">
                        <div class="col-auto">
                            <input asp-for="FromDateBack" type="hidden" value="@Model.FromDateBack" />
                            <input asp-for="ToDateBack" type="hidden" value="@Model.ToDateBack" />
                            <input asp-for="GateNoBack" type="hidden" value="@Model.GateNoBack" />
                            <input asp-for="PartCodeBack" type="hidden" value="@Model.PartCodeBack" />
                            <input asp-for="ItemNameBack" type="hidden" value="@Model.ItemNameBack" />
                            <input asp-for="MrnNoBack" type="hidden" value="@Model.MrnNoBack" />
                            <input asp-for="PoNoBack" type="hidden" value="@Model.PoNoBack" />
                            <input asp-for="GlobalSearchBack" type="hidden" value="@Model.GlobalSearchBack" />
                            <input asp-for="DashboardTypeBack" type="hidden" value="@Model.DashboardTypeBack" />
                            <input asp-for="VendorNameBack" type="hidden" value="@Model.VendorNameBack" />
                            @*<a href="#" class="btn offer-listbtn hvr-sweep-to-right btn-sm btn-secondary" onclick="back();">*@
                            <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                BACK
                            </a>
                        </div>
                        @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                        {
                                <div class="col-auto">
                                @*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
                                    <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                    @* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
                                        <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                        REFRESH
                                    </a>
                                </div>
                            @if (Model.Mode == "U")
                            {
                                @*Model.Mode = "U";*@
                                        <div class="col-auto">
                                    @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                            <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="UpdateButton">
                                                <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                                UPDATE
                                            </button>
                                        </div>
                            }

                            else
                            {
                                        <div class="col-auto">
                                    @*   <button type="submit" class="btn btn-sm btn-outline-primary">*@
                                            <button type="submit" class="btn btn-primary btn-sm" id="submitBTN">
                                                <i class="fa-solid fa-chevron-circle-right"></i>
                                                SUBMIT
                                            </button>
                                        </div>
                            }
                        }
                    </div>
                </span>
            </h5>
        </div>
        <div>
        </div>
        <div class="card-body bg-light pt-0">
            <partial name="_Batchdetail" />
            <div class="accordion shadow-lg">
                <div class="accordion-item" id="GI_Grid">
                    <h2 class="accordion-header" id="H_RParameter">
                        <button class="accordion-button text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_RParameter" aria-expanded="true" aria-controls="B_RParameter">
                            <i class="fa-brands fa-wpforms fa-lg fa-fw pr35"></i>
                            Required Parameter
                        </button>
                    </h2>
                    <div id="B_RParameter" class="accordion-collapse collapse show pnl1 bg-gradient" aria-labelledby="H_RParameter">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3">
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <input type="hidden" id="hiddenMode" value="@Model.Mode" />
                                    <input type="hidden" asp-for="Mode" value="@Model.Mode" />
                                    <input type="hidden" asp-for="DateIntact" value="@Model.DateIntact" />
                                    <input type="hidden" asp-for="FinFromDate" value="@Model.FinFromDate" />
                                    <input type="hidden" asp-for="FinToDate" value="@Model.FinToDate" />
                                    <label asp-for="EntryID" class="form-label">Entry ID</label>
                                    <input asp-for="EntryID" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="YearCode" class="form-label">Year</label>
                                    <input asp-for="YearCode" class="form-control" value="@Model.YearCode" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryDate" class="form-label">Entry Date</label>
                                    <input asp-for="EntryDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="MRNNo" class="form-label">MRNNo</label>
                                    <input asp-for="MRNNo" class="form-control" readonly value="@Model.MRNNo" style="background-color: lightblue !important;" />
                                </div>
                                <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label class="form-label">From Date</label>
                                    <input asp-for="FromDate" type="text" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label class="form-label">To Date</label>
                                    <input asp-for="ToDate" type="text" class="form-control" readonly />
                                </div>

                                <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    @if (Model.Mode == "U" || Model.Mode == "V")
                                    {
                                            <label asp-for="GateNo" class="form-label">Gate Entry No</label>

                                            <input asp-for="GateNo" value="@Model.GateNo" class="form-control" readonly />

                                            <input type="hidden" id="GateEntry" />
                                    }
                                    else
                                    {
                                            <label asp-for="GateNo" class="form-label">Gate Entry No</label>
                                            <select class="form-select" asp-for="GateNo">
                                                <option value="" disabled selected>-Select-</option>
                                            </select>
                                            <input type="hidden" id="GateEntry" />
                                    }

                                </div>


                                @*     <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                <label asp-for="YearCode" class="form-label">Year</label>
                                <input asp-for="YearCode" class="form-control" readonly />
                                </div>*@

                                @*<div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">*@

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    @if (Model.Mode == "U" || Model.Mode == "V")
                                    {
                                            <label asp-for="GateYearCode" class="form-label">Gate YC</label>
                                            <input asp-for="GateYearCode" value="@Model.GateYearCode" class="form-control" readonly />

                                    }
                                    else
                                    {
                                            <label asp-for="GateYearCode" class="form-label">Gate Year</label>
                                            <select class="form-select" asp-for="GateYearCode">
                                                <option value="">-Select-</option>
                                            </select>
                                    }
                                </div>
                                @*<div class=" col-4 col-auto">*@

                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="GateDate" class="form-label">Gate Date</label>
                                    <input asp-for="GateDate " class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="CC" class="form-label">Branch</label>
                                    <input asp-for="CC" class="form-control" readonly />
                                </div>

                                <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="InvoiceNo" class="form-label"> Invoice No</label>
                                    <input asp-for="InvoiceNo" class="form-control" readonly />
                                </div>

                                <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="InvoiceDate" class="form-label">InvoiceDate </label>
                                    <input asp-for="InvoiceDate " class="form-control" readonly />
                                </div>

                                <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="DocType" class="form-label">Document</label>
                                    <input asp-for="DocType" class="form-control" readonly />
                                    <input asp-for="DOCID" type="hidden" />
                                </div>
                                <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="AccountCode" class="form-label">Vendor name</label>
                                    <input asp-for="AccountCode " class="form-control" readonly />
                                    <input asp-for="AccountID" type="hidden" />
                                    @* <label asp-for="AccountCode" class="form-label">Vendor name</label>
                                    <input asp-for="AccountCode " class="form-control" readonly />
                                    <input asp-for="AccountID" type="hidden" />*@
                                </div>
                                <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label class="form-label">Address</label>
                                    <input asp-for="Address" class="form-control" readonly />
                                </div>

                                <div class="col-xl-1  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="RecStoreId" class="form-label">RecStore</label>
                                    <input asp-for="RecStoreId " class="form-control" type="hidden" readonly />
                                    <input asp-for="RecInStore" class="form-control" readonly />
                                </div>
                                <div class="col-xl-1 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="CurrencyID" class="form-label">Currency</label>
                                    <input asp-for="CurrencyID" class="form-control" hidden readonly />
                                    <input id="CurrencyName" class="form-control" readonly />
                                </div>
                                <div class="col-xl-3 col-lg-4 col-md-3 col-sm-6 col-xs-12">
                                    <div class="row align-items-center g-2 gx-2">
                                        <div class="col-auto">
                                            @*<button type="button" class="GridButton btn btn-sm btn-outline-danger mt-3">
                                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> *@
                                            <button type="button" class="GridButton btn btn-sm btn-outline-danger mt-3">
                                                <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                                            </button>
                                        </div>
                                        <div class="col-auto">
                                            @*<button type="button" class="GridButton btn btn-sm btn-outline-danger mt-3">
                                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> *@
                                            <button type="button" class="ClearGrid btn btn-sm btn-outline-primary mt-3">
                                                Clear
                                            </button>
                                        </div>
                                        <div class="col-auto">
                                            @*<button type="button" class="GridButton btn btn-sm btn-outline-danger mt-3">
                                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> *@
                                            <button type="button" class="BatchDetail btn btn-sm btn-outline-primary mt-3">
                                                Batch Detail
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="H_SAGrid">
                        <button class="accordion-button collapsed text-light pnl4BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#B_SAGrid" aria-expanded="true" aria-controls="B_SAGrid">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Item Detail Grid</strong>
                        </button>
                    </h2>

                    <div id="B_SAGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3" id="_ItemGrid">
                            </div>

                            @*<div class=" col-4 col-auto">
                            <div class="row justify-content-around">
                            <div class="col-auto">
                            <button type="button" class="ItemBtn btn btn-sm btn-outline-danger mt-3">
                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                            </button>
                            </div>
                            </div>
                            </div>*@

                            <div class="progress my-2 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-secondary progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="card">

                                <div class="card-body overflow-auto pb-0">
                                    <table class="table table-hover table-bordered table-striped">
                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                            <tr>
                                                <th>PO No</th>
                                                <th>PO Year</th>
                                                <th>Sch No</th>
                                                <th>Sch Year Code</th>
                                                <th>PO Type</th>
                                                <th>PO Date</th>
                                                <th>Item Name</th>
                                                <th>Part Code</th>
                                                <th>Unit</th>
                                                <th>Qty</th>
                                                <th>Bill Qty</th>
                                                <th>Rec Qty</th>
                                                <th>Alt Qty</th>
                                                <th>Rate Unit</th>
                                                <th>Alt Unit</th>
                                                <th>No of case</th>
                                                <th>Alt Rec Qty</th>
                                                <th>ShortExcessQty</th>
                                                <th>Rate</th>
                                                <th>RateInOtherCurr</th>
                                                <th>Amount</th>
                                                <th>Pend PO QTY</th>
                                                <th>QCCompleted</th>
                                                <th>Ret Challan Pend Qty</th>
                                                <th>BatchWise</th>
                                                <th>SaleBillNo</th>
                                                <th>SaleBillYearCode</th>
                                                <th>AgainstChallanNo</th>
                                                <th>BatchNo</th>
                                                <th>Unique Batch No</th>
                                                <th>SupplierBatchNo</th>
                                                <th>ShelfLife</th>
                                                <th>Item Size</th>
                                                <th>Item Color</th>
                                            </tr>
                                        </thead>
                                        <tbody id="divMRNGrid">
                                            @if (Model.Mode == "U" || Model.Mode == "V")
                                            {
                                                    <partial name="_MaterialReceiptGridEdit" />
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            @*<div class=" col-4 col-auto">
                            <div class="row justify-content-around">
                            <div class="col-auto">
                            <button type="button" class="GridButton btn btn-sm btn-outline-danger mt-3">
                            <i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID
                            </button>
                            </div>
                            </div>
                            </div>*@
                            <div class="progress my-3 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <div class="card">
                                <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12" style="margin-top:10px;margin-left:1100px">
                                    <input type="text" class="form-control" id="search-box" style="background-color:#FFFACD" placeholder="Search...">
                                </div>
                                <div class="card-body overflow-auto pb-0">
                                    <table class="table table-hover table-bordered" id="MRNTable">
                                        <thead class="bg-gradient card-headerBG text-light small" style="white-space:nowrap">
                                            <tr>
                                                <th>Action</th>
                                                <th data-columnno="1" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO No</th>
                                                <th data-columnno="2" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO Year</th>
                                                <th data-columnno="3" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Sch No</th>
                                                <th data-columnno="4" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Sch Year Code</th>
                                                <th data-columnno="5" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO Type</th>
                                                <th data-columnno="6" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>PO Date</th>
                                                <th data-columnno="7" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Item Name</th>
                                                <th data-columnno="8" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Part Code</th>
                                                <th data-columnno="9" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Unit</th>
                                                <th data-columnno="10" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Qty</th>
                                                <th data-columnno="11" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Alt Qty</th>
                                                <th data-columnno="12" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Rate Unit</th>
                                                <th data-columnno="13" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Alt Unit</th>
                                                <th data-columnno="14" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>No of case</th>
                                                <th data-columnno="15" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Bill Qty</th>
                                                <th data-columnno="16" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Rec Qty</th>
                                                <th data-columnno="17" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Alt Rec Qty</th>
                                                <th data-columnno="18" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>ShortExcessQty</th>
                                                <th data-columnno="19" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Rate</th>
                                                <th data-columnno="20" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>RateInOtherCurr</th>
                                                <th data-columnno="21" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Amount</th>
                                                <th data-columnno="22" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Pend PO QTY</th>
                                                <th data-columnno="23" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>QCCompleted</th>
                                                <th data-columnno="24" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Ret Challan Pend Qty</th>
                                                <th data-columnno="25" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>BatchWise</th>
                                                <th data-columnno="26" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>SaleBillNo</th>
                                                <th data-columnno="27" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>SaleBillYearCode</th>
                                                <th data-columnno="28" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>AgainstChallanNo</th>
                                                <th data-columnno="29" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>BatchNo</th>
                                                <th data-columnno="30" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Unique Batch No</th>
                                                <th data-columnno="31" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>SupplierBatchNo</th>
                                                <th data-columnno="32" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>ShelfLife</th>
                                                <th data-columnno="33" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Item Size</th>
                                                <th data-columnno="34" data-sortorder="asc" class="sortCol"><span style="padding:5px;margin:5px" class="sort-icon"><i class="fa" aria-hidden="true"></i></span>Item Color</th>
                                            </tr>
                                        </thead>
                                        <tbody id="divMRNGridAdd">

                                            <partial name="_MaterialReceiptGrid" />

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="progress my-3 mb-3" style="height: 4px;">
                                <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>


                </div>

                <div class="accordion-item">
                    <h2 class="accordion-header" id="HPanel2">
                        <button class="accordion-button collapsed text-light pnl1BG bg-gradient" type="button" data-bs-toggle="collapse" data-bs-target="#ODGrid" aria-expanded="false" aria-controls="ODGrid">
                            <strong style="text-transform:uppercase"><i class="fa-solid fa-table-list fa-lg fa-fw pr35 fa-fade" style="--fa-animation-duration: 2s; --fa-fade-opacity: 0.6;"></i>Other Detail</strong>
                        </button>
                    </h2>
                    <div id="ODGrid" class="accordion-collapse collapse pnl4 bg-gradient" aria-labelledby="H_SAGrid">
                        <div class="accordion-body">
                            <div class="row g-2 gx-3" id="_ItemGrid">
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="FOC" class="form-label">FOC</label>
                                    <input asp-for="FOC" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="TotalAmt" class="form-label">Total Amt</label>
                                    <input asp-for="TotalAmt" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-3  col-xs-12">
                                    <label asp-for="NetAmt" class="form-label">Net Amt</label>
                                    <input asp-for="NetAmt" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-3  col-xs-12">
                                    <label asp-for="CheckQC" class="form-label">Check QC</label>
                                    <input asp-for="CheckQC" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="DepartId" class="form-label">DepartId</label>
                                    <input asp-for="DepartId" type="hidden" class="form-control" readonly />
                                    <input asp-for="DepartIdName" class="form-control" readonly />

                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="RespEmdId" class="form-label">Resp Emp for QC</label>
                                    <input asp-for="RespEmdId" type="hidden" class="form-control" readonly />
                                    <input asp-for="ResEmpName" class="form-control" readonly />

                                </div>
                                <div class="col-xl-2  col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="Remark" class="form-label">Remark </label>
                                    <input asp-for="Remark " class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="TareWeight" class="form-label">Tare Weight</label>
                                    <input asp-for="TareWeight " class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="GrossWeight" class="form-label">Gross Weight</label>
                                    <input asp-for="GrossWeight " class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-xs-12">
                                    <label asp-for="NetWeight" class="form-label">Net Weight</label>
                                    <input asp-for="NetWeight " class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ModeOfTransport" class="form-label">ModeOfTransport</label>
                                    <input asp-for="ModeOfTransport" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EnteredEmpId" class="form-label">Entered By EMP</label>
                                    @*<input type="hidden" asp-for="EnteredEmpId" class="form-control" readonly />*@
                                    @*<input asp-for="EnteredByEmpname" class="form-control" readonly />*@
                                    <select asp-for="EnteredEmpId" asp-items="@(new SelectList(Model.EmployeeList,"Value","Text"))">
                                        <option value="" disabled>-Select-</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ActualEnteredBy" class="form-label">Actual Entered By</label>
                                    <input type="hidden" asp-for="ActualEnteredBy" class="form-control" readonly />
                                    <input asp-for="ActualEntryByName" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="ActualEntryDate" class="form-label">Actual Entry date</label>
                                    <input asp-for="ActualEntryDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="UpdatedBy" class="form-label">Updated By</label>
                                    <input type="hidden" asp-for="UpdatedBy" class="form-control" readonly />
                                    <input asp-for="UpdatedByName" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="UpdatedDate" class="form-label">Updated Date</label>
                                    <input asp-for="UpdatedDate" class="form-control" readonly />
                                </div>
                                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-6 col-xs-12">
                                    <label asp-for="EntryByMachineName" class="form-label">EntryByMachineName</label>
                                    <input type="" asp-for="EntryByMachineName" class="form-control" value="@Environment.MachineName" readonly />

                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="card-header card-headerBG text-light bg-gradient">
            <h5>
                <strong>Material Receipt</strong>
                <span class="d-flex float-end" style="margin-top:-2px;">
                    @*<a asp-action="Dashboard" asp-route-ID="0" class="btn btn-sm btn-outline-light bg-gradient">*@
                    <div class="col-auto">
                        @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                        <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="PrintButton">
                            <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                            PRINT
                        </button>
                    </div>
                    <a asp-action="MRNDashboard" asp-route-ID="0" class="btn btn-secondary btn-sm DashBoard">
                        <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>
                        Dashboard
                    </a>
                    @*<partial name="_FormsButton" />*@
                    <div class="row justify-content-between g-2">
                        <div class="col-auto">
                            <input asp-for="FromDateBack" type="hidden" value="@Model.FromDateBack" />
                            <input asp-for="ToDateBack" type="hidden" value="@Model.ToDateBack" />
                            <input asp-for="GateNoBack" type="hidden" value="@Model.GateNoBack" />
                            <input asp-for="PartCodeBack" type="hidden" value="@Model.PartCodeBack" />
                            <input asp-for="ItemNameBack" type="hidden" value="@Model.ItemNameBack" />
                            <input asp-for="MrnNoBack" type="hidden" value="@Model.MrnNoBack" />
                            <input asp-for="PoNoBack" type="hidden" value="@Model.PoNoBack" />
                            <input asp-for="GlobalSearchBack" type="hidden" value="@Model.GlobalSearchBack" />
                            <input asp-for="DashboardTypeBack" type="hidden" value="@Model.DashboardTypeBack" />
                            <input asp-for="VendorNameBack" type="hidden" value="@Model.VendorNameBack" />
                            @*<a href="#" class="btn offer-listbtn hvr-sweep-to-right btn-sm btn-secondary" onclick="back();">*@
                            <a href="#" class=" btn btn-primary btn-sm" onclick="PressBack();">
                                <i class="fa fa-chevron-circle-left fa-fw fa-lg" aria-hidden="true"></i>
                                BACK
                            </a>
                        </div>
                        @if (Model.Mode != "V" && Model.Mode != "SOC" && Model.Mode != "POC")
                        {
                                <div class="col-auto">
                                @*  <a class="btn btn-sm btn-outline-danger" onclick="location.href=$('form')[0].action">*@
                                    <a class="btn btn-secondary btn-sm" onclick="location.href=$('form')[0].action">
                                    @* <i class="fa-solid fa-grip fa-lg fa-fw fa-beat" style="--fa-animation-duration: 2s;"></i>*@
                                        <i class="fa fa-refresh fa-fw fa-lg" aria-hidden="true"></i>
                                        REFRESH
                                    </a>
                                </div>
                            @if (Model.Mode == "U")
                            {
                                @*Model.Mode = "U";*@
                                        <div class="col-auto">
                                    @* <button type="submit" class="btn btn-sm btn-outline-warning">*@
                                            <button type="submit" class="btn btn-sm btn-outline-light bg-gradient" id="UpdateButton">
                                                <i class="fa fa-pencil-square fa-fw fa-lg" aria-hidden="true"></i>
                                                UPDATE
                                            </button>
                                        </div>
                            }

                            else
                            {
                                        <div class="col-auto">
                                    @*   <button type="submit" class="btn btn-sm btn-outline-primary">*@
                                            <button type="submit" class="btn btn-primary btn-sm" id="submitBTN">
                                                <i class="fa-solid fa-chevron-circle-right"></i>
                                                SUBMIT
                                            </button>
                                        </div>
                            }
                        }
                    </div>
                </span>
            </h5>
        </div>
    </form>


</div>


@section Scripts 
{
        <script>
            var checkBeforeInsert = "false";
            $("button[type='submit']").click(function (e) {

                e.preventDefault();

                CheckBeforeInsert();

                var rowCount = $('#divMRNGridAdd tr').length;
                var batchRowCount = $('#divDisplayGrid tr').length;
                var upperRowCount = $('#divMRNGrid tr').length;


                var billQtyArray = [];
                var ItemCodeArray = [];
                var PartCodeArray = [];
                var BatchPartCodeArray = [];

            var finfromdate = parseDateToFormat($("#FinFromDate").val());
            var fintodate = parseDateToFormat($("#FinToDate").val());
            var entrydate = parseDateToFormat($("#EntryDate").val());
            

            if (parseDate(finfromdate) > parseDate(entrydate)) {
                $.notify('Entrydate should be in financial year...!', "error");
                return;
            }
            if (parseDate(fintodate) < parseDate(entrydate)) {
                $.notify('Entrydate should be in financial year...!', "error");
                return;
            }          

                for (var i = 0; i < rowCount; i++) {

                    if ($('#VendorBatchMand-' + (i + 1)).val() == "Y") {
                        PartCodeArray[i] = $('#PartCode-' + (i + 1)).text();
                    }
                    billQtyArray[i] = parseInt($('#BillQty-' + (i + 1)).text());
                    ItemCodeArray[i] = parseInt($('#ItemCode-' + (i + 1)).val());
                }

                for (var i = 0; i < batchRowCount; i++) {
                    BatchPartCodeArray[i] = $('#BatchPartCode-' + (i + 1)).text();
                }
                const distinctbatchPartArray = [...new Set(BatchPartCodeArray)];

                var distinctPartArray = [...new Set(PartCodeArray)];
                distinctPartArray = distinctPartArray.filter(element => element !== undefined);
                const allInDistinctBatch = distinctPartArray.every(item => distinctbatchPartArray.includes(item));

                if (allInDistinctBatch || $('#DocType').val() == 'SALE RETURN') {
                    // All elements of distinctPartArray are in distinctbatchPartArray
                    console.log("All elements of distinctPartArray are in distinctbatchPartArray.");
                }
                else {
                    $.notify("Please check MRN grid with Batch Detail Grid", "error");
                    return false;
                }

                if ($('#divMRNGridAdd tr td').length <= 1) {
                    $.notify('Grid Should Have Atleast 1 Item...!', "error");
                }
                else if (upperRowCount > 0) {
                    $.notify("Please Add all items to below grid first!!", "error");

                }
                else if (checkBeforeInsert == "True") {
                    $.notify("Entry for this Gate no is already done", "error");
                }
                else if (billQtyArray.includes(0)) {
                    $.notify('Bill Qty cannot be zero...!', "error");

                }
                else if (ItemCodeArray.includes(0)) {
                    $.notify('Item Code cannot be zero...!', "error");
                }
                else {
                    $("form").submit();
                }
            });
           function GetServerDate() 
           {
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetServerDate")",
                async: false, // Note: async:false is deprecated, consider using async/await
                success: function (result, status, error) {
                    console.log(result);
                    if (result != null) {
                        alert("Server Date: " + result);
                        $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(result));
                        $('#manufactureDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(result));
                        $('#ExpiryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(result));
                        $('#manufactureDate').datepicker("option", "maxDate", parseDateToFormat(result));
                    }
                }
            });
        }


            // function GetServerDate() 
            // {
            //     $.ajax({
            //         type: "GET",
            //         url: "@Url.Action("GetServerDate")",
            //         async: false,
            //         success: function (result, status, error) {
            //             console.log(result);
            //             if (result != null)
            //             {
            //             alert("Server Date: " + result);
            //             $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(result));
            //             $('#manufactureDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(result));
            //             $('#ExpiryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(result));
            //             $('#manufactureDate').datepicker("option", "maxDate", result);
            //             }
            //         }
            //     });
            // }

            $('#UpdateButton').click(function (e) {

                e.preventDefault();
                var rowCount = $('#divMRNGridAdd tr').length;
                var batchRowCount = $('#divDisplayGrid tr').length;
                var upperRowCount = $('#divMRNGrid tr').length;
                var billQtyArray = [];
                var ItemCodeArray = [];
                var PartCodeArray = [];
                var BatchPartCodeArray = [];
                for (var i = 0; i < rowCount; i++) {

                    if ($('#VendorBatchMand-' + (i + 1)).val() == "Y") {
                        PartCodeArray[i] = $('#PartCode-' + (i + 1)).text();
                    }
                    billQtyArray[i] = parseInt($('#BillQty-' + (i + 1)).text());
                    ItemCodeArray[i] = parseInt($('#ItemCode-' + (i + 1)).val());
                }
                for (var i = 0; i < batchRowCount; i++) {
                    BatchPartCodeArray[i] = $('#BatchPartCode-' + (i + 1)).text();
                }
                const distinctbatchPartArray = [...new Set(BatchPartCodeArray)];
                const distinctPartArray = [...new Set(PartCodeArray)];

                const allInDistinctBatch = distinctPartArray.every(item => distinctbatchPartArray.includes(item));

                if (allInDistinctBatch) {
                    // All elements of distinctPartArray are in distinctbatchPartArray
                    console.log("All elements of distinctPartArray are in distinctbatchPartArray.");
                } else {
                    // Not all elements of distinctPartArray are in distinctbatchPartArray
                    $.notify("Please check MRN grid with Batch Detail Grid", "error");
                    return false;
                }

                if ($('#divMRNGridAdd tr td').length <= 1) {
                    $.notify('Grid Should Have Atleast 1 Item...!', "error");
                }
                else if (upperRowCount > 0) {
                    $.notify("Please Add all items to below grid first!!", "error");

                }
                else if (billQtyArray.includes(0)) {
                    $.notify('Bill Qty cannot be zero...!', "error");

                }
                else if (ItemCodeArray.includes(0)) {
                    $.notify('Item Code cannot be zero...!', "error");
                }
                else {
                    $("form").submit();
                }
            });

            $('.ClearGrid').click(function () {
                ClearGridAjax();
            });

            function CheckBeforeInsert() {

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("CheckBeforeInsert")",
                    data: { "GateNo": $('#GateNo').val(), "GateYearCode": $('#GateYearCode').val() },
                    async: false,
                    dataType: "json",
                    success: function (data, status, error) {

                        var obj = $.parseJSON(data);
                        if (obj.Result[0].GateCount > 0) {
                            checkBeforeInsert = "True";
                        }
                    },
                    error: function (req, status, error) {
                        alert(error);
                    }
                });
            }


            $(document).ready(function () 
            {
                debugger
                GetFormRights();

                if ($('#Mode').val() != "U" && $('#Mode').val() != "V") 
                {

                    fillEntryandMRN();
                    $('.BatchDetail').fadeOut();
                    var finFromDate = $('#FinFromDate').val();
                    var finToDate = $('#FinToDate').val();

                    var dateParts1 = finFromDate.split("/");
                    var monthNames = {
                        "Jan": "01",
                        "Feb": "02",
                        "Mar": "03",
                        "Apr": "04",
                        "May": "05",
                        "Jun": "06",
                        "Jul": "07",
                        "Aug": "08",
                        "Sep": "09",
                        "Oct": "10",
                        "Nov": "11",
                        "Dec": "12"
                    };

                    var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
                    var dateParts2 = finToDate.split("/");

                    var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];


                    // $('#EntryDate').datepicker("option", "minDate", formattedDate1);
                    // $('#EntryDate').datepicker("option", "maxDate", formattedDate2);
                console.log("start");
                GetServerDate();
                console.log("after server date" + $('#EntryDate').val());

                }
                else 
                {
                    $('#divMRNGrid').empty();
                    CountTotVendBatchQty();
                }
                if ($('#Mode').val() == "U" || $('#Mode').val() == "V") 
                {

                    // var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ")[0]);
                    // var InvoiceDt = parseDateToFormat($('#InvoiceDate').val().split(" ")[0]);
                    // var GateDate = parseDateToFormat($('#GateDate').val().split(" ")[0]);
                    // $('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", EntryDate);
                    // $('#InvoiceDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", InvoiceDt);
                    // $('#GateDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", GateDate);



                console.log($('#EntryDate').val());



                var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ")[0]);
                var InvoiceDt = parseDateToFormat($('#InvoiceDate').val().split(" ")[0]);
                var gatedate = parseDateToFormat($('#GateDate').val().split(" ")[0]);
                console.log(EntryDate);
                console.log(InvoiceDt);
                console.log(gatedate);

                /* var EntryDate = parseDateToFormat($('#EntryDate').val().split(" ").join("/"));
                var InvoiceDt = parseDateToFormat($('#InvoiceDate').val().split(" ").join("/")); */
                $('#EntryDate').datepicker("setDate", EntryDate);
                $('#InvoiceDate').datepicker("setDate", InvoiceDt);
                $('#GateDate').datepicker("setDate", gatedate);
                }
                if ($('#Mode').val() == "I") {
                    $('#GateDate,#InvoiceNo,#InvoiceDate,#DocType,#AccountCode,#Address,#RecInStore,#CurrencyName').val("");
                }
                var finFromDate = $('#FinFromDate').val();
                var finToDate = $('#FinToDate').val();

                var dateParts1 = finFromDate.split("/");
                var monthNames = {
                    "Jan": "01",
                    "Feb": "02",
                    "Mar": "03",
                    "Apr": "04",
                    "May": "05",
                    "Jun": "06",
                    "Jul": "07",
                    "Aug": "08",
                    "Sep": "09",
                    "Oct": "10",
                    "Nov": "11",
                    "Dec": "12"
                };

                var formattedDate1 = dateParts1[0] + "/" + monthNames[dateParts1[1]] + "/" + dateParts1[2];
            console.log("formattedDate1" + finFromDate);
                var dateParts2 = finToDate.split("/");

                var formattedDate2 = dateParts2[0] + "/" + monthNames[dateParts2[1]] + "/" + dateParts2[2];
            console.log("formattedDate2" + finToDate);
            $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(finFromDate));
            $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(finToDate));
            $('#FromDate').datepicker("option", "minDate", parseDateToFormat(finFromDate));
            $('#ToDate').datepicker("option", "maxDate", parseDateToFormat(finToDate));

                console.log($('#FromDate').val());
            console.log($('#ToDate').val());
                //$('#EntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                // $('#ActualEntryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');

               
                functionFeatureOption();
                $('#GateNo').rules("remove", "required");
                $('#GateYearCode').rules("remove", "required");
                $('#MRNNo').rules("remove", "required");
                $('#RecStoreId').rules("remove", "required");
                $('#CurrencyID').rules("remove", "required");
                $('#DepartId').rules("remove", "required");
                $('#FOC').rules("remove", "required");
                $('#RateUnit').rules("remove", "required");
                $('#ShortExcessQty').rules("remove", "required");
                $('#RateinOther').rules("remove", "required");
                $('#Amount').rules("remove", "required");
                $('#PendPOQty').rules("remove", "required");
                $('#RetChallanPendQty').rules("remove", "required");
                $('#BatchWise').rules("remove", "required");
                $('#UniqueBatchNo').rules("remove", "required");
                $('#BillQty').rules("remove", "required");
                $('#SupplierBatchNo').rules("remove", "required");
                $('#ItemColor').rules("remove", "required");
                $('#ItemSize').rules("remove", "required");
                $('#SaleBillNo').rules("remove", "required");
                $('#SaleBillYearCode').rules("remove", "required");
                $('#AgainstChallanNo').rules("remove", "required");
                $('#ShelfLife').rules("remove", "required");
                $('#ItemServType').rules("remove", "required");
                $('#PoType').rules("remove", "required");
                $('#BatchNo').rules("remove", "required");
                $('#CC').rules("remove", "required");
                $('#ModeOfTransport').rules("remove", "required");
                $('#Remark').rules("remove", "required");


                if ($('#DateIntact').val() == "Y") {
                    var fromDt = $('#FromDate').val();
                    var toDt = $('#ToDate').val();
                $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(finFromDate));
                $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(finToDate));
                console.log("inside if"+$('#ToDate').val());
                
                    FillGateNo();
                    //$('#GateNo').val(@Model.GateNo);
                    //            $('#GateYearCode').val(@Model.GateYearCode);
                    $('#GateDate,#CC, #InvoiceNo,#InvoiceDate,#DocType,#AccountCode,#Address,#RecInStore,#CurrencyName').val("");
                }
                else {
                    var fromDate;
                    var toDate;
                $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(finFromDate));
                $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", parseDateToFormat(finToDate));
                $('#FromDate').datepicker("option", "minDate", parseDateToFormat(finFromDate));
                $('#ToDate').datepicker("option", "maxDate", parseDateToFormat(finToDate));
                console.log("else"+$('#ToDate').val());
                }

                bindDept();

                $('#FromDate').change(function () {
                    fromDate = $(this).datepicker('getDate');
                    $('#ToDate').datepicker("option", "minDate", fromDate);
                })
                $('#ToDate').change(function () {
                    toDate = $(this).datepicker('getDate');
                    $('#FromDate').datepicker("option", "maxDate", toDate);
                })
                //$('#FromDate,#ToDate,#EntryDate').datepicker({
                //    format: 'dd-mm-yy',
                //}).datepicker("setDate", 'now');
                //$('#YearCode').val(new Date().getFullYear());
                $('#RecQty').change(function () {

                    alert("hello");
                    var billQty = parseInt($('#BillQty').val());
                    var recQty = parseInt($('#RecQty').val());

                    $('#ShortExcessQty').attr("value", Math.abs(billQty - recQty));
                });
                FillGateNo();

                if ('@Model.IsError' == "true") {
                    var fromDt = $('#FromDate').val();
                    var toDt = $('#ToDate').val();
                    $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", fromDt);
                    $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", toDt);
                    FillGateNo();
                    $('#GateNo').val('@Model.GateNo');
                    $('#GateYearCode').val('@Model.GateYearCode');
                    $('.BatchDetail').fadeIn();

                }
                //else if ($('#DateIntact').val() == "Y") {
                //
                //    var fromDt = $('#FromDate').val();
                //    var toDt = $('#ToDate').val();
                //    $('#FromDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", fromDt);
                //    $('#ToDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", toDt);
                //    FillGateNo();
                //    //$('#GateNo').val(@Model.GateNo);
                //    //            $('#GateYearCode').val(@Model.GateYearCode);
                //    $('#GateDate,#CC, #InvoiceNo,#InvoiceDate,#DocType,#AccountCode,#Address,#RecInStore,#CurrencyName').val("");
                //}
                //var today = new (Date);
                //$("#FromDate,#ToDate").datepicker({ dateFormat: 'dd-mm-yy', minDate: today });
                //$("#FromDate,#ToDate").datepicker("option", "minDate", formatDate(threeMonthsAgo));
                //$("#FromDate,#ToDate").datepicker("option", "maxDate", formatDate(today));
                if ($('#hiddenMode').val() == "U" || $('#hiddenMode').val() == "V") {
                    GetgateItemdata();
                }
            });

            $('#ToDate').change(function () {
                FillGateNo();
            });
            $('#FromDate').change(function () {
                FillGateNo();
            });
            var poNumArray = [];
            var poYearArray = [];
            var schNoArray = [];
            var schYearArray = [];
            var partCodeArray = [];
            var itemNameArray = [];
            var filteredPOArray = [];
            var filteredPOyearArray = [];
            var filteredschnoArray = [];
            var filteredschYearArray = [];
            var filteredpartcodeArray = [];
            var filtereditemNameArray = [];

            $('.BatchDetail').click(function () {

                poNumArray = [];
                poYearArray = [];
                schNoArray = [];
                schYearArray = [];
                partCodeArray = [];
                itemNameArray = [];
                filteredPOArray = [];
                filteredPOyearArray = [];
                filteredschnoArray = [];
                filteredschYearArray = [];
                filteredpartcodeArray = [];
                filtereditemNameArray = [];
                $('#ErrorBox').hide();
                $('#ErrorBox1').hide();
                //$('#manufactureDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                //$('#ExpiryDate').datepicker({ dateFormat: 'dd/mm/yy' }).datepicker("setDate", 'now');
                //$('#manufactureDate').datepicker("option", "maxDate", 'now');
                $('#ExpiryDate').datepicker("option", "minDate", 'today');

                $('#batchTotQty,#batchTotRecQty').val(0);
                $('#batchItemName,#batchPartCode,#batchPONO,#batchpoYear,#batchSchNo,#batchSchYear').empty();
                $('#batchItemName,#batchPartCode,#batchPONO,#batchpoYear,#batchSchNo,#batchSchYear').append('<option value="" selected disabled>-SELECT-</option>');

                var rowCount = $('#divMRNGridAdd tr').length;

                for (var i = 1; i <= rowCount; i++) {
                    var SchYear = $('#SchYear-' + 1).text() == '' ? 0 : $('#SchYear-' + 1).text();
                    if (filteredpartcodeArray.includes($('#ItemCode-' + i).val())) {
                        //do nothing
                    } else {
                        $('#batchItemName').append('<option value=' + $('#ItemCode-' + i).val() + ' data-vendBatch=' + $('#VendorBatchMand-' + i).val() + ' data-recQty=' + $('#RecQty-' + i).text() + ' data-totQty=' + $('#Qty-' + i).text() + ' data-pono=' + $('#PONO-' + i).text() + ' data-poyear=' + $('#POYear-' + i).text() + ' data-schno=' + $('#SchNo-' + i).text() + ' data-schyear=' + SchYear + '>' + $('#ItemName-' + i).text() + '</option>');
                    }
                    if (filteredpartcodeArray.includes($('#ItemCode-' + i).val())) {
                        //do nothing
                    } else {
                        $('#batchPartCode').append('<option value=' + $('#ItemCode-' + i).val() + ' data-recQty=' + $('#RecQty-' + i).text() + ' data-totQty=' + $('#Qty-' + i).text() + ' data-pono=' + $('#PONO-' + i).text() + ' data-poyear=' + $('#POYear-' + i).text() + ' data-schno=' + $('#SchNo-' + i).text() + ' data-schyear=' + SchYear + '>' + $('#PartCode-' + i).text() + '</option>');

                    }
                    //if (filteredPOArray.includes($('#PONO-' + i).text())) {
                    //    //do nothing
                    //} else {
                    //    $('#batchPONO').append('<option value=' + $('#PONO-' + i).text() + ' >' + $('#PONO-' + i).text() + '</option>');
                    //}
                    //if (filteredPOyearArray.includes($('#POYear-' + i).text())) {
                    //    //do nothing
                    //} else {
                    //    $('#batchpoYear').append('<option value=' + $('#POYear-' + i).text() + '>' + $('#POYear-' + i).text() + '</option>');
                    //}
                    //if (filteredschnoArray.includes($('#SchNo-' + i).text())) {
                    //    //do nothing
                    //} else {
                    //    $('#batchSchNo').append('<option value=' + $('#SchNo-' + i).text() + '>' + $('#SchNo-' + i).text() + '</option>');
                    //}
                    //if (filteredschYearArray.includes($('#SchYear-' + i).text())) {
                    //    //do nothing
                    //} else {
                    //    $('#batchSchYear').append('<option value=' + $('#SchYear-' + i).text() + '>' + $('#SchYear-' + i).text() + '</option>');
                    //}

                    partCodeArray.push($('#ItemCode-' + i).val());
                    itemNameArray.push($('#ItemCode-' + i).val());
                    filteredpartcodeArray = partCodeArray.filter((value, index, self) => self.indexOf(value) === index);
                    filtereditemNameArray = itemNameArray.filter((value, index, self) => self.indexOf(value) === index);
                    //poNumArray.push($('#PONO-' + i).text());
                    //poYearArray.push($('#POYear-' + i).text());
                    //schNoArray.push($('#SchNo-' + i).text());
                    //schYearArray.push($('#SchYear-' + i).text());
                    //filteredPOArray = poNumArray.filter((value, index, self) => self.indexOf(value) === index);
                    //filteredPOyearArray = poYearArray.filter((value, index, self) => self.indexOf(value) === index);
                    //filteredschnoArray = schNoArray.filter((value, index, self) => self.indexOf(value) === index);
                    //filteredschYearArray = schYearArray.filter((value, index, self) => self.indexOf(value) === index);

                }

                $('#BatchDetailModel').modal("show");
            });

            $(document).on('change', '#batchItemName,#batchPartCode', function (e) {
                var cntId = e.target.id;

                if (cntId == 'batchItemName') {
                    BatchItemNameChange(cntId);
                }
                else {
                    BatchPartCodeChange(cntId);
                }

            });

            function ValidateBatchdetail() {

                var Err = 0;
                if ($('#batchPartCode').prop('selectedIndex') <= 0 || $('#batchItemName').prop('selectedIndex') <= 0) {
                    AddErrorCls('batchPartCode'), AddErrorCls('batchItemName');
                    Err = 1;
                }
                else {
                    RemoveErrorCls('batchPartCode'), RemoveErrorCls('batchItemName');
                }
                if ($('#batchPONO option').length > 1) {
                    if ($('#batchPONO').prop('selectedIndex') == 0) {
                        AddErrorCls('batchPONO');
                        Err = 1;
                    }
                    else {
                        RemoveErrorCls('batchPONO');
                    }
                    if ($('#batchpoYear').prop('selectedIndex') == 0) {
                        AddErrorCls('batchpoYear');
                        Err = 1;
                    }
                    else {
                        RemoveErrorCls('batchpoYear');
                    }
                }
                if ($('#vendorBatchQty').val() == "" || $('#vendorBatchQty').val() == null || parseInt($('#vendorBatchQty').val()) <= 0) {
                    AddErrorCls('vendorBatchQty');
                    Err = 1;
                }
                else {
                    RemoveErrorCls('vendorBatchQty');
                }
                if ($('#vendorBatchNo').val() == "" || $('#vendorBatchNo').val() == null || parseInt($('#vendorBatchNo').val()) == 0) {
                    AddErrorCls('vendorBatchNo');
                    Err = 1;
                }
                else {
                    RemoveErrorCls('vendorBatchNo');
                }

                Err == 1 ? ShowErrorFld('H_SAGrid') : HideErrorFld('H_SAGrid');
                if (Err == 1) return false;

                return true;
            }

            $('#AddBatchDetail').click(function (e) {

                e.preventDefault();

                if (!ValidateBatchdetail()) return;


                var BatchData = {
                    "ItemCode": parseInt($('#batchItemName').val()),
                    "ItemName": $('#batchItemName').find(':selected').text(),
                    "PartCode": $('#batchPartCode').find(':selected').text(),
                    "PONO": $('#batchPONO').val(),
                    "POYearCode": $('#batchpoYear').val(),
                    "SchNo": $('#batchSchNo').val(),
                    "SchYearCode": $('#batchSchYear').val(),
                    "Qty": parseFloat($('#batchTotQty').val()),
                    "RecQty": parseFloat($('#batchTotRecQty').val()),
                    "VendorBatchQty": parseFloat($('#vendorBatchQty').val()),
                    "VendorBatchNo": $('#vendorBatchNo').val(),
                    "UniqueBatchNO": $('#uniqueBatchNum').val(),
                    "ManufactureDate": $('#manufactureDate').val(),
                    "ExpiryDate": $('#ExpiryDate').val()
                }

                $.ajax({
                    url: "@Url.Action("AddBatchDetail")",
                    type: "POST",
                    data: BatchData,
                    beforeSend: function (xhr) {
                        //xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
                    },
                    success: function (data, status, xhr) {

                        if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                            $.notify('Vendor batch Qty Exceeded', "info");
                            $('#ErrorBox').show();
                            $('.ItemBtn').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                        }
                        else if (xhr.status == 205) {
                            $.notify('Cannot Add duplicate Vendor batch Number', "info");
                            $('#ErrorBox1').show();
                        }
                        else {
                            //if (!DelSeqNo && DelSeqNo != 0) {
                            //    $('#divSaleItemGrid ."' + DelSeqNo + "'").remove();
                            //}
                            $('#divDisplayGrid').html(data);
                            $.notify('Item Added To Grid.', "success");
                            $('#ErrorBox').hide();
                            $('#ErrorBox1').hide();
                            CountTotVendBatchQty();
                            $('#vendorBatchNo').val('');
                            $('#uniqueBatchNum').val('');

                            var batchGridCount = $('#divDisplayGrid tr').length;
                            if (batchGridCount > 0) {

                                var sum = 0;
                                for (var i = 1; i <= batchGridCount; i++) {
                                    if ($('#PONOBatchAdd-' + i).text() == '') {
                                        if ($('#ItemCodeBatch-' + i).val() == parseInt($('#batchItemName').val())) {
                                            sum += parseInt($('#VendorBatchQty-' + i).text());
                                        }
                                    }
                                    else {
                                        if ($('#SchNoBatchAdd-' + i).text() == '') {
                                            if ($('#ItemCodeBatch-' + i).val() == parseInt($('#batchItemName').val()) && $('#PONOBatchAdd-' + i).text() == $('#batchPONO').val()) {
                                                sum += parseInt($('#VendorBatchQty-' + i).text());
                                            }
                                        }
                                        else {
                                            if ($('#ItemCodeBatch-' + i).val() == parseInt($('#batchItemName').val()) && $('#PONOBatchAdd-' + i).text() == $('#batchPONO').val() && $('#SchNoBatchAdd-' + i).text() == $('#batchSchNo').val()) {
                                                sum += parseInt($('#VendorBatchQty-' + i).text());
                                            }
                                        }


                                    }
                                }
                                $('#vendorBatchQty').val(parseInt($('#batchTotRecQty').val()) - sum); //batchTotRecQty
                            }
                            //ClearGrid();
                        }

                    },
                    error: function (result, status, xhr) {
                        $.notify(result.responseText, "error");
                    }
                });

            });

            function CountTotVendBatchQty() {

                var BatchRowCount = $('#divDisplayGrid tr').length;
                if (BatchRowCount > 0) {
                    var sum = 0;
                    for (var i = 1; i <= BatchRowCount; i++) {
                        sum += parseInt($('#VendorBatchQty-' + i).text());
                    }
                    $('#TotvendRecQty').text(sum);
                } else {
                    $('#TotvendRecQty').text(0);
                }
            }

            function ClearGrid() {
                $('#batchItemName,#batchPartCode,#batchPONO,#batchpoYear,#batchSchNo,#batchSchYear').prop('selectedIndex', 0);
                $('#batchTotQty,#batchTotRecQty,#vendorBatchQty').val(0);
                $('#vendorBatchNo,#uniqueBatchNum').val('');
            }

            var currentSearchColumn = null;
            $("#search-box").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#divMRNGridAdd tr").filter(function () {
                    if (currentSearchColumn !== null) {
                        var columnText = $(this).find('td').eq(currentSearchColumn).text().toLowerCase();
                        $(this).toggle(columnText.indexOf(value) > -1);
                    } else {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                    }
                });
            });


            $(document).on("click", "th[data-columnno]", function () {
                currentSearchColumn = $(this).data('columnno');
                $("#search-box").val('').trigger('keyup'); // Reset search box and trigger the search
            });
            $(document).on("click", ".sortCol", function () {
                ;
                var $column = $(this).parent().closest("th");
                var colno = $(this).data('columnno');
                var currentOrder = $(this).data('sortorder');

                $('.sortCol').css('color', 'white');
                if (currentOrder === 'asc') {
                    sortTable(colno, false);
                    $(this).data('sortorder', 'desc');
                    $(this).css('color', 'yellow'); // Visual indication of descending order
                    //$(this).css('font-size', 'larger'); // Visual indication of descending order
                    $(this).find('i:first').removeClass('fa-arrow-up');
                    $(this).find('i:first').addClass('fa-arrow-down');
                } else {
                    sortTable(colno, true);
                    $(this).data('sortorder', 'asc');
                    $(this).css('color', 'yellow');
                    // $(this).css('font-size', 'larger'); // Visual indication of ascending order
                    $(this).find('i:first').removeClass('fa-arrow-down');
                    $(this).find('i:first').addClass('fa-arrow-up');
                }
            });
            function sortTable(columnIndex, ascending) {

                var table = $('#MRNTable');
                var rows = table.find('#divMRNGridAdd > tr').toArray();

                rows.sort(function (a, b) {
                    var aValue = $(a).find('td').eq(columnIndex).text();
                    var bValue = $(b).find('td').eq(columnIndex).text();

                    var aIntValue = 0;
                    var bIntValue = 0;
                    if (/^\d*\.?\d+$/.test(aValue) && /^\d*\.?\d+$/.test(bValue)) {
                        aIntValue = parseInt(aValue, 10);
                        bIntValue = parseInt(bValue, 10);
                    }

                    if (aIntValue > 0) {
                        if (ascending) {
                            return aValue - bValue;
                        } else {
                            return bValue - aValue;
                        }
                    } else {
                        if (ascending) {
                            return aValue.localeCompare(bValue);
                        } else {
                            return bValue.localeCompare(aValue);
                        }
                    }
                });

                $.each(rows, function (index, row) {
                    table.children('#divMRNGridAdd').append(row);
                });
            }

            $('#clearBTN').click(function () {
                ClearGrid();
                var dataParams = {
                    "FromDate": $('#FromDate').val(),
                    "ToDate": $('#ToDate').val()
                }
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("ClearbatchGridAjax")",
                    data: dataParams,
                    dataType: "json",
                    success: function (data, status, error) {
                        $('#divDisplayGrid').empty();
                    },
                    error: function (req, status, error) {
                        alert(error);
                    }
                });
            });

            function BatchItemNameChange(ID) {
                poNumArray = [];
                filteredPOArray = [];
                $("#batchItemCode").val($('#batchItemName').find(":selected").data('itemcode'));
                var rowCount = $('#divMRNGridAdd tr').length;
                $('#batchPONO').empty();
                $('#batchPONO').append('<option value="" disabled>-SELECT-</option>');
                for (var e = 1; e <= rowCount; e++) {
                    if ($('#PONO-' + e).text() != '') {
                        if ($('#batchItemName').find(':selected').text() == $('#ItemName-' + e).text()) {

                            //$('#batchPONO').append('<option value=' + $('#PONO-' + e).text() + '>' + $('#PONO-' + e).text() + '</option>');
                            if (filteredPOArray.includes($('#PONO-' + e).text())) {
                                //do nothing
                            } else {
                                $('#batchPONO').append('<option value=' + $('#PONO-' + e).text() + '>' + $('#PONO-' + e).text() + '</option>');
                            }
                            poNumArray.push($('#PONO-' + e).text());
                            filteredPOArray = poNumArray.filter((value, index, self) => self.indexOf(value) === index);
                        }
                    }
                    else {
                        $("#batchTotQty").val($('#batchItemName').find(":selected").data('totqty'));
                        $("#batchTotRecQty").val($('#batchItemName').find(":selected").data('recqty'));
                    }


                }

                SetPartCodeItemName(ID);
                //GetItemPartCode(ID);
            }

            function BatchPartCodeChange(ID) {
                poNumArray = [];
                filteredPOArray = [];
                $("#batchItemCode").val($('#batchPartCode').find(":selected").data('itemcode'));

                var rowCount = $('#divMRNGridAdd tr').length;
                $('#batchPONO').empty();
                $('#batchPONO').append('<option value="">-SELECT-</option>');
                for (var e = 1; e <= rowCount; e++) {
                    if ($('#PONO-' + e).text() != '') {
                        if ($('#batchPartCode').find(':selected').text() == $('#PartCode-' + e).text()) {
                            //$('#batchPONO').append('<option value=' + $('#PONO-' + e).text() + '>' + $('#PONO-' + e).text() + '</option>');
                            if (filteredPOArray.includes($('#PONO-' + e).text())) {
                                //do nothing
                            } else {
                                $('#batchPONO').append('<option value=' + $('#PONO-' + e).text() + '>' + $('#PONO-' + e).text() + '</option>');
                            }
                            poNumArray.push($('#PONO-' + e).text());
                            filteredPOArray = poNumArray.filter((value, index, self) => self.indexOf(value) === index);
                        }
                    }
                    else {
                        $("#batchTotQty").val($("#batchPartCode").find(":selected").data('totqty'));
                        $("#batchTotRecQty").val($("#batchPartCode").find(":selected").data('recqty'));
                    }
                }


                $.when(SetPartCodeItemName(ID)).done(function () {
                    //GetItemPartCode(ID)
                });
                //GetItemPartCode(ID);
            }

            $('#batchPONO').change(function () {

                poYearArray = [];
                filteredPOyearArray = [];
                var rowCount = $('#divMRNGridAdd tr').length;
                $('#batchpoYear').empty();
                $('#batchpoYear').append('<option value="">-SELECT-</option>');
                for (var e = 1; e <= rowCount; e++) {
                    if ($('#batchPONO').find(':selected').text() == $('#PONO-' + e).text() && $('#batchPartCode').find(':selected').text() == $('#PartCode-' + e).text()) {
                        if (filteredPOyearArray.includes($('#POYear-' + e).text())) {
                            //do nothing
                        } else {
                            $('#batchpoYear').append('<option value=' + $('#POYear-' + e).text() + ' data-totqty=' + $('#Qty-' + e).text() + ' data-recqty=' + $('#RecQty-' + e).text() + '>' + $('#POYear-' + e).text() + '</option>');
                        }
                        poYearArray.push($('#POYear-' + e).text());
                        filteredPOyearArray = poYearArray.filter((value, index, self) => self.indexOf(value) === index);
                    }
                }
            });

            $('#batchpoYear').change(function () {
                if ($('#SchNo-' + e).text() == 'NA' || $('#SchNo-' + e).text() == '') {
                    //$("#batchTotQty").val($(this).find(":selected").data('totqty'));
                    //$("#batchTotRecQty").val($(this).find(":selected").data('recqty'));
                }

                schNoArray = [];
                filteredschnoArray = [];
                var rowCount = $('#divMRNGridAdd tr').length;
                $('#batchSchNo').empty();
                $('#batchSchNo').append('<option value="">-SELECT-</option>');
                for (var e = 1; e <= rowCount; e++) {
                    if ($('#batchPONO').find(':selected').text() == $('#PONO-' + e).text() && $('#batchPartCode').find(':selected').text() == $('#PartCode-' + e).text()) {
                        if (filteredschnoArray.includes($('#SchNo-' + e).text())) {
                            //do nothing
                        } else {
                            if ($('#SchNo-' + e).text() == 'NA' || $('#SchNo-' + e).text() == '') {
                                $("#batchTotQty").val($(this).find(":selected").data('totqty'));
                                $("#batchTotRecQty").val($(this).find(":selected").data('recqty'));
                            }
                            else {

                                $('#batchSchNo').append('<option value=' + $('#SchNo-' + e).text() + ' >' + $('#SchNo-' + e).text() + '</option>');
                            }
                        }
                        schNoArray.push($('#SchNo-' + e).text());
                        filteredschnoArray = schNoArray.filter((value, index, self) => self.indexOf(value) === index);
                    }
                }
            });

            $('#batchSchNo').change(function () {


                schYearArray = [];
                filteredschYearArray = [];
                var rowCount = $('#divMRNGridAdd tr').length;
                $('#batchSchYear').empty();
                $('#batchSchYear').append('<option value="">-SELECT-</option>');
                for (var e = 1; e <= rowCount; e++) {
                    if ($('#batchSchNo').find(':selected').text() == $('#SchNo-' + e).text() && $('#batchPartCode').find(':selected').text() == $('#PartCode-' + e).text()) {
                        if (filteredschnoArray.includes($('#POYear-' + e).text())) {
                            //do nothing
                        } else {

                            $('#batchSchYear').append('<option value=' + $('#SchYear-' + e).text() + ' data-totqty=' + $('#Qty-' + e).text() + ' data-recqty=' + $('#RecQty-' + e).text() + '>' + $('#SchYear-' + e).text() + '</option>');

                        }
                        schYearArray.push($('#SchYear-' + e).text());
                        filteredschYearArray = schYearArray.filter((value, index, self) => self.indexOf(value) === index);
                    }
                }
            });

            $('#batchSchYear').change(function () {
                $("#batchTotQty").val($(this).find(":selected").data('totqty'));
                $("#batchTotRecQty").val($(this).find(":selected").data('recqty'));
            });

            function SetPartCodeItemName(ID) {
                if (!ID) return;
                else {
                    var v = $('#' + ID).val();
                    if (ID == "batchPartCode") {
                        $("#batchItemName").val(v);
                    }

                    if (ID == "batchItemName") {
                        $("#batchPartCode").val(v);
                    }
                }
            }

            function fillEntryandMRN() {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("FillEntryandMRN")",
                    dataType: "json",
                    data: { "YearCode": $('#YearCode').val() },
                    success: function (result, status, error) {
                        console.log(result);
                        if (result != null) {
                            var obj = $.parseJSON(result);
                            console.log(obj);
                            $('#EntryID').val(obj.Result[0].EntryId);
                            $('#MRNNo').val(obj.Result[0].MRNNO);
                        }
                    }
                });
            }

            function GetFormRights() {
                $.ajax({
                    url: "@Url.Action("GetFormRights")",
                    type: "POST",
                    success: function (data) {
                        if (data != null) {
                            var obj = $.parseJSON(data);
                            console.log(obj);
                            var optAll = obj.Result.Table[0].OptAll;
                            var optSave = obj.Result.Table[0].OptSave;
                            var optUpdate = obj.Result.Table[0].OptUpdate;
                            var optDelete = obj.Result.Table[0].OptDelete;
                            var optView = obj.Result.Table[0].OptView;
                            if (!optAll) {
                                if (!optSave) {
                                    $("#submitBTN").prop("disabled", true);
                                }
                            if (!(optUpdate || optDelete || optView)) {
                                $(".DashBoard")
                                    .addClass("disabled-link")
                                    .on("click", function (e) {
                                        e.preventDefault(); // Prevents clicking the link
                                    });
                            }
                            }
                        }
                    },
                    error: function (errMsg) {
                        $.notify(errMsg, { position: "top center", className: "error" });
                    }
                });
            }

            function functionFeatureOption() {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("CheckFeatureOption")",
                    dataType: "json",
                    success: function (result, status, error) {
                        if (result != null) {
                            var obj = $.parseJSON(result);
                            var allowOption = obj.Result.Table[0].AllowBackDateMRNEntry;
                            console.log(allowOption);
                            if (allowOption == 'Y') {
                                //$('#EntryDate').prop("readonly", false);
                                $('#EntryDate').prop("disabled", false);
                                $('#EntryDate').css('color', 'rgb(248 255 178)'); // feature option
                            }
                            else {
                                $('#EntryDate').prop("readonly", true);
                                $('#EntryDate').prop("disabled", true);
                                $('#EntryDate').css('color', 'rgb(248 255 178)'); // feature option
                            }
                        }
                    }
                });
            }

            function AltUnitConversion(ItemCode, UnitQty, i) {//for getting AltQty -> BillQty
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("AltUnitConversion")",
                    dataType: "json",
                    async: false,
                    data: { "ItemCode": ItemCode, "AltQty": 0, "UnitQty": UnitQty },
                    success: function (data, status, error) {
                        if (data != null) {
                            var obj = $.parseJSON(data);
                            $('#altqty' + i).val(obj.Result[0].AltUnitValue);
                        }
                    },
                    error: function (req, status, error) {
                        alert(error);
                    }
                });
            }

            function AltRecUnitConversion(ItemCode, UnitQty, i) { // for getting AltRecQty -> RecQty
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("AltUnitConversion")",
                    dataType: "json",
                    async: false,
                    data: { "ItemCode": ItemCode, "AltQty": 0, "UnitQty": UnitQty },
                    success: function (data, status, error) {
                        if (data != null) {
                            var obj = $.parseJSON(data);
                            $('#AltRecQty' + i).val(obj.Result[0].AltUnitValue);
                        }
                    },
                    error: function (req, status, error) {
                        alert(error);
                    }
                });
            }

            function bindDept() {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("BindDept")",
                    dataType: "json",
                    success: function (result, status, error) {
                        if (result != null) {
                            var obj = $.parseJSON(result);
                            if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                                $('#DepartId').empty();
                                $('#DepartId').append('<option disabled selected>-Select-</option>');
                                $.each(obj.Result, function (index, val) {
                                    $('#DepartId').append('<option value="' + val.EntryId +
                                        '">' + val.DeptName + '</option>');

                                });
                            }
                        }
                    }
                });
            }

            function FillAltUnit() {

            }

            function FillGateNo() {
                var dataParams = {
                    "FromDate": $('#FromDate').val(),
                    "ToDate": $('#ToDate').val()
                }
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("GetGateNo")",
                    data: dataParams,
                    async: false,
                    dataType: "json",
                    success: function (result, status, error) {
                        if (result != null) {
                            var obj = $.parseJSON(result);
                            if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                                $('#GateNo,#GateYearCode').empty();
                                $('#GateNo').append('<option disabled selected>-Select-</option>');
                                $('#GateYearCode').append('<option selected>-Select-</option>');
                                $.each(obj.Result, function (index, val) {
                                    $('#GateNo').append('<option value="' + val.GateNo +
                                        '" data-year-code="' + val.YEARCODE +
                                        '" data-gate-entry="' + val.EntryId +
                                        '" data-branch="' + val.CC +
                                        '">' + val.GateNo + '</option>');
                                    $('#GateYearCode').append('<option style="display:none" value="' + val.YEARCODE +
                                        '" data-gate-no="' + val.GateNo +
                                        '" data-branch="' + val.CC +
                                        '">' + val.YEARCODE + '</option>');

                                });
                            }
                            else {
                                $('#GateNo,#GateYearCode').empty();
                            }
                        }
                    }
                });
            }

            $('#GateNo').change(function () {
                $('#GateEntry').val($(this).find(":selected").data('gate-entry'));
                $("#GateYearCode").find("option").css('display', 'none');
                $("#GateYearCode").find("option").prop("selected", false);
                $("#GateYearCode").find('option:first').css('display', 'block');
                $("#GateYearCode").find('option:first').attr('selected', 'selected');
                $("#GateYearCode").find("[data-gate-no='" + $(this).val() + "']").css('display', 'block');
                $('#divMRNGridAdd').empty();
                var dataParams = {
                    "FromDate": $('#FromDate').val(),
                    "ToDate": $('#ToDate').val()
                }
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("ClearGridAjax")",
                    data: dataParams,
                    dataType: "json",
                    success: function (data, status, error) {
                        console.log("Grid cleared");
                        $('#divMRNGridAdd').empty();
                        $('#divMRNGrid').empty();
                    },
                    error: function (req, status, error) {
                        alert(error);
                    }
                });
            });

            function ClearGridAjax() {
                var dataParams = {
                    "FromDate": $('#FromDate').val(),
                    "ToDate": $('#ToDate').val()
                }
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("ClearGridAjax")",
                    data: dataParams,
                    dataType: "json",
                    async: false,
                    success: function (data, status, error) {
                        console.log("Grid cleared");
                        $('#divMRNGridAdd').empty();
                    },
                    error: function (req, status, error) {
                        alert(error);
                    }
                });
            }

            $('#GateYearCode').change(function () {
                ClearGridAjax();
                $('#divMRNGrid').empty();
                $('#CC').val($(this).find(":selected").data('branch'));
                var dataParams = {
                    "GateNo": $('#GateNo').val(),
                    "GateYearCode": $('#GateYearCode').val(),
                    "GateEntryId": parseInt($('#GateEntry').val())
                }
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("GetGateMainData")",
                    data: dataParams,
                    success: function (result, status, error) {
                        if (result != null) {

                            var obj = $.parseJSON(result);
                            if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                                $.each(obj.Result, function (index, val) {
                                    $('#GateDate').val(val.GDate);
                                    $('#AccountCode').val(val.account_name);
                                    $('#Address').val(val.address);
                                    $('#DocType').val(val.DocName);
                                    $('#InvoiceNo').val(val.Invoiceno);
                                    $('#InvoiceDate').val(val.InvoiceDate);
                                    $('#DOCID').val(val.docTypeId);
                                    $('#AccountID').val(val.AccountCode);
                                    $('#CheckQC').val(val.checkQC);
                                    $('#RecInStore').val(val.RecInStore);
                                    $('#RecStoreId').val(val.StoreId);
                                    $('#CurrencyID').val(val.CurrencyId);
                                    $('#CurrencyName').val(val.CurrencyName);
                                    $('#TotalAmt').val(val.TotalAmt);
                                    $('#NetAmt').val(val.NetAmt);
                                    $('#NetWeight').val(val.NetWeight);
                                    $('#TareWeight').val(val.TareWeight);
                                    $('#Remark').val(val.Remark);
                                    $('#GrossWeight').val(val.GrossWeight);
                                    $('#ModeOfTransport').val(val.ModeOftransport);
                                });
                            }
                        }
                    }
                });
                GetgateItemdata();

            });

            function GetgateItemdata() {
                var dataParams = {
                    "GateNo": $('#GateNo').val(),
                    "GateYearCode": $('#GateYearCode').val(),
                    "GateEntryId": parseInt($('#GateEntry').val())
                }
                $.ajax({
                    url: "@Url.Action("GetGateItemData")",
                    async: false,
                    data: dataParams,
                    success: function (result, status, xhr) {
                        if (result != null) {
                            var obj = $.parseJSON(result);
                            if (obj.StatusCode == 200 && obj.StatusText == 'Success') {
                                var html = '';
                                $('#divMRNGrid').empty();
                                var i = 1;
                                $.each(obj.Result, function (index, val) {

                                    var DeptId = "";
                                    var empId = "";

                                    if (val.ItemsForDepartmentID == '' || val.ItemsForDepartmentID == 0) {
                                        //do nothing
                                    }
                                    else {
                                        $('#DepartId').val(val.ItemsForDepartmentID);
                                    }
                                    if (val.ResposibleEmplforQC == '' || val.ResposibleEmplforQC == 0) {
                                        //do nothing
                                    }
                                    else {
                                        $('#RespEmdId').val(val.ResposibleEmplforQC);
                                    }

                                    if (val.SchNo == "") {
                                        val.SchNo = "NA";
                                    }

                                    html += '<tr><td><input type="hidden" id="VendorBatchMand' + i + '" value=' + val.VendorBatchcodeMand + ' /><input readonly id="PONo' + i + '" value=' + val.PONo + '  ></td><td><input style="width:50px" id="POYearCode' + i + '" value=' + val.POYearCode + ' readonly ></td><td><input style="width:80px" id="SchNo' + i + '" value=' + val.SchNo + ' readonly ></td><td><input style="width:50px" id="SchYearCode' + i + '" value=' + val.SchYearCode + ' readonly ></td><td><input style="width:70px" id="POType' + i + '" readonly value=' + val.POType + '  ></td><td><input style="width:80px" id="PODate' + i + '" value=' + val.PODate + ' readonly ></td><td><input id="Item_Name' + i + '" value=' + JSON.stringify(val.Item_Name) + ' readonly ></td><td><input style="width:100px !important;" id="PartCode' + i + '" value=' + val.PartCode + ' readonly ></td><td><input style="width:50px" id="unit' + i + '" value=' + val.unit + ' readonly ></td><td><input style="width:50px" id="Qty' + i + '" value=' + val.Qty + ' readonly ></td><td><input style="width:50px" readonly id="BillQty' + i + '" onchange="BillQtyChange(' + i + ');" value=' + val.BillQty + ' ></td><td><input style="width:50px;background-color:#ffd6dd !important" id="RecQty' + i + '" onchange="RecQtyChange(' + i + ');" value=' + val.RecQty + ' ></td><td><input style="width:70px" id="altqty' + i + '" value=' + val.altqty + ' readonly ></td><td><input style="width:50px" id="RateUnit' + i + '" readonly value=' + val.RateUnit + ' ></td><td><input style="width:50px" id="altunit' + i + '" value="' + val.altunit + '" readonly ></td><td><input style="width:50px;background-color:#ffd6dd !important" id="NoofCase' + i + '" value=' + val.NoofCase + ' readonly ></td><td><input style="width:50px;background-color:#ffd6dd !important" id="AltRecQty' + i + '" value=' + val.AltRecQty + ' ></td><td><input style="width:50px;" id="ShortExcessQty' + i + '" readonly value=' + val.ShortExcessQty + ' ></td><td><input style="width:50px;"  id="Rate' + i + '" value=' + val.Rate + ' ></td><td><input style="width:50px;" id="RateInOtherCurr' + i + '" readonly value=' + val.RateInOtherCurr + ' ></td><td><input style="width:50px;" id="Amount' + i + '" readonly value=' + val.Amount + ' ></td><td><input style="width:50px;" id="PendPOQty' + i + '" readonly value=' + val.PendPOQty + ' > </td><td> <input style="width:50px;" id="QCCompleted' + i + '" readonly value=' + val.QCCompleted + ' ></td><td><input style="width:50px;" id="RetChallanPendQty' + i + '" readonly value=' + val.RetChallanPendQty + ' ></td><td><input style="width:50px;" id="BatchWise' + i + '" readonly value=' + val.Batchwise + ' ></td><td><input style="width:50px;" id="SaleBillNo' + i + '" readonly value=' + val.SaleBillNo + ' ></td><td><input style="width:50px;" id="SaleBillYearCode' + i + '" readonly value=' + val.SaleBillYearCode + ' ></td><td><input style="width:50px;" id="AgainstChallanNo' + i + '" readonly value=' + val.AgainstChallanNo + ' ></td><td><input id="BatchNo' + i + '" readonly value=' + val.BatchNo + ' ></td><td><input id="Uniquebatchno' + i + '" readonly value=' + val.Uniquebatchno + ' ></td><td><input id="SupplierBatchNo' + i + '" readonly value=' + val.SupplierBatchNo + ' > </td><td><input id="ShelfLife' + i + '" readonly value=' + val.ShelfLife + ' ></td><td> <input id="ItemSize' + i + '" readonly value=' + JSON.stringify(val.ItemSize) + ' ></td><td><input id="ItemColor' + i + '" readonly value=' + JSON.stringify(val.ItemColor) + ' ></td><td><input id="ItemCode' + i + '" type="hidden" value=' + val.ItemCode + ' ></td></tr > ';
                                    i++;
                                });
                                $('#divMRNGrid').append(html);
                                var rowCount = $('#divMRNGrid tr').length;
                                for (var i = 1; i <= rowCount; i++) {
                                    AltUnitConversion($('#ItemCode' + i).val(), $('#BillQty' + i).val(), i);
                                    AltRecUnitConversion($('#ItemCode' + i).val(), $('#RecQty' + i).val(), i);
                                }
                            }
                        }
                        if ($('#PONO').val() == '') {
                            $('#Rate').prop("readonly", false);
                        }
                    },
                });
                if ($('#DepartId').val() == '' && $('#RespEmpId').val() == '') {
                    //do nothing
                }
                else {
                    $.ajax({
                        url: '@Url.Action("GetDeptAndEmp")',
                        type: "POST",
                        data: { "DeptId": $('#DepartId').val(), "RespEmp": $('#RespEmdId').val() },
                        success: function (data, status, xhr) {

                            DataEntryGate();
                            var obj = $.parseJSON(data);
                            if (obj != null) {

                                $('#DepartIdName').val(obj.Result.Table[0].deptname);
                                $('#ResEmpName').val(obj.Result.Table[0].empname);
                            }
                        },
                        error: function (response, status, xhr) {
                            alert(response.responseText);
                            $.notify(response.responseText, "error");
                        },
                        failure: function (response, status, xhr) {
                            alert(response.responseText);
                            $.notify(response.responseText, "error");
                        }
                    });
                }



            }

            function DataEntryGate() {

                var inputDate = $('#GateDate').val();

                const date = new Date(inputDate);

                const day = date.getDate();
                const month = date.getMonth() + 1; // Note: Months are zero-based, so we add 1
                const year = date.getFullYear();

                const formattedDate = `${day}/${month < 10 ? '0' : ''}${month}/${year}`;

                console.log(formattedDate); // Output: "17/08/2023"
                //$('#EntryDate').datepicker("option", "minDate", formattedDate);
            }

            $('.GridButton').click(function () {
                //if ($('#hiddenMode').val() == "U" || $('#hiddenMode').val() == "V") {
                //    var rowCount = $('#divMRNGrid tr').length;

                //    var ItemData = [];
                //    for (let i = 1; i <= rowCount; i++) {
                //        var pono = '#PONo' + i;

                //        ItemData.push({
                //            "PONO": $('#PONo--' + i).val(),
                //            "PoYearCode": $('#POYearCode--' + i).val(),
                //            "SchNo": $('#SchNo--' + i).val(),
                //            "SchYearCode": $('#SchYearCode--' + i).val(),
                //            "PoType": $('#POType--' + i).val(),
                //            "PODate": $('#PODate--' + i).val(),
                //            "ItemName": $('#Item_Name--' + i).val(),
                //            "PartCode": $('#PartCode--' + i).val(),
                //            "Unit": $('#unit--' + i).val(),
                //            "Qty": $('#Qty--' + i).val(),
                //            "AltQty": $('#altqty--' + i).val(),
                //            "RateUnit": $('#RateUnit--' + i).val(),
                //            "AltUnit": $('#altunit--' + i).val(),
                //            "NoOfCase": $('#NoofCase--' + i).val(),
                //            "BillQty": $('#BillQty--' + i).val(),
                //            "RecQty": $('#RecQty--' + i).val(),
                //            "AltRecQty": $('#AltRecQty--' + i).val(),
                //            "ShortExcessQty": $('#ShortExcessQty--' + i).val(),
                //            "Rate": $('#Rate--' + i).val(),
                //            "RateinOther": $('#RateInOtherCurr--' + i).val(),
                //            "Amount": $('#Amount--' + i).val(),
                //            "PendPOQty": $('#PendPOQty--' + i).val(),
                //            "QCCompleted": $('#QCCompleted--' + i).val(),
                //            "RetChallanPendQty": $('#RetChallanPendQty--' + i).val(),
                //            "BatchWise": $('#Batchwise--' + i).val(),
                //            "SaleBillNo": $('#SaleBillNo--' + i).val(),
                //            "SaleBillYearCode": $('#SaleBillYearCode--' + i).val(),
                //            "AgainstChallanNo": $('#AgainstChallanNo--' + i).val(),
                //            "BatchNo": $('#BatchNo--' + i).val(),
                //            "UniqueBatchNo": $('#Uniquebatchno--' + i).val(),
                //            "SupplierBatchNo": $('#SupplierBatchNo--' + i).val(),
                //            "ShelfLife": $('#ShelfLife--' + i).val(),
                //            "ItemSize": $('#ItemSize--' + i).val(),
                //            "ItemColor": $('#ItemColor--' + i).val(),
                //            "ItemNumber": $('#ItemCode--' + i).val(),
                //            "BeforeAdd": $('#BeforeAdd--').val(),
                //            "Mode": $('#hiddenMode').val()
                //        });
                //    }
                //}
                //else {
                var rowCount = $('#divMRNGrid tr').length;

                var ItemData = [];
                for (let i = 1; i <= rowCount; i++) {
                    var pono = '#PONo' + i;

                    ItemData.push({
                        "PONO": $('#PONo' + i).val(),
                        "PoYearCode": $('#POYearCode' + i).val(),
                        "SchNo": $('#SchNo' + i).val(),
                        "SchYearCode": $('#SchYearCode' + i).val(),
                        "PoType": $('#POType' + i).val(),
                        "PODate": $('#PODate' + i).val(),
                        "ItemName": $('#Item_Name' + i).val(),
                        "PartCode": $('#PartCode' + i).val(),
                        "Unit": $('#unit' + i).val(),
                        "Qty": $('#Qty' + i).val(),
                        "AltQty": $('#altqty' + i).val(),
                        "RateUnit": $('#RateUnit' + i).val(),
                        "AltUnit": $('#altunit' + i).val(),
                        "NoOfCase": $('#NoofCase' + i).val(),
                        "BillQty": $('#BillQty' + i).val(),
                        "RecQty": $('#RecQty' + i).val(),
                        "AltRecQty": $('#AltRecQty' + i).val(),
                        "ShortExcessQty": $('#ShortExcessQty' + i).val(),
                        "Rate": $('#Rate' + i).val(),
                        "RateinOther": $('#RateInOtherCurr' + i).val(),
                        "Amount": $('#Amount' + i).val(),
                        "PendPOQty": $('#PendPOQty' + i).val(),
                        "QCCompleted": $('#QCCompleted' + i).val(),
                        "RetChallanPendQty": $('#RetChallanPendQty' + i).val(),
                        "BatchWise": $('#Batchwise' + i).val(),
                        "SaleBillNo": $('#SaleBillNo' + i).val(),
                        "SaleBillYearCode": $('#SaleBillYearCode' + i).val(),
                        "AgainstChallanNo": $('#AgainstChallanNo' + i).val(),
                        "BatchNo": $('#BatchNo' + i).val(),
                        "UniqueBatchNo": $('#Uniquebatchno' + i).val(),
                        "SupplierBatchNo": $('#SupplierBatchNo' + i).val(),
                        "ShelfLife": $('#ShelfLife' + i).val(),
                        "ItemSize": $('#ItemSize' + i).val(),
                        "ItemColor": $('#ItemColor' + i).val(),
                        "ItemNumber": $('#ItemCode' + i).val(),
                        "ItemCode": $('#ItemCode' + i).val(),
                        "VendorBatchMand": $('#VendorBatchMand' + i).val(),
                        "BeforeAdd": $('#BeforeAdd').val()
                    });
                }
                //}

                $.ajax({
                    url: "@Url.Action("AddMaterialReceiptDetail")",
                    type: "POST",
                    data: { model: ItemData },
                    beforeSend: function (xhr) {

                    },
                    success: function (data, status, xhr) {


                        if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                            $.notify('Duplicate Item Not Allowed.', "info");
                            $('.GridButton').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                        }
                        else if (xhr.status == 205 && (xhr.responseText.indexOf('Reset') || xhr.statusText.indexOf('Reset'))) {
                            $.notify('Adding Item Not Allowed, Please Clear Tax Detail...!!!', "info");
                        }
                        else {
                            $('#divMRNGridAdd').html(data);
                            $('#divMRNGrid').empty();
                            var RowCount = $('#divMRNGridAdd tr').length;
                            var errorCount = 0;
                            for (let i = 1; i <= RowCount; i++) {
                                if ($('#VendorBatchMand-' + i).val() == "Y") {
                                    $('.' + i).css("color", "red");
                                }
                            }
                            $.notify('Item Added To Grid.', "success");
                        }
                        $('.BatchDetail').fadeIn();
                    },
                    error: function (result, status, xhr) {
                        $.notify(result.responseText, "error");
                    },
                    failure: function (result, status, xhr) {
                        alert(response.responseText);
                    },
                    complete: function () {

                        $('.Schedule').fadeIn();
                        //$('.ItemBtn').html('<span role="status"><i class="fa-solid fa-angles-down fa-fw fa-lg"></i> ADD TO GRID</span>').prop("disabled", false);
                    }
                }).done(function () {

                }).fail(function () {
                    alert("error");;
                }).always(function () {

                });

            });

            function RecQtyChange(id) {

                var billQty = parseInt($('#BillQty' + id).val());
                var recQty = parseInt($('#RecQty' + id).val());

                $('#ShortExcessQty' + id).val(Math.abs(billQty - recQty));
                AltRecUnitConversion($('#ItemCode' + id).val(), $('#RecQty' + id).val(), id);
            }

            function BillQtyChange(id) {

                var billQty = parseInt($('#BillQty' + id).val());
                var recQty = parseInt($('#RecQty' + id).val());

                $('#ShortExcessQty' + id).val(Math.abs(billQty - recQty));
            }

            async function EditItemRow(SeqNo) {
                //var PartCode = $('#PartCode').val();
                var upperRowCount = $('#divMRNGrid tr').length;
                if (upperRowCount == 0) {
                    $.ajax({
                        url: '@Url.Action("EditItemRow")',
                        type: "POST",
                        data: { SeqNo: SeqNo },
                        success: await function (data, status, xhr) {
                            if (data === "Duplicate" && (xhr.statusCode === 207 || xhr.responseText === "Duplicate")) {
                                $.notify("If Same Tax Exists, Item Cannot Be Edited...!", "warning");
                            }
                            else {
                                ;
                                var obj = $.parseJSON(data);
                                DeleteItemRow(SeqNo);
                                $('#divMRNGrid').empty();
                                var i = 1;
                                var html = '';
                                if (obj != null && obj.length == 1) {
                                    html += '<tr><td><input type="hidden" id="VendorBatchMand' + i + '" value=' + obj[0].VendorBatchMand + ' /><input readonly id="PONo' + i + '" value=' + obj[0].PONO + '  ></td><td><input style="width:50px" id="POYearCode' + i + '" value=' + obj[0].PoYearCode + ' readonly ></td><td><input style="width:80px" id="SchNo' + i + '" value=' + obj[0].SchNo + ' readonly ></td><td><input style="width:50px" id="SchYearCode' + i + '" value=' + obj[0].SchYearCode + ' readonly ></td><td><input style="width:70px" id="POType' + i + '" readonly value=' + obj[0].PoType + '  ></td><td><input style="width:80px" id="PODate' + i + '" value=' + obj[0].PODate + ' readonly ></td><td><input id="Item_Name' + i + '" value=' + JSON.stringify(obj[0].ItemName) + ' readonly ></td><td><input style="width:100px !important;" id="PartCode' + i + '" value=' + obj[0].PartCode + ' readonly ></td><td><input style="width:50px" id="unit' + i + '" value=' + obj[0].Unit + ' readonly ></td><td><input style="width:50px" id="Qty' + i + '" value=' + obj[0].Qty + ' readonly ></td><td><input style="width:50px" readonly id="BillQty' + i + '" onchange="BillQtyChange(' + i + ');" value=' + obj[0].BillQty + ' ></td><td><input style="width:50px;background-color:#ffd6dd !important" id="RecQty' + i + '" onchange="RecQtyChange(' + i + ');" value=' + obj[0].RecQty + ' ></td><td><input style="width:70px" id="altqty' + i + '" value=' + obj[0].AltQty + ' readonly ></td><td><input style="width:50px" id="RateUnit' + i + '" readonly value=' + obj[0].RateUnit + ' ></td><td><input style="width:50px" id="altunit' + i + '" value="' + obj[0].AltUnit + '" readonly ></td><td><input style="width:50px" id="NoofCase' + i + '" value=' + obj[0].NoOfCase + ' readonly ></td><td><input id="AltRecQty' + i + '" value=' + obj[0].AltRecQty + ' ></td><td><input id="ShortExcessQty' + i + '" readonly value=' + obj[0].ShortExcessQty + ' ></td><td><input id="Rate' + i + '" value=' + obj[0].Rate + ' ></td><td><input id="RateInOtherCurr' + i + '" readonly value=' + obj[0].RateinOther + ' ></td><td><input id="Amount' + i + '" readonly value=' + obj[0].Amount + ' ></td><td><input id="PendPOQty' + i + '" readonly value=' + obj[0].PendPOQty + ' > </td><td> <input id="QCCompleted' + i + '" readonly value=' + obj[0].QCCompleted + ' ></td><td><input id="RetChallanPendQty' + i + '" readonly value=' + obj[0].RetChallanPendQty + ' ></td><td><input id="BatchWise' + i + '" readonly value=' + obj[0].BatchWise + ' ></td><td><input id="SaleBillNo' + i + '" readonly value=' + obj[0].SaleBillNo + ' ></td><td><input id="SaleBillYearCode' + i + '" readonly value=' + obj[0].SaleBillYearCode + ' ></td><td><input id="AgainstChallanNo' + i + '" readonly value=' + obj[0].AgainstChallanNo + ' ></td><td><input id="BatchNo' + i + '" readonly value=' + obj[0].BatchNo + ' ></td><td><input id="Uniquebatchno' + i + '" readonly value=' + obj[0].UniqueBatchNo + ' ></td><td><input id="SupplierBatchNo' + i + '" readonly value=' + obj[0].SupplierBatchNo + ' > </td><td><input id="ShelfLife' + i + '" readonly value=' + obj[0].ShelfLife + ' ></td><td> <input id="ItemSize' + i + '" readonly value=' + JSON.stringify(obj[0].ItemSize) + ' ></td><td><input id="ItemColor' + i + '" readonly value=' + JSON.stringify(obj[0].ItemColor) + ' ></td><td><input id="ItemCode' + i + '" type="hidden" value=' + obj[0].ItemCode + ' ></td></tr > ';
                                }
                                $('#divMRNGrid').append(html);
                            }

                        },
                        error: function (response) {
                            $.notify(response.responseText, "error");
                        },
                        failure: function (response) {
                            $.notify(response.responseText, "error");
                        }
                    });
                }
                else {
                    $.notify("Please Add all items to below grid first!!", "error");
                }
            }

            function PressBack() {

                sessionStorage.setItem('FromDateBack', $('#FromDateBack').val());
                sessionStorage.setItem('ToDateBack', $('#ToDateBack').val());
                sessionStorage.setItem('GateNoBack', $('#GateNoBack').val());
                sessionStorage.setItem('PartCodeBack', $('#PartCodeBack').val());
                sessionStorage.setItem('ItemNameBack', $('#ItemNameBack').val());
                sessionStorage.setItem('MrnNoBack', $('#MrnNoBack').val());
                sessionStorage.setItem('PoNoBack', $('#PoNoBack').val());
                sessionStorage.setItem('GlobalSearchBack', $('#GlobalSearchBack').val());
                sessionStorage.setItem('DashboardTypeBack', $('#DashboardTypeBack').val());
                sessionStorage.setItem('VendorNameBack', $('#VendorNameBack').val());

                window.history.back();
            }

            function DeleteItemRow(SeqNo) {
                $.ajax({
                    url: '@Url.Action("DeleteItemRow")',
                    type: "POST",
                    data: { "SeqNo": SeqNo },
                    async: false,
                    success: function (data, status, xhr) {
                        $('#divMRNGridAdd').html(data);
                    },
                    error: function (response, status, xhr) {
                        alert(response.responseText);
                        $.notify(response.responseText, "error");
                    },
                    failure: function (response, status, xhr) {
                        alert(response.responseText);
                        $.notify(response.responseText, "error");
                    }
                });
            }

            async function DeleteBatchItemRow(SeqNo) {
                $.ajax({
                    url: '@Url.Action("DeleteBatchItemRow")',
                    type: "POST",
                    data: { "SeqNo": SeqNo },
                    async: false,
                    success: await function (data, status, xhr) {
                        $('#divDisplayGrid').html(data);
                        CountTotVendBatchQty();
                    },
                    error: function (response, status, xhr) {
                        alert(response.responseText);
                        $.notify(response.responseText, "error");
                    },
                    failure: function (response, status, xhr) {
                        alert(response.responseText);
                        $.notify(response.responseText, "error");
                    }
                });
            }

        </script>

}